---
ms.openlocfilehash: 92210f6becb5a5a43893ee0fd51ef51e2ddd7f8d
ms.sourcegitcommit: dc2feef0794cf41dbac1451a13b8183258566c0e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/24/2020
ms.locfileid: "85325207"
---
### <a name="kestrel-http2-disabled-over-tls-on-incompatible-windows-versions"></a><span data-ttu-id="2c28b-101">Gheppio: HTTP/2 disabilitato su TLS in versioni incompatibili di Windows</span><span class="sxs-lookup"><span data-stu-id="2c28b-101">Kestrel: HTTP/2 disabled over TLS on incompatible Windows versions</span></span>

<span data-ttu-id="2c28b-102">Per abilitare HTTP/2 tramite Transport Layer Security (TLS) in Windows, è necessario soddisfare due requisiti:</span><span class="sxs-lookup"><span data-stu-id="2c28b-102">To enable HTTP/2 over Transport Layer Security (TLS) on Windows, two requirements need to be met:</span></span>

- <span data-ttu-id="2c28b-103">Supporto ALPN (Application-Layer Protocol negotiation), disponibile a partire da Windows 8.1 e Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="2c28b-103">Application-Layer Protocol Negotiation (ALPN) support, which is available starting with Windows 8.1 and Windows Server 2012 R2.</span></span>
- <span data-ttu-id="2c28b-104">Set di crittografie compatibili con HTTP/2, disponibile a partire da Windows 10 e Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="2c28b-104">A set of ciphers compatible with HTTP/2, which is available starting with Windows 10 and Windows Server 2016.</span></span>

<span data-ttu-id="2c28b-105">Di conseguenza, il comportamento di Gheppio quando HTTP/2 su TLS è configurato è stato modificato in:</span><span class="sxs-lookup"><span data-stu-id="2c28b-105">As such, Kestrel's behavior when HTTP/2 over TLS is configured has changed to:</span></span>

- <span data-ttu-id="2c28b-106">Effettuare il downgrade a `Http1` e registrare un messaggio al `Information` livello quando [ListenOptions. HttpProtocols](/dotnet/api/microsoft.aspnetcore.server.kestrel.core.httpprotocols) è impostato su `Http1AndHttp2` .</span><span class="sxs-lookup"><span data-stu-id="2c28b-106">Downgrade to `Http1` and log a message at the `Information` level when [ListenOptions.HttpProtocols](/dotnet/api/microsoft.aspnetcore.server.kestrel.core.httpprotocols) is set to `Http1AndHttp2`.</span></span> <span data-ttu-id="2c28b-107">`Http1AndHttp2` è il valore predefinito di `ListenOptions.HttpProtocols`.</span><span class="sxs-lookup"><span data-stu-id="2c28b-107">`Http1AndHttp2` is the default value for `ListenOptions.HttpProtocols`.</span></span>
- <span data-ttu-id="2c28b-108">Generare un `NotSupportedException` quando `ListenOptions.HttpProtocols` è impostato su `Http2` .</span><span class="sxs-lookup"><span data-stu-id="2c28b-108">Throw a `NotSupportedException` when `ListenOptions.HttpProtocols` is set to `Http2`.</span></span>

<span data-ttu-id="2c28b-109">Per informazioni, vedere Issue [DotNet/aspnetcore # 23068](https://github.com/dotnet/aspnetcore/issues/23068).</span><span class="sxs-lookup"><span data-stu-id="2c28b-109">For discussion, see issue [dotnet/aspnetcore#23068](https://github.com/dotnet/aspnetcore/issues/23068).</span></span>

#### <a name="version-introduced"></a><span data-ttu-id="2c28b-110">Versione introdotta</span><span class="sxs-lookup"><span data-stu-id="2c28b-110">Version introduced</span></span>

<span data-ttu-id="2c28b-111">ASP.NET Core 5,0 Preview 7</span><span class="sxs-lookup"><span data-stu-id="2c28b-111">ASP.NET Core 5.0 Preview 7</span></span>

#### <a name="old-behavior"></a><span data-ttu-id="2c28b-112">Comportamento precedente</span><span class="sxs-lookup"><span data-stu-id="2c28b-112">Old behavior</span></span>

<span data-ttu-id="2c28b-113">La tabella seguente illustra il comportamento quando viene configurato HTTP/2 su TLS.</span><span class="sxs-lookup"><span data-stu-id="2c28b-113">The following table outlines the behavior when HTTP/2 over TLS is configured.</span></span>

| <span data-ttu-id="2c28b-114">Protocolli</span><span class="sxs-lookup"><span data-stu-id="2c28b-114">Protocols</span></span> | <span data-ttu-id="2c28b-115">Windows 7,</span><span class="sxs-lookup"><span data-stu-id="2c28b-115">Windows 7,</span></span><br /><span data-ttu-id="2c28b-116">Windows Server 2008 R2,</span><span class="sxs-lookup"><span data-stu-id="2c28b-116">Windows Server 2008 R2,</span></span><br /><span data-ttu-id="2c28b-117">o versioni precedenti</span><span class="sxs-lookup"><span data-stu-id="2c28b-117">or earlier</span></span> | <span data-ttu-id="2c28b-118">Windows 8,</span><span class="sxs-lookup"><span data-stu-id="2c28b-118">Windows 8,</span></span><br /><span data-ttu-id="2c28b-119">Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="2c28b-119">Windows Server 2012</span></span> | <span data-ttu-id="2c28b-120">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="2c28b-120">Windows 8.1,</span></span><br /><span data-ttu-id="2c28b-121">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="2c28b-121">Windows Server 2012 R2</span></span> | <span data-ttu-id="2c28b-122">Windows 10,</span><span class="sxs-lookup"><span data-stu-id="2c28b-122">Windows 10,</span></span><br /><span data-ttu-id="2c28b-123">Windows Server 2016,</span><span class="sxs-lookup"><span data-stu-id="2c28b-123">Windows Server 2016,</span></span><br /><span data-ttu-id="2c28b-124">o versione successiva</span><span class="sxs-lookup"><span data-stu-id="2c28b-124">or newer</span></span> |
|---------------|-----------------------------------------------|--------------------------------|-------------------------------------|------------------------------------------|
| `Http2`         | <span data-ttu-id="2c28b-125">Generare`NotSupportedException`</span><span class="sxs-lookup"><span data-stu-id="2c28b-125">Throw `NotSupportedException`</span></span>                   | <span data-ttu-id="2c28b-126">Errore durante l'handshake TLS</span><span class="sxs-lookup"><span data-stu-id="2c28b-126">Error during TLS handshake</span></span>     | <span data-ttu-id="2c28b-127">Errore durante l'handshake TLS&ast;</span><span class="sxs-lookup"><span data-stu-id="2c28b-127">Error during TLS handshake &ast;</span></span>     | <span data-ttu-id="2c28b-128">Nessun errore</span><span class="sxs-lookup"><span data-stu-id="2c28b-128">No error</span></span> |
| `Http1AndHttp2` | <span data-ttu-id="2c28b-129">Esegui il downgrade a`Http1`</span><span class="sxs-lookup"><span data-stu-id="2c28b-129">Downgrade to `Http1`</span></span>                    | <span data-ttu-id="2c28b-130">Esegui il downgrade a`Http1`</span><span class="sxs-lookup"><span data-stu-id="2c28b-130">Downgrade to `Http1`</span></span>     | <span data-ttu-id="2c28b-131">Errore durante l'handshake TLS&ast;</span><span class="sxs-lookup"><span data-stu-id="2c28b-131">Error during TLS handshake &ast;</span></span>     | <span data-ttu-id="2c28b-132">Nessun errore</span><span class="sxs-lookup"><span data-stu-id="2c28b-132">No error</span></span> |

<span data-ttu-id="2c28b-133">&ast;Configurare i pacchetti di crittografia compatibili per abilitare questi scenari.</span><span class="sxs-lookup"><span data-stu-id="2c28b-133">&ast; Configure compatible cipher suites to enable these scenarios.</span></span>

#### <a name="new-behavior"></a><span data-ttu-id="2c28b-134">Nuovo comportamento</span><span class="sxs-lookup"><span data-stu-id="2c28b-134">New behavior</span></span>

<span data-ttu-id="2c28b-135">La tabella seguente illustra il comportamento quando viene configurato HTTP/2 su TLS.</span><span class="sxs-lookup"><span data-stu-id="2c28b-135">The following table outlines the behavior when HTTP/2 over TLS is configured.</span></span>

| <span data-ttu-id="2c28b-136">Protocolli</span><span class="sxs-lookup"><span data-stu-id="2c28b-136">Protocols</span></span> | <span data-ttu-id="2c28b-137">Windows 7,</span><span class="sxs-lookup"><span data-stu-id="2c28b-137">Windows 7,</span></span><br /><span data-ttu-id="2c28b-138">Windows Server 2008 R2,</span><span class="sxs-lookup"><span data-stu-id="2c28b-138">Windows Server 2008 R2,</span></span><br /><span data-ttu-id="2c28b-139">o versioni precedenti</span><span class="sxs-lookup"><span data-stu-id="2c28b-139">or earlier</span></span> | <span data-ttu-id="2c28b-140">Windows 8,</span><span class="sxs-lookup"><span data-stu-id="2c28b-140">Windows 8,</span></span><br /><span data-ttu-id="2c28b-141">Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="2c28b-141">Windows Server 2012</span></span> | <span data-ttu-id="2c28b-142">Windows 8.1</span><span class="sxs-lookup"><span data-stu-id="2c28b-142">Windows 8.1,</span></span><br /><span data-ttu-id="2c28b-143">Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="2c28b-143">Windows Server 2012 R2</span></span> | <span data-ttu-id="2c28b-144">Windows 10,</span><span class="sxs-lookup"><span data-stu-id="2c28b-144">Windows 10,</span></span><br /><span data-ttu-id="2c28b-145">Windows Server 2016,</span><span class="sxs-lookup"><span data-stu-id="2c28b-145">Windows Server 2016,</span></span><br /><span data-ttu-id="2c28b-146">o versione successiva</span><span class="sxs-lookup"><span data-stu-id="2c28b-146">or newer</span></span> |
|---------------|-----------------------------------------------|--------------------------------|-------------------------------------|------------------------------------------|
| `Http2`         | <span data-ttu-id="2c28b-147">Generare`NotSupportedException`</span><span class="sxs-lookup"><span data-stu-id="2c28b-147">Throw `NotSupportedException`</span></span>                   | <span data-ttu-id="2c28b-148">Generare`NotSupportedException`</span><span class="sxs-lookup"><span data-stu-id="2c28b-148">Throw `NotSupportedException`</span></span>     | <span data-ttu-id="2c28b-149">Genera `NotSupportedException`&ast;&ast;</span><span class="sxs-lookup"><span data-stu-id="2c28b-149">Throw `NotSupportedException` &ast;&ast;</span></span>     | <span data-ttu-id="2c28b-150">Nessun errore</span><span class="sxs-lookup"><span data-stu-id="2c28b-150">No error</span></span> |
| `Http1AndHttp2` | <span data-ttu-id="2c28b-151">Esegui il downgrade a`Http1`</span><span class="sxs-lookup"><span data-stu-id="2c28b-151">Downgrade to `Http1`</span></span>                    | <span data-ttu-id="2c28b-152">Esegui il downgrade a`Http1`</span><span class="sxs-lookup"><span data-stu-id="2c28b-152">Downgrade to `Http1`</span></span>     | <span data-ttu-id="2c28b-153">Esegui il downgrade a `Http1`&ast;&ast;</span><span class="sxs-lookup"><span data-stu-id="2c28b-153">Downgrade to `Http1` &ast;&ast;</span></span>     | <span data-ttu-id="2c28b-154">Nessun errore</span><span class="sxs-lookup"><span data-stu-id="2c28b-154">No error</span></span> |

<span data-ttu-id="2c28b-155">&ast;&ast;Configurare i pacchetti di crittografia compatibili e impostare l'opzione di contesto dell'app `Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2` su `true` per abilitare questi scenari.</span><span class="sxs-lookup"><span data-stu-id="2c28b-155">&ast;&ast; Configure compatible cipher suites and set the app context switch `Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2` to `true` to enable these scenarios.</span></span>

#### <a name="reason-for-change"></a><span data-ttu-id="2c28b-156">Motivo della modifica</span><span class="sxs-lookup"><span data-stu-id="2c28b-156">Reason for change</span></span>

<span data-ttu-id="2c28b-157">Questa modifica garantisce che gli errori di compatibilità per HTTP/2 su TLS nelle versioni precedenti di Windows vengano esposti il prima e il più chiaramente possibile.</span><span class="sxs-lookup"><span data-stu-id="2c28b-157">This change ensures compatibility errors for HTTP/2 over TLS on older Windows versions are surfaced as early and as clearly as possible.</span></span>

#### <a name="recommended-action"></a><span data-ttu-id="2c28b-158">Azione consigliata</span><span class="sxs-lookup"><span data-stu-id="2c28b-158">Recommended action</span></span>

<span data-ttu-id="2c28b-159">Verificare che HTTP/2 su TLS sia disabilitato nelle versioni di Windows incompatibili.</span><span class="sxs-lookup"><span data-stu-id="2c28b-159">Ensure HTTP/2 over TLS is disabled on incompatible Windows versions.</span></span> <span data-ttu-id="2c28b-160">Windows 8.1 e Windows Server 2012 R2 sono incompatibili perché non dispongono delle crittografie necessarie per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="2c28b-160">Windows 8.1 and Windows Server 2012 R2 are incompatible since they lack the necessary ciphers by default.</span></span> <span data-ttu-id="2c28b-161">Tuttavia, è possibile aggiornare le impostazioni di configurazione del computer per usare le crittografie compatibili con HTTP/2.</span><span class="sxs-lookup"><span data-stu-id="2c28b-161">However, it's possible to update the Computer Configuration settings to use HTTP/2 compatible ciphers.</span></span> <span data-ttu-id="2c28b-162">Per ulteriori informazioni, vedere la pagina relativa ai pacchetti [di crittografia TLS in Windows 8.1](/windows/win32/secauthn/tls-cipher-suites-in-windows-8-1).</span><span class="sxs-lookup"><span data-stu-id="2c28b-162">For more information, see [TLS cipher suites in Windows 8.1](/windows/win32/secauthn/tls-cipher-suites-in-windows-8-1).</span></span> <span data-ttu-id="2c28b-163">Dopo la configurazione, è necessario abilitare HTTP/2 su TLS in gheppio impostando il cambio di contesto dell'app `Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2` .</span><span class="sxs-lookup"><span data-stu-id="2c28b-163">Once configured, HTTP/2 over TLS on Kestrel must be enabled by setting the app context switch `Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2`.</span></span> <span data-ttu-id="2c28b-164">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="2c28b-164">For example:</span></span>

```csharp
AppContext.SetSwitch("Microsoft.AspNetCore.Server.Kestrel.EnableWindows81Http2", true);
```

<span data-ttu-id="2c28b-165">Nessun supporto sottostante modificato.</span><span class="sxs-lookup"><span data-stu-id="2c28b-165">No underlying support has changed.</span></span> <span data-ttu-id="2c28b-166">Ad esempio, HTTP/2 su TLS non ha mai funzionato in Windows 8 o Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="2c28b-166">For example, HTTP/2 over TLS has never worked on Windows 8 or Windows Server 2012.</span></span> <span data-ttu-id="2c28b-167">Questa modifica modifica la modalità di presentazione degli errori in questi scenari non supportati.</span><span class="sxs-lookup"><span data-stu-id="2c28b-167">This change modifies how errors in these unsupported scenarios are presented.</span></span>

#### <a name="category"></a><span data-ttu-id="2c28b-168">Category</span><span class="sxs-lookup"><span data-stu-id="2c28b-168">Category</span></span>

<span data-ttu-id="2c28b-169">ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2c28b-169">ASP.NET Core</span></span>

#### <a name="affected-apis"></a><span data-ttu-id="2c28b-170">API interessate</span><span class="sxs-lookup"><span data-stu-id="2c28b-170">Affected APIs</span></span>

<span data-ttu-id="2c28b-171">Nessuno</span><span class="sxs-lookup"><span data-stu-id="2c28b-171">None</span></span>

<!--

#### Affected APIs

Not detectable via API analysis

-->
