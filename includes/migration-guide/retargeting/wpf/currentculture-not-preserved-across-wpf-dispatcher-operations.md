---
ms.openlocfilehash: bd656478a55856e676853e57f3e7386ea0aa0211
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614826"
---
### <a name="currentculture-is-not-preserved-across-wpf-dispatcher-operations"></a><span data-ttu-id="ecfce-101">CurrentCulture non viene mantenuto nelle operazioni Dispatcher di WPF</span><span class="sxs-lookup"><span data-stu-id="ecfce-101">CurrentCulture is not preserved across WPF Dispatcher operations</span></span>

#### <a name="details"></a><span data-ttu-id="ecfce-102">Dettagli</span><span class="sxs-lookup"><span data-stu-id="ecfce-102">Details</span></span>

<span data-ttu-id="ecfce-103">A partire da .NET Framework 4.6, le modifiche apportate a <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> o <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> all'interno di un <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> vanno perdute al termine dell'operazione del dispatcher.</span><span class="sxs-lookup"><span data-stu-id="ecfce-103">Beginning in the .NET Framework 4.6, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made within a <xref:System.Windows.Threading.Dispatcher?displayProperty=fullName> will be lost at the end of that dispatcher operation.</span></span> <span data-ttu-id="ecfce-104">In modo analogo, le modifiche apportate a <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> o <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> all'esterno di un'operazione di Dispatcher potrebbero non essere disponibili quando viene eseguita l'operazione. In pratica, ciò significa che le modifiche <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> potrebbero non essere trasferite tra i callback UI di WPF e altro codice in un'applicazione WPF. Questo è dovuto a una modifica in <xref:System.Threading.ExecutionContext?displayProperty=fullName> in seguito alla quale <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> vengono archiviati nel contesto di esecuzione a partire dalle app destinate a .NET Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="ecfce-104">Similarly, changes to <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> made outside of a Dispatcher operation may not be reflected when that operation executes.Practically speaking, this means that <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> changes may not flow between WPF UI callbacks and other code in a WPF application.This is due to a change in <xref:System.Threading.ExecutionContext?displayProperty=fullName> that causes <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> to be stored in the execution context beginning with apps targeting the .NET Framework 4.6.</span></span> <span data-ttu-id="ecfce-105">Le operazioni del dispatcher WPF archiviano il contesto di esecuzione usato per avviare l'operazione e ripristinano il contesto precedente dopo il completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="ecfce-105">WPF dispatcher operations store the execution context used to begin the operation and restore the previous context when the operation is completed.</span></span> <span data-ttu-id="ecfce-106">Dato che <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> fanno ora parte di tale contesto, le modifiche di questi elementi all'interno di un'operazione di Dispatcher non vengono mantenute all'esterno dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="ecfce-106">Because <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are now part of that context, changes to them within a dispatcher operation are not persisted outside of the operation.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="ecfce-107">Suggerimento</span><span class="sxs-lookup"><span data-stu-id="ecfce-107">Suggestion</span></span>

<span data-ttu-id="ecfce-108">Le app interessate da questa modifica possono risolvere il problema archiviando i valori <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> o <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> desiderati in un campo e controllando che siano impostati i valori corretti di <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> e <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> in tutti i corpi delle operazioni del dispatcher (inclusi i gestori di callback degli eventi dell'interfaccia utente).</span><span class="sxs-lookup"><span data-stu-id="ecfce-108">Apps affected by this change may work around it by storing the desired <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> or <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> in a field and checking in all Dispatcher operation bodies (including UI event callback handlers) that the correct <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName> and <xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> are set.</span></span> <span data-ttu-id="ecfce-109">In alternativa, dato che la modifica di ExecutionContext sottostante questa modifica WPF influisce solo sulle app destinate a .NET Framework 4.6 o versione successiva, è possibile evitare il problema destinando le app a .NET Framework 4.5.2. Anche le app destinate a .NET Framework 4.6 o versioni successive possono evitare il problema impostando la seguente opzione di compatibilità:</span><span class="sxs-lookup"><span data-stu-id="ecfce-109">Alternatively, because the ExecutionContext change underlying this WPF change only affects apps targeting the .NET Framework 4.6 or newer, this break can be avoided by targeting the .NET Framework 4.5.2.Apps that target .NET Framework 4.6 or later can also work around this by setting the following compatibility switch:</span></span>

<pre><code class="lang-csharp">AppContext.SetSwitch(&quot;Switch.System.Globalization.NoAsyncCurrentCulture&quot;, true);&#13;&#10;</code></pre>

<span data-ttu-id="ecfce-110">Il problema è stato risolto da WPF in .NET Framework 4.6.2.</span><span class="sxs-lookup"><span data-stu-id="ecfce-110">This issue has been fixed by WPF in .NET Framework 4.6.2.</span></span> <span data-ttu-id="ecfce-111">È stato risolto anche in .NET Framework 4.6 e 4.6.1 mediante [KB 3139549](https://support.microsoft.com/kb/3139549).</span><span class="sxs-lookup"><span data-stu-id="ecfce-111">It has also been fixed in .NET Frameworks 4.6, 4.6.1 through [KB 3139549](https://support.microsoft.com/kb/3139549).</span></span> <span data-ttu-id="ecfce-112">Le applicazioni destinate a .NET Framework 4.6 o versioni successive otterranno automaticamente il comportamento corretto nelle applicazioni WPF: le proprietà <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName> vengono mantenute tra operazioni Dispatcher.</span><span class="sxs-lookup"><span data-stu-id="ecfce-112">Applications targeting .NET Framework 4.6 or later will automatically get the right behavior in WPF applications - <xref:System.Globalization.CultureInfo.CurrentCulture?displayProperty=fullName>/<xref:System.Globalization.CultureInfo.CurrentUICulture?displayProperty=fullName>) would be preserved across Dispatcher operations.</span></span>

| <span data-ttu-id="ecfce-113">Nome</span><span class="sxs-lookup"><span data-stu-id="ecfce-113">Name</span></span>    | <span data-ttu-id="ecfce-114">Valore</span><span class="sxs-lookup"><span data-stu-id="ecfce-114">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="ecfce-115">Scope</span><span class="sxs-lookup"><span data-stu-id="ecfce-115">Scope</span></span>   | <span data-ttu-id="ecfce-116">Minorenne</span><span class="sxs-lookup"><span data-stu-id="ecfce-116">Minor</span></span>       |
| <span data-ttu-id="ecfce-117">Version</span><span class="sxs-lookup"><span data-stu-id="ecfce-117">Version</span></span> | <span data-ttu-id="ecfce-118">4.6</span><span class="sxs-lookup"><span data-stu-id="ecfce-118">4.6</span></span>         |
| <span data-ttu-id="ecfce-119">Type</span><span class="sxs-lookup"><span data-stu-id="ecfce-119">Type</span></span>    | <span data-ttu-id="ecfce-120">Ridestinazione</span><span class="sxs-lookup"><span data-stu-id="ecfce-120">Retargeting</span></span> |
