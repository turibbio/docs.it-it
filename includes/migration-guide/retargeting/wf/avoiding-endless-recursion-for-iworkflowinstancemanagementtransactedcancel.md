---
ms.openlocfilehash: daf09748e69e70ad982bcee14461b66579f3bb87
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614859"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="9a2c4-101">Evitare la ricorsione infinita per IWorkflowInstanceManagement.TransactedCancel e IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="9a2c4-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

#### <a name="details"></a><span data-ttu-id="9a2c4-102">Dettagli</span><span class="sxs-lookup"><span data-stu-id="9a2c4-102">Details</span></span>

<span data-ttu-id="9a2c4-103">In alcune circostanza quando si usano le API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> per annullare o terminare un'istanza del servizio del flusso di lavoro, nell'istanza del flusso di lavoro può verificarsi un overflow dello stack a causa della ricorsione infinita quando il runtime di `Workflow` tenta di rendere persistente l'istanza del servizio nell'ambito dell'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a worklow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the `Workflow` runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="9a2c4-104">Il problema si verifica se l'istanza del flusso di lavoro si trova in uno stato in cui è in attesa del completamento di un'altra richiesta WCF in attesa a un altro servizio.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.</span></span> <span data-ttu-id="9a2c4-105">Le `TransactedCancel` `TransactedTerminate` operazioni e creano elementi di lavoro accodati per l'istanza del servizio flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-105">The `TransactedCancel` and `TransactedTerminate` operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="9a2c4-106">Questi elementi di lavoro non vengono eseguiti nell'ambito dell'elaborazione della richiesta `TransactedCancel/TransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-106">These work items are not executed as part of the processing of the `TransactedCancel/TransactedTerminate` request.</span></span> <span data-ttu-id="9a2c4-107">Poiché l'istanza del servizio del flusso di lavoro è in attesa del completamento dell'altra richiesta WCF in sospeso, l'elemento di lavoro creato rimane in coda.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-107">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="9a2c4-108">L'operazione `TransactedCancel/TransactedTerminate` viene completata e il controllo torna al client.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-108">The `TransactedCancel/TransactedTerminate` operation completes and control is returned back to the client.</span></span> <span data-ttu-id="9a2c4-109">Quando la transazione associata con l'operazione `TransactedCancel/TransactedTerminate` tenta di eseguire il commit, è necessario che lo stato dell'istanza del servizio del flusso di lavoro sia persistente.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-109">When the transaction associated with the `TransactedCancel/TransactedTerminate` operation attempts to commit, it needs to persist the workflow serivce instance state.</span></span> <span data-ttu-id="9a2c4-110">Tuttavia, la presenza di una richiesta `WCF` in sospeso per l'istanza impedisce al runtime di Workflow di rendere persistente l'istanza del servizio del flusso di lavoro e un ciclo di ricorsione infinito determina l'overflow dello stack. Dal momento che `TransactedCancel` e `TransactedTerminate` creano un elemento di lavoro solo in memoria, l'esistenza di una transazione non produce alcun effetto.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-110">But because there is an outstanding `WCF` request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because `TransactedCancel` and `TransactedTerminate` only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="9a2c4-111">Il rollback della transazione non rimuove l'elemento di lavoro. Per risolvere questo problema, a partire da .NET Framework 4.7.2, è stato introdotto un elemento `AppSetting` che può essere aggiunto al file `web.config/app.config` del servizio del flusso di lavoro che indica a quest'ultimo di ignorare le transazioni per `TransactedCancel` e `TransactedTerminate`.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-111">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an `AppSetting` that can be added to the `web.config/app.config` of the workflow service that tells it to ignore transactions for `TransactedCancel` and `TransactedTerminate`.</span></span> <span data-ttu-id="9a2c4-112">Ciò consente di eseguire il commit della transazione senza attendere che l'istanza del flusso di lavoro venga mantenute.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-112">This allows the transaction to commit without waiting for the workflow instance to persist.</span></span> <span data-ttu-id="9a2c4-113">Il AppSetting di questa funzionalità è denominato `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate` .</span><span class="sxs-lookup"><span data-stu-id="9a2c4-113">The AppSetting for this feature is named `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span></span> <span data-ttu-id="9a2c4-114">Il valore `true` indica che la transazione deve essere ignorata, evitando quindi l'overflow dello stack.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-114">A value of `true` indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="9a2c4-115">Il valore predefinito di AppSetting è `false`, quindi le istanze del servizio del flusso di lavoro esistenti non sono interessate.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-115">The default value of this AppSetting is `false`, so existing workflow service instances are not affected.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="9a2c4-116">Suggerimento</span><span class="sxs-lookup"><span data-stu-id="9a2c4-116">Suggestion</span></span>

<span data-ttu-id="9a2c4-117">Se si usa AppFabric o un altro client <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> e si riscontra un overflow dello stack nell'istanza del servizio del flusso di lavoro quando si tenta di annullare o terminare un'istanza, è possibile aggiungere il codice seguente alla sezione `<appSettings>` del file web.config/app.config per il servizio del flusso di lavoro:</span><span class="sxs-lookup"><span data-stu-id="9a2c4-117">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow serivce instance when trying to cancel or terminate a workflow instance, you can add the following to the `<appSettings>` section of the web.config/app.config file for the workflow service:</span></span>

<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>

<span data-ttu-id="9a2c4-118">Se il problema non si verifica, questa operazione non è necessaria.</span><span class="sxs-lookup"><span data-stu-id="9a2c4-118">If you are not encountering the problem, you do not need to do this.</span></span>

| <span data-ttu-id="9a2c4-119">Nome</span><span class="sxs-lookup"><span data-stu-id="9a2c4-119">Name</span></span>    | <span data-ttu-id="9a2c4-120">Valore</span><span class="sxs-lookup"><span data-stu-id="9a2c4-120">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="9a2c4-121">Scope</span><span class="sxs-lookup"><span data-stu-id="9a2c4-121">Scope</span></span>   | <span data-ttu-id="9a2c4-122">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="9a2c4-122">Edge</span></span>        |
| <span data-ttu-id="9a2c4-123">Version</span><span class="sxs-lookup"><span data-stu-id="9a2c4-123">Version</span></span> | <span data-ttu-id="9a2c4-124">4.7.2</span><span class="sxs-lookup"><span data-stu-id="9a2c4-124">4.7.2</span></span>       |
| <span data-ttu-id="9a2c4-125">Type</span><span class="sxs-lookup"><span data-stu-id="9a2c4-125">Type</span></span>    | <span data-ttu-id="9a2c4-126">Ridestinazione</span><span class="sxs-lookup"><span data-stu-id="9a2c4-126">Retargeting</span></span> |
