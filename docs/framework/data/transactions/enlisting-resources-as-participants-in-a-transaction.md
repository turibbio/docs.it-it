---
title: Integrazione di risorse come partecipanti a una transazione
description: Integrare le risorse come partecipanti in una transazione .NET. Ogni risorsa in una transazione viene gestita da un gestore di risorse, coordinata da una gestione transazioni.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 786a12c2-d530-49f4-9c59-5c973e15a11d
ms.openlocfilehash: c3c777593750b3a4f05ae97ed6e26e19f58e4d72
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141875"
---
# <a name="enlisting-resources-as-participants-in-a-transaction"></a><span data-ttu-id="16239-104">Integrazione di risorse come partecipanti a una transazione</span><span class="sxs-lookup"><span data-stu-id="16239-104">Enlisting Resources as Participants in a Transaction</span></span>

<span data-ttu-id="16239-105">Ogni risorsa che partecipa a una transazione viene gestita dalla gestione risorse, le cui azioni vengono coordinate dalla gestione transazioni.</span><span class="sxs-lookup"><span data-stu-id="16239-105">Each resource participating in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="16239-106">La coordinazione si basa sull'invio di notifiche ai partecipanti che hanno utilizzato la gestione transazioni per integrarsi nella transazione.</span><span class="sxs-lookup"><span data-stu-id="16239-106">The coordination is done through notifications given to subscribers who have enlisted in a transaction through the transaction manager.</span></span>

<span data-ttu-id="16239-107">Questo argomento descrive come integrare una o più risorse in una transazione, nonché i vari tipi di integrazione.</span><span class="sxs-lookup"><span data-stu-id="16239-107">This topic covers how a resource (or multiple resources) can be enlisted in a transaction, as well as the different types of enlistment.</span></span> <span data-ttu-id="16239-108">Il [commit di una transazione in un argomento a fase singola e multifase](committing-a-transaction-in-single-phase-and-multi-phase.md) descrive il modo in cui l'impegno delle transazioni può essere coordinato tra le risorse integrate.</span><span class="sxs-lookup"><span data-stu-id="16239-108">The [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md) topic covers how transaction commitment can be coordinated among enlisted resources.</span></span>

## <a name="enlisting-resources-in-a-transaction"></a><span data-ttu-id="16239-109">Integrazione di risorse in una transazione</span><span class="sxs-lookup"><span data-stu-id="16239-109">Enlisting Resources in a Transaction</span></span>

<span data-ttu-id="16239-110">Per poter partecipare a una determinata transazione, una risorsa deve integrarsi in essa.</span><span class="sxs-lookup"><span data-stu-id="16239-110">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="16239-111">La <xref:System.Transactions.Transaction> classe definisce un set di metodi i cui nomi iniziano con **integrazione** che forniscono questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="16239-111">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="16239-112">I diversi **metodi di integrazione corrispondono** ai diversi tipi di integrazione che può avere un gestore di risorse.</span><span class="sxs-lookup"><span data-stu-id="16239-112">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="16239-113">In particolare, i metodi <xref:System.Transactions.Transaction.EnlistVolatile%2A> vengono utilizzati per le risorse volatili, mentre i metodi <xref:System.Transactions.Transaction.EnlistDurable%2A> vengono utilizzati per le risorse durevoli.</span><span class="sxs-lookup"><span data-stu-id="16239-113">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="16239-114">La durabilità (o la volatilità) di un gestore di risorse ne indica la capacità (o la non capacità) di ripristino in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="16239-114">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="16239-115">I gestori di risorse che supportano il ripristino in caso di errore salvano i dati in modo permanente in un archivio durevole durante la fase 1, ovvero la fase di preparazione. In questo modo, se il gestore di risorse diventa non disponibile, può reintegrarsi nella transazione non appena viene ripristinato e quindi eseguire le azioni appropriate in base alle notifiche ricevute dalla gestione transazioni.</span><span class="sxs-lookup"><span data-stu-id="16239-115">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the TM.</span></span> <span data-ttu-id="16239-116">In generale, i gestori di risorse volatili gestiscono risorse volatili, come nel caso di una struttura di dati in memoria (ad esempio, una tabella hash transazionale in memoria), laddove i gestori di risorse durevoli gestiscono risorse che presentano un archivio di backup permanente, come nel caso di un database con archivio di backup su disco.</span><span class="sxs-lookup"><span data-stu-id="16239-116">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>

<span data-ttu-id="16239-117">Per semplicità, dopo aver deciso se utilizzare il metodo <xref:System.Transactions.Transaction.EnlistDurable%2A> o il metodo <xref:System.Transactions.Transaction.EnlistVolatile%2A> a seconda del supporto di durabilità della risorsa utilizzata, è necessario integrare la risorsa nel protocollo 2PC (2-Phase Commit, commit a due fasi) implementando nel gestore di risorse l'interfaccia <xref:System.Transactions.IEnlistmentNotification>.</span><span class="sxs-lookup"><span data-stu-id="16239-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="16239-118">Per altre informazioni su 2PC, vedere [commit di una transazione in un'unica fase e in più fasi](committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="16239-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>

<span data-ttu-id="16239-119">Un determinato partecipante può integrarsi in uno o più di questi protocolli chiamando più volte i metodi <xref:System.Transactions.Transaction.EnlistDurable%2A> e <xref:System.Transactions.Transaction.EnlistVolatile%2A>.</span><span class="sxs-lookup"><span data-stu-id="16239-119">A single participant can enlist for more than one of these protocols by calling <xref:System.Transactions.Transaction.EnlistDurable%2A> and <xref:System.Transactions.Transaction.EnlistVolatile%2A> multiple times.</span></span>

### <a name="durable-enlistment"></a><span data-ttu-id="16239-120">Integrazione durevole</span><span class="sxs-lookup"><span data-stu-id="16239-120">Durable Enlistment</span></span>

<span data-ttu-id="16239-121">I metodi <xref:System.Transactions.Transaction.EnlistDurable%2A> consentono di integrare un gestore di risorse affinché partecipi alla transazione come risorsa durevole.</span><span class="sxs-lookup"><span data-stu-id="16239-121">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods are used to enlist a resource manager for participation in the transaction as a durable resource.</span></span>  <span data-ttu-id="16239-122">Un gestore di risorse durevoli è in grado di eseguire il ripristino anche se diventa non disponibile durante l'esecuzione di una transazione. Non appena diventa nuovamente disponibile, il gestore di risorse esegue il ripristino reintegrandosi (tramite il metodo <xref:System.Transactions.TransactionManager.Reenlist%2A>) in tutte le transazioni a cui partecipava e per cui non è stato in grado di completare la fase 2. Al termine delle operazioni di ripristino, il gestore di risorse chiama il metodo <xref:System.Transactions.TransactionManager.RecoveryComplete%2A>.</span><span class="sxs-lookup"><span data-stu-id="16239-122">It is expected that if a durable resource manager is brought down in the middle of a transaction, it can perform recovery once it is brought back online by reenlisting (using the <xref:System.Transactions.TransactionManager.Reenlist%2A> method) in all transactions in which it was a participant and did not complete phase 2, and call <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> once it finishes recovery processing.</span></span> <span data-ttu-id="16239-123">Per ulteriori informazioni sul ripristino, vedere [esecuzione del ripristino](performing-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="16239-123">For more information on recovery, see [Performing Recovery](performing-recovery.md).</span></span>

<span data-ttu-id="16239-124">Tutti i metodi <xref:System.Transactions.Transaction.EnlistDurable%2A> accettano come primo parametro un oggetto <xref:System.Guid>.</span><span class="sxs-lookup"><span data-stu-id="16239-124">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods all take a <xref:System.Guid> object as their first parameter.</span></span> <span data-ttu-id="16239-125">L'oggetto <xref:System.Guid> viene utilizzato dalla gestione transazioni per associare un'integrazione durevole a un determinato gestore di risorse.</span><span class="sxs-lookup"><span data-stu-id="16239-125">The <xref:System.Guid> is used by the transaction manager to associate a durable enlistment with a particular resource manager.</span></span> <span data-ttu-id="16239-126">È pertanto estremamente importante che, quando riavviato, un gestore di risorse utilizzi in modo coerente lo stesso oggetto <xref:System.Guid> per identificarsi anche presso più gestori di risorse. In caso contrario, è possibile che la procedura di ripristino abbia esito negativo.</span><span class="sxs-lookup"><span data-stu-id="16239-126">As such, it is imperative that a resource manager consistently uses the same <xref:System.Guid> to identify itself even across different resource managers upon restarting, otherwise the recovery can fail.</span></span>

<span data-ttu-id="16239-127">Il secondo parametro del metodo <xref:System.Transactions.Transaction.EnlistDurable%2A> è un riferimento all'oggetto che il gestore di risorse implementa per ricevere notifiche transazionali.</span><span class="sxs-lookup"><span data-stu-id="16239-127">The second parameter of the <xref:System.Transactions.Transaction.EnlistDurable%2A> method is a reference to the object that the resource manager implements to receive transaction notifications.</span></span> <span data-ttu-id="16239-128">L'overload utilizzato consente di comunicare alla gestione transazioni se il gestore di risorse supporta l'ottimizzazione mediante SPC (Single-Phase Commit, commit monofase).</span><span class="sxs-lookup"><span data-stu-id="16239-128">The overload you use informs the transaction manager whether your resource manager supports the Single Phase Commit (SPC) optimization.</span></span> <span data-ttu-id="16239-129">La maggior parte delle volte si implementerebbe l'interfaccia <xref:System.Transactions.IEnlistmentNotification> per consentire la partecipazione al commit a due fasi.</span><span class="sxs-lookup"><span data-stu-id="16239-129">Most of the time you would implement the <xref:System.Transactions.IEnlistmentNotification> interface to take part in Two-Phase Commit (2PC).</span></span> <span data-ttu-id="16239-130">Tuttavia, se si desidera ottimizzare il processo di commit, è possibile implementare l'interfaccia <xref:System.Transactions.ISinglePhaseNotification> per il commit monofase.</span><span class="sxs-lookup"><span data-stu-id="16239-130">However, if you want to optimize the commit process, you can consider implementing the <xref:System.Transactions.ISinglePhaseNotification> interface for SPC.</span></span> <span data-ttu-id="16239-131">Per ulteriori informazioni su SPC, vedere [commit di una transazione in un'unica fase e multifase](committing-a-transaction-in-single-phase-and-multi-phase.md) e [Ottimizzazione mediante commit a fase singola e notifica a singola fase promuovibile](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="16239-131">For more information on SPC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md) and [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>

<span data-ttu-id="16239-132">Il terzo parametro è un'enumerazione <xref:System.Transactions.EnlistmentOptions> il cui valore può essere <xref:System.Transactions.EnlistmentOptions.None> o <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span><span class="sxs-lookup"><span data-stu-id="16239-132">The third parameter is an <xref:System.Transactions.EnlistmentOptions> enumeration, whose value can be either <xref:System.Transactions.EnlistmentOptions.None> or <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span></span> <span data-ttu-id="16239-133">Se il valore è impostato su <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, l'integrazione può coinvolgere gestori di risorse aggiuntivi non appena viene ricevuta la notifica di preparazione inviata dalla gestione transazioni.</span><span class="sxs-lookup"><span data-stu-id="16239-133">If the value is set to <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, the enlistment may enlist additional resource managers upon receiving the Prepare notification from the transaction manager.</span></span> <span data-ttu-id="16239-134">Si noti tuttavia che per questo tipo di integrazione non è possibile utilizzare l'ottimizzazione mediante SPC.</span><span class="sxs-lookup"><span data-stu-id="16239-134">However, you should be aware that this type of enlistment is not eligible for the Single Phase Commit optimization.</span></span>

### <a name="volatile-enlistment"></a><span data-ttu-id="16239-135">Integrazione volatile</span><span class="sxs-lookup"><span data-stu-id="16239-135">Volatile Enlistment</span></span>

<span data-ttu-id="16239-136">I partecipanti che gestiscono risorse volatili, ad esempio una cache, devono integrarsi mediante i metodi <xref:System.Transactions.Transaction.EnlistVolatile%2A>.</span><span class="sxs-lookup"><span data-stu-id="16239-136">Participants managing volatile resources such as a cache should enlist using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods.</span></span> <span data-ttu-id="16239-137">Tali oggetti potrebbero non essere in grado di conoscere il risultato di una transazione o ripristinare lo stato delle transazioni a cui partecipano a seguito di un errore di sistema.</span><span class="sxs-lookup"><span data-stu-id="16239-137">Such objects might not be able to obtain the outcome of a transaction or recover the state of any transaction they participate in after a system failure.</span></span>

<span data-ttu-id="16239-138">Come già descritto, i gestori di risorse eseguono un'integrazione volatile solo se gestiscono una risorsa in memoria volatile.</span><span class="sxs-lookup"><span data-stu-id="16239-138">As stated previously, a resource manager would make a volatile enlistment if it manages an in-memory, volatile resource.</span></span> <span data-ttu-id="16239-139">Uno dei vantaggi dell'utilizzo del metodo <xref:System.Transactions.Transaction.EnlistVolatile%2A> è che consente di evitare le escalation non necessarie delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="16239-139">One of the benefits of using <xref:System.Transactions.Transaction.EnlistVolatile%2A> is that it does not force an unnecessary escalation of the transaction.</span></span> <span data-ttu-id="16239-140">Per ulteriori informazioni sull'escalation delle transazioni, vedere l'argomento relativo all' [escalation della gestione delle transazioni](transaction-management-escalation.md) .</span><span class="sxs-lookup"><span data-stu-id="16239-140">For more information on transaction escalation, see [Transaction Management Escalation](transaction-management-escalation.md) topic.</span></span> <span data-ttu-id="16239-141">L'integrazione della volatilità implica una differenza nel modo in cui l'integrazione viene gestita dal gestore transazioni, oltre a quanto previsto dal gestore delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="16239-141">Enlisting volatility implies both a difference in how the enlistment is handled by the transaction manager, as well as what is expected of the resource manager by the transaction manager.</span></span> <span data-ttu-id="16239-142">Ciò è dovuto al fatto che il gestore di risorse volatile non esegue alcuna procedura di ripristino.</span><span class="sxs-lookup"><span data-stu-id="16239-142">This is because a volatile resource manager does not perform recovery.</span></span> <span data-ttu-id="16239-143">Ciò a sua volta comporta che i gestori di risorse volatili non chiamano alcun metodo <xref:System.Transactions.Transaction.EnlistVolatile%2A> a cui passare un oggetto <xref:System.Guid>. Ne consegue che i metodi <xref:System.Transactions.TransactionManager.Reenlist%2A> non accettano alcun parametro <xref:System.Guid>.</span><span class="sxs-lookup"><span data-stu-id="16239-143">The <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods do not take a <xref:System.Guid> parameter, because a volatile resource manager does not perform recovery and would not call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method which needs a <xref:System.Guid>.</span></span>

<span data-ttu-id="16239-144">Analogamente alle integrazioni durevoli, la gestione transazioni è in grado di stabilire se il gestore di risorse supporta l'ottimizzazione mediante il protocollo SPC a partire dal metodo di overload utilizzato per eseguire l'integrazione.</span><span class="sxs-lookup"><span data-stu-id="16239-144">As with durable enlistments, whichever overload method you use to enlist denotes to the transaction manager whether your resource manager supports the Single Phase Commit optimization.</span></span> <span data-ttu-id="16239-145">Poiché i gestori delle risorse volatili non eseguono alcuna procedura di ripristino, la fase di preparazione dell'integrazione volatile non prevede alcuna scrittura di informazioni di ripristino.</span><span class="sxs-lookup"><span data-stu-id="16239-145">Since a volatile resource manager cannot perform recovery, no recovery information is written for a volatile enlistment during the Prepare phase.</span></span> <span data-ttu-id="16239-146">Se pertanto si chiama il metodo <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A>, il sistema genera un'eccezione <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="16239-146">Therefore, calling the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> method results in an <xref:System.InvalidOperationException>.</span></span>

<span data-ttu-id="16239-147">Nell'esempio seguente viene mostrato come utilizzare il metodo <xref:System.Transactions.Transaction.EnlistVolatile%2A> per integrare un oggetto come partecipante a una transazione.</span><span class="sxs-lookup"><span data-stu-id="16239-147">The following example shows how to enlist such an object as a participant in a transaction using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> method.</span></span>

[!code-csharp[Tx_Enlist#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_enlist/cs/enlist.cs#1)]
[!code-vb[Tx_Enlist#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_enlist/vb/enlist.vb#1)]

### <a name="optimizing-performance"></a><span data-ttu-id="16239-148">Ottimizzazione delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="16239-148">Optimizing Performance</span></span>

<span data-ttu-id="16239-149">La classe <xref:System.Transactions.Transaction> fornisce inoltre il metodo <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> per eseguire l'integrazione PSPE (Promotable Single Phase Enlistment).</span><span class="sxs-lookup"><span data-stu-id="16239-149">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="16239-150">Grazie a questo meccanismo, un gestore di risorse durevoli può ospitare e "possedere" una transazione di cui in seguito può eseguire l'escalation in modo che venga gestita dal gestore MSDTC, se necessario.</span><span class="sxs-lookup"><span data-stu-id="16239-150">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="16239-151">Per altre informazioni, vedere [ottimizzazione tramite commit a fase singola e notifica a singola fase promuovibile](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="16239-151">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="16239-152">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="16239-152">See also</span></span>

- [<span data-ttu-id="16239-153">Ottimizzazione mediante commit monofase e notifica monofase promuovibile</span><span class="sxs-lookup"><span data-stu-id="16239-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)
- [<span data-ttu-id="16239-154">Commit di una transazione in monofase e multifase</span><span class="sxs-lookup"><span data-stu-id="16239-154">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)
