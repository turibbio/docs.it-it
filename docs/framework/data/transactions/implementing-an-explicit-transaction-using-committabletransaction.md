---
title: Implementazione di una transazione esplicita utilizzando CommittableTransaction
description: Implementare una transazione esplicita usando la classe CommittableTransaction in .NET. Questa classe fornisce un modo esplicito per l'utilizzo di una transazione da parte delle applicazioni.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 29efe5e5-897b-46c2-a35f-e599a273acc8
ms.openlocfilehash: 40001422e665a7dda3fb938c8d57860909525404
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141991"
---
# <a name="implementing-an-explicit-transaction-using-committabletransaction"></a><span data-ttu-id="35d37-104">Implementazione di una transazione esplicita utilizzando CommittableTransaction</span><span class="sxs-lookup"><span data-stu-id="35d37-104">Implementing an Explicit Transaction using CommittableTransaction</span></span>
<span data-ttu-id="35d37-105">A differenza della classe <xref:System.Transactions.CommittableTransaction>, che consente di utilizzare le transazioni in modo implicito, la classe <xref:System.Transactions.TransactionScope> consente di utilizzare le transazioni in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="35d37-105">The <xref:System.Transactions.CommittableTransaction> class provides an explicit way for applications to use a transaction, as opposed to using the <xref:System.Transactions.TransactionScope> class implicitly.</span></span> <span data-ttu-id="35d37-106">Questa classe è utile nelle applicazioni che utilizzano la stessa transazione per più chiamate di funzione o di thread.</span><span class="sxs-lookup"><span data-stu-id="35d37-106">It is useful for applications that want to use the same transaction across multiple function calls or multiple thread calls.</span></span> <span data-ttu-id="35d37-107">A differenza della classe <xref:System.Transactions.TransactionScope>, il writer di applicazione deve chiamare in modo specifico i metodi <xref:System.Transactions.CommittableTransaction.Commit%2A> e <xref:System.Transactions.Transaction.Rollback%2A>, rispettivamente per interrompere la transazione o per eseguirne il commit.</span><span class="sxs-lookup"><span data-stu-id="35d37-107">Unlike the <xref:System.Transactions.TransactionScope> class, the application writer needs to specifically call the <xref:System.Transactions.CommittableTransaction.Commit%2A> and <xref:System.Transactions.Transaction.Rollback%2A> methods in order to commit or abort the transaction.</span></span>  
  
## <a name="overview-of-the-committabletransaction-class"></a><span data-ttu-id="35d37-108">Panoramica sulla classe CommittableTransaction</span><span class="sxs-lookup"><span data-stu-id="35d37-108">Overview of the CommittableTransaction class</span></span>  
 <span data-ttu-id="35d37-109">La classe <xref:System.Transactions.CommittableTransaction> deriva dalla classe <xref:System.Transactions.Transaction> e pertanto ne presenta tutte le funzionalità.</span><span class="sxs-lookup"><span data-stu-id="35d37-109">The <xref:System.Transactions.CommittableTransaction> class derives from the <xref:System.Transactions.Transaction> class, therefore providing all the functionality of the latter.</span></span> <span data-ttu-id="35d37-110">Il metodo <xref:System.Transactions.Transaction.Rollback%2A> della classe <xref:System.Transactions.Transaction> è particolarmente utile e può inoltre essere utilizzato per eseguire il rollback di un oggetto <xref:System.Transactions.CommittableTransaction>.</span><span class="sxs-lookup"><span data-stu-id="35d37-110">Specifically useful is the <xref:System.Transactions.Transaction.Rollback%2A> method on the <xref:System.Transactions.Transaction> class that can also be used to rollback a <xref:System.Transactions.CommittableTransaction> object.</span></span>  
  
 <span data-ttu-id="35d37-111">La classe <xref:System.Transactions.Transaction> è simile alla classe <xref:System.Transactions.CommittableTransaction>. Tuttavia, a differenza di quest'ultima, la prima non prevede alcun metodo `Commit`.</span><span class="sxs-lookup"><span data-stu-id="35d37-111">The  <xref:System.Transactions.Transaction> class is similar to the <xref:System.Transactions.CommittableTransaction> class but does not offer a `Commit` method.</span></span> <span data-ttu-id="35d37-112">Ciò consente di passare l'oggetto di transazione (o i cloni di tale oggetto) agli altri metodi (eventualmente presenti su altri thread) e al contempo controllare il momento in cui viene eseguito il commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-112">This enables you to pass the transaction object (or clones of it) to other methods (potentially on other threads) while still controlling when the transaction is committed.</span></span> <span data-ttu-id="35d37-113">Benché il codice chiamato sia in grado di integrarsi nella transazione e di votare sull'esito di quest'ultima, soltanto il creatore dell'oggetto <xref:System.Transactions.CommittableTransaction> può eseguire il commit della transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-113">The called code is able to enlist and vote on the transaction, but only the creator of the <xref:System.Transactions.CommittableTransaction> object has the ability to commit the transaction.</span></span>  
  
 <span data-ttu-id="35d37-114">Quando si utilizza la classe <xref:System.Transactions.CommittableTransaction> è opportuno tenere presente i punti seguenti.</span><span class="sxs-lookup"><span data-stu-id="35d37-114">You should note the followings when working with the <xref:System.Transactions.CommittableTransaction> class,</span></span>  
  
- <span data-ttu-id="35d37-115">La creazione di una transazione <xref:System.Transactions.CommittableTransaction> non comporta l'impostazione della transazione di ambiente.</span><span class="sxs-lookup"><span data-stu-id="35d37-115">Creating a <xref:System.Transactions.CommittableTransaction> transaction does not set the ambient transaction.</span></span> <span data-ttu-id="35d37-116">Questa transazione deve essere impostata e reimpostata in modo specifico, in modo da garantire che i gestori di risorse possano funzionare nel contesto temporale e transazionale appropriato.</span><span class="sxs-lookup"><span data-stu-id="35d37-116">You need to specifically set and reset the ambient transaction, to ensure that resource managers operate under the right transaction context when appropriate.</span></span> <span data-ttu-id="35d37-117">Per definire la transazione di ambiente corrente è necessario impostare la proprietà statica <xref:System.Transactions.Transaction.Current%2A> dell'oggetto globale <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="35d37-117">The way to set the current ambient transaction is by setting the static <xref:System.Transactions.Transaction.Current%2A> property on the global <xref:System.Transactions.Transaction> object.</span></span>  
  
- <span data-ttu-id="35d37-118">Gli oggetti <xref:System.Transactions.CommittableTransaction> non possono essere riutilizzati.</span><span class="sxs-lookup"><span data-stu-id="35d37-118">A <xref:System.Transactions.CommittableTransaction> object cannot be reused.</span></span> <span data-ttu-id="35d37-119">In particolare, un oggetto <xref:System.Transactions.CommittableTransaction> per cui è stato eseguito il commit o il rollback non può essere utilizzato nuovamente in una transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-119">Once a <xref:System.Transactions.CommittableTransaction> object has been committed or rolled back, it cannot be used again in a transaction.</span></span> <span data-ttu-id="35d37-120">In altre parole, non può essere impostato come contesto della transazione di ambiente corrente.</span><span class="sxs-lookup"><span data-stu-id="35d37-120">That is, it cannot be set as the current ambient transaction context.</span></span>  
  
## <a name="creating-a-committabletransaction"></a><span data-ttu-id="35d37-121">Creazione di una transazione CommittableTransaction</span><span class="sxs-lookup"><span data-stu-id="35d37-121">Creating a CommittableTransaction</span></span>  
 <span data-ttu-id="35d37-122">Nell'esempio seguente viene creata una nuova istanza della classe <xref:System.Transactions.CommittableTransaction> e quindi ne viene eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="35d37-122">The following sample creates a new <xref:System.Transactions.CommittableTransaction> and commits it.</span></span>  
  
 [!code-csharp[Tx_CommittableTx#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_committabletx/cs/committabletxwithsql.cs#1)]
 [!code-vb[Tx_CommittableTx#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_committabletx/vb/committabletxwithsql.vb#1)]  
  
 <span data-ttu-id="35d37-123">La creazione di una transazione <xref:System.Transactions.CommittableTransaction> non comporta l'impostazione automatica del contesto della transazione di ambiente.</span><span class="sxs-lookup"><span data-stu-id="35d37-123">Creating an instance of <xref:System.Transactions.CommittableTransaction> does not automatically set the ambient transaction context.</span></span> <span data-ttu-id="35d37-124">Ne consegue che a tale transazione non può appartenere alcuna operazione di gestore di risorse.</span><span class="sxs-lookup"><span data-stu-id="35d37-124">Therefore, any operation on a resource manager is not part of that transaction.</span></span> <span data-ttu-id="35d37-125">La proprietà statica <xref:System.Transactions.Transaction.Current%2A> dell'oggetto globale <xref:System.Transactions.Transaction> viene utilizzata per impostare o recuperare la transazione di ambiente e l'applicazione deve impostarla manualmente per garantire che i gestori di risorse possano partecipare alla transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-125">The static <xref:System.Transactions.Transaction.Current%2A> property on the global <xref:System.Transactions.Transaction> object is used to set or retrieve the ambient transaction and the application must manually set it to ensure that resource managers can participate in the transaction.</span></span> <span data-ttu-id="35d37-126">È inoltre consigliabile salvare la transazione di ambiente precedente e ripristinarla al termine dell'utilizzo dell'oggetto <xref:System.Transactions.CommittableTransaction>.</span><span class="sxs-lookup"><span data-stu-id="35d37-126">It is also a good practice to save the old ambient transaction and restore it when you finish using the <xref:System.Transactions.CommittableTransaction> object.</span></span>  
  
 <span data-ttu-id="35d37-127">Per eseguire il commit di una transazione è necessario chiamare esplicitamente il metodo <xref:System.Transactions.CommittableTransaction.Commit%2A>.</span><span class="sxs-lookup"><span data-stu-id="35d37-127">To commit the transaction, you need to explicitly call the <xref:System.Transactions.CommittableTransaction.Commit%2A> method.</span></span> <span data-ttu-id="35d37-128">Per eseguire il rollback di una transazione è invece necessario chiamare il metodo <xref:System.Transactions.Transaction.Rollback%2A>.</span><span class="sxs-lookup"><span data-stu-id="35d37-128">For rolling back a transaction, you should call the <xref:System.Transactions.Transaction.Rollback%2A> method.</span></span> <span data-ttu-id="35d37-129">È importante notare che tutte le risorse coinvolte in una transazione <xref:System.Transactions.CommittableTransaction> restano bloccate finché non viene eseguito il commit o il rollback di tale transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-129">It is important to note that until a <xref:System.Transactions.CommittableTransaction> has been committed or rolled back, all the resources involved in that transaction are still locked.</span></span>  
  
 <span data-ttu-id="35d37-130">Un oggetto <xref:System.Transactions.CommittableTransaction> può essere utilizzato per più thread e chiamate di funzione.</span><span class="sxs-lookup"><span data-stu-id="35d37-130">A <xref:System.Transactions.CommittableTransaction> object can be used across function calls and threads.</span></span> <span data-ttu-id="35d37-131">In caso di errore, tuttavia, spetta allo sviluppatore dell'applicazione gestire le eccezioni e chiamare in modo specifico il metodo <xref:System.Transactions.Transaction.Rollback%28System.Exception%29>.</span><span class="sxs-lookup"><span data-stu-id="35d37-131">However, it is up to the application developer to handle exceptions and specifically call the <xref:System.Transactions.Transaction.Rollback%28System.Exception%29> method in case of failures.</span></span>  
  
## <a name="asynchronous-commit"></a><span data-ttu-id="35d37-132">Commit asincrono</span><span class="sxs-lookup"><span data-stu-id="35d37-132">Asynchronous Commit</span></span>  
 <span data-ttu-id="35d37-133">La classe <xref:System.Transactions.CommittableTransaction> fornisce inoltre un meccanismo per eseguire il commit asincrono di una transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-133">The <xref:System.Transactions.CommittableTransaction> class also provides a mechanism for committing a transaction asynchronously.</span></span> <span data-ttu-id="35d37-134">Il commit di una transazione può richiedere molto tempo, in quanto può coinvolgere varie operazioni di accesso al database nonché un'eventuale latenza di rete.</span><span class="sxs-lookup"><span data-stu-id="35d37-134">A transaction commit can take substantial time, as it might involve multiple database access and possible network latency.</span></span> <span data-ttu-id="35d37-135">Nelle applicazioni ad elevata velocità effettiva è essenziale evitare i deadlock. A tale scopo, è possibile utilizzare il commit asincrono per concludere le operazioni transazionali il prima possibile ed eseguire l'operazione di commit come attività in background.</span><span class="sxs-lookup"><span data-stu-id="35d37-135">When you want to avoid deadlocks in high throughput applications, you can use asynchronous commit to finish the transactional work as soon as possible, and run the commit operation as a background task.</span></span> <span data-ttu-id="35d37-136">I metodi <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> e <xref:System.Transactions.CommittableTransaction.EndCommit%2A> della classe <xref:System.Transactions.CommittableTransaction> consentono di raggiungere tale obiettivo.</span><span class="sxs-lookup"><span data-stu-id="35d37-136">The <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> and <xref:System.Transactions.CommittableTransaction.EndCommit%2A> methods of the <xref:System.Transactions.CommittableTransaction> class allow you to do so.</span></span>  
  
 <span data-ttu-id="35d37-137">È possibile chiamare il metodo <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> per avviare la procedura di commit in un thread del pool di thread.</span><span class="sxs-lookup"><span data-stu-id="35d37-137">You can call <xref:System.Transactions.CommittableTransaction.BeginCommit%2A> to dispatch the commit holdup to a thread from the thread pool.</span></span> <span data-ttu-id="35d37-138">È inoltre possibile chiamare il metodo <xref:System.Transactions.CommittableTransaction.EndCommit%2A> per determinare se il commit della transazione è stato effettivamente eseguito.</span><span class="sxs-lookup"><span data-stu-id="35d37-138">You can also call <xref:System.Transactions.CommittableTransaction.EndCommit%2A> to determine if the transaction has actually been committed.</span></span> <span data-ttu-id="35d37-139">Se per qualche motivo il commit della transazione ha avuto esito negativo, il metodo <xref:System.Transactions.CommittableTransaction.EndCommit%2A> genera un'eccezione di transazione.</span><span class="sxs-lookup"><span data-stu-id="35d37-139">If the transaction failed to commit for whatever reason, <xref:System.Transactions.CommittableTransaction.EndCommit%2A> raises a transaction exception.</span></span> <span data-ttu-id="35d37-140">Se al momento della chiamata al metodo <xref:System.Transactions.CommittableTransaction.EndCommit%2A> il commit della transazione non è ancora stato eseguito, il chiamante resta bloccato finché la transazione non viene interrotta o non ne viene eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="35d37-140">If the transaction is not yet committed by the time <xref:System.Transactions.CommittableTransaction.EndCommit%2A> is called, the caller is blocked until the transaction is committed or aborted.</span></span>  
  
 <span data-ttu-id="35d37-141">Il modo più semplice per eseguire un commit asincrono è ricorrere a un metodo callback che viene chiamato al completamento della procedura di commit.</span><span class="sxs-lookup"><span data-stu-id="35d37-141">The easiest way to do an asynchronous commit is by providing a callback method, to be called when committing is finished.</span></span> <span data-ttu-id="35d37-142">Tuttavia, è necessario chiamare il metodo <xref:System.Transactions.CommittableTransaction.EndCommit%2A> sull'oggetto <xref:System.Transactions.CommittableTransaction> inizialmente utilizzato per effettuare la chiamata.</span><span class="sxs-lookup"><span data-stu-id="35d37-142">However, you must call the <xref:System.Transactions.CommittableTransaction.EndCommit%2A> method on the original <xref:System.Transactions.CommittableTransaction> object used to invoke the call.</span></span> <span data-ttu-id="35d37-143">Per ottenere tale oggetto, è possibile abbattuto del parametro *IAsyncResult* del metodo di callback, perché la classe <xref:System.Transactions.CommittableTransaction> implementa la <xref:System.IAsyncResult> classe.</span><span class="sxs-lookup"><span data-stu-id="35d37-143">To obtain that object, you can downcast the *IAsyncResult* parameter of the callback method, since the <xref:System.Transactions.CommittableTransaction> class implements <xref:System.IAsyncResult> class.</span></span>  
  
 <span data-ttu-id="35d37-144">L'esempio seguente illustra come eseguire un commit asincrono.</span><span class="sxs-lookup"><span data-stu-id="35d37-144">The following example shows how an asynchronous commit can be done.</span></span>  
  
```csharp  
public void DoTransactionalWork()  
{  
     Transaction oldAmbient = Transaction.Current;  
     CommittableTransaction committableTransaction = new CommittableTransaction();  
     Transaction.Current = committableTransaction;  
  
     try  
     {  
          /* Perform transactional work here */  
          // No errors - commit transaction asynchronously  
          committableTransaction.BeginCommit(OnCommitted,null);  
     }  
     finally  
     {  
          //Restore the ambient transaction
          Transaction.Current = oldAmbient;  
     }  
}  
void OnCommitted(IAsyncResult asyncResult)  
{  
     CommittableTransaction committableTransaction;  
     committableTransaction = asyncResult as CommittableTransaction;
     Debug.Assert(committableTransaction != null);  
     try  
     {  
          using(committableTransaction)  
          {  
               committableTransaction.EndCommit(asyncResult);  
          }  
     }  
     catch(TransactionException e)  
     {  
          //Handle the failure to commit  
     }  
}  
```  
  
## <a name="see-also"></a><span data-ttu-id="35d37-145">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="35d37-145">See also</span></span>

- [<span data-ttu-id="35d37-146">Implementazione di una transazione implicita utilizzando l'ambito di transazione</span><span class="sxs-lookup"><span data-stu-id="35d37-146">Implementing an Implicit Transaction using Transaction Scope</span></span>](implementing-an-implicit-transaction-using-transaction-scope.md)
- [<span data-ttu-id="35d37-147">Elaborazione delle transazioni</span><span class="sxs-lookup"><span data-stu-id="35d37-147">Transaction Processing</span></span>](index.md)
