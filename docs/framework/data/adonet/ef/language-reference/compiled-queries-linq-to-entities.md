---
title: Query compilate (LINQ to Entities)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a
ms.openlocfilehash: b4594932b6ed21de98faab57d80404a7b763067d
ms.sourcegitcommit: 488aced39b5f374bc0a139a4993616a54d15baf0
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/12/2020
ms.locfileid: "83207909"
---
# <a name="compiled-queries--linq-to-entities"></a><span data-ttu-id="a7f66-102">Query compilate (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="a7f66-102">Compiled queries  (LINQ to Entities)</span></span>

<span data-ttu-id="a7f66-103">Quando si usa un'applicazione che esegue molte volte query strutturalmente simili in Entity Framework, è spesso possibile migliorare le prestazioni compilando la query una volta ed eseguendola più volte con parametri diversi.</span><span class="sxs-lookup"><span data-stu-id="a7f66-103">When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="a7f66-104">Un'applicazione potrebbe ad esempio essere usata per recuperare tutti i clienti di una determinata città, specificata in fase di runtime dall'utente in un modulo.</span><span class="sxs-lookup"><span data-stu-id="a7f66-104">For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.</span></span> <span data-ttu-id="a7f66-105">In LINQ to Entities è supportato l'uso di query compilate per questo scopo.</span><span class="sxs-lookup"><span data-stu-id="a7f66-105">LINQ to Entities supports using compiled queries for this purpose.</span></span>  
  
 <span data-ttu-id="a7f66-106">A partire da .NET Framework 4,5, le query LINQ vengono memorizzate nella cache automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a7f66-106">Starting with .NET Framework 4.5, LINQ queries are cached automatically.</span></span> <span data-ttu-id="a7f66-107">Tuttavia, è comunque possibile usare le query LINQ compilate per ridurre il costo nelle esecuzioni successive e le query compilate possono essere più efficienti di quelle LINQ che vengono memorizzate nella cache automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a7f66-107">However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="a7f66-108">LINQ to Entities le query che applicano l' `Enumerable.Contains` operatore alle raccolte in memoria non vengono memorizzate automaticamente nella cache.</span><span class="sxs-lookup"><span data-stu-id="a7f66-108">LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="a7f66-109">Inoltre, le raccolte in memoria parametrizzazione nelle query LINQ compilate non sono consentite.</span><span class="sxs-lookup"><span data-stu-id="a7f66-109">Also, parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>  
  
 <span data-ttu-id="a7f66-110">La classe <xref:System.Data.Objects.CompiledQuery> consente di compilare e memorizzare nella cache le query da riusare.</span><span class="sxs-lookup"><span data-stu-id="a7f66-110">The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse.</span></span> <span data-ttu-id="a7f66-111">Dal punto di vista concettuale, questa classe contiene un metodo <xref:System.Data.Objects.CompiledQuery> di `Compile` con numerosi overload.</span><span class="sxs-lookup"><span data-stu-id="a7f66-111">Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads.</span></span> <span data-ttu-id="a7f66-112">Chiamare il metodo `Compile` per creare un nuovo delegato che rappresenti la query compilata.</span><span class="sxs-lookup"><span data-stu-id="a7f66-112">Call the `Compile` method to create a new delegate to represent the compiled query.</span></span> <span data-ttu-id="a7f66-113">I metodi `Compile` forniti con un oggetto <xref:System.Data.Objects.ObjectContext> e i valori di parametro restituiscono un delegato che produce un risultato, ad esempio un'istanza di <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="a7f66-113">The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance).</span></span> <span data-ttu-id="a7f66-114">La query viene compilata solo una volta durante la prima esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a7f66-114">The query compiles once during only the first execution.</span></span> <span data-ttu-id="a7f66-115">Le opzioni di merge impostate per la query durante la compilazione non possono essere modificate successivamente.</span><span class="sxs-lookup"><span data-stu-id="a7f66-115">The merge options set for the query at the time of the compilation cannot be changed later.</span></span> <span data-ttu-id="a7f66-116">Una volta compilata la query, è possibile specificare solo parametri di tipo primitivo, ma non è possibile sostituire parti della query che modificano l'oggetto SQL generato.</span><span class="sxs-lookup"><span data-stu-id="a7f66-116">Once the query is compiled, you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.</span></span> <span data-ttu-id="a7f66-117">Per altre informazioni, vedere [Opzioni di merge EF e query compilate](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span><span class="sxs-lookup"><span data-stu-id="a7f66-117">For more information, see [EF Merge Options and Compiled Queries](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span></span>
  
 <span data-ttu-id="a7f66-118">Il LINQ to Entities espressione di query che <xref:System.Data.Objects.CompiledQuery> il `Compile` metodo di compila è rappresentato da uno dei `Func` delegati generici, ad esempio <xref:System.Func%605> .</span><span class="sxs-lookup"><span data-stu-id="a7f66-118">The LINQ to Entities query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>.</span></span> <span data-ttu-id="a7f66-119">L'espressione di query può incapsulare al massimo un parametro `ObjectContext`, un parametro restituito e 16 parametri di query.</span><span class="sxs-lookup"><span data-stu-id="a7f66-119">At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters.</span></span> <span data-ttu-id="a7f66-120">Se sono richiesti più di 16 parametri di query, è possibile creare una struttura le cui proprietà rappresentino tali parametri.</span><span class="sxs-lookup"><span data-stu-id="a7f66-120">If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.</span></span> <span data-ttu-id="a7f66-121">È possibile quindi usare le proprietà sulla struttura nell'espressione di query dopo averle impostate.</span><span class="sxs-lookup"><span data-stu-id="a7f66-121">You can then use the properties on the structure in the query expression after you set the properties.</span></span>  
  
## <a name="example-1"></a><span data-ttu-id="a7f66-122">Esempio 1</span><span class="sxs-lookup"><span data-stu-id="a7f66-122">Example 1</span></span>  
 <span data-ttu-id="a7f66-123">Nell'esempio seguente viene compilata e quindi richiamata una query che accetta un parametro di input <xref:System.Decimal> e restituisce una sequenza di ordini in cui il totale dovuto è maggiore o uguale a 200,00 dollari:</span><span class="sxs-lookup"><span data-stu-id="a7f66-123">The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query 2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]
 [!code-vb[DP L2E Conceptual Examples - compiled query2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  
  
## <a name="example-2"></a><span data-ttu-id="a7f66-124">Esempio 2</span><span class="sxs-lookup"><span data-stu-id="a7f66-124">Example 2</span></span>  
 <span data-ttu-id="a7f66-125">Nell'esempio seguente viene compilata e quindi richiamata una query che restituisce un'istanza di <xref:System.Data.Objects.ObjectQuery%601>:</span><span class="sxs-lookup"><span data-stu-id="a7f66-125">The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  
  
## <a name="example-3"></a><span data-ttu-id="a7f66-126">Esempio 3</span><span class="sxs-lookup"><span data-stu-id="a7f66-126">Example 3</span></span>  
 <span data-ttu-id="a7f66-127">Nell'esempio seguente viene compilata e quindi richiamata una query che restituisce la media del prezzo di listino dei prodotti come valore <xref:System.Decimal>:</span><span class="sxs-lookup"><span data-stu-id="a7f66-127">The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  
  
## <a name="example-4"></a><span data-ttu-id="a7f66-128">Esempio 4</span><span class="sxs-lookup"><span data-stu-id="a7f66-128">Example 4</span></span>  
 <span data-ttu-id="a7f66-129">Nell'esempio seguente viene compilata e quindi richiamata una query che accetta un <xref:System.String> parametro di input e quindi restituisce un oggetto il `Contact` cui indirizzo di posta elettronica inizia con la stringa specificata:</span><span class="sxs-lookup"><span data-stu-id="a7f66-129">The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose email address starts with the specified string:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  
  
## <a name="example-5"></a><span data-ttu-id="a7f66-130">Esempio 5</span><span class="sxs-lookup"><span data-stu-id="a7f66-130">Example 5</span></span>  
 <span data-ttu-id="a7f66-131">Nell'esempio seguente viene compilata e quindi richiamata una query che accetta parametri di input <xref:System.DateTime> e <xref:System.Decimal> e restituisce una sequenza di ordini in cui la data di ordine è successiva all'8 marzo 2003 e il totale dovuto è inferiore a 300,00 dollari:</span><span class="sxs-lookup"><span data-stu-id="a7f66-131">The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]
 [!code-vb[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  
  
## <a name="example-6"></a><span data-ttu-id="a7f66-132">Esempio 6</span><span class="sxs-lookup"><span data-stu-id="a7f66-132">Example 6</span></span>  
 <span data-ttu-id="a7f66-133">Nell'esempio seguente viene compilata e quindi richiamata una query che accetta un parametro di input <xref:System.DateTime> e restituisce una sequenza di ordini in cui la data di ordine è successiva all'8 marzo 2004.</span><span class="sxs-lookup"><span data-stu-id="a7f66-133">The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.</span></span> <span data-ttu-id="a7f66-134">Questa query restituisce le informazioni sull'ordine come sequenza di tipi anonimi.</span><span class="sxs-lookup"><span data-stu-id="a7f66-134">This query returns the order information as a sequence of anonymous types.</span></span> <span data-ttu-id="a7f66-135">I tipi anonimi vengono dedotti dal compilatore, pertanto non è possibile specificare parametri di tipo nel metodo <xref:System.Data.Objects.CompiledQuery>'s `Compile` e il tipo viene definito nella query stessa.</span><span class="sxs-lookup"><span data-stu-id="a7f66-135">Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]
 [!code-vb[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  
  
## <a name="example-7"></a><span data-ttu-id="a7f66-136">Esempio 7</span><span class="sxs-lookup"><span data-stu-id="a7f66-136">Example 7</span></span>  
 <span data-ttu-id="a7f66-137">Nell'esempio seguente viene compilata e quindi richiamata una query che accetta un parametro di input di una struttura definita dall'utente e restituisce una sequenza di ordini</span><span class="sxs-lookup"><span data-stu-id="a7f66-137">The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.</span></span> <span data-ttu-id="a7f66-138">La struttura definisce i parametri di query della data di inizio, della data di fine e del totale dovuto e la query restituisce gli ordini inviati tra il 3 e l'8 marzo 2003 con un totale dovuto maggiore di 700,00 dollari.</span><span class="sxs-lookup"><span data-stu-id="a7f66-138">The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]
 [!code-vb[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  
  
 <span data-ttu-id="a7f66-139">La struttura che definisce i parametri di query:</span><span class="sxs-lookup"><span data-stu-id="a7f66-139">The structure that defines the query parameters:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]
 [!code-vb[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  
  
## <a name="see-also"></a><span data-ttu-id="a7f66-140">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a7f66-140">See also</span></span>

- [<span data-ttu-id="a7f66-141">ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="a7f66-141">ADO.NET Entity Framework</span></span>](../index.md)
- [<span data-ttu-id="a7f66-142">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="a7f66-142">LINQ to Entities</span></span>](linq-to-entities.md)
- [<span data-ttu-id="a7f66-143">Opzioni di Unione EF e query compilate</span><span class="sxs-lookup"><span data-stu-id="a7f66-143">EF Merge Options and Compiled Queries</span></span>](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries)
