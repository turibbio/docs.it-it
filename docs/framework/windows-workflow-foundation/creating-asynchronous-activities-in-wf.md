---
title: Creazione di attività asincrone in WF
description: Informazioni su come creare attività asincrone personalizzate usando AsyncCodeActivity, che consente alle attività derivate di implementare la logica di esecuzione asincrona.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: f7ce0c0157791b34723feff185aed24bb56a4b3f
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/15/2020
ms.locfileid: "83421527"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="dd3c8-103">Creazione di attività asincrone in WF</span><span class="sxs-lookup"><span data-stu-id="dd3c8-103">Creating Asynchronous Activities in WF</span></span>
<span data-ttu-id="dd3c8-104"><xref:System.Activities.AsyncCodeActivity> fornisce agli autori dell'attività una classe di base che consente alle attività derivate di implementare la logica di esecuzione asincrona.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="dd3c8-105">Ciò si rivela utile per attività personalizzate che devono eseguire un lavoro asincrono senza contenere il thread dell'utilità di pianificazione del flusso di lavoro e senza bloccare nessuna attività che può essere eseguita in parallelo.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="dd3c8-106">In questo argomento viene fornita una panoramica su come creare attività asincrone personalizzate usando l'oggetto <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="dd3c8-107">Uso di AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="dd3c8-107">Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="dd3c8-108">L'oggetto <xref:System.Activities?displayProperty=nameWithType> fornisce agli autori dell'attività personalizzata classi di base diverse per requisiti di creazione di attività differenti.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="dd3c8-109">Ognuna presenta una particolare semantica e offre a un autore del flusso di lavoro (e al runtime attività) un contratto corrispondente.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="dd3c8-110">Un'attività basata sull'oggetto <xref:System.Activities.AsyncCodeActivity> è un'attività che esegue un lavoro in modo asincrono relativo al thread dell'utilità di pianificazione e la cui logica di esecuzione viene espressa in codice gestito.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="dd3c8-111">Come conseguenza di tale modalità asincrona, un oggetto <xref:System.Activities.AsyncCodeActivity> può determinare un punto di inattività durante l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="dd3c8-112">A causa della natura volatile del lavoro asincrono, un oggetto <xref:System.Activities.AsyncCodeActivity> crea sempre un blocco di non persistenza per la durata dell'esecuzione dell'attività.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="dd3c8-113">In questo modo si evita che l'esecuzione del flusso di lavoro renda persistente l'istanza del flusso di lavoro durante il lavoro asincrono e si evita anche lo scaricamento dell'istanza del flusso di lavoro mentre il codice asincrono è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="dd3c8-114">Metodi AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="dd3c8-114">AsyncCodeActivity Methods</span></span>  
 <span data-ttu-id="dd3c8-115">Le attività che derivano dall'oggetto <xref:System.Activities.AsyncCodeActivity> possono creare la logica di esecuzione asincrona eseguendo l'override dei metodi <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> con codice personalizzato.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="dd3c8-116">Quando chiamati dal runtime, a questi metodi viene passato un oggetto <xref:System.Activities.AsyncCodeActivityContext>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="dd3c8-117"><xref:System.Activities.AsyncCodeActivityContext>consente all'autore dell'attività di fornire lo stato condiviso attraverso <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> la proprietà del contesto <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> .</span><span class="sxs-lookup"><span data-stu-id="dd3c8-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="dd3c8-118">Nell'esempio seguente un'attività `GenerateRandom` genera in modo asincrono un numero casuale.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="dd3c8-119">L'attività dell'esempio precedente deriva da <xref:System.Activities.AsyncCodeActivity%601> e dispone di un oggetto `OutArgument<int>` elevato denominato `Result`.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="dd3c8-120">Il valore restituito dal metodo `GetRandom` viene estratto e restituito dall'override del metodo <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> e tale valore viene impostato come valore `Result`.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="dd3c8-121">Le attività asincrone che non restituiscono un risultato devono derivare da <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="dd3c8-122">Nell'esempio seguente viene definita un'attività `DisplayRandom` che deriva da <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="dd3c8-123">Questa attività è come l'attività `GetRandom` ma anziché restituire un risultato visualizza un messaggio nella console.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="dd3c8-124">Notare che a causa dell'assenza di un valore restituito, `DisplayRandom` usa <xref:System.Action> anziché <xref:System.Func%602> per richiamare il delegato e il delegato non restituisce alcun valore.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="dd3c8-125">Anche <xref:System.Activities.AsyncCodeActivity> fornisce un override di <xref:System.Activities.AsyncCodeActivity.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="dd3c8-126">Mentre <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> sono override obbligatori, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> è facoltativo e può essere sottoposto a override in modo che l'attività possa pulire il relativo stato asincrono in attesa quando è in fase di annullamento o di interruzione.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="dd3c8-127">Se la pulizia è possibile e l'oggetto `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` è `true`, l'attività deve chiamare il metodo <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="dd3c8-128">Qualsiasi eccezione generata da questo metodo è irreversibile per l'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="dd3c8-129">Richiamo di metodi asincroni su una classe</span><span class="sxs-lookup"><span data-stu-id="dd3c8-129">Invoking Asynchronous Methods on a Class</span></span>  
 <span data-ttu-id="dd3c8-130">Molte delle classi nella .NET Framework forniscono funzionalità asincrone e questa funzionalità può essere richiamata in modo asincrono tramite un' <xref:System.Activities.AsyncCodeActivity> attività basata su.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="dd3c8-131">Nell'esempio seguente viene creata un'attività che crea in modo asincrono un file tramite la <xref:System.IO.FileStream> classe.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="dd3c8-132">Condivisione dello stato tra i metodi BeginExecute e EndExecute</span><span class="sxs-lookup"><span data-stu-id="dd3c8-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  
 <span data-ttu-id="dd3c8-133">Nell'esempio precedente, è stato effettuato l'accesso in <xref:System.IO.FileStream> all'oggetto <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> creato in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="dd3c8-134">Ciò è possibile poiché la variabile `file` è stata passata nella proprietà <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="dd3c8-135">Questo è il metodo corretto per condividere lo stato tra <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="dd3c8-136">È errato usare una variabile membro nella classe derivata (in questo caso `FileWriter`) per condividere lo stato tra <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> e <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> perché più istanze dell'attività possono fare riferimento agli oggetti attività.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="dd3c8-137">Tentare di usare una variabile membro per condividere lo stato può causare la sovrascrittura o la cancellazione di valori da un oggetto <xref:System.Activities.ActivityInstance> a un altro oggetto <xref:System.Activities.ActivityInstance>.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="dd3c8-138">Accesso ai valori degli argomenti</span><span class="sxs-lookup"><span data-stu-id="dd3c8-138">Accessing Argument Values</span></span>  
 <span data-ttu-id="dd3c8-139">L'ambiente di un oggetto <xref:System.Activities.AsyncCodeActivity> è costituito dagli argomenti definiti nell'attività.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="dd3c8-140">È possibile accedere a questi argomenti dalle <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> sostituzioni utilizzando il <xref:System.Activities.AsyncCodeActivityContext> parametro.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="dd3c8-141">L'accesso agli argomenti non può essere eseguito nel delegato, ma i valori dell'argomento o i dati desiderati possono essere passati al delegato usando i relativi parametri.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="dd3c8-142">Nell'esempio seguente viene definita un'attività che genera un numero casuale e ottiene il limite superiore incluso dal relativo argomento `Max`.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="dd3c8-143">Il valore dell'argomento viene passato al codice asincrono quando viene richiamato il delegato.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="dd3c8-144">Azioni di programmazione o attività figlio usando AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="dd3c8-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="dd3c8-145">Le attività personalizzate derivate <xref:System.Activities.AsyncCodeActivity> forniscono un metodo per eseguire il lavoro in modo asincrono rispetto al thread del flusso di lavoro, ma non consentono di pianificare le attività figlio o le azioni.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="dd3c8-146">Tuttavia, il comportamento asincrono può essere incorporato nella pianificazione delle attività figlio tramite la composizione.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="dd3c8-147">Un'attività asincrona può essere creata e quindi composta con un'attività <xref:System.Activities.Activity> o <xref:System.Activities.NativeActivity> derivata per fornire il comportamento asincrono e la pianificazione delle attività figlio o delle azioni.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="dd3c8-148">Ad esempio, è possibile creare un'attività che deriva da <xref:System.Activities.Activity> e ha come implementazione un oggetto <xref:System.Activities.Statements.Sequence> che contiene l'attività asincrona nonché le altre attività che implementano la logica dell'attività.</span><span class="sxs-lookup"><span data-stu-id="dd3c8-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="dd3c8-149">Per altri esempi di composizione di attività usando <xref:System.Activities.Activity> e <xref:System.Activities.NativeActivity> , vedere [procedura: creare un'attività](how-to-create-an-activity.md) e le [Opzioni di creazione di attività](activity-authoring-options-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="dd3c8-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dd3c8-150">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="dd3c8-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>
