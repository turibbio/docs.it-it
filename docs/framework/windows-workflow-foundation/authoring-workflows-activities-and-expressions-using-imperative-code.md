---
title: Creazione di flussi di lavoro, attività ed espressioni tramite codice imperativo
description: Una definizione del flusso di lavoro di Workflow Foundation è un albero di oggetti attività configurati. Utilizzare il codice per creare definizioni, attività ed espressioni del flusso di lavoro.
ms.date: 03/30/2017
ms.assetid: cefc9cfc-2882-4eb9-8c94-7a6da957f2b2
ms.openlocfilehash: d8b4cb8b85d3ea3759d58e15df823a72146772e8
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/15/2020
ms.locfileid: "83421553"
---
# <a name="authoring-workflows-activities-and-expressions-using-imperative-code"></a><span data-ttu-id="cd230-104">Creazione di flussi di lavoro, attività ed espressioni tramite codice imperativo</span><span class="sxs-lookup"><span data-stu-id="cd230-104">Authoring Workflows, Activities, and Expressions Using Imperative Code</span></span>
<span data-ttu-id="cd230-105">Una definizione del flusso di lavoro è un albero degli oggetti attività configurati</span><span class="sxs-lookup"><span data-stu-id="cd230-105">A workflow definition is a tree of configured activity objects.</span></span> <span data-ttu-id="cd230-106">che può essere definita in diversi modi, ad esempio modificando manualmente il codice XAML o usando l'utilità di progettazione del flusso di lavoro per produrre codice XAML.</span><span class="sxs-lookup"><span data-stu-id="cd230-106">This tree of activities can be defined many ways, including by hand-editing XAML or by using the Workflow Designer to produce XAML.</span></span> <span data-ttu-id="cd230-107">L'utilizzo di XAML tuttavia non è un requisito.</span><span class="sxs-lookup"><span data-stu-id="cd230-107">Use of XAML, however, is not a requirement.</span></span> <span data-ttu-id="cd230-108">Le definizioni del flusso di lavoro possono essere create anche a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="cd230-108">Workflow definitions can also be created programmatically.</span></span> <span data-ttu-id="cd230-109">In questo argomento viene fornita una panoramica sulla creazione di definizioni del flusso di lavoro, di attività e di espressioni tramite codice.</span><span class="sxs-lookup"><span data-stu-id="cd230-109">This topic provides an overview of creating workflow definitions, activities, and expressions by using code.</span></span> <span data-ttu-id="cd230-110">Per esempi relativi all'uso di flussi di lavoro XAML tramite codice, vedere [serializzazione di flussi di lavoro e attività da e verso XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-110">For examples of working with XAML workflows using code, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
## <a name="creating-workflow-definitions"></a><span data-ttu-id="cd230-111">Creazione di definizioni del flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="cd230-111">Creating Workflow Definitions</span></span>  
 <span data-ttu-id="cd230-112">È possibile creare una definizione del flusso di lavoro creando un'istanza di un tipo di attività e configurando le proprietà dell'oggetto attività.</span><span class="sxs-lookup"><span data-stu-id="cd230-112">A workflow definition can be created by instantiating an instance of an activity type and configuring the activity object’s properties.</span></span> <span data-ttu-id="cd230-113">Per attività che non contengono attività figlio, questa operazione può essere completata usando alcune righe di codice.</span><span class="sxs-lookup"><span data-stu-id="cd230-113">For activities that do not contain child activities, this can be accomplished using a few lines of code.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#47](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#47)]  
  
> [!NOTE]
> <span data-ttu-id="cd230-114">Negli esempi del presente argomento viene usato <xref:System.Activities.WorkflowInvoker> per l'esecuzione dei flussi di lavoro di esempio.</span><span class="sxs-lookup"><span data-stu-id="cd230-114">The examples in this topic use <xref:System.Activities.WorkflowInvoker> to run the sample workflows.</span></span> <span data-ttu-id="cd230-115">Per ulteriori informazioni sulla chiamata di flussi di lavoro, sul passaggio di argomenti e sulle diverse opzioni di hosting disponibili, vedere [utilizzo di WorkflowInvoker e WorkflowApplication](using-workflowinvoker-and-workflowapplication.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-115">For more information about invoking workflows, passing arguments, and the different hosting choices that are available, see [Using WorkflowInvoker and WorkflowApplication](using-workflowinvoker-and-workflowapplication.md).</span></span>  
  
 <span data-ttu-id="cd230-116">In questo esempio viene creato un flusso di lavoro che è costituito da una singola attività <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="cd230-116">In this example, a workflow that consists of a single <xref:System.Activities.Statements.WriteLine> activity is created.</span></span> <span data-ttu-id="cd230-117">L'argomento <xref:System.Activities.Statements.WriteLine> dell'attività <xref:System.Activities.Statements.WriteLine.Text%2A> viene impostato e il flusso di lavoro viene richiamato.</span><span class="sxs-lookup"><span data-stu-id="cd230-117">The <xref:System.Activities.Statements.WriteLine> activity’s <xref:System.Activities.Statements.WriteLine.Text%2A> argument is set, and the workflow is invoked.</span></span> <span data-ttu-id="cd230-118">Se un'attività contiene attività figlio, il metodo di costruzione è simile.</span><span class="sxs-lookup"><span data-stu-id="cd230-118">If an activity contains child activities, the method of construction is similar.</span></span> <span data-ttu-id="cd230-119">Nell'esempio seguente viene usata un'attività <xref:System.Activities.Statements.Sequence> che contiene due attività <xref:System.Activities.Statements.WriteLine>.</span><span class="sxs-lookup"><span data-stu-id="cd230-119">The following example uses a <xref:System.Activities.Statements.Sequence> activity that contains two <xref:System.Activities.Statements.WriteLine> activities.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#48](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#48)]  
  
### <a name="using-object-initializers"></a><span data-ttu-id="cd230-120">Uso di inizializzatori di oggetti</span><span class="sxs-lookup"><span data-stu-id="cd230-120">Using Object Initializers</span></span>  
 <span data-ttu-id="cd230-121">Negli esempi di questo argomento viene usata la sintassi di inizializzazione oggetti</span><span class="sxs-lookup"><span data-stu-id="cd230-121">The examples in this topic use object initialization syntax.</span></span> <span data-ttu-id="cd230-122">che può essere utile per creare definizioni del flusso di lavoro in codice in quanto fornisce una visualizzazione gerarchica delle attività nel flusso di lavoro e consente di illustrare la relazione tra le attività.</span><span class="sxs-lookup"><span data-stu-id="cd230-122">Object initialization syntax can be a useful way to create workflow definitions in code because it provides a hierarchical view of the activities in the workflow and shows the relationship between the activities.</span></span> <span data-ttu-id="cd230-123">Non è previsto alcun requisito per usare la sintassi di inizializzazione oggetti quando si creano flussi di lavoro a livello di codice.</span><span class="sxs-lookup"><span data-stu-id="cd230-123">There is no requirement to use object initialization syntax when you programmatically create workflows.</span></span> <span data-ttu-id="cd230-124">L'esempio seguente rappresenta l'equivalente funzionale dell'esempio precedente.</span><span class="sxs-lookup"><span data-stu-id="cd230-124">The following example is functionally equivalent to the previous example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#49](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#49)]  
  
 <span data-ttu-id="cd230-125">Per altre informazioni sugli inizializzatori di oggetto, vedere [procedura: inizializzare oggetti senza chiamare un costruttore (Guida per programmatori C#)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) e [procedura: dichiarare un oggetto usando un inizializzatore di oggetto](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-125">For more information about object initializers, see [How to: Initialize Objects without Calling a Constructor (C# Programming Guide)](../../csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer.md) and [How to: Declare an Object by Using an Object Initializer](../../visual-basic/programming-guide/language-features/objects-and-classes/how-to-declare-an-object-by-using-an-object-initializer.md).</span></span>  
  
### <a name="working-with-variables-literal-values-and-expressions"></a><span data-ttu-id="cd230-126">Uso di variabili, valori letterali ed espressioni</span><span class="sxs-lookup"><span data-stu-id="cd230-126">Working with Variables, Literal Values, and Expressions</span></span>  
 <span data-ttu-id="cd230-127">Quando si crea una definizione del flusso di lavoro tramite codice, prestare attenzione a quale parte di codice viene eseguita per la creazione della definizione del flusso di lavoro e a quale invece per l'esecuzione di un'istanza di quel flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-127">When creating a workflow definition using code, be aware of what code executes as part of the creation of the workflow definition and what code executes as part of the execution of an instance of that workflow.</span></span> <span data-ttu-id="cd230-128">Ad esempio il flusso di lavoro seguente viene usato per generare un numero casuale e scriverlo nella console.</span><span class="sxs-lookup"><span data-stu-id="cd230-128">For example, the following workflow is intended to generate a random number and write it to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#50](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#50)]  
  
 <span data-ttu-id="cd230-129">Quando viene eseguito questo codice di definizione del flusso di lavoro, viene effettuata la chiamata all'oggetto `Random.Next` e il risultato viene archiviato nella definizione del flusso di lavoro come valore letterale.</span><span class="sxs-lookup"><span data-stu-id="cd230-129">When this workflow definition code is executed, the call to `Random.Next` is made and the result is stored in the workflow definition as a literal value.</span></span> <span data-ttu-id="cd230-130">È possibile richiamare molte istanze di questo flusso di lavoro e tutte vengono visualizzate con lo stesso numero.</span><span class="sxs-lookup"><span data-stu-id="cd230-130">Many instances of this workflow can be invoked, and all would display the same number.</span></span> <span data-ttu-id="cd230-131">Per la generazione di numeri casuali durante l'esecuzione del flusso di lavoro, è necessario usare un'espressione che viene valutata ad ogni esecuzione del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-131">To have the random number generation occur during workflow execution, an expression must be used that is evaluated each time the workflow runs.</span></span> <span data-ttu-id="cd230-132">Nell'esempio seguente riportato di seguito viene usata un'espressione di Visual Basic con un elemento <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-132">In the following example, a Visual Basic expression is used with a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="cd230-133">L'espressione nell'esempio precedente poteva essere distribuita anche usando un elemento <xref:Microsoft.CSharp.Activities.CSharpValue%601> e un'espressione C#.</span><span class="sxs-lookup"><span data-stu-id="cd230-133">The expression in the previous example could also be implemented using a <xref:Microsoft.CSharp.Activities.CSharpValue%601> and a C# expression.</span></span>  
  
```csharp  
new Assign<int>  
{  
    To = n,  
    Value = new CSharpValue<int>("new Random().Next(1, 101)")  
}  
```  
  
 <span data-ttu-id="cd230-134">Le espressioni C# devono essere compilate prima che il flusso di lavoro che le contiene venga richiamato.</span><span class="sxs-lookup"><span data-stu-id="cd230-134">C# expressions must be compiled before the workflow containing them is invoked.</span></span> <span data-ttu-id="cd230-135">Se le espressioni C# non vengono compilate, <xref:System.NotSupportedException> viene generata un'eccezione quando il flusso di lavoro viene richiamato con un messaggio simile al seguente: ``Expression Activity type 'CSharpValue`1' requires compilation in order to run.  Please ensure that the workflow has been compiled.`` nella maggior parte degli scenari che coinvolgono i flussi di lavoro creati in Visual Studio le espressioni c# vengono compilate automaticamente, ma in alcuni scenari, ad esempio i flussi di lavoro di codice, le espressioni c# devono essere compilate manualmente.</span><span class="sxs-lookup"><span data-stu-id="cd230-135">If the C# expressions are not compiled, a <xref:System.NotSupportedException> is thrown when the workflow is invoked with a message similar to the following: ``Expression Activity type 'CSharpValue`1' requires compilation in order to run.  Please ensure that the workflow has been compiled.`` In most scenarios involving workflows created in Visual Studio the C# expressions are compiled automatically, but in some scenarios, such as code workflows, the C# expressions must be manually compiled.</span></span> <span data-ttu-id="cd230-136">Per un esempio di come compilare espressioni C#, vedere la sezione [uso di espressioni c# nei flussi di lavoro del codice](csharp-expressions.md#CodeWorkflows) dell'argomento [espressioni di c#](csharp-expressions.md) .</span><span class="sxs-lookup"><span data-stu-id="cd230-136">For an example of how to compile C# expressions, see the [Using C# expressions in code workflows](csharp-expressions.md#CodeWorkflows) section of the [C# Expressions](csharp-expressions.md) topic.</span></span>  
  
 <span data-ttu-id="cd230-137"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> rappresenta un'espressione nella sintassi di Visual Basic che può essere usata come r-value in un'espressione e <xref:Microsoft.CSharp.Activities.CSharpValue%601> rappresenta un'espressione nella sintassi di C# che può essere usata come r-value in un'espressione.</span><span class="sxs-lookup"><span data-stu-id="cd230-137">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> represents an expression in Visual Basic syntax that can be used as an r-value in an expression, and a <xref:Microsoft.CSharp.Activities.CSharpValue%601> represents an expression in C# syntax that can be used as an r-value in an expression.</span></span> <span data-ttu-id="cd230-138">Queste espressioni vengono valutate ad ogni esecuzione dell'attività che le contiene.</span><span class="sxs-lookup"><span data-stu-id="cd230-138">These expressions are evaluated each time the containing activity is executed.</span></span> <span data-ttu-id="cd230-139">Il risultato dell'espressione viene assegnato alla variabile `n` del flusso di lavoro e questi risultati vengono utilizzati dalla successiva attività nel flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-139">The result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="cd230-140">Per accedere al valore della variabile `n` del flusso di lavoro in fase di esecuzione, è necessario l'oggetto <xref:System.Activities.ActivityContext></span><span class="sxs-lookup"><span data-stu-id="cd230-140">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="cd230-141">al quale è possibile accedere tramite l'espressione lambda seguente.</span><span class="sxs-lookup"><span data-stu-id="cd230-141">This can be accessed by using the following lambda expression.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="cd230-142">Si noti che entrambi i codici di esempio usano C# come linguaggio di programmazione, ma uno usa un oggetto <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> e l'altro usa un oggetto <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-142">Note that both of these code are examples are using C# as the programming language, but one uses a <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and one uses a <xref:Microsoft.CSharp.Activities.CSharpValue%601>.</span></span> <span data-ttu-id="cd230-143"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> e <xref:Microsoft.CSharp.Activities.CSharpValue%601> possono essere usati sia nei progetti C# che in progetti Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="cd230-143"><xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> and <xref:Microsoft.CSharp.Activities.CSharpValue%601> can be used in both Visual Basic and C# projects.</span></span> <span data-ttu-id="cd230-144">Per impostazione predefinita, le espressioni create nella finestra di progettazione del flusso di lavoro corrispondono al linguaggio del progetto di hosting.</span><span class="sxs-lookup"><span data-stu-id="cd230-144">By default, expressions created in the workflow designer match the language of the hosting project.</span></span> <span data-ttu-id="cd230-145">Durante la creazione dei flussi di lavoro nel codice, il linguaggio usato è a discrezione dell'autore del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-145">When creating workflows in code, the desired language is at the discretion of the workflow author.</span></span>  
  
 <span data-ttu-id="cd230-146">In questi esempi il risultato dell'espressione viene assegnato alla variabile `n` del flusso di lavoro e questi risultati vengono usati dalla successiva attività nel flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-146">In these examples the result of the expression is assigned to the workflow variable `n`, and these results are used by the next activity in the workflow.</span></span> <span data-ttu-id="cd230-147">Per accedere al valore della variabile `n` del flusso di lavoro in fase di esecuzione, è necessario l'oggetto <xref:System.Activities.ActivityContext></span><span class="sxs-lookup"><span data-stu-id="cd230-147">To access the value of the workflow variable `n` at runtime, the <xref:System.Activities.ActivityContext> is required.</span></span> <span data-ttu-id="cd230-148">al quale è possibile accedere tramite l'espressione lambda seguente.</span><span class="sxs-lookup"><span data-stu-id="cd230-148">This can be accessed by using the following lambda expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#52](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#52)]  
  
 <span data-ttu-id="cd230-149">Per ulteriori informazioni sulle espressioni lambda, vedere [espressioni lambda (Guida per programmatori C#)](../../csharp/programming-guide/statements-expressions-operators/lambda-expressions.md) o [espressioni lambda (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/lambda-expressions.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-149">For more information about lambda expressions, see [Lambda Expressions (C# Programming Guide)](../../csharp/programming-guide/statements-expressions-operators/lambda-expressions.md) or [Lambda Expressions (Visual Basic)](../../visual-basic/programming-guide/language-features/procedures/lambda-expressions.md).</span></span>  
  
 <span data-ttu-id="cd230-150">Le espressioni lambda non sono serializzabili nel formato XAML.</span><span class="sxs-lookup"><span data-stu-id="cd230-150">Lambda expressions are not serializable to XAML format.</span></span> <span data-ttu-id="cd230-151">Se viene effettuato un tentativo di serializzare un flusso di lavoro con espressioni lambda, viene generata un'eccezione <xref:System.Activities.Expressions.LambdaSerializationException> con il messaggio seguente: "Il flusso di lavoro contiene le espressioni lambda specificate nel codice.</span><span class="sxs-lookup"><span data-stu-id="cd230-151">If an attempt to serialize a workflow with lambda expressions is made, a <xref:System.Activities.Expressions.LambdaSerializationException> is thrown with the following message: "This workflow contains lambda expressions specified in code.</span></span> <span data-ttu-id="cd230-152">Queste espressioni non sono serializzabili in XAML.</span><span class="sxs-lookup"><span data-stu-id="cd230-152">These expressions are not XAML serializable.</span></span> <span data-ttu-id="cd230-153">Per rendere il flusso di lavoro serializzabile in XAML, usare VisualBasicValue/VisualBasicReference o ExpressionServices.Convert(lambda).</span><span class="sxs-lookup"><span data-stu-id="cd230-153">In order to make your workflow XAML-serializable, either use VisualBasicValue/VisualBasicReference or ExpressionServices.Convert(lambda).</span></span> <span data-ttu-id="cd230-154">In questo modo le espressioni lambda verranno convertite in attività di espressione."</span><span class="sxs-lookup"><span data-stu-id="cd230-154">This will convert your lambda expressions into expression activities."</span></span> <span data-ttu-id="cd230-155">Per rendere questa espressione compatibile con XAML, usare l'oggetto <xref:System.Activities.Expressions.ExpressionServices> e il metodo <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="cd230-155">To make this expression compatible with XAML, use <xref:System.Activities.Expressions.ExpressionServices> and <xref:System.Activities.Expressions.ExpressionServices.Convert%2A>, as shown in the following example.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#53](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#53)]  
  
 <span data-ttu-id="cd230-156">Si può usare anche un oggetto <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-156">A <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> could also be used.</span></span> <span data-ttu-id="cd230-157">Si noti che le espressioni lambda non sono obbligatorie quando si usa un'espressione di Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="cd230-157">Note that no lambda expression is required when using a Visual Basic expression.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#54](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#54)]  
  
 <span data-ttu-id="cd230-158">In fase di runtime, le espressioni di Visual Basic vengono compilate nelle espressioni LINQ.</span><span class="sxs-lookup"><span data-stu-id="cd230-158">At run time, Visual Basic expressions are compiled into LINQ expressions.</span></span> <span data-ttu-id="cd230-159">Entrambi gli esempi precedenti sono serializzabili in XAML, ma se si intende visualizzare e modificare il codice XAML serializzato nella finestra di progettazione del flusso di lavoro, usare <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> per le espressioni.</span><span class="sxs-lookup"><span data-stu-id="cd230-159">Both of the previous examples are serializable to XAML, but if the serialized XAML is intended to be viewed and edited in the workflow designer, use <xref:Microsoft.VisualBasic.Activities.VisualBasicValue%601> for your expressions.</span></span> <span data-ttu-id="cd230-160">I flussi di lavoro serializzati che usano `ExpressionServices.Convert` possono essere aperti nella finestra di progettazione, ma il valore dell'espressione sarà vuoto.</span><span class="sxs-lookup"><span data-stu-id="cd230-160">Serialized workflows that use `ExpressionServices.Convert` can be opened in the designer, but the value of the expression will be blank.</span></span> <span data-ttu-id="cd230-161">Per ulteriori informazioni sulla serializzazione dei flussi di lavoro in XAML, vedere [serializzazione di flussi di lavoro e attività da e verso XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-161">For more information about serializing workflows to XAML, see [Serializing Workflows and Activities to and from XAML](serializing-workflows-and-activities-to-and-from-xaml.md).</span></span>  
  
#### <a name="literal-expressions-and-reference-types"></a><span data-ttu-id="cd230-162">Espressioni letterali e tipi riferimento</span><span class="sxs-lookup"><span data-stu-id="cd230-162">Literal Expressions and Reference Types</span></span>  
 <span data-ttu-id="cd230-163">Le espressioni letterali sono rappresentate nei flussi di lavoro dall'attività <xref:System.Activities.Expressions.Literal%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-163">Literal expressions are represented in workflows by the <xref:System.Activities.Expressions.Literal%601> activity.</span></span> <span data-ttu-id="cd230-164">Le seguenti attività <xref:System.Activities.Statements.WriteLine> sono equivalenti a livello funzionale.</span><span class="sxs-lookup"><span data-stu-id="cd230-164">The following <xref:System.Activities.Statements.WriteLine> activities are functionally equivalent.</span></span>  
  
```csharp  
new WriteLine  
{  
    Text = "Hello World."  
},  
new WriteLine  
{  
    Text = new Literal<string>("Hello World.")  
}  
```  
  
 <span data-ttu-id="cd230-165">Non è valido inizializzare un'espressione letterale con qualsiasi tipo di riferimento eccetto <xref:System.String>.</span><span class="sxs-lookup"><span data-stu-id="cd230-165">It is invalid to initialize a literal expression with any reference type except <xref:System.String>.</span></span> <span data-ttu-id="cd230-166">Nell'esempio riportato di seguito, la proprietà <xref:System.Activities.Statements.Assign> di un'attività <xref:System.Activities.Statements.Assign.Value%2A> viene inizializzata con un'espressione letterale usando `List<string>`.</span><span class="sxs-lookup"><span data-stu-id="cd230-166">In the following example, an <xref:System.Activities.Statements.Assign> activity's <xref:System.Activities.Statements.Assign.Value%2A> property is initialized with a literal expression using a `List<string>`.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new List<string>())  
},  
```  
  
 <span data-ttu-id="cd230-167">Quando il flusso di lavoro che contiene questa attività viene convalidato, viene restituito il seguente errore di convalida: “Il valore letterale supporta solo tipi di valore e il tipo non modificabile System.String.</span><span class="sxs-lookup"><span data-stu-id="cd230-167">When the workflow containing this activity is validated, the following validation error is returned: "Literal only supports value types and the immutable type System.String.</span></span> <span data-ttu-id="cd230-168">Impossibile usare System.Collections.Generic.List\`1[System.String] come valore letterale".</span><span class="sxs-lookup"><span data-stu-id="cd230-168">The type System.Collections.Generic.List\`1[System.String] cannot be used as a literal."</span></span> <span data-ttu-id="cd230-169">Se il flusso di lavoro viene richiamato, viene generata un'eccezione <xref:System.Activities.InvalidWorkflowException> contenente il testo dell'errore di convalida.</span><span class="sxs-lookup"><span data-stu-id="cd230-169">If the workflow is invoked, an <xref:System.Activities.InvalidWorkflowException> is thrown that contains the text of the validation error.</span></span> <span data-ttu-id="cd230-170">Si tratta di un errore di convalida perché la creazione di un'espressione letterale con un tipo di riferimento non crea una nuova istanza del tipo di riferimento per ogni istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-170">This is a validation error because creating a literal expression with a reference type does not create a new instance of the reference type for each instance of the workflow.</span></span> <span data-ttu-id="cd230-171">Per risolvere il problema, sostituire l'espressione letterale con una che crea e restituisce una nuova istanza del tipo di riferimento.</span><span class="sxs-lookup"><span data-stu-id="cd230-171">To resolve this, replace the literal expression with one that creates and returns a new instance of the reference type.</span></span>  
  
```csharp  
new Assign  
{  
    To = new OutArgument<List<string>>(items),  
    Value = new InArgument<List<string>>(new VisualBasicValue<List<string>>("New List(Of String)"))  
},  
```  
  
 <span data-ttu-id="cd230-172">Per ulteriori informazioni sulle espressioni, vedere [espressioni](expressions.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-172">For more information about expressions, see [Expressions](expressions.md).</span></span>  
  
#### <a name="invoking-methods-on-objects-using-expressions-and-the-invokemethod-activity"></a><span data-ttu-id="cd230-173">Chiamata di metodi su oggetti usando le espressioni e l'attività InvokeMethod</span><span class="sxs-lookup"><span data-stu-id="cd230-173">Invoking Methods on Objects using Expressions and the InvokeMethod Activity</span></span>  
 <span data-ttu-id="cd230-174">L'attività <xref:System.Activities.Expressions.InvokeMethod%601> può essere usata per richiamare i metodi statici e di istanza di classi di .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cd230-174">The <xref:System.Activities.Expressions.InvokeMethod%601> activity can be used to invoke static and instance methods of classes in the .NET Framework.</span></span> <span data-ttu-id="cd230-175">In un esempio precedente in questo argomento, un numero casuale è stato generato usando la classe <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="cd230-175">In a previous example in this topic, a random number was generated using the <xref:System.Random> class.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#51](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#51)]  
  
 <span data-ttu-id="cd230-176">Si sarebbe anche potuto usare l'attività <xref:System.Activities.Expressions.InvokeMethod%601> per chiamare il metodo <xref:System.Random.Next%2A> della classe <xref:System.Random>.</span><span class="sxs-lookup"><span data-stu-id="cd230-176">The <xref:System.Activities.Expressions.InvokeMethod%601> activity could also have been used to call the <xref:System.Random.Next%2A> method of the <xref:System.Random> class.</span></span>  
  
```csharp  
new InvokeMethod<int>  
{  
    TargetObject = new InArgument<Random>(new VisualBasicValue<Random>("New Random()")),  
    MethodName = "Next",  
    Parameters =
    {  
        new InArgument<int>(1),  
        new InArgument<int>(101)  
    },  
    Result = n  
}  
```  
  
 <span data-ttu-id="cd230-177">Poiché <xref:System.Random.Next%2A> non è un metodo statico, un'istanza della classe <xref:System.Random> viene fornita per la proprietà <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="cd230-177">Since <xref:System.Random.Next%2A> is not a static method, an instance of the <xref:System.Random> class is supplied for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A> property.</span></span> <span data-ttu-id="cd230-178">In questo esempio viene creata una nuova istanza usando un'espressione di Visual Basic, ma avrebbe potuto essere creata in precedenza ed essere archiviata in una variabile del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-178">In this example a new instance is created using a Visual Basic expression, but it could also have been created previously and stored in a workflow variable.</span></span> <span data-ttu-id="cd230-179">In questo esempio, sarebbe più semplice usare l'attività <xref:System.Activities.Statements.Assign%601> anziché l'attività <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-179">In this example, it would be simpler to use the <xref:System.Activities.Statements.Assign%601> activity instead of the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="cd230-180">Se la chiamata al metodo richiamato di recente dalla attività <xref:System.Activities.Statements.Assign%601> o <xref:System.Activities.Expressions.InvokeMethod%601> ha un'esecuzione prolungata, <xref:System.Activities.Expressions.InvokeMethod%601> ha un vantaggio poiché dispone di una proprietà <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A>.</span><span class="sxs-lookup"><span data-stu-id="cd230-180">If the method call ultimately invoked by either the <xref:System.Activities.Statements.Assign%601> or <xref:System.Activities.Expressions.InvokeMethod%601> activities is long running, <xref:System.Activities.Expressions.InvokeMethod%601> has an advantage since it has a <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> property.</span></span> <span data-ttu-id="cd230-181">Se questa proprietà è impostata su `true`, il metodo richiamato verrà eseguito in modo asincrono rispetto al flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cd230-181">When this property is set to `true`, the invoked method will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="cd230-182">Se vi sono altre attività in parallelo, queste non verranno bloccate durante l'esecuzione asincrona del metodo.</span><span class="sxs-lookup"><span data-stu-id="cd230-182">If other activities are in parallel, they will not be blocked while the method is asynchronously executing.</span></span> <span data-ttu-id="cd230-183">Inoltre, se il metodo da richiamare non ha valore restituito, <xref:System.Activities.Expressions.InvokeMethod%601> rappresenta la soluzione appropriata per richiamare il metodo.</span><span class="sxs-lookup"><span data-stu-id="cd230-183">Also, if the method to be invoked has no return value, then <xref:System.Activities.Expressions.InvokeMethod%601> is the appropriate way to invoke the method.</span></span>  
  
## <a name="arguments-and-dynamic-activities"></a><span data-ttu-id="cd230-184">Argomenti e attività dinamiche</span><span class="sxs-lookup"><span data-stu-id="cd230-184">Arguments and Dynamic Activities</span></span>  
 <span data-ttu-id="cd230-185">Una definizione del flusso di lavoro viene creata in codice assemblando le attività in un albero delle attività e configurando qualsiasi proprietà e argomento.</span><span class="sxs-lookup"><span data-stu-id="cd230-185">A workflow definition is created in code by assembling activities into an activity tree and configuring any properties and arguments.</span></span> <span data-ttu-id="cd230-186">Gli argomenti esistenti possono essere associati, ma quelli nuovi non possono essere aggiunti alle attività,</span><span class="sxs-lookup"><span data-stu-id="cd230-186">Existing arguments can be bound, but new arguments cannot be added to activities.</span></span> <span data-ttu-id="cd230-187">inclusi gli argomenti del flusso di lavoro passati all'attività radice.</span><span class="sxs-lookup"><span data-stu-id="cd230-187">This includes workflow arguments passed to the root activity.</span></span> <span data-ttu-id="cd230-188">In codice imperativo, gli argomenti del flusso di lavoro vengono specificati come proprietà in un nuovo tipo CLR e in XAML vengono dichiarati tramite gli oggetti `x:Class` e `x:Member`.</span><span class="sxs-lookup"><span data-stu-id="cd230-188">In imperative code, workflow arguments are specified as properties on a new CLR type, and in XAML they are declared by using `x:Class` and `x:Member`.</span></span> <span data-ttu-id="cd230-189">Poiché non è disponibile alcun nuovo tipo CLR creato quando una definizione del flusso di lavoro viene creata come albero degli oggetti in memoria, gli argomenti non possono essere aggiunti.</span><span class="sxs-lookup"><span data-stu-id="cd230-189">Because there is no new CLR type created when a workflow definition is created as a tree of in-memory objects, arguments cannot be added.</span></span> <span data-ttu-id="cd230-190">Tuttavia, gli argomenti possono essere aggiunti a un oggetto <xref:System.Activities.DynamicActivity>.</span><span class="sxs-lookup"><span data-stu-id="cd230-190">However, arguments can be added to a <xref:System.Activities.DynamicActivity>.</span></span> <span data-ttu-id="cd230-191">In questo esempio viene creato un oggetto <xref:System.Activities.DynamicActivity%601> che accetta due argomenti Integer, li somma e restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="cd230-191">In this example, a <xref:System.Activities.DynamicActivity%601> is created that takes two integer arguments, adds them together, and returns the result.</span></span> <span data-ttu-id="cd230-192">Viene creato un oggetto <xref:System.Activities.DynamicActivityProperty> per ogni argomento e il risultato dell'operazione viene assegnato all'argomento <xref:System.Activities.Activity%601.Result%2A> dell'oggetto <xref:System.Activities.DynamicActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-192">A <xref:System.Activities.DynamicActivityProperty> is created for each argument, and the result of the operation is assigned to the <xref:System.Activities.Activity%601.Result%2A> argument of the <xref:System.Activities.DynamicActivity%601>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#55](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#55)]  
  
 <span data-ttu-id="cd230-193">Per ulteriori informazioni sulle attività dinamiche, vedere [creazione di un'attività in fase di esecuzione](creating-an-activity-at-runtime-with-dynamicactivity.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-193">For more information about dynamic activities, see [Creating an Activity at Runtime](creating-an-activity-at-runtime-with-dynamicactivity.md).</span></span>  
  
## <a name="compiled-activities"></a><span data-ttu-id="cd230-194">Attività compilate</span><span class="sxs-lookup"><span data-stu-id="cd230-194">Compiled Activities</span></span>  
 <span data-ttu-id="cd230-195">Le attività dinamiche sono un modo per definire tramite codice un'attività che contiene argomenti, ma le attività possono anche essere create nel codice e compilate nei tipi.</span><span class="sxs-lookup"><span data-stu-id="cd230-195">Dynamic activities are one way to define an activity that contains arguments using code, but activities can also be created in code and compiled into types.</span></span> <span data-ttu-id="cd230-196">È possibile creare attività semplici che derivano da <xref:System.Activities.CodeActivity>e attività asincrone che derivano da <xref:System.Activities.AsyncCodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="cd230-196">Simple activities can be created that derive from <xref:System.Activities.CodeActivity>, and asynchronous activities that derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="cd230-197">Queste attività possono avere argomenti, valori restituiti e definiscono la relativa logica usando il codice imperativo.</span><span class="sxs-lookup"><span data-stu-id="cd230-197">These activities can have arguments, return values, and define their logic using imperative code.</span></span> <span data-ttu-id="cd230-198">Per esempi di creazione di questi tipi di attività, vedere [classe di base CodeActivity](workflow-activity-authoring-using-the-codeactivity-class.md) e [creazione di attività asincrone](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="cd230-198">For examples of creating these types of activities, see [CodeActivity Base Class](workflow-activity-authoring-using-the-codeactivity-class.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>  
  
 <span data-ttu-id="cd230-199">Le attività che derivano da <xref:System.Activities.NativeActivity> possono definire la relativa logica usando il codice imperativo possono inoltre contenere attività figlio che definiscono la logica.</span><span class="sxs-lookup"><span data-stu-id="cd230-199">Activities that derive from <xref:System.Activities.NativeActivity> can define their logic using imperative code and they can also contain child activities that define the logic.</span></span> <span data-ttu-id="cd230-200">Dispongono inoltre dell'accesso completo alle funzionalità del runtime come la creazione dei segnalibri.</span><span class="sxs-lookup"><span data-stu-id="cd230-200">They also have full access to the features of the runtime such as creating bookmarks.</span></span> <span data-ttu-id="cd230-201">Per esempi relativi alla creazione di un' <xref:System.Activities.NativeActivity> attività basata su, vedere la pagina relativa alla [classe di base NativeActivity](nativeactivity-base-class.md), [procedura: creare un'attività](how-to-create-an-activity.md)e l'esempio [Custom Composite using Native Activity](./samples/custom-composite-using-native-activity.md) .</span><span class="sxs-lookup"><span data-stu-id="cd230-201">For examples of creating a <xref:System.Activities.NativeActivity>-based activity, see [NativeActivity Base Class](nativeactivity-base-class.md), [How to: Create an Activity](how-to-create-an-activity.md), and the [Custom Composite using Native Activity](./samples/custom-composite-using-native-activity.md) sample.</span></span>  
  
 <span data-ttu-id="cd230-202">Le attività che derivano da <xref:System.Activities.Activity> definiscono la relativa logica unicamente attraverso l'uso di attività figlio.</span><span class="sxs-lookup"><span data-stu-id="cd230-202">Activities that derive from <xref:System.Activities.Activity> define their logic solely through the use of child activities.</span></span> <span data-ttu-id="cd230-203">Queste attività vengono in genere create tramite la finestra di progettazione del flusso di lavoro, ma possono essere definite anche tramite codice.</span><span class="sxs-lookup"><span data-stu-id="cd230-203">These activities are typically created by using the workflow designer, but can also be defined by using code.</span></span> <span data-ttu-id="cd230-204">Nell'esempio seguente viene definita un'attività `Square` che deriva da `Activity<int>`.</span><span class="sxs-lookup"><span data-stu-id="cd230-204">In the following example, a `Square` activity is defined that derives from `Activity<int>`.</span></span> <span data-ttu-id="cd230-205">L'attività `Square` ha un unico <xref:System.Activities.InArgument%601> denominato `Value` e definisce la relativa logica specificando un'attività <xref:System.Activities.Statements.Sequence> che usa la proprietà <xref:System.Activities.Activity.Implementation%2A>.</span><span class="sxs-lookup"><span data-stu-id="cd230-205">The `Square` activity has a single <xref:System.Activities.InArgument%601> named `Value`, and defines its logic by specifying a <xref:System.Activities.Statements.Sequence> activity using the <xref:System.Activities.Activity.Implementation%2A> property.</span></span> <span data-ttu-id="cd230-206">L'attività <xref:System.Activities.Statements.Sequence> contiene un'attività <xref:System.Activities.Statements.WriteLine> e un'attività <xref:System.Activities.Statements.Assign%601>.</span><span class="sxs-lookup"><span data-stu-id="cd230-206">The <xref:System.Activities.Statements.Sequence> activity contains a <xref:System.Activities.Statements.WriteLine> activity and an <xref:System.Activities.Statements.Assign%601> activity.</span></span> <span data-ttu-id="cd230-207">Insieme, queste tre attività implementano la logica dell'attività `Square`.</span><span class="sxs-lookup"><span data-stu-id="cd230-207">Together, these three activities implement the logic of the `Square` activity.</span></span>  
  
```csharp  
class Square : Activity<int>  
{  
    [RequiredArgument]  
    public InArgument<int> Value { get; set; }  
  
    public Square()  
    {  
        this.Implementation = () => new Sequence  
        {  
            Activities =  
            {  
                new WriteLine  
                {  
                    Text = new InArgument<string>((env) => "Squaring the value: " + this.Value.Get(env))  
                },  
                new Assign<int>  
                {  
                    To = new OutArgument<int>((env) => this.Result.Get(env)),  
                    Value = new InArgument<int>((env) => this.Value.Get(env) * this.Value.Get(env))  
                }  
            }  
        };  
    }  
}  
```  
  
 <span data-ttu-id="cd230-208">Nell'esempio riportato di seguito, una definizione del flusso di lavoro costituita da un'unica attività `Square` viene richiamata usando <xref:System.Activities.WorkflowInvoker>.</span><span class="sxs-lookup"><span data-stu-id="cd230-208">In the following example, a workflow definition consisting of a single `Square` activity is invoked using <xref:System.Activities.WorkflowInvoker>.</span></span>  
  
```csharp  
Dictionary<string, object> inputs = new Dictionary<string, object> {{ "Value", 5}};  
int result = WorkflowInvoker.Invoke(new Square(), inputs);  
Console.WriteLine("Result: {0}", result);  
```  
  
 <span data-ttu-id="cd230-209">Quando il flusso di lavoro viene richiamato, l'output seguente viene visualizzato nella console:</span><span class="sxs-lookup"><span data-stu-id="cd230-209">When the workflow is invoked, the following output is displayed to the console:</span></span>  
  
 <span data-ttu-id="cd230-210">**Elevazione al quadrato del valore: 5.**</span><span class="sxs-lookup"><span data-stu-id="cd230-210">**Squaring the value: 5**</span></span>  
<span data-ttu-id="cd230-211">**Result: 25**</span><span class="sxs-lookup"><span data-stu-id="cd230-211">**Result: 25**</span></span>
