---
title: Creazione di copie replicate di assembly
description: Esplorare la copia shadow degli assembly in .NET, in modo che quelli usati in un dominio dell'applicazione possano essere aggiornati senza scaricare il dominio dell'applicazione.
ms.date: 03/30/2017
helpviewer_keywords:
- assemblies [.NET Framework], shadow copying
- application domains, shadow copying assemblies
- shadow copying assemblies
ms.assetid: de8b8759-fca7-4260-896b-5a4973157672
ms.openlocfilehash: a7ff72763dd26dbc50cd37e070c2d25ababa00f3
ms.sourcegitcommit: 1c37a894c923bea021a3cc38ce7cba946357bbe1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/19/2020
ms.locfileid: "85104559"
---
# <a name="shadow-copying-assemblies"></a><span data-ttu-id="ef293-103">Creazione di copie replicate di assembly</span><span class="sxs-lookup"><span data-stu-id="ef293-103">Shadow Copying Assemblies</span></span>

<span data-ttu-id="ef293-104">La creazione di copie shadow consente di aggiornare gli assembly usati in un dominio applicazione senza scaricare quest'ultimo.</span><span class="sxs-lookup"><span data-stu-id="ef293-104">Shadow copying enables assemblies that are used in an application domain to be updated without unloading the application domain.</span></span> <span data-ttu-id="ef293-105">Ciò è particolarmente utile per le applicazioni che devono essere disponibili in modo continuo, ad esempio siti ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ef293-105">This is particularly useful for applications that must be available continuously, such as ASP.NET sites.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ef293-106">La copia shadow non è supportata nelle app di Windows 8. x Store.</span><span class="sxs-lookup"><span data-stu-id="ef293-106">Shadow copying is not supported in Windows 8.x Store apps.</span></span>

<span data-ttu-id="ef293-107">Common Language Runtime blocca un file di assembly quando l'assembly è caricato, in modo che non sia possibile aggiornare il file finché l'assembly non sarà stato scaricato.</span><span class="sxs-lookup"><span data-stu-id="ef293-107">The common language runtime locks an assembly file when the assembly is loaded, so the file cannot be updated until the assembly is unloaded.</span></span> <span data-ttu-id="ef293-108">L'unico modo per scaricare un assembly da un dominio applicazione consiste nello scaricare il dominio applicazione; pertanto, in circostanze normali, non è possibile aggiornare un assembly su disco fino a quando tutti i domini applicazione che lo usano non saranno stati scaricati.</span><span class="sxs-lookup"><span data-stu-id="ef293-108">The only way to unload an assembly from an application domain is by unloading the application domain, so under normal circumstances, an assembly cannot be updated on disk until all the application domains that are using it have been unloaded.</span></span>

<span data-ttu-id="ef293-109">Quando un dominio applicazione è configurato per la copia shadow di file, gli assembly dal percorso dell'applicazione vengono copiati in un'altra posizione e caricati da tale posizione.</span><span class="sxs-lookup"><span data-stu-id="ef293-109">When an application domain is configured to shadow copy files, assemblies from the application path are copied to another location and loaded from that location.</span></span> <span data-ttu-id="ef293-110">La copia è bloccata, ma il file di assembly originale è sbloccato e può essere aggiornato.</span><span class="sxs-lookup"><span data-stu-id="ef293-110">The copy is locked, but the original assembly file is unlocked and can be updated.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ef293-111">Gli unici assembly che possono essere replicati mediante copia shadow sono quelli memorizzati nella directory dell'applicazione o nelle relative sottodirectory, specificato dalle proprietà <xref:System.AppDomainSetup.ApplicationBase%2A> e <xref:System.AppDomainSetup.PrivateBinPath%2A> quando viene configurato il dominio applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef293-111">The only assemblies that can be shadow copied are those stored in the application directory or its subdirectories, specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties when the application domain is configured.</span></span> <span data-ttu-id="ef293-112">Gli assembly memorizzati nella Global Assembly Cache non vengono replicati mediante copia shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-112">Assemblies stored in the global assembly cache are not shadow copied.</span></span>

<span data-ttu-id="ef293-113">In questo articolo sono contenute le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="ef293-113">This article contains the following sections:</span></span>

- <span data-ttu-id="ef293-114">[Abilitazione e uso della creazione di copie shadow](#EnablingAndUsing): illustra l'uso di base e le opzioni disponibili per la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-114">[Enabling and Using Shadow Copying](#EnablingAndUsing) describes the basic use and the options that are available for shadow copying.</span></span>

- <span data-ttu-id="ef293-115">[Prestazioni di avvio](#StartupPerformance): illustra le modifiche che vengono apportate alla copia shadow in .NET Framework 4 per migliorare le prestazioni di avvio e come ripristinare il funzionamento delle versioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="ef293-115">[Startup Performance](#StartupPerformance) describes the changes that are made to shadow copying in the .NET Framework 4 to improve startup performance, and how to revert to the behavior of earlier versions.</span></span>

- <span data-ttu-id="ef293-116">[Metodi obsoleti](#ObsoleteMethods): illustra le modifiche apportate ai metodi e alle proprietà che controllano la creazione di copie shadow in .NET Framework 2.0.</span><span class="sxs-lookup"><span data-stu-id="ef293-116">[Obsolete Methods](#ObsoleteMethods) describes the changes that were made to the properties and methods that control shadow copying in the .NET Framework 2.0.</span></span>

<a name="EnablingAndUsing"></a>

## <a name="enabling-and-using-shadow-copying"></a><span data-ttu-id="ef293-117">Abilitazione e uso della creazione di copie shadow</span><span class="sxs-lookup"><span data-stu-id="ef293-117">Enabling and Using Shadow Copying</span></span>

<span data-ttu-id="ef293-118">È possibile usare le proprietà della classe <xref:System.AppDomainSetup> come indicato di seguito per configurare un dominio applicazione per la creazione di copie shadow:</span><span class="sxs-lookup"><span data-stu-id="ef293-118">You can use the properties of the <xref:System.AppDomainSetup> class as follows to configure an application domain for shadow copying:</span></span>

- <span data-ttu-id="ef293-119">Abilitare la creazione di copie shadow impostando la proprietà <xref:System.AppDomainSetup.ShadowCopyFiles%2A> sul valore della stringa `"true"`.</span><span class="sxs-lookup"><span data-stu-id="ef293-119">Enable shadow copying by setting the <xref:System.AppDomainSetup.ShadowCopyFiles%2A> property to the string value `"true"`.</span></span>

  <span data-ttu-id="ef293-120">Per impostazione predefinita, tutti gli assembly nel percorso dell'applicazione verranno copiati in una Download Cache prima che vengano caricati.</span><span class="sxs-lookup"><span data-stu-id="ef293-120">By default, this setting causes all assemblies in the application path to be copied to a download cache before they are loaded.</span></span> <span data-ttu-id="ef293-121">Si tratta della stessa cache gestita da Common Language Runtime per archiviare i file scaricati da altri computer ed eliminare automaticamente i file quando non sono più necessari.</span><span class="sxs-lookup"><span data-stu-id="ef293-121">This is the same cache maintained by the common language runtime to store files downloaded from other computers, and the common language runtime automatically deletes the files when they are no longer needed.</span></span>

- <span data-ttu-id="ef293-122">Facoltativamente, impostare un percorso personalizzato per i file di copia shadow usando la proprietà <xref:System.AppDomainSetup.CachePath%2A> e la proprietà <xref:System.AppDomainSetup.ApplicationName%2A>.</span><span class="sxs-lookup"><span data-stu-id="ef293-122">Optionally set a custom location for shadow copied files by using the <xref:System.AppDomainSetup.CachePath%2A> property and the <xref:System.AppDomainSetup.ApplicationName%2A> property.</span></span>

  <span data-ttu-id="ef293-123">Il percorso di base della posizione è costituito dalla concatenazione della proprietà <xref:System.AppDomainSetup.ApplicationName%2A> alla proprietà <xref:System.AppDomainSetup.CachePath%2A> come sottodirectory.</span><span class="sxs-lookup"><span data-stu-id="ef293-123">The base path for the location is formed by concatenating the <xref:System.AppDomainSetup.ApplicationName%2A> property to the <xref:System.AppDomainSetup.CachePath%2A> property as a subdirectory.</span></span> <span data-ttu-id="ef293-124">Gli assembly vengono replicati nelle sottodirectory di questo percorso, non nel percorso di base.</span><span class="sxs-lookup"><span data-stu-id="ef293-124">Assemblies are shadow copied to subdirectories of this path, not to the base path itself.</span></span>

  > [!NOTE]
  > <span data-ttu-id="ef293-125">Se la proprietà <xref:System.AppDomainSetup.ApplicationName%2A> non è impostata, la proprietà <xref:System.AppDomainSetup.CachePath%2A> viene ignorata e viene usata la Download Cache.</span><span class="sxs-lookup"><span data-stu-id="ef293-125">If the <xref:System.AppDomainSetup.ApplicationName%2A> property is not set, the <xref:System.AppDomainSetup.CachePath%2A> property is ignored and the download cache is used.</span></span> <span data-ttu-id="ef293-126">Non viene generata alcuna eccezione.</span><span class="sxs-lookup"><span data-stu-id="ef293-126">No exception is thrown.</span></span>

  <span data-ttu-id="ef293-127">Se si specifica un percorso personalizzato, si è responsabili della pulizia delle directory e dei file copiati quando non sono più necessari,</span><span class="sxs-lookup"><span data-stu-id="ef293-127">If you specify a custom location, you are responsible for cleaning up the directories and copied files when they are no longer needed.</span></span> <span data-ttu-id="ef293-128">perché non vengono eliminati automaticamente.</span><span class="sxs-lookup"><span data-stu-id="ef293-128">They are not deleted automatically.</span></span>

  <span data-ttu-id="ef293-129">Esistono diversi motivi per cui è consigliabile impostare un percorso personalizzato per i file della copia shadow,</span><span class="sxs-lookup"><span data-stu-id="ef293-129">There are a few reasons why you might want to set a custom location for shadow copied files.</span></span> <span data-ttu-id="ef293-130">ad esempio se l'applicazione genera un numero elevato di copie.</span><span class="sxs-lookup"><span data-stu-id="ef293-130">You might want to set a custom location for shadow copied files if your application generates a large number of copies.</span></span> <span data-ttu-id="ef293-131">La Download Cache è limitata dalle dimensioni, non dalla durata, pertanto è possibile che Common Language Runtime proverà a eliminare un file che è ancora in uso.</span><span class="sxs-lookup"><span data-stu-id="ef293-131">The download cache is limited by size, not by lifetime, so it is possible that the common language runtime will attempt to delete a file that is still in use.</span></span> <span data-ttu-id="ef293-132">Un altro motivo per impostare un percorso personalizzato è quando gli utenti che eseguono l'applicazione non hanno accesso in scrittura al percorso di directory che Common Language Runtime usa per la Download Cache.</span><span class="sxs-lookup"><span data-stu-id="ef293-132">Another reason to set a custom location is when users running your application do not have write access to the directory location the common language runtime uses for the download cache.</span></span>

- <span data-ttu-id="ef293-133">Facoltativamente, limitare gli assembly che vengono replicati usando la proprietà <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="ef293-133">Optionally limit the assemblies that are shadow copied by using the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span>

  <span data-ttu-id="ef293-134">Quando si abilita la creazione di copie shadow per un dominio applicazione, l'impostazione predefinita consiste nel copiare tutti gli assembly nel percorso dell'applicazione, ovvero nelle directory specificate dalle proprietà <xref:System.AppDomainSetup.ApplicationBase%2A> e <xref:System.AppDomainSetup.PrivateBinPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="ef293-134">When you enable shadow copying for an application domain, the default is to copy all assemblies in the application path — that is, in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties.</span></span> <span data-ttu-id="ef293-135">È possibile limitare la copia alle directory selezionate creando una stringa che contiene solo le directory per cui si vogliono creare copie shadow e assegnando la stringa alla proprietà <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>.</span><span class="sxs-lookup"><span data-stu-id="ef293-135">You can limit the copying to selected directories by creating a string that contains only those directories you want to shadow copy, and assigning the string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span> <span data-ttu-id="ef293-136">Separare le directory con punti e virgola.</span><span class="sxs-lookup"><span data-stu-id="ef293-136">Separate the directories with semicolons.</span></span> <span data-ttu-id="ef293-137">Gli unici assembly che vengono replicati sono quelli nelle directory selezionate.</span><span class="sxs-lookup"><span data-stu-id="ef293-137">The only assemblies that are shadow copied are the ones in the selected directories.</span></span>

  > [!NOTE]
  > <span data-ttu-id="ef293-138">Se non si assegna una stringa alla proprietà <xref:System.AppDomainSetup.ShadowCopyDirectories%2A>  o se si imposta questa proprietà su `null`, tutti gli assembly nelle directory specificate dalle proprietà <xref:System.AppDomainSetup.ApplicationBase%2A> e <xref:System.AppDomainSetup.PrivateBinPath%2A> vengono replicati come copie shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-138">If you don’t assign a string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property, or if you set this property to `null`, all assemblies in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties are shadow copied.</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="ef293-139">I percorsi delle directory non devono contenere punti e virgola, perché il punto e virgola è il carattere delimitatore.</span><span class="sxs-lookup"><span data-stu-id="ef293-139">Directory paths must not contain semicolons, because the semicolon is the delimiter character.</span></span> <span data-ttu-id="ef293-140">Non esiste alcun carattere di escape per i punti e virgola.</span><span class="sxs-lookup"><span data-stu-id="ef293-140">There is no escape character for semicolons.</span></span>

<a name="StartupPerformance"></a>

## <a name="startup-performance"></a><span data-ttu-id="ef293-141">Prestazioni di avvio</span><span class="sxs-lookup"><span data-stu-id="ef293-141">Startup Performance</span></span>

<span data-ttu-id="ef293-142">All'avvio di un dominio applicazione che usa la creazione di copie shadow, si verifica un ritardo mentre gli assembly nella directory dell'applicazione vengono copiati nella directory di copia shadow o verificati, se si trovano già in tale posizione.</span><span class="sxs-lookup"><span data-stu-id="ef293-142">When an application domain that uses shadow copying starts, there is a delay while assemblies in the application directory are copied to the shadow copy directory, or verified if they are already in that location.</span></span> <span data-ttu-id="ef293-143">Nelle versioni precedenti a .NET Framework 4, tutti gli assembly vengono copiati in una directory temporanea.</span><span class="sxs-lookup"><span data-stu-id="ef293-143">Before the .NET Framework 4, all assemblies were copied to a temporary directory.</span></span> <span data-ttu-id="ef293-144">Ogni assembly è stato aperto per verificare il nome dell'assembly e il nome sicuro è stato convalidato.</span><span class="sxs-lookup"><span data-stu-id="ef293-144">Each assembly was opened to verify the assembly name, and the strong name was validated.</span></span> <span data-ttu-id="ef293-145">Ogni assembly è stato controllato per verificare se è stato aggiornato più di recente rispetto alla copia nella directory della copia shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-145">Each assembly was checked to see whether it had been updated more recently than the copy in the shadow copy directory.</span></span> <span data-ttu-id="ef293-146">In tal caso, è stato copiato nella directory della copia shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-146">If so, it was copied to the shadow copy directory.</span></span> <span data-ttu-id="ef293-147">Infine, le copie temporanee vengono rimosse.</span><span class="sxs-lookup"><span data-stu-id="ef293-147">Finally, the temporary copies were discarded.</span></span>

<span data-ttu-id="ef293-148">A partire da .NET Framework 4, il comportamento di avvio predefinito consiste nel confrontare direttamente la data e l'ora del file di ogni assembly nella directory dell'applicazione con la data e l'ora della copia nella directory della copia shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-148">Beginning with the .NET Framework 4, the default startup behavior is to directly compare the file date and time of each assembly in the application directory with the file date and time of the copy in the shadow copy directory.</span></span> <span data-ttu-id="ef293-149">Se l'assembly è stato aggiornato, viene copiato usando la stessa procedura adottata nelle versioni precedenti di .NET Framework. In caso contrario, viene caricata la copia nella directory della copia shadow.</span><span class="sxs-lookup"><span data-stu-id="ef293-149">If the assembly has been updated, it is copied by using the same procedure as in earlier versions of the .NET Framework; otherwise, the copy in the shadow copy directory is loaded.</span></span>

<span data-ttu-id="ef293-150">Il miglioramento delle prestazioni risultante è maggiore per le applicazioni in cui gli assembly non vengono modificati di frequente e le modifiche vengono apportate in genere in un piccolo subset di assembly.</span><span class="sxs-lookup"><span data-stu-id="ef293-150">The resulting performance improvement is largest for applications in which assemblies do not change frequently and changes usually occur in a small subset of assemblies.</span></span> <span data-ttu-id="ef293-151">Se la maggior parte degli assembly in un'applicazione viene modificata frequentemente, il nuovo comportamento predefinito potrebbe causare una regressione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ef293-151">If a majority of assemblies in an application change frequently, the new default behavior might cause a performance regression.</span></span> <span data-ttu-id="ef293-152">È possibile ripristinare il comportamento di avvio delle versioni precedenti del .NET Framework aggiungendo l' [ \<shadowCopyVerifyByTimestamp> elemento](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) al file di configurazione con `enabled="false"` .</span><span class="sxs-lookup"><span data-stu-id="ef293-152">You can restore the startup behavior of previous versions of the .NET Framework by adding the [\<shadowCopyVerifyByTimestamp> element](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) to the configuration file, with `enabled="false"`.</span></span>

<a name="ObsoleteMethods"></a>

## <a name="obsolete-methods"></a><span data-ttu-id="ef293-153">Metodi obsoleti</span><span class="sxs-lookup"><span data-stu-id="ef293-153">Obsolete Methods</span></span>

<span data-ttu-id="ef293-154">La classe <xref:System.AppDomain> include diversi metodi, ad esempio <xref:System.AppDomain.SetShadowCopyFiles%2A> e <xref:System.AppDomain.ClearShadowCopyPath%2A>, che possono essere usati per controllare la creazione di copie shadow in un dominio applicazione, ma che sono stati contrassegnati come obsoleti in .NET Framework versione 2.0.</span><span class="sxs-lookup"><span data-stu-id="ef293-154">The <xref:System.AppDomain> class has several methods, such as <xref:System.AppDomain.SetShadowCopyFiles%2A> and <xref:System.AppDomain.ClearShadowCopyPath%2A>, that can be used to control shadow copying on an application domain, but these have been marked obsolete in the .NET Framework version 2.0.</span></span> <span data-ttu-id="ef293-155">Il modo consigliato per configurare un dominio applicazione per la creazione di copie shadow consiste nell'usare le proprietà della classe <xref:System.AppDomainSetup>.</span><span class="sxs-lookup"><span data-stu-id="ef293-155">The recommended way to configure an application domain for shadow copying is to use the properties of the <xref:System.AppDomainSetup> class.</span></span>

## <a name="see-also"></a><span data-ttu-id="ef293-156">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="ef293-156">See also</span></span>

- <xref:System.AppDomainSetup.ShadowCopyFiles%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.CachePath%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ApplicationName%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ShadowCopyDirectories%2A?displayProperty=nameWithType>
- [<span data-ttu-id="ef293-157">\<shadowCopyVerifyByTimestamp>Elemento</span><span class="sxs-lookup"><span data-stu-id="ef293-157">\<shadowCopyVerifyByTimestamp> Element</span></span>](../configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md)
