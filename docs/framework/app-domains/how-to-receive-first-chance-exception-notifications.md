---
title: 'Procedura: Ricevere notifiche di eccezioni first-chance'
description: Ottenere notifiche di eccezioni first-chance in .NET tramite l'evento FirstChanceException della classe AppDomain, prima che CLR cerchi gestori di eccezioni.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- first-chance exception notifications
- exceptions, first chance notifications
ms.assetid: 66f002b8-a97d-4a6e-a503-2cec01689113
ms.openlocfilehash: e8b5ae5fb69c7befd329316aee11523f79d73fcd
ms.sourcegitcommit: 1c37a894c923bea021a3cc38ce7cba946357bbe1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/19/2020
ms.locfileid: "85104740"
---
# <a name="how-to-receive-first-chance-exception-notifications"></a><span data-ttu-id="f405c-103">Procedura: Ricevere notifiche di eccezioni first-chance</span><span class="sxs-lookup"><span data-stu-id="f405c-103">How to: Receive First-Chance Exception Notifications</span></span>
<span data-ttu-id="f405c-104">L'evento <xref:System.AppDomain.FirstChanceException> della classe <xref:System.AppDomain> consente di ricevere una notifica in cui si informa che è stata generata un'eccezione, prima che Common Language Runtime inizi a cercare gestori di eccezioni .</span><span class="sxs-lookup"><span data-stu-id="f405c-104">The <xref:System.AppDomain.FirstChanceException> event of the <xref:System.AppDomain> class lets you receive a notification that an exception has been thrown, before the common language runtime has begun searching for exception handlers.</span></span>

 <span data-ttu-id="f405c-105">L'evento viene generato a livello di dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f405c-105">The event is raised at the application domain level.</span></span> <span data-ttu-id="f405c-106">Poiché un thread di esecuzione può passare attraverso più domini dell'applicazione, un'eccezione che non viene gestita in un dominio dell'applicazione può essere gestita in un altro dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f405c-106">A thread of execution can pass through multiple application domains, so an exception that is unhandled in one application domain could be handled in another application domain.</span></span> <span data-ttu-id="f405c-107">La notifica si verifica in ogni dominio dell'applicazione che ha aggiunto un gestore per l'evento fino a quando un dominio non gestisce l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-107">The notification occurs in each application domain that has added a handler for the event, until an application domain handles the exception.</span></span>

 <span data-ttu-id="f405c-108">Le procedure e gli esempi di questo articolo illustrano come ricevere notifiche di eccezioni first-chance in un programma semplice che include un solo dominio dell'applicazione e in un dominio dell'applicazione creato.</span><span class="sxs-lookup"><span data-stu-id="f405c-108">The procedures and examples in this article show how to receive first-chance exception notifications in a simple program that has one application domain, and in an application domain that you create.</span></span>

 <span data-ttu-id="f405c-109">Per un esempio più complesso che riguarda più domini dell'applicazione, vedere l'esempio relativo all'evento <xref:System.AppDomain.FirstChanceException>.</span><span class="sxs-lookup"><span data-stu-id="f405c-109">For a more complex example that spans several application domains, see the example for the <xref:System.AppDomain.FirstChanceException> event.</span></span>

## <a name="receiving-first-chance-exception-notifications-in-the-default-application-domain"></a><span data-ttu-id="f405c-110">Ricezione di notifiche di eccezioni first-chance nel dominio dell'applicazione predefinito</span><span class="sxs-lookup"><span data-stu-id="f405c-110">Receiving First-Chance Exception Notifications in the Default Application Domain</span></span>
 <span data-ttu-id="f405c-111">Nella procedura seguente il punto di ingresso per l'applicazione, il metodo `Main()`, viene eseguito nel dominio dell'applicazione predefinito.</span><span class="sxs-lookup"><span data-stu-id="f405c-111">In the following procedure, the entry point for the application, the `Main()` method, runs in the default application domain.</span></span>

#### <a name="to-demonstrate-first-chance-exception-notifications-in-the-default-application-domain"></a><span data-ttu-id="f405c-112">Per visualizzare notifiche di eccezioni first-chance nel dominio dell'applicazione predefinito</span><span class="sxs-lookup"><span data-stu-id="f405c-112">To demonstrate first-chance exception notifications in the default application domain</span></span>

1. <span data-ttu-id="f405c-113">Definire un gestore dell'evento per l'evento <xref:System.AppDomain.FirstChanceException> usando una funzione lambda e collegarlo all'evento.</span><span class="sxs-lookup"><span data-stu-id="f405c-113">Define an event handler for the <xref:System.AppDomain.FirstChanceException> event, using a lambda function, and attach it to the event.</span></span> <span data-ttu-id="f405c-114">In questo esempio il gestore dell'evento stampa il nome del dominio dell'applicazione in cui l'evento è stato gestito e la proprietà <xref:System.Exception.Message%2A> dell'eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-114">In this example, the event handler prints the name of the application domain where the event was handled and the exception's <xref:System.Exception.Message%2A> property.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#2)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#2)]

2. <span data-ttu-id="f405c-115">Generare un'eccezione e rilevarla.</span><span class="sxs-lookup"><span data-stu-id="f405c-115">Throw an exception and catch it.</span></span> <span data-ttu-id="f405c-116">Prima che il runtime individui il gestore di eccezioni, viene generato l'evento <xref:System.AppDomain.FirstChanceException> che visualizza un messaggio.</span><span class="sxs-lookup"><span data-stu-id="f405c-116">Before the runtime locates the exception handler, the <xref:System.AppDomain.FirstChanceException> event is raised and displays a message.</span></span> <span data-ttu-id="f405c-117">Questo messaggio è seguito dal messaggio visualizzato dal gestore di eccezioni.</span><span class="sxs-lookup"><span data-stu-id="f405c-117">This message is followed by the message that is displayed by the exception handler.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#3)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#3)]

3. <span data-ttu-id="f405c-118">Generare un'eccezione senza rilevarla.</span><span class="sxs-lookup"><span data-stu-id="f405c-118">Throw an exception, but do not catch it.</span></span> <span data-ttu-id="f405c-119">Prima che il runtime cerchi un gestore di eccezioni, viene generato l'evento <xref:System.AppDomain.FirstChanceException> che visualizza un messaggio.</span><span class="sxs-lookup"><span data-stu-id="f405c-119">Before the runtime looks for an exception handler, the <xref:System.AppDomain.FirstChanceException> event is raised and displays a message.</span></span> <span data-ttu-id="f405c-120">Poiché non è presente alcun gestore di eccezioni, l'applicazione viene chiusa.</span><span class="sxs-lookup"><span data-stu-id="f405c-120">There is no exception handler, so the application terminates.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#4)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#4)]

     <span data-ttu-id="f405c-121">Il codice visualizzato nei primi tre passaggi di questa procedura forma un'applicazione console completa.</span><span class="sxs-lookup"><span data-stu-id="f405c-121">The code that is shown in the first three steps of this procedure forms a complete console application.</span></span> <span data-ttu-id="f405c-122">L'output dell'applicazione varia a seconda del nome del file con estensione exe, perché il nome del dominio dell'applicazione predefinito è costituito dal nome e dall'estensione del file exe.</span><span class="sxs-lookup"><span data-stu-id="f405c-122">The output from the application varies, depending on the name of the .exe file, because the name of the default application domain consists of the name and extension of the .exe file.</span></span> <span data-ttu-id="f405c-123">Di seguito è illustrato un output di esempio.</span><span class="sxs-lookup"><span data-stu-id="f405c-123">See the following for sample output.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto_simple#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/cs/example.cs#5)]
     [!code-vb[System.AppDomain.FirstChanceException_howto_simple#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto_simple/vb/example.vb#5)]

## <a name="receiving-first-chance-exception-notifications-in-another-application-domain"></a><span data-ttu-id="f405c-124">Ricezione di notifiche di eccezioni first-chance in un altro dominio dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="f405c-124">Receiving First-Chance Exception Notifications in Another Application Domain</span></span>
 <span data-ttu-id="f405c-125">Se il programma contiene più domini di applicazione, è possibile specificare i domini di applicazione che ricevono le notifiche.</span><span class="sxs-lookup"><span data-stu-id="f405c-125">If your program contains more than one application domain, you can choose which application domains receive notifications.</span></span>

#### <a name="to-receive-first-chance-exception-notifications-in-an-application-domain-that-you-create"></a><span data-ttu-id="f405c-126">Per ricevere notifiche di eccezioni first-chance in un dominio dell'applicazione creato</span><span class="sxs-lookup"><span data-stu-id="f405c-126">To receive first-chance exception notifications in an application domain that you create</span></span>

1. <span data-ttu-id="f405c-127">Definire un gestore dell'evento per l'evento <xref:System.AppDomain.FirstChanceException>.</span><span class="sxs-lookup"><span data-stu-id="f405c-127">Define an event handler for the <xref:System.AppDomain.FirstChanceException> event.</span></span> <span data-ttu-id="f405c-128">Questo esempio usa un metodo `static` (`Shared` in Visual Basic) che stampa il nome del dominio dell'applicazione in cui l'evento viene gestito e la proprietà <xref:System.Exception.Message%2A> dell'eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-128">This example uses a `static` method (`Shared` method in Visual Basic) that prints the name of the application domain where the event was handled and the exception's <xref:System.Exception.Message%2A> property.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#3)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#3)]

2. <span data-ttu-id="f405c-129">Creare un dominio dell'applicazione e aggiungere il gestore dell'evento all'evento <xref:System.AppDomain.FirstChanceException> per il dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f405c-129">Create an application domain and add the event handler to the <xref:System.AppDomain.FirstChanceException> event for that application domain.</span></span> <span data-ttu-id="f405c-130">In questo esempio il dominio dell'applicazione è denominato `AD1`.</span><span class="sxs-lookup"><span data-stu-id="f405c-130">In this example, the application domain is named `AD1`.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#2](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#2)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#2)]

     <span data-ttu-id="f405c-131">È possibile gestire questo evento nel dominio dell'applicazione predefinito nello stesso modo.</span><span class="sxs-lookup"><span data-stu-id="f405c-131">You can handle this event in the default application domain in the same way.</span></span> <span data-ttu-id="f405c-132">Usare la proprietà `static` (`Shared` in Visual Basic) <xref:System.AppDomain.CurrentDomain%2A?displayProperty=nameWithType> in `Main()` per ottenere un riferimento al dominio dell'applicazione predefinito.</span><span class="sxs-lookup"><span data-stu-id="f405c-132">Use the `static` (`Shared` in Visual Basic) <xref:System.AppDomain.CurrentDomain%2A?displayProperty=nameWithType> property in `Main()` to get a reference to the default application domain.</span></span>

#### <a name="to-demonstrate-first-chance-exception-notifications-in-the-application-domain"></a><span data-ttu-id="f405c-133">Per visualizzare notifiche di eccezioni first-chance nel dominio dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="f405c-133">To demonstrate first-chance exception notifications in the application domain</span></span>

1. <span data-ttu-id="f405c-134">Creare un oggetto `Worker` nel dominio dell'applicazione creato nella procedura precedente.</span><span class="sxs-lookup"><span data-stu-id="f405c-134">Create a `Worker` object in the application domain that you created in the previous procedure.</span></span> <span data-ttu-id="f405c-135">La classe `Worker` deve essere pubblica e deve derivare da <xref:System.MarshalByRefObject>, come illustrato nell'esempio completo alla fine di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="f405c-135">The `Worker` class must be public, and must derive from <xref:System.MarshalByRefObject>, as shown in the complete example at the end of this article.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#4)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#4)]

2. <span data-ttu-id="f405c-136">Chiamare un metodo dell'oggetto `Worker` che genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-136">Call a method of the `Worker` object that throws an exception.</span></span> <span data-ttu-id="f405c-137">In questo esempio il metodo `Thrower` viene chiamato due volte.</span><span class="sxs-lookup"><span data-stu-id="f405c-137">In this example, the `Thrower` method is called twice.</span></span> <span data-ttu-id="f405c-138">La prima volta, poiché l'argomento del metodo è `true`, il metodo rileva la propria eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-138">The first time, the method argument is `true`, which causes the method to catch its own exception.</span></span> <span data-ttu-id="f405c-139">La seconda volta, l'argomento è `false` e il metodo `Main()` rileva l'eccezione nel dominio dell'applicazione predefinito.</span><span class="sxs-lookup"><span data-stu-id="f405c-139">The second time, the argument is `false`, and the `Main()` method catches the exception in the default application domain.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#6)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#6)]

3. <span data-ttu-id="f405c-140">Inserire codice nel metodo `Thrower` per controllare se il metodo gestisce la propria eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-140">Place code in the `Thrower` method to control whether the method handles its own exception.</span></span>

     [!code-csharp[System.AppDomain.FirstChanceException_howto#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#5)]
     [!code-vb[System.AppDomain.FirstChanceException_howto#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#5)]

## <a name="example"></a><span data-ttu-id="f405c-141">Esempio</span><span class="sxs-lookup"><span data-stu-id="f405c-141">Example</span></span>
 <span data-ttu-id="f405c-142">L'esempio seguente crea un dominio dell'applicazione denominato `AD1` e aggiunge un gestore dell'evento all'evento <xref:System.AppDomain.FirstChanceException> del dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f405c-142">The following example creates an application domain named `AD1` and adds an event handler to the application domain's <xref:System.AppDomain.FirstChanceException> event.</span></span> <span data-ttu-id="f405c-143">L'esempio crea un'istanza della classe `Worker` nel dominio dell'applicazione e chiama un metodo denominato `Thrower` che genera <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="f405c-143">The example creates an instance of the `Worker` class in the application domain, and calls a method named `Thrower` that throws an <xref:System.ArgumentException>.</span></span> <span data-ttu-id="f405c-144">A seconda del valore del proprio argomento, il metodo rileva l'eccezione o non riesce a gestirla.</span><span class="sxs-lookup"><span data-stu-id="f405c-144">Depending on the value of its argument, the method either catches the exception or fails to handle it.</span></span>

 <span data-ttu-id="f405c-145">Ogni volta che il metodo `Thrower` genera un'eccezione in `AD1`, viene generato l'evento <xref:System.AppDomain.FirstChanceException> in `AD1` e il gestore dell'evento visualizza un messaggio.</span><span class="sxs-lookup"><span data-stu-id="f405c-145">Each time the `Thrower` method throws an exception in `AD1`, the <xref:System.AppDomain.FirstChanceException> event is raised in `AD1`, and the event handler displays a message.</span></span> <span data-ttu-id="f405c-146">Il runtime cerca quindi un gestore di eccezioni.</span><span class="sxs-lookup"><span data-stu-id="f405c-146">The runtime then looks for an exception handler.</span></span> <span data-ttu-id="f405c-147">Nel primo caso il gestore di eccezioni viene trovato in `AD1`.</span><span class="sxs-lookup"><span data-stu-id="f405c-147">In the first case, the exception handler is found in `AD1`.</span></span> <span data-ttu-id="f405c-148">Nel secondo caso anziché essere gestita in `AD1`, l'eccezione viene rilevata nel dominio dell'applicazione predefinito.</span><span class="sxs-lookup"><span data-stu-id="f405c-148">In the second case, the exception is unhandled in `AD1`, and instead is caught in the default application domain.</span></span>

> [!NOTE]
> <span data-ttu-id="f405c-149">Il nome del dominio dell'applicazione predefinito è uguale al nome dell'eseguibile.</span><span class="sxs-lookup"><span data-stu-id="f405c-149">The name of the default application domain is the same as the name of the executable.</span></span>

 <span data-ttu-id="f405c-150">Se si aggiunge un gestore per l'evento <xref:System.AppDomain.FirstChanceException> al dominio dell'applicazione predefinito, l'evento viene generato e gestito prima che il dominio dell'applicazione predefinito gestisca l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="f405c-150">If you add a handler for the <xref:System.AppDomain.FirstChanceException> event to the default application domain, the event is raised and handled before the default application domain handles the exception.</span></span> <span data-ttu-id="f405c-151">Per verificarlo, aggiungere il codice C# `AppDomain.CurrentDomain.FirstChanceException += FirstChanceException;` (in Visual Basic, `AddHandler AppDomain.CurrentDomain.FirstChanceException, FirstChanceException`) all'inizio di `Main()`.</span><span class="sxs-lookup"><span data-stu-id="f405c-151">To see this, add the C# code `AppDomain.CurrentDomain.FirstChanceException += FirstChanceException;` (in Visual Basic, `AddHandler AppDomain.CurrentDomain.FirstChanceException, FirstChanceException`) at the beginning of `Main()`.</span></span>

 [!code-csharp[System.AppDomain.FirstChanceException_howto#1](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/cs/example.cs#1)]
 [!code-vb[System.AppDomain.FirstChanceException_howto#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.appdomain.firstchanceexception_howto/vb/example.vb#1)]

## <a name="see-also"></a><span data-ttu-id="f405c-152">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="f405c-152">See also</span></span>

- <xref:System.AppDomain.FirstChanceException>
