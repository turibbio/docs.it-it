---
title: Misurazione dei miglioramenti dell'avvio con .NET Native
ms.date: 03/30/2017
ms.assetid: c4d25b24-9c1a-4b3e-9705-97ba0d6c0289
ms.openlocfilehash: 41a693f18ffea0e5ce0ca742bc251d147e8e3784
ms.sourcegitcommit: b16c00371ea06398859ecd157defc81301c9070f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/06/2020
ms.locfileid: "79181004"
---
# <a name="measuring-startup-improvement-with-net-native"></a><span data-ttu-id="df167-102">Misurazione dei miglioramenti dell'avvio con .NET Native</span><span class="sxs-lookup"><span data-stu-id="df167-102">Measuring Startup Improvement with .NET Native</span></span>
<span data-ttu-id="df167-103">.NET Native migliora significativamente il tempo di avvio delle app.</span><span class="sxs-lookup"><span data-stu-id="df167-103">.NET Native significantly improves the launch time of apps.</span></span> <span data-ttu-id="df167-104">Questo miglioramento è particolarmente evidente nei dispositivi portatili a basso consumo e con app complesse.</span><span class="sxs-lookup"><span data-stu-id="df167-104">This improvement is particularly noticeable on portable, low-powered devices and with complex apps.</span></span> <span data-ttu-id="df167-105">In questo argomento viene introdotta la strumentazione di base necessaria per misurare il miglioramento dell'avvio.</span><span class="sxs-lookup"><span data-stu-id="df167-105">This topic helps you get started with the basic instrumentation needed to measure this startup improvement.</span></span>  
  
 <span data-ttu-id="df167-106">Per facilitare l'analisi delle prestazioni, .NET Framework e Windows usano un framework di eventi chiamato Event Tracing for Windows (ETW) che consente all'app di notificare gli strumenti quando si verificano degli eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-106">To facilitate performance investigations, the .NET Framework and Windows use an event framework called Event Tracing for Windows (ETW) that allows your app to notify tooling when events happen.</span></span> <span data-ttu-id="df167-107">È quindi possibile usare uno strumento chiamato PerfView per visualizzare e analizzare facilmente gli eventi ETW.</span><span class="sxs-lookup"><span data-stu-id="df167-107">You can then use a tool called PerfView to easily view and analyze of ETW events.</span></span> <span data-ttu-id="df167-108">In questo argomento viene descritto come:</span><span class="sxs-lookup"><span data-stu-id="df167-108">This topic explains how to:</span></span>  
  
- <span data-ttu-id="df167-109">Usare la classe <xref:System.Diagnostics.Tracing.EventSource> per creare eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-109">Use the <xref:System.Diagnostics.Tracing.EventSource> class to emit events.</span></span>  
  
- <span data-ttu-id="df167-110">Usare PerfView per raccogliere gli eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-110">Use PerfView to gather those events.</span></span>  
  
- <span data-ttu-id="df167-111">Usare PerfView per visualizzare gli eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-111">Use PerfView to display those events.</span></span>  
  
## <a name="using-eventsource-to-emit-events"></a><span data-ttu-id="df167-112">Uso di EventSource per creare eventi</span><span class="sxs-lookup"><span data-stu-id="df167-112">Using EventSource to emit events</span></span>  
 <span data-ttu-id="df167-113"><xref:System.Diagnostics.Tracing.EventSource> fornisce una classe base da cui creare un provider di eventi personalizzato.</span><span class="sxs-lookup"><span data-stu-id="df167-113"><xref:System.Diagnostics.Tracing.EventSource> provides a base class from which to create a custom event provider.</span></span> <span data-ttu-id="df167-114">In genere si crea una sottoclasse di <xref:System.Diagnostics.Tracing.EventSource> e si esegue il wrapping dei metodi `Write*` con i propri metodi di eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-114">Generally, you create a subclass of <xref:System.Diagnostics.Tracing.EventSource> and wrap the `Write*` methods with your own event methods.</span></span> <span data-ttu-id="df167-115">In genere viene usato un criterio singleton per ogni <xref:System.Diagnostics.Tracing.EventSource>.</span><span class="sxs-lookup"><span data-stu-id="df167-115">A singleton pattern is generally used for each <xref:System.Diagnostics.Tracing.EventSource>.</span></span>  
  
 <span data-ttu-id="df167-116">Ad esempio, la classe nel seguente esempio può essere usata per misurare due caratteristiche di prestazioni:</span><span class="sxs-lookup"><span data-stu-id="df167-116">For example, the class in the following example can be used to measure two performance characteristics:</span></span>  
  
- <span data-ttu-id="df167-117">L'ora di fine delle chiamate al costruttore della classe `App`.</span><span class="sxs-lookup"><span data-stu-id="df167-117">The time until the `App` class constructor was called.</span></span>  
  
- <span data-ttu-id="df167-118">L'ora di fine delle chiamate al costruttore della classe `MainPage`.</span><span class="sxs-lookup"><span data-stu-id="df167-118">The time until the `MainPage` constructor was called.</span></span>  
  
 [!code-csharp[ProjectN_ETW#1](../../../samples/snippets/csharp/VS_Snippets_CLR/projectn_etw/cs/etw1.cs#1)]  
  
 <span data-ttu-id="df167-119">È opportuno fare alcune considerazioni.</span><span class="sxs-lookup"><span data-stu-id="df167-119">There are a few things to notice here.</span></span> <span data-ttu-id="df167-120">Prima di tutto, un singleton viene creato in `AppEventSource.Log`.</span><span class="sxs-lookup"><span data-stu-id="df167-120">First, a singleton is created in `AppEventSource.Log`.</span></span> <span data-ttu-id="df167-121">Questa istanza viene usata per tutte le registrazioni.</span><span class="sxs-lookup"><span data-stu-id="df167-121">That instance will be used for all logging.</span></span> <span data-ttu-id="df167-122">Secondo, ogni metodo di eventi ha un <xref:System.Diagnostics.Tracing.EventAttribute>.</span><span class="sxs-lookup"><span data-stu-id="df167-122">Second, each event method has an <xref:System.Diagnostics.Tracing.EventAttribute>.</span></span> <span data-ttu-id="df167-123">In questo modo, gli strumenti possono associare l'indice del metodo <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> al metodo chiamato in `AppEventSource`.</span><span class="sxs-lookup"><span data-stu-id="df167-123">This helps tooling associate the index of the <xref:System.Diagnostics.Tracing.EventSource.WriteEvent%2A> method with the method that was called on `AppEventSource`.</span></span>  
  
 <span data-ttu-id="df167-124">Questi eventi sono puramente illustrativi.</span><span class="sxs-lookup"><span data-stu-id="df167-124">Note that these events are purely illustrative.</span></span> <span data-ttu-id="df167-125">La maggior parte dei codici app viene eseguita dopo questi eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-125">Most app code will run after these events.</span></span> <span data-ttu-id="df167-126">È necessario comprendere quali eventi nel codice corrispondono alle interazioni dell'utente, misurarli e migliorare i benchmark.</span><span class="sxs-lookup"><span data-stu-id="df167-126">You should understand which events in code correspond to user interactions, measure those, and improve those benchmarks.</span></span> <span data-ttu-id="df167-127">Inoltre, gli stessi eventi possono registrare una sola istanza alla volta.</span><span class="sxs-lookup"><span data-stu-id="df167-127">Also, the events themselves log only a single instance in time.</span></span> <span data-ttu-id="df167-128">Spesso, è utile disporre di una coppia di eventi di inizio e di fine per ogni operazione.</span><span class="sxs-lookup"><span data-stu-id="df167-128">It’s often useful to have paired start and stop events for every operation.</span></span> <span data-ttu-id="df167-129">Quando si esamina l'avvio dell'app, l'evento di inizio corrisponde in genere all'evento "Processo/Avvio" generato dal sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="df167-129">When examining app startup, the start event is generally the "Process/Start" event that the operating system emits.</span></span>  
  
 <span data-ttu-id="df167-130">Ad esempio, si supponga di creare un lettore RSS.</span><span class="sxs-lookup"><span data-stu-id="df167-130">For example, suppose you are creating an RSS reader.</span></span> <span data-ttu-id="df167-131">Alcuni scenari interessanti per la registrazione di un evento sono:</span><span class="sxs-lookup"><span data-stu-id="df167-131">A few interesting locations to log an event are:</span></span>  
  
- <span data-ttu-id="df167-132">Quando viene eseguito il primo rendering della pagina principale.</span><span class="sxs-lookup"><span data-stu-id="df167-132">When the main page is first rendered.</span></span>  
  
- <span data-ttu-id="df167-133">Quando le storie RSS obsolete vengono deserializzate dall'archivio locale.</span><span class="sxs-lookup"><span data-stu-id="df167-133">When old RSS stories are deserialized from local storage.</span></span>  
  
- <span data-ttu-id="df167-134">Quando l'app inizia la sincronizzazione con le nuove storie.</span><span class="sxs-lookup"><span data-stu-id="df167-134">When your app begins syncing new stories.</span></span>  
  
- <span data-ttu-id="df167-135">Quando l'app termina la sincronizzazione delle nuove storie.</span><span class="sxs-lookup"><span data-stu-id="df167-135">When your app has finished syncing new stories.</span></span>  
  
 <span data-ttu-id="df167-136">La strumentazione di un'app è semplice: è sufficiente chiamare il metodo appropriato nella classe derivata.</span><span class="sxs-lookup"><span data-stu-id="df167-136">Instrumenting an app is straightforward: Just call the appropriate method on the derived class.</span></span> <span data-ttu-id="df167-137">Usando `AppEventSource` dell'esempio precedente, è possibile instrumentare l'app come segue:</span><span class="sxs-lookup"><span data-stu-id="df167-137">Using `AppEventSource` from the previous example, you can instrument an app as follows:</span></span>  
  
 [!code-csharp[ProjectN_ETW#2](../../../samples/snippets/csharp/VS_Snippets_CLR/projectn_etw/cs/etw2.cs#2)]  
  
 <span data-ttu-id="df167-138">Dopo la strumentazione dell'app è possibile raccogliere gli eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-138">When the app is instrumented, you’re ready to gather events.</span></span>  
  
## <a name="gathering-events-with-perfview"></a><span data-ttu-id="df167-139">Raccolta di eventi con PerfView</span><span class="sxs-lookup"><span data-stu-id="df167-139">Gathering events with PerfView</span></span>  
 <span data-ttu-id="df167-140">PerfView usa gli eventi ETW per eseguire tutti i tipi di analisi delle prestazioni sull'app.</span><span class="sxs-lookup"><span data-stu-id="df167-140">PerfView uses ETW events to help you do all sorts of performance investigations on your app.</span></span> <span data-ttu-id="df167-141">Include anche una configurazione GUI che consente di attivare e disattivare la registrazione per i diversi tipi di eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-141">It also includes a configuration GUI that lets you turn logging for different types of events on or off.</span></span> <span data-ttu-id="df167-142">PerfView è uno strumento gratuito scaricabile dall'[Area download Microsoft](https://www.microsoft.com/download/details.aspx?id=28567).</span><span class="sxs-lookup"><span data-stu-id="df167-142">PerfView is a free tool and can be downloaded from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=28567).</span></span> <span data-ttu-id="df167-143">Per altre informazioni, guardare i [video delle esercitazioni di PerfView](https://channel9.msdn.com/Series/PerfView-Tutorial).</span><span class="sxs-lookup"><span data-stu-id="df167-143">For more information, watch the [PerfView tutorial videos](https://channel9.msdn.com/Series/PerfView-Tutorial).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="df167-144">PerfView non consente di raccogliere eventi nei sistemi ARM.</span><span class="sxs-lookup"><span data-stu-id="df167-144">PerfView cannot be used to collect events on ARM systems.</span></span> <span data-ttu-id="df167-145">Per raccogliere gli eventi nei sistemi ARM, usare Windows Performance Recorder (WPR).</span><span class="sxs-lookup"><span data-stu-id="df167-145">To collect events on ARM systems, use Windows Performance Recorder (WPR).</span></span> <span data-ttu-id="df167-146">Per altre informazioni, vedere il [post di blog di Vance Morrison](https://docs.microsoft.com/archive/blogs/vancem/collecting-etwperfview-data-on-an-windows-rt-winrt-arm-surface-device).</span><span class="sxs-lookup"><span data-stu-id="df167-146">For more information, see [Vance Morrison's blog post](https://docs.microsoft.com/archive/blogs/vancem/collecting-etwperfview-data-on-an-windows-rt-winrt-arm-surface-device).</span></span>  
  
 <span data-ttu-id="df167-147">PerfView può essere richiamato anche dalla riga di comando.</span><span class="sxs-lookup"><span data-stu-id="df167-147">You can also invoke PerfView from the command line.</span></span> <span data-ttu-id="df167-148">Per registrare solo gli eventi dal provider, aprire la finestra del prompt dei comandi e digitare il comando:</span><span class="sxs-lookup"><span data-stu-id="df167-148">To log only the events from your provider, open the Command Prompt window and enter the command:</span></span>  
  
```console
perfview -KernelEvents:Process -OnlyProviders:*MyCompany-MyApp collect outputFile
```  
  
 <span data-ttu-id="df167-149">dove:</span><span class="sxs-lookup"><span data-stu-id="df167-149">where:</span></span>  
  
 `-KernelEvents:Process`  
 <span data-ttu-id="df167-150">Indica che si vuole sapere l'ora di inizio e di fine del processo.</span><span class="sxs-lookup"><span data-stu-id="df167-150">Indicates that you want to know when the process starts and stops.</span></span> <span data-ttu-id="df167-151">È necessario l'evento Processo/Avvio per l'app, in modo da sottrarlo al tempo associato agli altri eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-151">You need the Process/Start event for your app so it can be subtracted from other event times.</span></span>  
  
 `-OnlyProviders:*MyCompany-MyApp`  
 <span data-ttu-id="df167-152">Disattiva gli altri provider che PerfView attiva per impostazione predefinita e attiva il provider MyCompany-MyApp.</span><span class="sxs-lookup"><span data-stu-id="df167-152">Turns off other providers that PerfView turns on by default, and turns on the MyCompany-MyApp provider.</span></span>  <span data-ttu-id="df167-153">L'asterisco indica che si tratta di un <xref:System.Diagnostics.Tracing.EventSource>.</span><span class="sxs-lookup"><span data-stu-id="df167-153">(The asterisk indicates that it is an <xref:System.Diagnostics.Tracing.EventSource>.)</span></span>  
  
 `collect outputFile`  
 <span data-ttu-id="df167-154">Indica che si vuole avviare la raccolta e salvare i dati in outputFile.etl.zip.</span><span class="sxs-lookup"><span data-stu-id="df167-154">Indicates that you want to start collection and save the data to outputFile.etl.zip.</span></span>  
  
 <span data-ttu-id="df167-155">Eseguire l'app dopo l'avvio di PerfView.</span><span class="sxs-lookup"><span data-stu-id="df167-155">Run your app after starting PerfView.</span></span> <span data-ttu-id="df167-156">Quando si esegue l'app, ricordare quanto segue:</span><span class="sxs-lookup"><span data-stu-id="df167-156">There are a few things to remember when running your app:</span></span>  
  
- <span data-ttu-id="df167-157">Usare una build di rilascio, non una build di debug.</span><span class="sxs-lookup"><span data-stu-id="df167-157">Use a release build, not a debug build.</span></span> <span data-ttu-id="df167-158">Le build di debug spesso contengono codice aggiuntivo per il controllo e la gestione degli errori che può causare un rallentamento della normale esecuzione dell'app.</span><span class="sxs-lookup"><span data-stu-id="df167-158">Debug builds often contain extra error checking and error handling code that can cause your app to run slower than expected.</span></span>  
  
- <span data-ttu-id="df167-159">L'esecuzione con un debugger collegato influisce sulle prestazioni dell'app.</span><span class="sxs-lookup"><span data-stu-id="df167-159">Running your app with a debugger attached affects the performance of your app.</span></span>  
  
- <span data-ttu-id="df167-160">Windows usa più strategie di memorizzazione nella cache per accelerare i tempi di avvio dell'app.</span><span class="sxs-lookup"><span data-stu-id="df167-160">Windows uses multiple caching strategies to speed up app launch times.</span></span> <span data-ttu-id="df167-161">Se l'app è attualmente nella memoria della cache e non deve essere caricata dal disco, viene avviata più rapidamente.</span><span class="sxs-lookup"><span data-stu-id="df167-161">If your app is currently cached in memory and doesn't have to be loaded from disk, it will start faster.</span></span> <span data-ttu-id="df167-162">Per garantire la coerenza, avviare e chiudere l'app più volte prima della misurazione.</span><span class="sxs-lookup"><span data-stu-id="df167-162">To ensure consistency, start and close your app a few times before measuring it.</span></span>  
  
 <span data-ttu-id="df167-163">Dopo aver eseguito l'app per consentire a PerfView di raccogliere gli eventi creati, scegliere il pulsante **Stop Collection** (Interrompi raccolta).</span><span class="sxs-lookup"><span data-stu-id="df167-163">When you’ve run your app so that PerfView can collect emitted events, choose the **Stop Collection** button.</span></span> <span data-ttu-id="df167-164">In genere la raccolta deve essere arrestata prima di chiudere l'app in modo da evitare eventi estranei.</span><span class="sxs-lookup"><span data-stu-id="df167-164">Generally, you should stop collection before closing your app so you don’t get extraneous events.</span></span> <span data-ttu-id="df167-165">Tuttavia, se si misurano le prestazioni di arresto o di sospensione è opportuno continuare la raccolta.</span><span class="sxs-lookup"><span data-stu-id="df167-165">However, if you’re measuring shutdown or suspension performance, you’ll want to continue collection.</span></span>  
  
## <a name="displaying-the-events"></a><span data-ttu-id="df167-166">Visualizzazione degli eventi</span><span class="sxs-lookup"><span data-stu-id="df167-166">Displaying the events</span></span>  
 <span data-ttu-id="df167-167">Per visualizzare gli eventi già raccolti, usare PerfView per aprire il file ETL o etl.zip creato e scegliere **Events** (Eventi).</span><span class="sxs-lookup"><span data-stu-id="df167-167">To view the events that have already been collected, use PerfView to open the .etl or .etl.zip file you created and choose **Events**.</span></span> <span data-ttu-id="df167-168">ETW avrà raccolto informazioni su numerosi eventi, inclusi quelli provenienti da altri processi.</span><span class="sxs-lookup"><span data-stu-id="df167-168">ETW will have collected information about a large number of events, including events from other processes.</span></span> <span data-ttu-id="df167-169">Per concentrare l'analisi, completare le seguenti caselle di testo nella visualizzazione degli eventi:</span><span class="sxs-lookup"><span data-stu-id="df167-169">To focus your investigation, complete the following text boxes in the events view:</span></span>  
  
- <span data-ttu-id="df167-170">Nella casella **Process Filter** (Filtro processo) specificare il nome dell'app (senza ".exe").</span><span class="sxs-lookup"><span data-stu-id="df167-170">In the **Process Filter** box, specify your app name (without ".exe").</span></span>  
  
- <span data-ttu-id="df167-171">Nella casella **Event Types Filter** (Filtro tipi di evento) specificare `Process/Start | MyCompany-MyApp`.</span><span class="sxs-lookup"><span data-stu-id="df167-171">In the **Event Types Filter** box, specify `Process/Start | MyCompany-MyApp`.</span></span> <span data-ttu-id="df167-172">Viene impostato un filtro per gli eventi provenienti da MyCompany-MyApp e l'evento Kernel Windows/Processo/Avvio.</span><span class="sxs-lookup"><span data-stu-id="df167-172">This sets a filter for events from MyCompany-MyApp and the Windows Kernel/Process/Start event.</span></span>  
  
 <span data-ttu-id="df167-173">Selezionare tutti gli eventi elencati nel riquadro di sinistra (CTRL+A) e premere **INVIO**.</span><span class="sxs-lookup"><span data-stu-id="df167-173">Select all the events listed in the left pane (Ctrl-A) and choose the **Enter** key.</span></span> <span data-ttu-id="df167-174">A questo punto, dovrebbero essere visualizzati i timestamp di tutti gli eventi.</span><span class="sxs-lookup"><span data-stu-id="df167-174">Now, you should be able to see the timestamps from each event.</span></span> <span data-ttu-id="df167-175">Questi timestamp sono relativi all'inizio della traccia, quindi è necessario sottrarre il tempo di ciascun evento dall'ora di inizio del processo per identificare il tempo trascorso dall'avvio.</span><span class="sxs-lookup"><span data-stu-id="df167-175">These timestamps are relative to the start of the trace, so you have to subtract the time of each event from the start time of the process to identify the elapsed time since startup.</span></span> <span data-ttu-id="df167-176">Se si usa CTRL + clic per selezionare due timestamp, la differenza tra di essi verrà visualizzata nella barra di stato nella parte inferiore della pagina.</span><span class="sxs-lookup"><span data-stu-id="df167-176">If you use Ctrl+Click to select two timestamps, you'll see the difference between them displayed in the status bar at the bottom of the page.</span></span> <span data-ttu-id="df167-177">Questo consente di visualizzare facilmente il tempo trascorso tra due eventi nella visualizzazione (compreso l'avvio del processo).</span><span class="sxs-lookup"><span data-stu-id="df167-177">This makes it easy to see the elapsed time between any two events in the display (including process start).</span></span> <span data-ttu-id="df167-178">È possibile aprire il menu di scelta rapida per la visualizzazione e selezionare diverse opzioni utili, ad esempio l'esportazione in file CSV o l'apertura di Microsoft Excel per salvare o elaborare i dati.</span><span class="sxs-lookup"><span data-stu-id="df167-178">You can open the shortcut menu for the view and select from a number of useful options, like exporting to CSV files or opening Microsoft Excel to save or process the data.</span></span>  
  
 <span data-ttu-id="df167-179">Ripetendo la procedura per l'app originale e la versione compilata con la catena di strumenti .NET Native, è possibile confrontare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="df167-179">By repeating the procedure for both your original app and the version you built by using the .NET Native tool chain, you can compare the difference in performance.</span></span>   <span data-ttu-id="df167-180">Le app .NET Native in genere iniziano più velocemente rispetto alle app native di non-.NET.</span><span class="sxs-lookup"><span data-stu-id="df167-180">.NET Native apps generally start faster than non-.NET Native apps.</span></span> <span data-ttu-id="df167-181">Se si desidera, PerfView fornisce anche informazioni dettagliate che consentono di identificare le parti di codice che richiedono più tempo.</span><span class="sxs-lookup"><span data-stu-id="df167-181">If you’re interested in digging deeper, PerfView can also identify the parts of your code that are taking the most time.</span></span> <span data-ttu-id="df167-182">Per altre informazioni, guardare le [esercitazioni di PerfView](https://channel9.msdn.com/Series/PerfView-Tutorial) o leggere il [post di blog di Vance Morrison](https://docs.microsoft.com/archive/blogs/vancem/publication-of-the-perfview-performance-analysis-tool).</span><span class="sxs-lookup"><span data-stu-id="df167-182">For more information, watch the [PerfView tutorials](https://channel9.msdn.com/Series/PerfView-Tutorial) or read [Vance Morrison’s blog entry](https://docs.microsoft.com/archive/blogs/vancem/publication-of-the-perfview-performance-analysis-tool).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="df167-183">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="df167-183">See also</span></span>

- <xref:System.Diagnostics.Tracing.EventSource>
