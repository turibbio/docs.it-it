---
title: Estensibilità host del servizio flusso di lavoro
ms.date: 03/30/2017
ms.assetid: c0e8f7bb-cb13-49ec-852f-b85d7c23972f
ms.openlocfilehash: 4c2edec8c23e27f019b95223c998c72069384c75
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84594894"
---
# <a name="workflow-service-host-extensibility"></a><span data-ttu-id="87770-102">Estensibilità host del servizio flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="87770-102">Workflow Service Host Extensibility</span></span>
[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)] <span data-ttu-id="87770-103">fornisce la classe <xref:System.ServiceModel.Activities.WorkflowServiceHost> per ospitare i servizi flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="87770-103">provides the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class for hosting workflow services.</span></span> <span data-ttu-id="87770-104">Questa classe viene usata in caso di hosting automatico di un servizio flusso di lavoro in un'applicazione gestita o un servizio Windows.</span><span class="sxs-lookup"><span data-stu-id="87770-104">This class is used when you are self-hosting a workflow service in a managed application or a Windows service.</span></span> <span data-ttu-id="87770-105">La classe viene inoltre usata quando si ospita un servizio flusso di lavoro con IIS (Internet Information Services) o con il servizio Attivazione Processo Windows (WAS, Windows Process Activation Service).</span><span class="sxs-lookup"><span data-stu-id="87770-105">This class is also used when hosting a workflow service with Internet Information Services (IIS) or Windows Process Activation Service (WAS).</span></span> <span data-ttu-id="87770-106">La classe <xref:System.ServiceModel.Activities.WorkflowServiceHost> fornisce punti di estensione che consentono di aggiungere estensioni personalizzate, modificare il comportamento inattivo e ospitare flussi di lavoro non di servizi (ovvero che non usano attività di messaggistica).</span><span class="sxs-lookup"><span data-stu-id="87770-106">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> class provides extension points that allow you to add custom extensions, change the idle behavior, and host non-service workflows (workflows that do not use messaging activities).</span></span>  
  
## <a name="workflow-service-host-extensions"></a><span data-ttu-id="87770-107">Estensioni host del servizio flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="87770-107">Workflow Service Host Extensions</span></span>  
 <span data-ttu-id="87770-108"><xref:System.ServiceModel.Activities.WorkflowServiceHost> contiene una proprietà <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> di tipo <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> che fornisce un metodo per l'aggiunta di estensioni a <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="87770-108">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> contains a <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> property of type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> that provides methods to add extensions to the <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="87770-109">Usare il metodo <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> per aggiungere un'estensione per ogni istanza del servizio flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="87770-109">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service instance.</span></span> <span data-ttu-id="87770-110">Il delegato specificato viene chiamato per creare una nuova estensione quando un'istanza del servizio flusso di lavoro viene creata o caricata da un archivio di persistenza.</span><span class="sxs-lookup"><span data-stu-id="87770-110">The delegate specified is called to create a new extension when a workflow service instance is created or loaded from a persistence store.</span></span> <span data-ttu-id="87770-111">Usare il metodo <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> per aggiungere un'estensione per ogni host del servizio flusso di lavoro. Un'istanza dell'estensione viene condivisa per tutte le istanze del servizio flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="87770-111">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service host, one instance of the extension is shared for all workflow service instances.</span></span>  
  
## <a name="react-to-unhandled-exceptions"></a><span data-ttu-id="87770-112">Reazione alle eccezioni non gestite</span><span class="sxs-lookup"><span data-stu-id="87770-112">React to Unhandled Exceptions</span></span>  
 <span data-ttu-id="87770-113"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> consente di specificare l'azione da eseguire quando si verifica un'eccezione non gestita in un servizio flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="87770-113">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> enables you to specify the action to take if an unhandled exception occurs within a workflow service.</span></span> <span data-ttu-id="87770-114">La proprietà <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> specifica uno dei valori <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction>:</span><span class="sxs-lookup"><span data-stu-id="87770-114">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> property specifies one of the <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> values:</span></span>  
  
- <span data-ttu-id="87770-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> - Interrompe l'istanza del servizio flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="87770-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Aborts the workflow service instance.</span></span>  
  
- <span data-ttu-id="87770-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> - Esegue il rollback all'ultimo stato persistente e sospende l'istanza del servizio flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="87770-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Rolls back to the last persisted state and suspends the workflow service instance.</span></span> <span data-ttu-id="87770-117">Questo caso si verifica solo se il flusso di lavoro è già stato reso persistente almeno una volta.</span><span class="sxs-lookup"><span data-stu-id="87770-117">This only occurs if the workflow has already been persisted at least once.</span></span> <span data-ttu-id="87770-118">In caso contrario, l'istanza del flusso di lavoro viene interrotta.</span><span class="sxs-lookup"><span data-stu-id="87770-118">If not the workflow instance is aborted.</span></span>  
  
- <span data-ttu-id="87770-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> - Annulla l'istanza.</span><span class="sxs-lookup"><span data-stu-id="87770-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Cancels the instance.</span></span>  
  
- <span data-ttu-id="87770-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> - Termina l'istanza.</span><span class="sxs-lookup"><span data-stu-id="87770-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Terminates the instance.</span></span>  
  
 <span data-ttu-id="87770-121">È possibile configurare questo comportamento nel codice, come indicato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="87770-121">This behavior can be configured in code as shown in the following example.</span></span>  
  
```csharp  
host.Description.Behaviors.Add(new WorkflowUnhandledExceptionBehavior { Action = WorkflowUnhandledExceptionAction.Abandon });  
```  
  
 <span data-ttu-id="87770-122">È inoltre possibile configurarlo in un file di configurazione, come indicato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="87770-122">It can also be configured in a configuration file as shown in the following example.</span></span>  
  
```xml
<behaviors>  
      <serviceBehaviors>  
        <behavior>  
          <serviceMetadata httpGetEnabled="True"/>  
          <serviceDebug includeExceptionDetailInFaults="False" />  
          <workflowUnhandledExceptionBehavior action="Abandon" />
        </behavior>  
      </serviceBehaviors>  
</behaviors>
```  
  
## <a name="hosting-non-service-workflows"></a><span data-ttu-id="87770-123">Hosting di flussi di lavoro non di servizi</span><span class="sxs-lookup"><span data-stu-id="87770-123">Hosting Non-Service Workflows</span></span>  
 <span data-ttu-id="87770-124">È possibile usare <xref:System.ServiceModel.Activities.WorkflowServiceHost> per ospitare flussi di lavoro non di servizi, che non iniziano con un'attività <xref:System.ServiceModel.Activities.Receive> o che non usano le attività di messaggistica.</span><span class="sxs-lookup"><span data-stu-id="87770-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> can be used to host non-service workflows, or workflows that either do not begin with a <xref:System.ServiceModel.Activities.Receive> activity or workflows that do not use the messaging activities.</span></span> <span data-ttu-id="87770-125">I servizi flusso di lavoro iniziano in genere con un'attività <xref:System.ServiceModel.Activities.Receive>.</span><span class="sxs-lookup"><span data-stu-id="87770-125">Workflow services normally begin with a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="87770-126">Se <xref:System.ServiceModel.Activities.WorkflowServiceHost> riceve un messaggio per un servizio flusso di lavoro, viene creata una nuova istanza del servizio flusso di lavoro (se non è già in esecuzione o non è stata già resa persistente).</span><span class="sxs-lookup"><span data-stu-id="87770-126">When the <xref:System.ServiceModel.Activities.WorkflowServiceHost> receives a message for a workflow service, if it is not already running (or persisted) a new workflow service instance is created.</span></span> <span data-ttu-id="87770-127">Se un flusso di lavoro non inizia con un'attività Receive, non può essere avviato inviando un messaggio, poiché non è presente alcuna attività che riceva il messaggio.</span><span class="sxs-lookup"><span data-stu-id="87770-127">If a workflow does not begin with a Receive activity, it cannot be started by sending a message because there is no activity to receive the message.</span></span> <span data-ttu-id="87770-128">Per ospitare un flusso di lavoro non di servizio, derivare una classe da <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> ed eseguire l'override di <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> e <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span><span class="sxs-lookup"><span data-stu-id="87770-128">To host a non-service workflow, derive a class from <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> and override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, and <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span></span> <span data-ttu-id="87770-129">Eseguire l'override di <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> se si desidera fornire un ID istanza preferito.</span><span class="sxs-lookup"><span data-stu-id="87770-129">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> if you want to provide a preferred instance ID.</span></span> <span data-ttu-id="87770-130">Eseguire l'override di <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> per creare un contesto di creazione di flusso di lavoro personalizzato o popolare un'istanza dell'elemento <xref:System.ServiceModel.Activities.WorkflowCreationContext> esistente.</span><span class="sxs-lookup"><span data-stu-id="87770-130">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> to create a custom workflow creation context or populate an instance of the existing <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span></span> <span data-ttu-id="87770-131">Eseguire l'override di <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> per estrarre manualmente il segnalibro dal messaggio in ingresso.</span><span class="sxs-lookup"><span data-stu-id="87770-131">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> to manually extract the bookmark from the incoming message.</span></span> <span data-ttu-id="87770-132">Se si esegue l'override di questo metodo, è necessario richiamare <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> dal corpo del metodo per rispondere al messaggio inviato a WorkflowHostingEndpoint.</span><span class="sxs-lookup"><span data-stu-id="87770-132">If you override this method, you must invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in its body so as to respond to the message sent to the WorkflowHostingEndpoint.</span></span> <span data-ttu-id="87770-133">In caso contrario, potrebbe venire superato il limite <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A>.</span><span class="sxs-lookup"><span data-stu-id="87770-133">If you do not do so, a <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limit may be eventually exceeded.</span></span> <span data-ttu-id="87770-134">Nei contratti bidirezionali, potrebbe rilevarsi l'impossibilità di richiamare <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in quanto il client non è in grado di ricevere una risposta.</span><span class="sxs-lookup"><span data-stu-id="87770-134">In two-way contracts, you may be able to detect your   failure to invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> because of the client’s failure to receive a response.</span></span> <span data-ttu-id="87770-135">Nei contratti unidirezionali è invece possibile che non si riesca a rilevare l'impossibilità di richiamare <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> se non troppo tardi, dopo che il limite <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> è stato superato.</span><span class="sxs-lookup"><span data-stu-id="87770-135">In one-way contracts, you may not recognize the mistake of failing to call <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> until it’s too late, after the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> throttle limit is exceeded.</span></span> <span data-ttu-id="87770-136">Per ulteriori informazioni, vedere il [segnalibro Resume WorkflowHostingEndpoint](../../windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)per creare una nuova istanza di un flusso di lavoro non di servizio, dichiarare un contratto di servizio che definisce un'operazione che crea una nuova istanza.</span><span class="sxs-lookup"><span data-stu-id="87770-136">For more information, please see the [WorkflowHostingEndpoint Resume Bookmark](../../windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)To create a new instance of a non-service workflow, declare a service contract that defines an operation that creates a new instance.</span></span> <span data-ttu-id="87770-137">L'operazione di creazione deve prendere un IDictionary \<string, object> per passare tutti i parametri del flusso di lavoro necessari.</span><span class="sxs-lookup"><span data-stu-id="87770-137">The creation operation should take an IDictionary\<string, object> to pass any required workflow parameters.</span></span> <span data-ttu-id="87770-138">Questo contratto viene implementato in modo implicito dalla classe derivata da <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="87770-138">This contract is implicitly implemented by the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class.</span></span> <span data-ttu-id="87770-139">In fase di hosting del flusso di lavoro, aggiungere un'istanza della classe derivata da <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> all'host chiamando <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> e chiamare <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span><span class="sxs-lookup"><span data-stu-id="87770-139">When hosting the workflow, add an instance of the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class to the host by calling <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> and call <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span></span> <span data-ttu-id="87770-140">Per creare un'istanza del flusso di lavoro, creare un elemento <xref:System.ServiceModel.ChannelFactory%601> del tipo di contratto di servizio e chiamare <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span><span class="sxs-lookup"><span data-stu-id="87770-140">To create an instance of the workflow, create a <xref:System.ServiceModel.ChannelFactory%601> of your service contract type and call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span></span> <span data-ttu-id="87770-141">È quindi possibile chiamare l'operazione di creazione definita nel contratto di servizio.</span><span class="sxs-lookup"><span data-stu-id="87770-141">You can then call the create operation defined in your service contract.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="87770-142">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="87770-142">See also</span></span>

- [<span data-ttu-id="87770-143">Servizi flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="87770-143">Workflow Services</span></span>](workflow-services.md)
- [<span data-ttu-id="87770-144">Attività di messaggistica</span><span class="sxs-lookup"><span data-stu-id="87770-144">Messaging Activities</span></span>](messaging-activities.md)
