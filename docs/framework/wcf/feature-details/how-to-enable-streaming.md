---
title: 'Procedura: attivare il flusso'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: c2c22ab699a996f4bc40d0b5f620ddd92ffe8059
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84593230"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="0fc9f-102">Procedura: attivare il flusso</span><span class="sxs-lookup"><span data-stu-id="0fc9f-102">How to: Enable Streaming</span></span>
<span data-ttu-id="0fc9f-103">Windows Communication Foundation (WCF) può inviare messaggi utilizzando trasferimenti memorizzati nel buffer o con flusso.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-103">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="0fc9f-104">Nella modalità predefinita, ovvero trasferimento con memorizzazione nel buffer, un messaggio deve essere recapitato completamente prima che un destinatario possa leggerlo.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-104">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="0fc9f-105">Nella modalità di trasferimento con flusso, il destinatario può iniziare a elaborare il messaggio prima che esso venga recapitato completamente.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-105">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="0fc9f-106">La modalità di trasmissione con flusso è utile quando le informazioni passate sono lunghe e possono essere elaborate in serie.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-106">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="0fc9f-107">La modalità di trasmissione con flusso è utile anche quando il messaggio è troppo grande da memorizzare completamente nel buffer.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-107">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="0fc9f-108">Per attivare il flusso, definire correttamente `OperationContract` e attivare il flusso a livello di trasporto.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-108">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="0fc9f-109">Per trasferire dati con flusso</span><span class="sxs-lookup"><span data-stu-id="0fc9f-109">To stream data</span></span>  
  
1. <span data-ttu-id="0fc9f-110">Per trasferire dati con flusso, `OperationContract` per il servizio deve soddisfare due requisiti:</span><span class="sxs-lookup"><span data-stu-id="0fc9f-110">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="0fc9f-111">Il parametro che contiene i dati da inviare in un flusso deve essere il solo parametro del metodo.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-111">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="0fc9f-112">Ad esempio, se il messaggio di input è quello da trasmettere, l'operazione deve avere esattamente un parametro di input.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-112">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="0fc9f-113">Allo stesso modo, se deve essere trasmesso il messaggio di output, l'operazione deve avere esattamente un solo parametro di output o un solo valore restituito.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-113">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="0fc9f-114">Almeno uno dei tipi di parametro e di valori restituiti deve essere <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message> o <xref:System.Xml.Serialization.IXmlSerializable>.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-114">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="0fc9f-115">Di seguito è riportato un esempio di contratto per dati trasferiti con flusso.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-115">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="0fc9f-116">L'operazione `GetStream` riceve alcuni dati di input memorizzati nel buffer come `string`, che è memorizzata nel buffer, e restituisce `Stream`, trasferito con flusso.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-116">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="0fc9f-117">Viceversa, `UploadStream` accetta uno `Stream` (trasmesso) e restituisce un `bool` (memorizzato nel buffer).</span><span class="sxs-lookup"><span data-stu-id="0fc9f-117">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="0fc9f-118">`EchoStream` accetta e restituisce uno `Stream` ed è un esempio di un'operazione i cui messaggi di input e output vengono entrambi trasmessi.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-118">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="0fc9f-119">Infine, `GetReversedStream` non prende input e restituisce un `Stream` (trasmesso).</span><span class="sxs-lookup"><span data-stu-id="0fc9f-119">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="0fc9f-120">La trasmissione deve essere attivata nell'associazione.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-120">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="0fc9f-121">Impostare una proprietà `TransferMode`, che può prendere uno dei valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="0fc9f-121">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="0fc9f-122">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="0fc9f-122">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="0fc9f-123">`Streamed`, che consente di attivare la comunicazione con flusso bidirezionale.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-123">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="0fc9f-124">`StreamedRequest`, che consente la trasmissione della sola richiesta.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-124">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="0fc9f-125">`StreamedResponse`, che consente la trasmissione della sola risposta.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-125">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="0fc9f-126">`BasicHttpBinding` espone la proprietà `TransferMode` sull'associazione come fanno anche `NetTcpBinding` e `NetNamedPipeBinding`.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-126">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="0fc9f-127">La proprietà `TransferMode` può essere impostata anche sull'elemento di associazione di trasporto e utilizzata in un'associazione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-127">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="0fc9f-128">Negli esempi seguenti viene illustrato come impostare `TransferMode` tramite codice e modificando il file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-128">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="0fc9f-129">In entrambi gli esempi, inoltre, la proprietà `maxReceivedMessageSize` viene impostata a 64 MB, che pone un limite alla dimensione massima consentita dei messaggi in ricezione.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-129">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="0fc9f-130">La misura predefinita è `maxReceivedMessageSize` 64 KB che è di solito troppo bassa per gli scenari di flusso.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-130">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="0fc9f-131">Impostare questa quota come appropriato in base alla dimensione massima dei messaggi che l'applicazione si aspetta di ricevere.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-131">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="0fc9f-132">Si noti inoltre che `maxBufferSize` controlla la dimensione massima memorizzata nel buffer e l'imposta correttamente.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-132">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="0fc9f-133">Nel frammento seguente di configurazione, preso dall'esempio, viene illustrata l'impostazione della proprietà `TransferMode` su trasmissione in `basicHttpBinding` e un'associazione HTTP personalizzata:</span><span class="sxs-lookup"><span data-stu-id="0fc9f-133">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="0fc9f-134">Nel frammento di codice seguente viene illustrata l'impostazione della proprietà `TransferMode` su trasmissione in `basicHttpBinding` e un'associazione HTTP personalizzata.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-134">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="0fc9f-135">Nel frammento di codice seguente viene illustrata l'impostazione della proprietà `TransferMode` su trasmissione in un'associazione TCP personalizzata.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-135">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="0fc9f-136">Le operazioni `GetStream`, `UploadStream` e `EchoStream` riguardano entrambe l'invio diretto di dati da un file o il salvataggio diretto dei dati ricevuti in un file.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-136">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="0fc9f-137">Il codice seguente riguarda `GetStream`.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-137">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="0fc9f-138">Scrittura di un flusso personalizzato</span><span class="sxs-lookup"><span data-stu-id="0fc9f-138">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="0fc9f-139">Per eseguire un'elaborazione speciale su ogni blocco di flusso di dati quando viene inviato o ricevuto, derivare una classe del flusso personalizzato da <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-139">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="0fc9f-140">Come esempio di flusso personalizzato, il codice riportato di seguito contiene un metodo `GetReversedStream` e una classe `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-140">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="0fc9f-141">`GetReversedStream` crea e restituisce una nuova istanza di `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-141">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="0fc9f-142">L'elaborazione effettiva si verifica quando il sistema legge dall'oggetto `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-142">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="0fc9f-143">Il metodo `ReverseStream.Read` legge un blocco di byte dal file sottostante, li inverte, quindi restituisce i byte invertiti.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-143">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="0fc9f-144">Questo metodo non inverte l'intero contenuto del file, ma un blocco di byte alla volta.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-144">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="0fc9f-145">In questo esempio viene illustrato come eseguire l'elaborazione del flusso mentre il contenuto viene letto o scritto da e verso il flusso.</span><span class="sxs-lookup"><span data-stu-id="0fc9f-145">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="0fc9f-146">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="0fc9f-146">See also</span></span>

- [<span data-ttu-id="0fc9f-147">Flussi e dati di grandi dimensioni</span><span class="sxs-lookup"><span data-stu-id="0fc9f-147">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="0fc9f-148">STREAM</span><span class="sxs-lookup"><span data-stu-id="0fc9f-148">Stream</span></span>](../samples/stream.md)
