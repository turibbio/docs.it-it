---
title: Protocollo di scambio del contesto
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: 86d2a19b086fbd5d6be6f1a084bfd7aaace0e250
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84597436"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="7cb83-102">Protocollo di scambio del contesto</span><span class="sxs-lookup"><span data-stu-id="7cb83-102">Context Exchange Protocol</span></span>
<span data-ttu-id="7cb83-103">In questa sezione viene descritto il protocollo di scambio del contesto introdotto nella versione Windows Communication Foundation (WCF) .NET Framework versione 3,5.</span><span class="sxs-lookup"><span data-stu-id="7cb83-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="7cb83-104">Questo protocollo consente al canale client di accettare un contesto fornito da un servizio e di applicarlo a tutte le richieste successive a quel servizio inviate sulla stessa istanza del canale client.</span><span class="sxs-lookup"><span data-stu-id="7cb83-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="7cb83-105">L'implementazione del protocollo di scambio del contesto può utilizzare uno dei due meccanismi seguenti per propagare il contesto tra il server e il client: cookie HTTP o un'intestazione SOAP.</span><span class="sxs-lookup"><span data-stu-id="7cb83-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="7cb83-106">Il protocollo di scambio del contesto viene implementato in un livello del canale personalizzato.</span><span class="sxs-lookup"><span data-stu-id="7cb83-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="7cb83-107">Il canale comunica il contesto da e verso il livello dell'applicazione utilizzando una proprietà <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="7cb83-108">Per la trasmissione tra endpoint, il valore del contesto viene serializzato come intestazione SOAP a livello del canale oppure convertito in o da le proprietà del messaggio che rappresentano una richiesta e una risposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="7cb83-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="7cb83-109">Nel secondo caso, è previsto che uno dei livelli di canale sottostanti converta la richiesta HTTP e le proprietà del messaggio di risposta rispettivamente in e da cookie HTTP.</span><span class="sxs-lookup"><span data-stu-id="7cb83-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="7cb83-110">Il meccanismo utilizzato per scambiare il contesto viene scelto utilizzando la proprietà <xref:System.ServiceModel.Channels.ContextExchangeMechanism> in <xref:System.ServiceModel.Channels.ContextBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="7cb83-111">I valori validi sono `HttpCookie` o `SoapHeader`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="7cb83-112">Sul client, un'istanza di un canale può operare in due modalità basate sulle impostazioni nella proprietà del canale, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="7cb83-113">Modalità 1: gestione del contesto del canale</span><span class="sxs-lookup"><span data-stu-id="7cb83-113">Mode 1: Channel Context Management</span></span>  
 <span data-ttu-id="7cb83-114">Questa è la modalità predefinita, in cui <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> è impostato su `true`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="7cb83-115">In questa modalità il canale del contesto gestisce il contesto e lo memorizza nella cache per la sua durata.</span><span class="sxs-lookup"><span data-stu-id="7cb83-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="7cb83-116">Il contesto può essere recuperato dal canale tramite la proprietà del canale `IContextManager` chiamando il metodo `GetContext`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="7cb83-117">Il canale può inoltre essere preinizializzato con un contesto specifico prima di venire aperto, chiamando il metodo `SetContext` sulla proprietà del canale.</span><span class="sxs-lookup"><span data-stu-id="7cb83-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="7cb83-118">Dopo essere stato inizializzato con il contesto, il canale non può essere reimpostato.</span><span class="sxs-lookup"><span data-stu-id="7cb83-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="7cb83-119">Di seguito vengono elencate le invarianti in questa modalità:</span><span class="sxs-lookup"><span data-stu-id="7cb83-119">The following is a list of invariants in this mode:</span></span>  
  
- <span data-ttu-id="7cb83-120">Qualsiasi tentativo di reimpostare il contesto utilizzando `SetContext` dopo che il canale è stato aperto genera una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="7cb83-121">Qualsiasi tentativo di inviare il contesto utilizzando <xref:System.ServiceModel.Channels.ContextMessageProperty> in un messaggio in uscita genera una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="7cb83-122">Se un messaggio viene ricevuto dal server con un contesto specifico, quando il canale è già stato inizializzato con un contesto specifico, viene generata una <xref:System.ServiceModel.ProtocolException>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="7cb83-123">La ricezione di un contesto iniziale dal server è appropriata solo se il canale viene aperto senza alcun contesto impostato in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="7cb83-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
- <span data-ttu-id="7cb83-124"><xref:System.ServiceModel.Channels.ContextMessageProperty> su un messaggio in arrivo è sempre null.</span><span class="sxs-lookup"><span data-stu-id="7cb83-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="7cb83-125">Modalità 2: gestione del contesto dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="7cb83-125">Mode 2: Application Context Management</span></span>  
 <span data-ttu-id="7cb83-126">Questa è la modalità quando <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> è impostato su `false`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="7cb83-127">In questa modalità il canale del contesto non gestisce il contesto.</span><span class="sxs-lookup"><span data-stu-id="7cb83-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="7cb83-128">È di responsabilità dell'applicazione recuperare, gestire e applicare il contesto utilizzando <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="7cb83-129">Qualsiasi tentativo di chiamare `GetContext` o `SetContext` genera una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="7cb83-130">A prescindere dalla modalità scelta, la channel factory del client supporta i modelli di scambio dei messaggi <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel> e <xref:System.ServiceModel.Channels.IDuplexSessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="7cb83-131">Nel servizio, un'istanza del canale ha la responsabilità di convertire il contesto fornito dal client sui messaggi in arrivo a <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="7cb83-132">Il livello dell'applicazione o altri canali più in alto nello stack delle chiamate possono quindi accedere alla proprietà del messaggio.</span><span class="sxs-lookup"><span data-stu-id="7cb83-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="7cb83-133">Il canale del servizio consente inoltre al livello dell'applicazione di specificare un nuovo valore del contesto da propagare indietro al client allegando una <xref:System.ServiceModel.Channels.ContextMessageProperty> al messaggio di risposta.</span><span class="sxs-lookup"><span data-stu-id="7cb83-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="7cb83-134">Questa proprietà viene convertita nell'intestazione SOAP o nel cookie HTTP che contiene il contesto, in base alla configurazione dell'associazione.</span><span class="sxs-lookup"><span data-stu-id="7cb83-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="7cb83-135">Il listener del canale del servizio supporta i modelli di scambio dei messaggi <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel> e <xref:System.ServiceModel.Channels.IReplySessionChannel>.</span><span class="sxs-lookup"><span data-stu-id="7cb83-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="7cb83-136">Il protocollo di scambio del contesto introduce una nuova intestazione SOAP `wsc:Context` per rappresentare le informazioni del contesto quando i cookie HTTP non sono utilizzati per propagare il contesto.</span><span class="sxs-lookup"><span data-stu-id="7cb83-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="7cb83-137">Lo schema dell'intestazione del contesto consente un numero qualsiasi di elementi figlio, ognuno con una chiave di stringa e un contenuto di stringa.</span><span class="sxs-lookup"><span data-stu-id="7cb83-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="7cb83-138">Di seguito è riportato un esempio di intestazione del contesto.</span><span class="sxs-lookup"><span data-stu-id="7cb83-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="7cb83-139">In modalità `HttpCookie`, i cookie sono impostati utilizzando l'intestazione `SetCookie`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="7cb83-140">Il nome del cookie è `WscContext`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="7cb83-141">Il valore del cookie è la codifica Base64 dell'intestazione `wsc:Context`.</span><span class="sxs-lookup"><span data-stu-id="7cb83-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="7cb83-142">Questo valore è racchiuso tra virgolette.</span><span class="sxs-lookup"><span data-stu-id="7cb83-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="7cb83-143">Il valore del contesto deve essere protetto dalle modifiche mentre è in transito, per la stessa ragione per cui sono protette le intestazioni WS-Addressing. L'intestazione è utilizzata per determinare dove inviare la richiesta nel servizio.</span><span class="sxs-lookup"><span data-stu-id="7cb83-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="7cb83-144">È pertanto necessario che l'intestazione `wsc:Context` sia firmata digitalmente o firmata e crittografata a livello SOAP o di trasporto quando l'associazione offre funzionalità di protezione dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="7cb83-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="7cb83-145">Quando i cookie HTTP sono utilizzati per propagare il contesto, devono essere protetti utilizzando sicurezza del trasporto.</span><span class="sxs-lookup"><span data-stu-id="7cb83-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="7cb83-146">Gli endpoint del servizio che richiedono il supporto per il protocollo di scambio del contesto possono renderlo esplicito nel criterio pubblicato.</span><span class="sxs-lookup"><span data-stu-id="7cb83-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="7cb83-147">Per rappresentare il requisito che il client supporti il protocollo di scambio del contesto a livello di SOAP o abiliti il supporto di cookie HTTP, sono state introdotte due nuove asserzioni di criteri.</span><span class="sxs-lookup"><span data-stu-id="7cb83-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="7cb83-148">La generazione di queste asserzioni all'interno del criterio nel servizio è controllata dal valore della proprietà <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> come segue:</span><span class="sxs-lookup"><span data-stu-id="7cb83-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
- <span data-ttu-id="7cb83-149">Per <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, viene generata l'asserzione seguente:</span><span class="sxs-lookup"><span data-stu-id="7cb83-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
- <span data-ttu-id="7cb83-150">Per <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, viene generata l'asserzione seguente:</span><span class="sxs-lookup"><span data-stu-id="7cb83-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="7cb83-151">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="7cb83-151">See also</span></span>

- [<span data-ttu-id="7cb83-152">Guida di interoperabilità dei protocolli di servizi Web</span><span class="sxs-lookup"><span data-stu-id="7cb83-152">Web Services Protocols Interoperability Guide</span></span>](web-services-protocols-interoperability-guide.md)
