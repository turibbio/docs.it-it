---
title: Procedure consigliate per la protezione in WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
ms.openlocfilehash: c99ab5e1e72aefc688df1692091e60caf930d5e4
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84597618"
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="c4c81-102">Procedure consigliate per la protezione in WCF</span><span class="sxs-lookup"><span data-stu-id="c4c81-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="c4c81-103">Nelle sezioni seguenti vengono elencate le procedure consigliate da prendere in considerazione quando si creano applicazioni protette tramite Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="c4c81-103">The following sections list the best practices to consider when creating secure applications using Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="c4c81-104">Per altre informazioni sulla sicurezza, vedere [Considerazioni sulla sicurezza](security-considerations-in-wcf.md), [Considerazioni sulla protezione per i dati](security-considerations-for-data.md) e [Considerazioni sulla sicurezza con metadati](security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="c4c81-104">For more information about security, see [Security Considerations](security-considerations-in-wcf.md), [Security Considerations for Data](security-considerations-for-data.md), and [Security Considerations with Metadata](security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="c4c81-105">Identificare i servizi che eseguono l'autenticazione di Windows con SPN</span><span class="sxs-lookup"><span data-stu-id="c4c81-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="c4c81-106">I servizi possono essere identificati con i nomi dell'entità utente (UPN) o i nomi dell'entità servizio (SPN).</span><span class="sxs-lookup"><span data-stu-id="c4c81-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="c4c81-107">I servizi in esecuzione in account di computer, come un servizio di rete, dispongono di un'identità SPN che corrisponde al computer in cui sono in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="c4c81-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="c4c81-108">I servizi in esecuzione in account utente dispongono di un'identità UPN che corrisponde all'utente utilizzato per l'esecuzione, sebbene sia possibile utilizzare lo strumento `setspn` per assegnare un SPN all'account utente.</span><span class="sxs-lookup"><span data-stu-id="c4c81-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="c4c81-109">La configurazione di un servizio in modo da poterlo identificare tramite SPN e la configurazione dei client che si connettono al servizio affinché utilizzino tale SPN possono rendere più difficili alcuni attacchi.</span><span class="sxs-lookup"><span data-stu-id="c4c81-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="c4c81-110">Questo materiale sussidiario si applica alle associazioni che utilizzano Kerberos o la negoziazione SSPI.</span><span class="sxs-lookup"><span data-stu-id="c4c81-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="c4c81-111">I client devono comunque specificare un SPN nel caso in cui SSPI esegua il fallback a NTLM.</span><span class="sxs-lookup"><span data-stu-id="c4c81-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="c4c81-112">Verificare le identità di servizio in WSDL</span><span class="sxs-lookup"><span data-stu-id="c4c81-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="c4c81-113">WS-SecurityPolicy consente ai servizi di pubblicare informazioni sulle relative identità nei metadati.</span><span class="sxs-lookup"><span data-stu-id="c4c81-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="c4c81-114">In caso di recupero tramite `svcutil` o altri metodi, ad esempio <xref:System.ServiceModel.Description.WsdlImporter>, le informazioni sull'identità vengono traslate nelle proprietà di identità degli indirizzi endpoint del servizio WCF.</span><span class="sxs-lookup"><span data-stu-id="c4c81-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the WCF service endpoint addresses.</span></span> <span data-ttu-id="c4c81-115">I client che non verificano la correttezza e la validità di queste identità di servizio ignorano in realtà l'autenticazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="c4c81-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="c4c81-116">Un servizio dannoso può sfruttare tali client per eseguire l'inoltro di credenziali e altri attacchi "man in the middle" modificando l'identità attestata in WSDL.</span><span class="sxs-lookup"><span data-stu-id="c4c81-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="c4c81-117">Utilizzare certificati X509 anziché NTLM</span><span class="sxs-lookup"><span data-stu-id="c4c81-117">Use X509 Certificates Instead of NTLM</span></span>  
 <span data-ttu-id="c4c81-118">WCF offre due meccanismi per l'autenticazione peer-to-peer: i certificati X509 (usati dal canale peer) e l'autenticazione di Windows in cui una negoziazione SSPI effettua un downgrade da Kerberos a NTLM.</span><span class="sxs-lookup"><span data-stu-id="c4c81-118">WCF offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="c4c81-119">L'autenticazione basata sui certificati che utilizza dimensioni della chiave pari a 1024 bit o superiori è preferibile a NTLM per diversi motivi:</span><span class="sxs-lookup"><span data-stu-id="c4c81-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
- <span data-ttu-id="c4c81-120">disponibilità di autenticazione reciproca</span><span class="sxs-lookup"><span data-stu-id="c4c81-120">the availability of mutual authentication,</span></span>  
  
- <span data-ttu-id="c4c81-121">utilizzo di algoritmi crittografici più avanzati</span><span class="sxs-lookup"><span data-stu-id="c4c81-121">the use of stronger cryptographic algorithms, and</span></span>  
  
- <span data-ttu-id="c4c81-122">maggiore difficoltà nell'utilizzo di credenziali X509 inoltrate.</span><span class="sxs-lookup"><span data-stu-id="c4c81-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  

## <a name="always-revert-after-impersonation"></a><span data-ttu-id="c4c81-123">Eseguire sempre il ripristino dopo la rappresentazione</span><span class="sxs-lookup"><span data-stu-id="c4c81-123">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="c4c81-124">Quando si utilizzano API che consentono la rappresentazione di un client, assicurarsi di ripristinare sempre l'identità originale.</span><span class="sxs-lookup"><span data-stu-id="c4c81-124">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="c4c81-125">Quando si usano, ad esempio, <xref:System.Security.Principal.WindowsIdentity> e <xref:System.Security.Principal.WindowsImpersonationContext>, usare l'istruzione C# `using` o l'istruzione Visual Basic `Using`, come illustrato nel codice seguente.</span><span class="sxs-lookup"><span data-stu-id="c4c81-125">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="c4c81-126">La classe <xref:System.Security.Principal.WindowsImpersonationContext> implementa l'interfaccia <xref:System.IDisposable> e pertanto, il Common Language Runtime (CLR) torna automaticamente alla propria l'identità originale quando il codice lascia il blocco `using`.</span><span class="sxs-lookup"><span data-stu-id="c4c81-126">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="c4c81-127">Eseguire la rappresentazione solo quando necessario</span><span class="sxs-lookup"><span data-stu-id="c4c81-127">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="c4c81-128">Utilizzando il metodo <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> della classe <xref:System.Security.Principal.WindowsIdentity> è possibile utilizzare la rappresentazione in un ambito molto controllato.</span><span class="sxs-lookup"><span data-stu-id="c4c81-128">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="c4c81-129">Si tratta di una procedura opposta all'utilizzo della proprietà <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> di <xref:System.ServiceModel.OperationBehaviorAttribute> che consente la rappresentazione per l'ambito dell'intera operazione.</span><span class="sxs-lookup"><span data-stu-id="c4c81-129">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="c4c81-130">Quando possibile, controllare sempre l'ambito della rappresentazione utilizzando il metodo <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> più preciso.</span><span class="sxs-lookup"><span data-stu-id="c4c81-130">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="c4c81-131">Ottenere i metadati da fonti attendibili</span><span class="sxs-lookup"><span data-stu-id="c4c81-131">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="c4c81-132">Assicurarsi che l'origine dei metadati sia attendibile e che nessuno abbia manomesso i metadati.</span><span class="sxs-lookup"><span data-stu-id="c4c81-132">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="c4c81-133">I metadati recuperati utilizzando il protocollo HTTP vengono inviati come testo non crittografato e possono essere alterati.</span><span class="sxs-lookup"><span data-stu-id="c4c81-133">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="c4c81-134">Se il servizio utilizza le proprietà <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> e <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A>, utilizzare l'URL fornito dal creatore del servizio per scaricare i dati tramite il protocollo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="c4c81-134">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="c4c81-135">Pubblicare i metadati tramite la protezione</span><span class="sxs-lookup"><span data-stu-id="c4c81-135">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="c4c81-136">Per impedire che i metadati pubblicati di un servizio vengano alterati, proteggere l'endpoint dello scambio di metadati con la sicurezza a livello di trasporto o di messaggio.</span><span class="sxs-lookup"><span data-stu-id="c4c81-136">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="c4c81-137">Per altre informazioni, vedere [Pubblicazione di endpoint dei metadati](../publishing-metadata-endpoints.md) e [Procedura: Pubblicare metadati per un servizio usando codice](how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="c4c81-137">For more information, see [Publishing Metadata Endpoints](../publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="c4c81-138">Assicurarsi che venga utilizzato l'emittente locale</span><span class="sxs-lookup"><span data-stu-id="c4c81-138">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="c4c81-139">Se per una determinata associazione vengono specificati l'indirizzo dell'emittente e l'associazione, l'emittente locale non verrà utilizzato per gli endpoint che utilizzano tale associazione.</span><span class="sxs-lookup"><span data-stu-id="c4c81-139">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="c4c81-140">Per i client che prevedono di utilizzare sempre l'emittente locale, è necessario accertarsi di non utilizzare tale associazione o di modificare l'associazione in modo che l'indirizzo dell'emittente sia null.</span><span class="sxs-lookup"><span data-stu-id="c4c81-140">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="c4c81-141">Quota delle dimensioni del token SAML</span><span class="sxs-lookup"><span data-stu-id="c4c81-141">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="c4c81-142">Quando i token SAML (Security Assertions Markup Language) vengono serializzati nei messaggi, quando sono rilasciati da un servizio token di sicurezza (STS, Security Token Service) o quando sono presentati dai client ai servizi nell'ambito dell'autenticazione, la quota della dimensione massima del messaggio deve essere sufficientemente grande da contenere il token SAML e le altre parti del messaggio.</span><span class="sxs-lookup"><span data-stu-id="c4c81-142">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="c4c81-143">Normalmente la quota della dimensione predefinita del messaggio è sufficiente.</span><span class="sxs-lookup"><span data-stu-id="c4c81-143">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="c4c81-144">Nei casi in cui un token SAML sia di grandi dimensioni perché contiene centinaia di attestazioni, è necessario aumentare le quote per contenere il token serializzato.</span><span class="sxs-lookup"><span data-stu-id="c4c81-144">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> <span data-ttu-id="c4c81-145">Per altre informazioni sulle quote, vedere [Considerazioni sulla protezione per i dati](security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="c4c81-145">For more information about quotas, see [Security Considerations for Data](security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="c4c81-146">Impostare SecurityBindingElement.IncludeTimestamp su True nelle associazioni personalizzate</span><span class="sxs-lookup"><span data-stu-id="c4c81-146">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="c4c81-147">Quando si crea un'associazione personalizzata, è necessario impostare <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> su `true`.</span><span class="sxs-lookup"><span data-stu-id="c4c81-147">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="c4c81-148">In caso contrario, se <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> viene impostato su `false` e il client utilizza un token basato su chiave asimmetrica quale un certificato X509, il messaggio non sarà firmato.</span><span class="sxs-lookup"><span data-stu-id="c4c81-148">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c4c81-149">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="c4c81-149">See also</span></span>

- [<span data-ttu-id="c4c81-150">Security Considerations</span><span class="sxs-lookup"><span data-stu-id="c4c81-150">Security Considerations</span></span>](security-considerations-in-wcf.md)
- [<span data-ttu-id="c4c81-151">Considerazioni sulla sicurezza per i dati</span><span class="sxs-lookup"><span data-stu-id="c4c81-151">Security Considerations for Data</span></span>](security-considerations-for-data.md)
- [<span data-ttu-id="c4c81-152">Considerazioni sulla sicurezza con metadati</span><span class="sxs-lookup"><span data-stu-id="c4c81-152">Security Considerations with Metadata</span></span>](security-considerations-with-metadata.md)
