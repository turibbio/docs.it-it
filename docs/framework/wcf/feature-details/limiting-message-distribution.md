---
title: Limitazione della distribuzione di messaggi
ms.date: 03/30/2017
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
ms.openlocfilehash: 188d7bd365caad7d4cd438744c78ae8e7cd95e7e
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84586312"
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="18631-102">Limitazione della distribuzione di messaggi</span><span class="sxs-lookup"><span data-stu-id="18631-102">Limiting Message Distribution</span></span>

<span data-ttu-id="18631-103">In base alla progettazione, il canale peer è una rete di trasmissione.</span><span class="sxs-lookup"><span data-stu-id="18631-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="18631-104">Il relativo modello di flooding di base prevede la distribuzione di ogni messaggio inviato da qualsiasi membro di una rete a tutti gli altri membri di quella stessa rete.</span><span class="sxs-lookup"><span data-stu-id="18631-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="18631-105">Questa soluzione è ideale nelle situazioni in cui tutti i messaggi generati da un membro sono attinenti e utili a tutti gli altri membri, ad esempio in una chat.</span><span class="sxs-lookup"><span data-stu-id="18631-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="18631-106">Tuttavia, molte applicazioni hanno occasionalmente la necessità di limitare la distribuzione dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="18631-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="18631-107">Ad esempio, se un nuovo membro si aggiunge a una rete e desidera recuperare l'ultimo messaggio inviato attraverso di essa, non è necessario che questa richiesta venga propagata a ogni membro della rete.</span><span class="sxs-lookup"><span data-stu-id="18631-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="18631-108">La richiesta può essere limitata a vicini adiacenti oppure i messaggi generati localmente possono essere esclusi. I messaggi possono essere inviati anche a un singolo nodo della rete.</span><span class="sxs-lookup"><span data-stu-id="18631-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="18631-109">In questo argomento viene illustrato come utilizzare il conteggio hop, un filtro di propagazione dei messaggi, un filtro locale o una connessione diretta per controllare il modo in cui i messaggi vengono inoltrati attraverso la rete. Vengono inoltre fornite linee guida generali per la scelta dell'approccio più appropriato.</span><span class="sxs-lookup"><span data-stu-id="18631-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>

## <a name="hop-counts"></a><span data-ttu-id="18631-110">Conteggi hop</span><span class="sxs-lookup"><span data-stu-id="18631-110">Hop Counts</span></span>

<span data-ttu-id="18631-111">Il concetto di `PeerHopCount` è simile a quello di durata (TTL, Time-To-Live) utilizzato nel protocollo IP.</span><span class="sxs-lookup"><span data-stu-id="18631-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="18631-112">Il valore di `PeerHopCount` viene collegato a un'istanza del messaggio e specifica il numero di volte in cui un messaggio deve essere inoltrato prima di essere rilasciato.</span><span class="sxs-lookup"><span data-stu-id="18631-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="18631-113">Ogni volta che un messaggio viene ricevuto da un client del canale peer, il client esamina il messaggio per verificare se `PeerHopCount` è specificato.</span><span class="sxs-lookup"><span data-stu-id="18631-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="18631-114">In caso affermativo, il client diminuisce il valore del conteggio hop di uno prima di inoltrare il messaggio ai nodi adiacenti.</span><span class="sxs-lookup"><span data-stu-id="18631-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="18631-115">Quando un client riceve un messaggio con un valore del conteggio hop pari a zero, il client elabora il messaggio, ma non lo inoltra ai router adiacenti.</span><span class="sxs-lookup"><span data-stu-id="18631-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>

<span data-ttu-id="18631-116">Il conteggio hop può essere inserito in un messaggio aggiungendo `PeerHopCount` come attributo alla proprietà o al campo pertinente nell'implementazione della classe del messaggio.</span><span class="sxs-lookup"><span data-stu-id="18631-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="18631-117">È possibile impostarlo su un valore specifico prima di inviare il messaggio nella rete.</span><span class="sxs-lookup"><span data-stu-id="18631-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="18631-118">Il conteggio hop consente quindi di limitare la distribuzione dei messaggi nella rete in caso di necessità, evitando potenzialmente la duplicazione non necessaria dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="18631-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="18631-119">Ciò si rivela utile nei casi in cui la rete contiene una quantità elevata di dati ridondanti oppure per l'invio di un messaggio a router immediatamente adiacenti o all'interno di un numero ridotto di hop.</span><span class="sxs-lookup"><span data-stu-id="18631-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>

- <span data-ttu-id="18631-120">Per i frammenti di codice e le informazioni correlate, vedere il post relativo all' [attributo PeerHopCount: controllo della distribuzione dei messaggi](https://docs.microsoft.com/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) nel Blog Peer Channel.</span><span class="sxs-lookup"><span data-stu-id="18631-120">For code snippets and related information, see the [The PeerHopCount Attribute: Controlling Message Distribution](https://docs.microsoft.com/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) post on the Peer Channel blog.</span></span>

## <a name="message-propagation-filter"></a><span data-ttu-id="18631-121">Filtro di propagazione dei messaggi</span><span class="sxs-lookup"><span data-stu-id="18631-121">Message Propagation Filter</span></span>

<span data-ttu-id="18631-122">`MessagePropagationFilter` può essere utilizzato per il controllo personalizzato del flood di messaggi, in particolare quando il contenuto del messaggio o altri scenari specifici determinano una propagazione.</span><span class="sxs-lookup"><span data-stu-id="18631-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="18631-123">Il filtro è responsabile delle decisioni sulla propagazione di ogni messaggio che passa attraverso il nodo.</span><span class="sxs-lookup"><span data-stu-id="18631-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="18631-124">Questa situazione si verifica sia per i messaggi creati in altri punti della rete e ricevuti dal nodo sia per i messaggi creati dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="18631-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="18631-125">Il filtro accede sia al messaggio che alla sua origine, pertanto le decisioni relative all'inoltro o all'eliminazione del messaggio possono basarsi sulle informazioni complete disponibili.</span><span class="sxs-lookup"><span data-stu-id="18631-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>

<span data-ttu-id="18631-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> è una classe astratta di base con una sola funzione, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span><span class="sxs-lookup"><span data-stu-id="18631-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="18631-127">Il primo argomento della chiamata al metodo passa una copia completa del messaggio.</span><span class="sxs-lookup"><span data-stu-id="18631-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="18631-128">Qualsiasi modifica apportata al messaggio non influisce sul messaggio effettivo.</span><span class="sxs-lookup"><span data-stu-id="18631-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="18631-129">L'ultimo argomento della chiamata al metodo identifica l'origine del messaggio (`PeerMessageOrigination.Local` o `PeerMessageOrigination.Remote`).</span><span class="sxs-lookup"><span data-stu-id="18631-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="18631-130">Le implementazioni concrete di questo metodo devono restituire una costante dall'enumerazione <xref:System.ServiceModel.PeerMessagePropagation> che indica che il messaggio deve essere inoltrato all'applicazione locale (`Local`), a client remoti (`Remote`), a entrambi (`LocalAndRemote`) o a nessuna delle parti (`None`).</span><span class="sxs-lookup"><span data-stu-id="18631-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="18631-131">È possibile applicare questo filtro accedendo all'oggetto `PeerNode` corrispondente e specificando un'istanza della classe del filtro di propagazione derivata nella proprietà `PeerNode.MessagePropagationFilter`.</span><span class="sxs-lookup"><span data-stu-id="18631-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="18631-132">Assicurarsi che il filtro di propagazione sia collegato prima di aprire il canale peer.</span><span class="sxs-lookup"><span data-stu-id="18631-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>

- <span data-ttu-id="18631-133">Per i frammenti di codice e le informazioni correlate, vedere il post [Peer Channel e MessagePropagationFilter](https://docs.microsoft.com/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) nel Blog Peer Channel.</span><span class="sxs-lookup"><span data-stu-id="18631-133">For code snippets and related information, see the [Peer Channel and MessagePropagationFilter](https://docs.microsoft.com/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) post on the Peer Channel blog.</span></span>

## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="18631-134">Contatto di un singolo nodo nella rete</span><span class="sxs-lookup"><span data-stu-id="18631-134">Contacting an Individual Node in the Mesh</span></span>

<span data-ttu-id="18631-135">È possibile contattare un singolo nodo in una rete configurando un filtro locale o una connessione diretta.</span><span class="sxs-lookup"><span data-stu-id="18631-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>

<span data-ttu-id="18631-136">Se ogni nodo di una rete dispone di un ID singolo, è possibile specificare un ID di destinazione nell'implementazione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="18631-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="18631-137">È possibile configurare un filtro locale scrivendo una funzione nel contratto di messaggio che consenta la visualizzazione del messaggio solo al nodo corrente se l'ID corrisponde a all'ID di destinazione specificato.</span><span class="sxs-lookup"><span data-stu-id="18631-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="18631-138">La rete trasporta il messaggio, di conseguenza è possibile evitare il sovraccarico della configurazione di una nuova connessione.</span><span class="sxs-lookup"><span data-stu-id="18631-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="18631-139">Viene tuttavia registrata una perdita di efficienza poiché il messaggio viene inviato molte volte attraverso la rete.</span><span class="sxs-lookup"><span data-stu-id="18631-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="18631-140">Questa soluzione è adeguata per l'invio di messaggi a singoli membri di una rete, a condizione che i messaggi non siano di dimensioni eccessive o troppo frequenti.</span><span class="sxs-lookup"><span data-stu-id="18631-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>

<span data-ttu-id="18631-141">Per connessioni durevoli e a larghezza di banda elevata, sono preferibili le connessioni dirette.</span><span class="sxs-lookup"><span data-stu-id="18631-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="18631-142">È possibile inviare informazioni sulla connessione sulla rete e successivamente configurare una connessione diretta a scelta per inviare e ricevere messaggi.</span><span class="sxs-lookup"><span data-stu-id="18631-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>

## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="18631-143">Scelta di un approccio per limitare la distribuzione di messaggi</span><span class="sxs-lookup"><span data-stu-id="18631-143">Choosing an Approach for Limiting Message Distribution</span></span>

<span data-ttu-id="18631-144">Quando si rileva uno scenario in cui è necessario limitare la distribuzione di messaggi, è opportuno porsi le seguenti domande:</span><span class="sxs-lookup"><span data-stu-id="18631-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>

- <span data-ttu-id="18631-145">**Chi** deve ricevere il messaggio?</span><span class="sxs-lookup"><span data-stu-id="18631-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="18631-146">Solo un nodo adiacente?</span><span class="sxs-lookup"><span data-stu-id="18631-146">Just one neighbor node?</span></span> <span data-ttu-id="18631-147">Un nodo in un'altra posizione della rete?</span><span class="sxs-lookup"><span data-stu-id="18631-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="18631-148">Metà della rete?</span><span class="sxs-lookup"><span data-stu-id="18631-148">Half the mesh?</span></span>

- <span data-ttu-id="18631-149">Con **quale frequenza** viene inviato questo messaggio?</span><span class="sxs-lookup"><span data-stu-id="18631-149">**How often** will this message be sent?</span></span>

- <span data-ttu-id="18631-150">Quale tipo di **larghezza di banda** verrà usato da questo messaggio?</span><span class="sxs-lookup"><span data-stu-id="18631-150">What kind of **bandwidth** will this message use?</span></span>

<span data-ttu-id="18631-151">Le risposte a queste domande possono essere utili per stabilire se utilizzare un conteggio hop, un filtro di propagazione dei messaggi, un filtro locale o una connessione diretta.</span><span class="sxs-lookup"><span data-stu-id="18631-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="18631-152">Si considerino le seguenti linee guida generali:</span><span class="sxs-lookup"><span data-stu-id="18631-152">Consider the following general guidelines:</span></span>

- <span data-ttu-id="18631-153">**Che**</span><span class="sxs-lookup"><span data-stu-id="18631-153">**Who**</span></span>

  - <span data-ttu-id="18631-154">*Singolo nodo*: filtro locale o connessione diretta.</span><span class="sxs-lookup"><span data-stu-id="18631-154">*Individual node*:  Local filter or direct connection.</span></span>

  - <span data-ttu-id="18631-155">*Adiacenti entro una certa vicinanza*: PeerHopCount.</span><span class="sxs-lookup"><span data-stu-id="18631-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>

  - <span data-ttu-id="18631-156">*Subset complesso della mesh*: MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="18631-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>

- <span data-ttu-id="18631-157">**Con quale frequenza**</span><span class="sxs-lookup"><span data-stu-id="18631-157">**How often**</span></span>

  - <span data-ttu-id="18631-158">*Molto frequente*: connessione diretta, PeerHopCount, MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="18631-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>

  - <span data-ttu-id="18631-159">*Occasionale*: filtro locale.</span><span class="sxs-lookup"><span data-stu-id="18631-159">*Occasional*:  Local filter.</span></span>

- <span data-ttu-id="18631-160">**Utilizzo della larghezza di banda**</span><span class="sxs-lookup"><span data-stu-id="18631-160">**Bandwidth use**</span></span>

  - <span data-ttu-id="18631-161">*Alta*: connessione diretta, meno consigliabile per l'uso di MessagePropagationFilter o di un filtro locale.</span><span class="sxs-lookup"><span data-stu-id="18631-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>

  - <span data-ttu-id="18631-162">*Bassa*: qualsiasi connessione diretta probabilmente non necessaria.</span><span class="sxs-lookup"><span data-stu-id="18631-162">*Low*:  Any, direct connection probably not needed.</span></span>

## <a name="see-also"></a><span data-ttu-id="18631-163">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="18631-163">See also</span></span>

- [<span data-ttu-id="18631-164">Creazione di un'applicazione del canale peer</span><span class="sxs-lookup"><span data-stu-id="18631-164">Building a Peer Channel Application</span></span>](building-a-peer-channel-application.md)
