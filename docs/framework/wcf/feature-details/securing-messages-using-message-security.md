---
title: Protezione dei messaggi mediante protezione a livello di messaggio
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: 70c645101033c31da01d79f624ab03ce328dd3a6
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84589981"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="23e6e-102">Protezione dei messaggi mediante protezione a livello di messaggio</span><span class="sxs-lookup"><span data-stu-id="23e6e-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="23e6e-103">In questa sezione viene illustrata la sicurezza del messaggio WCF quando si utilizza <xref:System.ServiceModel.NetMsmqBinding> .</span><span class="sxs-lookup"><span data-stu-id="23e6e-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="23e6e-104">Prima di leggere questo argomento, è consigliabile leggere i [concetti relativi alla sicurezza](security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="23e6e-104">Before reading through this topic, it is recommended that you read [Security Concepts](security-concepts.md).</span></span>  
  
 <span data-ttu-id="23e6e-105">Nella figura seguente viene illustrato un modello concettuale di comunicazione in coda con WCF.</span><span class="sxs-lookup"><span data-stu-id="23e6e-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="23e6e-106">L'illustrazione e la terminologia vengono utilizzate nella spiegazione</span><span class="sxs-lookup"><span data-stu-id="23e6e-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="23e6e-107">dei concetti della protezione del trasporto.</span><span class="sxs-lookup"><span data-stu-id="23e6e-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="23e6e-108">![Diagramma di applicazioni in coda](media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span><span class="sxs-lookup"><span data-stu-id="23e6e-108">![Queued Application Diagram](media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="23e6e-109">Quando si inviano messaggi in coda tramite WCF, il messaggio WCF viene allegato come corpo del messaggio di Accodamento messaggi (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="23e6e-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="23e6e-110">Mentre la protezione del trasporto protegge l'intero messaggio MSMQ, la protezione del messaggio, o SOAP, protegge il corpo del messaggio MSMQ.</span><span class="sxs-lookup"><span data-stu-id="23e6e-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="23e6e-111">Il concetto chiave della protezione del messaggio consiste nel fatto che il client protegge il messaggio per l'applicazione ricevente (servizio), a differenza dalla protezione del trasporto in cui il client protegge il messaggio per la coda di destinazione.</span><span class="sxs-lookup"><span data-stu-id="23e6e-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="23e6e-112">Per questo motivo, MSMQ non svolge alcuna parte quando si protegge il messaggio WCF mediante la sicurezza dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="23e6e-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="23e6e-113">La sicurezza dei messaggi WCF aggiunge intestazioni di sicurezza al messaggio WCF che si integrano con infrastrutture di sicurezza esistenti, ad esempio un certificato o il protocollo Kerberos.</span><span class="sxs-lookup"><span data-stu-id="23e6e-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="23e6e-114">Tipo di credenziali del messaggio</span><span class="sxs-lookup"><span data-stu-id="23e6e-114">Message Credential Type</span></span>  
 <span data-ttu-id="23e6e-115">Mediante la protezione del messaggio il servizio e il client possono presentare credenziali per autenticarsi reciprocamente.</span><span class="sxs-lookup"><span data-stu-id="23e6e-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="23e6e-116">È possibile selezionare la protezione del messaggio impostando la modalità <xref:System.ServiceModel.NetMsmqBinding.Security%2A> su `Message` o `Both` (ovvero per utilizzare sia la protezione del trasporto che la protezione del messaggio).</span><span class="sxs-lookup"><span data-stu-id="23e6e-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="23e6e-117">Il servizio può utilizzare la proprietà <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> per controllare la credenziale utilizzata per autenticare il client,</span><span class="sxs-lookup"><span data-stu-id="23e6e-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="23e6e-118">nonché per ulteriori controlli di autorizzazione che il servizio scelga di implementare.</span><span class="sxs-lookup"><span data-stu-id="23e6e-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="23e6e-119">Contenuto della sezione vengono illustrati i diversi tipi di credenziali e viene spiegato come utilizzarli con le code.</span><span class="sxs-lookup"><span data-stu-id="23e6e-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="23e6e-120">Certificato</span><span class="sxs-lookup"><span data-stu-id="23e6e-120">Certificate</span></span>  
 <span data-ttu-id="23e6e-121">Il tipo di credenziale del certificato utilizza un certificato X.509 per identificare il servizio e il client.</span><span class="sxs-lookup"><span data-stu-id="23e6e-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="23e6e-122">In uno scenario tipico il client e il servizio ricevono un certificato valido rilasciato da un'autorità di certificazione attendibile.</span><span class="sxs-lookup"><span data-stu-id="23e6e-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="23e6e-123">La connessione viene quindi stabilita, il client autentica la validità del servizio utilizzando il certificato del servizio per decidere se il servizio è attendibile.</span><span class="sxs-lookup"><span data-stu-id="23e6e-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="23e6e-124">Analogamente il servizio utilizza il certificato del client per verificare l'attendibilità del client.</span><span class="sxs-lookup"><span data-stu-id="23e6e-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="23e6e-125">In considerazione del fatto che le code funzionano spesso in modalità disconnessa, il client e il servizio potrebbero non essere in linea contemporaneamente</span><span class="sxs-lookup"><span data-stu-id="23e6e-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="23e6e-126">e potrebbero doversi scambiare i certificati fuori banda.</span><span class="sxs-lookup"><span data-stu-id="23e6e-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="23e6e-127">Il client, in particolare, poiché detiene il certificato del servizio (che può essere collegato a un'autorità di certificazione) nell'archivio attendibile, deve appurare di avere stabilito la comunicazione con il servizio corretto.</span><span class="sxs-lookup"><span data-stu-id="23e6e-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="23e6e-128">Per autenticare il client, il servizio utilizza il certificato X.509 allegato al messaggio e cerca una corrispondenza con il certificato esistente nell'archivio.</span><span class="sxs-lookup"><span data-stu-id="23e6e-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="23e6e-129">Anche in questo caso il certificato deve essere collegato a un'autorità di certificazione.</span><span class="sxs-lookup"><span data-stu-id="23e6e-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="23e6e-130">Nei computer che eseguono Windows i certificati sono contenuti in vari tipi di archivio.</span><span class="sxs-lookup"><span data-stu-id="23e6e-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="23e6e-131">Per ulteriori informazioni sui diversi archivi, vedere [archivi certificati](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc757138(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="23e6e-131">For more information about the different stores, see [Certificate stores](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc757138(v=ws.10)).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="23e6e-132">Windows</span><span class="sxs-lookup"><span data-stu-id="23e6e-132">Windows</span></span>  
 <span data-ttu-id="23e6e-133">Il tipo di credenziale del messaggio di Windows utilizza il protocollo Kerberos.</span><span class="sxs-lookup"><span data-stu-id="23e6e-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="23e6e-134">Il protocollo Kerberos è un meccanismo di sicurezza che esegue l'autenticazione degli utenti in un dominio e consente agli utenti autenticati di stabilire una connessione protetta con le altre entità del dominio.</span><span class="sxs-lookup"><span data-stu-id="23e6e-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="23e6e-135">Il problema dell'utilizzo del protocollo Kerberos per la comunicazione in coda consiste nel fatto che i ticket che contengono l'identità client distribuita dal centro distribuzione chiavi (KDC, Key Distribution Center) hanno una durata limitata.</span><span class="sxs-lookup"><span data-stu-id="23e6e-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="23e6e-136">Una *durata* è associata al ticket Kerberos che indica la validità del ticket.</span><span class="sxs-lookup"><span data-stu-id="23e6e-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="23e6e-137">Per questa ragione e in considerazione della latenza elevata non è possibile avere la certezza che il token sia ancora valido per il servizio che autentica il client.</span><span class="sxs-lookup"><span data-stu-id="23e6e-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="23e6e-138">Si noti che in caso di utilizzo di questo tipo di credenziale, il servizio deve essere in esecuzione nell'account SERVIZIO.</span><span class="sxs-lookup"><span data-stu-id="23e6e-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="23e6e-139">Il protocollo Kerberos viene utilizzato per impostazione predefinita durante la scelta della credenziale del messaggio.</span><span class="sxs-lookup"><span data-stu-id="23e6e-139">The Kerberos protocol is used by default when choosing message credential.</span></span>
  
### <a name="username-password"></a><span data-ttu-id="23e6e-140">Nome utente/password</span><span class="sxs-lookup"><span data-stu-id="23e6e-140">Username Password</span></span>  
 <span data-ttu-id="23e6e-141">Mediante questa proprietà il client può eseguire l'autenticazione nel server utilizzando una password di nome utente nell'intestazione di sicurezza del messaggio.</span><span class="sxs-lookup"><span data-stu-id="23e6e-141">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="23e6e-142">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="23e6e-142">IssuedToken</span></span>  
 <span data-ttu-id="23e6e-143">Il client può utilizzare il servizio token di sicurezza per rilasciare un token che può quindi essere allegato al messaggio affinché il servizio autentichi il client.</span><span class="sxs-lookup"><span data-stu-id="23e6e-143">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="23e6e-144">Utilizzo della protezione del trasporto e del messaggio</span><span class="sxs-lookup"><span data-stu-id="23e6e-144">Using Transport and Message Security</span></span>  
 <span data-ttu-id="23e6e-145">In caso di utilizzo della protezione del trasporto e della protezione del messaggio, il certificato utilizzato per proteggere il messaggio sia a livello di trasporto che a livello di messaggio SOAP deve essere lo stesso.</span><span class="sxs-lookup"><span data-stu-id="23e6e-145">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="23e6e-146">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="23e6e-146">See also</span></span>

- [<span data-ttu-id="23e6e-147">Protezione dei messaggi mediante protezione del trasporto</span><span class="sxs-lookup"><span data-stu-id="23e6e-147">Securing Messages Using Transport Security</span></span>](securing-messages-using-transport-security.md)
- [<span data-ttu-id="23e6e-148">Sicurezza dei messaggi nell'accodamento messaggi</span><span class="sxs-lookup"><span data-stu-id="23e6e-148">Message Security over Message Queuing</span></span>](../samples/message-security-over-message-queuing.md)
- [<span data-ttu-id="23e6e-149">Concetti relativi alla sicurezza</span><span class="sxs-lookup"><span data-stu-id="23e6e-149">Security Concepts</span></span>](security-concepts.md)
- [<span data-ttu-id="23e6e-150">Securing Services and Clients</span><span class="sxs-lookup"><span data-stu-id="23e6e-150">Securing Services and Clients</span></span>](securing-services-and-clients.md)
