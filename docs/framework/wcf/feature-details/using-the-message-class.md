---
title: Utilizzo della classe Message
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d1d62bfb-2aa3-4170-b6f8-c93d3afdbbed
ms.openlocfilehash: 142578ef76a70fed27dc0137378b59e228cd25c9
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84585649"
---
# <a name="using-the-message-class"></a><span data-ttu-id="73938-102">Utilizzo della classe Message</span><span class="sxs-lookup"><span data-stu-id="73938-102">Using the Message Class</span></span>
<span data-ttu-id="73938-103">La <xref:System.ServiceModel.Channels.Message> classe è fondamentale per Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="73938-103">The <xref:System.ServiceModel.Channels.Message> class is fundamental to Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="73938-104">Tutte le comunicazioni tra client e servizi implicano in ultima istanza l'invio e la ricezione di istanze di <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="73938-104">All communication between clients and services ultimately results in <xref:System.ServiceModel.Channels.Message> instances being sent and received.</span></span>  
  
 <span data-ttu-id="73938-105">Di norma non si interagisce con la classe <xref:System.ServiceModel.Channels.Message> in modo diretto.</span><span class="sxs-lookup"><span data-stu-id="73938-105">You would not usually interact with the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="73938-106">Al contrario, i costrutti del modello del servizio WCF, ad esempio i contratti dati, i contratti di messaggio e i contratti di operazione, vengono utilizzati per descrivere i messaggi in ingresso e in uscita.</span><span class="sxs-lookup"><span data-stu-id="73938-106">Instead, WCF service model constructs, such as data contracts, message contracts, and operation contracts, are used to describe incoming and outgoing messages.</span></span> <span data-ttu-id="73938-107">Tuttavia, in alcuni scenari avanzati, è possibile eseguire la programmazione usando direttamente la classe <xref:System.ServiceModel.Channels.Message>.</span><span class="sxs-lookup"><span data-stu-id="73938-107">However, in some advanced scenarios you can program using the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="73938-108">Ad esempio, può essere necessario usare la classe <xref:System.ServiceModel.Channels.Message>:</span><span class="sxs-lookup"><span data-stu-id="73938-108">For example, you might want to use the <xref:System.ServiceModel.Channels.Message> class:</span></span>  
  
- <span data-ttu-id="73938-109">Quando è necessario un modo alternativo per creare il contenuto dei messaggi in uscita (ad esempio, la creazione di un messaggio direttamente da un file su disco) invece di serializzare .NET Framework oggetti.</span><span class="sxs-lookup"><span data-stu-id="73938-109">When you need an alternative way of creating outgoing message contents (for example, creating a message directly from a file on disk) instead of serializing .NET Framework objects.</span></span>  
  
- <span data-ttu-id="73938-110">Quando è necessario un modo alternativo per utilizzare il contenuto dei messaggi in ingresso, ad esempio quando si desidera applicare una trasformazione XSLT al contenuto XML non elaborato, anziché deserializzare in oggetti .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="73938-110">When you need an alternative way of using incoming message contents (for example, when you want to apply an XSLT transformation to the raw XML contents) instead of deserializing into .NET Framework objects.</span></span>  
  
- <span data-ttu-id="73938-111">Quando è necessario gestire i messaggi in modo generico, indipendentemente dal contenuto (ad esempio, per l'indirizzamento o l'inoltro di messaggi durante la creazione di un router, un servizio di bilanciamento del carico o un sistema di pubblicazione-sottoscrizione).</span><span class="sxs-lookup"><span data-stu-id="73938-111">When you need to deal with messages in a general way regardless of message contents (for example, when routing or forwarding messages when building a router, load-balancer, or a publish-subscribe system).</span></span>  
  
 <span data-ttu-id="73938-112">Prima di utilizzare la <xref:System.ServiceModel.Channels.Message> classe, acquisire familiarità con l'architettura di trasferimento dei dati WCF in [trasferimento dati panoramica dell'architettura](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="73938-112">Before using the <xref:System.ServiceModel.Channels.Message> class, familiarize yourself with the WCF data transfer architecture in [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
 <span data-ttu-id="73938-113">Una classe <xref:System.ServiceModel.Channels.Message> è un contenitore generico di dati, la cui progettazione segue però da vicino quella di un messaggio nel protocollo SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-113">A <xref:System.ServiceModel.Channels.Message> is a general-purpose container for data, but its design closely follows the design of a message in the SOAP protocol.</span></span> <span data-ttu-id="73938-114">Proprio come in SOAP, un messaggio ha un corpo e delle intestazioni.</span><span class="sxs-lookup"><span data-stu-id="73938-114">Just like in SOAP, a message has both a message body and headers.</span></span> <span data-ttu-id="73938-115">Il corpo del messaggio contiene i dati del payload effettivi, mentre le intestazioni contengono contenitori dei dati denominati aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="73938-115">The message body contains the actual payload data, while the headers contain additional named data containers.</span></span> <span data-ttu-id="73938-116">Le regole per la lettura e la scrittura del corpo e delle intestazioni sono diverse, ad esempio, le intestazioni vengono sempre memorizzate nel buffer in memoria ed è possibile accedervi in qualsiasi ordine, tutte le volte che si desidera, il corpo può invece essere letto una sola volta ed essere trasmesso.</span><span class="sxs-lookup"><span data-stu-id="73938-116">The rules for reading and writing the body and the headers are different, for example, the headers are always buffered in memory and may be accessed in any order any number of times, while the body may be read only once and may be streamed.</span></span> <span data-ttu-id="73938-117">In genere, quando si usa SOAP, il corpo del messaggio viene mappato al corpo SOAP e le intestazioni vengono mappate alle intestazioni SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-117">Normally, when using SOAP, the message body is mapped to the SOAP body and the message headers are mapped to the SOAP headers.</span></span>  
  
## <a name="using-the-message-class-in-operations"></a><span data-ttu-id="73938-118">Uso della classe Message nelle operazioni</span><span class="sxs-lookup"><span data-stu-id="73938-118">Using the Message Class in Operations</span></span>  
 <span data-ttu-id="73938-119">È possibile usare la classe <xref:System.ServiceModel.Channels.Message> come parametro di input e/o valore restituito di un'operazione.</span><span class="sxs-lookup"><span data-stu-id="73938-119">You can use the <xref:System.ServiceModel.Channels.Message> class as an input parameter of an operation, the return value of an operation, or both.</span></span> <span data-ttu-id="73938-120">Se la classe <xref:System.ServiceModel.Channels.Message> viene usata in un punto qualsiasi di un'operazione, si applicano le restrizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="73938-120">If <xref:System.ServiceModel.Channels.Message> is used anywhere in an operation, the following restrictions apply:</span></span>  
  
- <span data-ttu-id="73938-121">L'operazione non può avere qualsiasi parametro `out` o `ref`.</span><span class="sxs-lookup"><span data-stu-id="73938-121">The operation cannot have any `out` or `ref` parameters.</span></span>  
  
- <span data-ttu-id="73938-122">Non può essere presente più di un parametro `input`.</span><span class="sxs-lookup"><span data-stu-id="73938-122">There cannot be more than one `input` parameter.</span></span> <span data-ttu-id="73938-123">Se il parametro è presente, deve essere di tipo Message o contratto di messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-123">If the parameter is present, it must be either Message or a message contract type.</span></span>  
  
- <span data-ttu-id="73938-124">Il tipo restituito deve essere `void`, `Message` o un tipo di contratto di messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-124">The return type must be either `void`, `Message`, or a message contract type.</span></span>  
  
 <span data-ttu-id="73938-125">L'esempio di codice seguente contiene un contratto di operazione valido.</span><span class="sxs-lookup"><span data-stu-id="73938-125">The following code example contains a valid operation contract.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#1)]
 [!code-vb[C_UsingTheMessageClass#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#1)]  
  
## <a name="creating-basic-messages"></a><span data-ttu-id="73938-126">Creazione di messaggi di base</span><span class="sxs-lookup"><span data-stu-id="73938-126">Creating Basic Messages</span></span>  
 <span data-ttu-id="73938-127">La classe <xref:System.ServiceModel.Channels.Message> fornisce metodi factory `CreateMessage` statici che è possibile usare per creare messaggi di base.</span><span class="sxs-lookup"><span data-stu-id="73938-127">The <xref:System.ServiceModel.Channels.Message> class provides static `CreateMessage` factory methods that you can use to create basic messages.</span></span>  
  
 <span data-ttu-id="73938-128">Tutti gli overload `CreateMessage` accettano un parametro di versione di tipo <xref:System.ServiceModel.Channels.MessageVersion>, che indica le versioni SOAP e WS-Addressing da usare per il messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-128">All `CreateMessage` overloads take a version parameter of type <xref:System.ServiceModel.Channels.MessageVersion> that indicates the SOAP and WS-Addressing versions to use for the message.</span></span> <span data-ttu-id="73938-129">Se si desidera usare le stesse versioni del protocollo del messaggio in ingresso, è possibile usare la proprietà <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> sull'istanza di <xref:System.ServiceModel.OperationContext> ottenuta dalla proprietà <xref:System.ServiceModel.OperationContext.Current%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-129">If you want to use the same protocol versions as the incoming message, you can use the <xref:System.ServiceModel.OperationContext.IncomingMessageVersion%2A> property on the <xref:System.ServiceModel.OperationContext> instance obtained from the <xref:System.ServiceModel.OperationContext.Current%2A> property.</span></span> <span data-ttu-id="73938-130">La maggior parte degli overload `CreateMessage` hanno anche un parametro stringa che indica l'azione SOAP da usare per il messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-130">Most `CreateMessage` overloads also have a string parameter that indicates the SOAP action to use for the message.</span></span> <span data-ttu-id="73938-131">È possibile impostare la versione su `None` per disabilitare la generazione di SOAP envelope. Il messaggio è costituito dal solo corpo.</span><span class="sxs-lookup"><span data-stu-id="73938-131">Version can be set to `None` to disable SOAP envelope generation; the message consists of only the body.</span></span>  
  
## <a name="creating-messages-from-objects"></a><span data-ttu-id="73938-132">Creazione di messaggi da oggetti</span><span class="sxs-lookup"><span data-stu-id="73938-132">Creating Messages from Objects</span></span>  
 <span data-ttu-id="73938-133">Tramite l'overload `CreateMessage` più elementare, che accetta solo una versione e un'azione, viene creato un messaggio con un corpo vuoto.</span><span class="sxs-lookup"><span data-stu-id="73938-133">The most basic `CreateMessage` overload that takes only a version and an action creates a message with an empty body.</span></span> <span data-ttu-id="73938-134">Un altro overload accetta un parametro <xref:System.Object> aggiuntivo, creando un messaggio il cui corpo è la rappresentazione serializzata dell'oggetto specificato.</span><span class="sxs-lookup"><span data-stu-id="73938-134">Another overload takes an additional <xref:System.Object> parameter; this creates a message whose body is the serialized representation of the given object.</span></span> <span data-ttu-id="73938-135">Usare la classe <xref:System.Runtime.Serialization.DataContractSerializer> con le impostazioni predefinite per la serializzazione.</span><span class="sxs-lookup"><span data-stu-id="73938-135">Use the <xref:System.Runtime.Serialization.DataContractSerializer> with default settings for serialization.</span></span> <span data-ttu-id="73938-136">Se si desidera usare un serializzatore diverso o si desidera che la classe `DataContractSerializer` venga configurata in modo diverso, usare l'overload `CreateMessage` che accetta anche un parametro `XmlObjectSerializer`.</span><span class="sxs-lookup"><span data-stu-id="73938-136">If you want to use a different serializer, or you want the `DataContractSerializer` configured differently, use the `CreateMessage` overload that also takes an `XmlObjectSerializer` parameter.</span></span>  
  
 <span data-ttu-id="73938-137">Per restituire un oggetto in un messaggio è, ad esempio, possibile usare il codice seguente.</span><span class="sxs-lookup"><span data-stu-id="73938-137">For example, to return an object in a message, you can use the following code.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#2)]
 [!code-vb[C_UsingTheMessageClass#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#2)]  
  
## <a name="creating-messages-from-xml-readers"></a><span data-ttu-id="73938-138">Creazione di messaggi da lettori XML</span><span class="sxs-lookup"><span data-stu-id="73938-138">Creating Messages from XML Readers</span></span>  
 <span data-ttu-id="73938-139">Esistono overload `CreateMessage` che accettano una classe <xref:System.Xml.XmlReader> o <xref:System.Xml.XmlDictionaryReader> per il corpo invece di un oggetto.</span><span class="sxs-lookup"><span data-stu-id="73938-139">There are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> for the body instead of an object.</span></span> <span data-ttu-id="73938-140">In questo caso il corpo del messaggio contiene il codice XML prodotto dalla lettura del lettore XML passato.</span><span class="sxs-lookup"><span data-stu-id="73938-140">In this case, the body of the message contains the XML that results from reading from the passed XML reader.</span></span> <span data-ttu-id="73938-141">Ad esempio, nel codice seguente viene restituito un messaggio con il contenuto del corpo letto da un file XML.</span><span class="sxs-lookup"><span data-stu-id="73938-141">For example, the following code returns a message with body contents read from an XML file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#3)]
 [!code-vb[C_UsingTheMessageClass#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#3)]  
  
 <span data-ttu-id="73938-142">Esistono, inoltre, overload `CreateMessage` che accettano una classe <xref:System.Xml.XmlReader> o <xref:System.Xml.XmlDictionaryReader> che rappresenta l'intero messaggio e non solo il corpo.</span><span class="sxs-lookup"><span data-stu-id="73938-142">Additionally, there are `CreateMessage` overloads that take an <xref:System.Xml.XmlReader> or an <xref:System.Xml.XmlDictionaryReader> that represents the entire message and not just the body.</span></span> <span data-ttu-id="73938-143">Questi overload accettano anche un parametro `maxSizeOfHeaders` intero.</span><span class="sxs-lookup"><span data-stu-id="73938-143">These overloads also take an integer `maxSizeOfHeaders` parameter.</span></span> <span data-ttu-id="73938-144">Le intestazioni vengono sempre memorizzate nel buffer in memoria non appena viene creato il messaggio e questo parametro limita la quantità di memorizzazione nel buffer eseguita.</span><span class="sxs-lookup"><span data-stu-id="73938-144">Headers are always buffered into memory as soon as the message is created, and this parameter limits the amount of buffering that takes place.</span></span> <span data-ttu-id="73938-145">È importante impostare questo parametro su un valore sicuro, se il codice XML proviene da un'origine non attendibile, per ridurre la possibilità di un attacco di tipo Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="73938-145">It is important to set this parameter to a safe value if the XML is coming from an untrusted source to mitigate the possibility of a denial of service attack.</span></span> <span data-ttu-id="73938-146">Le versioni SOAP e WS-Addressing del messaggio rappresentato dal lettore XML devono corrispondere alle versioni indicate mediante il parametro di versione.</span><span class="sxs-lookup"><span data-stu-id="73938-146">The SOAP and WS-Addressing versions of the message the XML reader represents must match the versions indicated using the version parameter.</span></span>  
  
## <a name="creating-messages-with-bodywriter"></a><span data-ttu-id="73938-147">Creazione di messaggi con BodyWriter</span><span class="sxs-lookup"><span data-stu-id="73938-147">Creating Messages with BodyWriter</span></span>  
 <span data-ttu-id="73938-148">Un overload `CreateMessage` accetta un'istanza di `BodyWriter` per descrivere il corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-148">One `CreateMessage` overload takes a `BodyWriter` instance to describe the body of the message.</span></span> <span data-ttu-id="73938-149">`BodyWriter` è una classe astratta che può essere derivata per personalizzare la modalità di creazione dei corpi dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="73938-149">A `BodyWriter` is an abstract class that can be derived to customize how message bodies are created.</span></span> <span data-ttu-id="73938-150">È possibile creare una classe derivata `BodyWriter` personalizzata per descrivere i corpi dei messaggi nel modo desiderato.</span><span class="sxs-lookup"><span data-stu-id="73938-150">You can create your own `BodyWriter` derived class to describe message bodies in a custom way.</span></span> <span data-ttu-id="73938-151">È necessario eseguire l'override del metodo `BodyWriter.OnWriteBodyContents` che accetta <xref:System.Xml.XmlDictionaryWriter>. Questo metodo è responsabile della scrittura del corpo.</span><span class="sxs-lookup"><span data-stu-id="73938-151">You must override the `BodyWriter.OnWriteBodyContents` method that takes an <xref:System.Xml.XmlDictionaryWriter>; this method is responsible for writing out the body.</span></span>  
  
 <span data-ttu-id="73938-152">I body writer possono essere memorizzati nel buffer oppure no (trasmessi).</span><span class="sxs-lookup"><span data-stu-id="73938-152">Body writers can be buffered or non-buffered (streamed).</span></span> <span data-ttu-id="73938-153">I body writer memorizzati nel buffer possono scrivere il proprio contenuto qualsiasi numero di volte, quelli trasmessi possono invece scrivere il proprio contenuto una sola volta.</span><span class="sxs-lookup"><span data-stu-id="73938-153">Buffered body writers can write out their contents any number of times, while streamed ones can write out their contents only once.</span></span> <span data-ttu-id="73938-154">La proprietà `IsBuffered` indica se un body writer è memorizzato o meno nel buffer.</span><span class="sxs-lookup"><span data-stu-id="73938-154">The `IsBuffered` property indicates whether a body writer is buffered or not.</span></span> <span data-ttu-id="73938-155">Per impostare questa proprietà per il body writer chiamare il costruttore `BodyWriter` protetto che accetta un parametro booleano `isBuffered`.</span><span class="sxs-lookup"><span data-stu-id="73938-155">You can set this for your body writer by calling the protected `BodyWriter` constructor that takes an `isBuffered` boolean parameter.</span></span> <span data-ttu-id="73938-156">I body writer supportano la creazione di un body writer memorizzato nel buffer da un body writer non memorizzato nel buffer.</span><span class="sxs-lookup"><span data-stu-id="73938-156">Body writers support creating a buffered body writer from a non-buffered body writer.</span></span> <span data-ttu-id="73938-157">È possibile eseguire l'override del metodo `OnCreateBufferedCopy` per personalizzare questo processo.</span><span class="sxs-lookup"><span data-stu-id="73938-157">You can override the `OnCreateBufferedCopy` method to customize this process.</span></span> <span data-ttu-id="73938-158">Per impostazione predefinita, viene usato un buffer in memoria contenente il codice XML restituito da `OnWriteBodyContents`.</span><span class="sxs-lookup"><span data-stu-id="73938-158">By default, an in-memory buffer that contains the XML returned by `OnWriteBodyContents` is used.</span></span> <span data-ttu-id="73938-159">`OnCreateBufferedCopy` accetta un parametro di tipo Integer `maxBufferSize`. Se si esegue l'override di questo metodo, non è necessario creare buffer più grandi della dimensione massima specificata.</span><span class="sxs-lookup"><span data-stu-id="73938-159">`OnCreateBufferedCopy` takes a `maxBufferSize` integer parameter; if you override this method, you must not create buffers larger than this maximum size.</span></span>  
  
 <span data-ttu-id="73938-160">La classe `BodyWriter` fornisce i metodi `WriteBodyContents` e `CreateBufferedCopy` che sono essenzialmente thin wrapper rispettivamente dei metodi `OnWriteBodyContents` e `OnCreateBufferedCopy`.</span><span class="sxs-lookup"><span data-stu-id="73938-160">The `BodyWriter` class provides the `WriteBodyContents` and `CreateBufferedCopy` methods, which are essentially thin wrappers around `OnWriteBodyContents` and `OnCreateBufferedCopy` methods, respectively.</span></span> <span data-ttu-id="73938-161">Questi metodi eseguono un controllo dello stato per assicurare che non sia possibile accedere a un body writer non memorizzato nel buffer più di una volta.</span><span class="sxs-lookup"><span data-stu-id="73938-161">These methods perform state checking to ensure that a non-buffered body writer is not accessed more than once.</span></span> <span data-ttu-id="73938-162">I metodi vengono chiamati direttamente solo in caso di creazione di classi derivate `Message` personalizzate basate su `BodyWriters`.</span><span class="sxs-lookup"><span data-stu-id="73938-162">These methods are called directly only when creating custom `Message` derived classes based on `BodyWriters`.</span></span>  
  
## <a name="creating-fault-messages"></a><span data-ttu-id="73938-163">Creazione di messaggi di errore</span><span class="sxs-lookup"><span data-stu-id="73938-163">Creating Fault Messages</span></span>  
 <span data-ttu-id="73938-164">È possibile usare determinati overload `CreateMessage` per creare messaggi di errore SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-164">You can use certain `CreateMessage` overloads to create SOAP fault messages.</span></span> <span data-ttu-id="73938-165">Il più elementare accetta un oggetto <xref:System.ServiceModel.Channels.MessageFault> che descrive l'errore.</span><span class="sxs-lookup"><span data-stu-id="73938-165">The most basic of these takes a <xref:System.ServiceModel.Channels.MessageFault> object that describes the fault.</span></span> <span data-ttu-id="73938-166">Altri overload vengono forniti per comodità.</span><span class="sxs-lookup"><span data-stu-id="73938-166">Other overloads are provided for convenience.</span></span> <span data-ttu-id="73938-167">Il primo di tali overload accetta un elemento `FaultCode` e una stringa motivo e crea un elemento `MessageFault` usando `MessageFault.CreateFault` che usa queste informazioni.</span><span class="sxs-lookup"><span data-stu-id="73938-167">The first such overload takes a `FaultCode` and a reason string and creates a `MessageFault` using `MessageFault.CreateFault` using this information.</span></span> <span data-ttu-id="73938-168">L'altro overload accetta un oggetto Detail e lo passa a `CreateFault` insieme al codice e al motivo dell'errore.</span><span class="sxs-lookup"><span data-stu-id="73938-168">The other overload takes a detail object and also passes it to `CreateFault` together with the fault code and the reason.</span></span> <span data-ttu-id="73938-169">Ad esempio, nell'operazione seguente viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="73938-169">For example, the following operation returns a fault.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#4)]
 [!code-vb[C_UsingTheMessageClass#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#4)]  
  
## <a name="extracting-message-body-data"></a><span data-ttu-id="73938-170">Estrazione di dati del corpo del messaggio</span><span class="sxs-lookup"><span data-stu-id="73938-170">Extracting Message Body Data</span></span>  
 <span data-ttu-id="73938-171">La classe `Message` supporta più modalità di estrazione delle informazioni dal proprio corpo.</span><span class="sxs-lookup"><span data-stu-id="73938-171">The `Message` class supports multiple ways of extracting information from its body.</span></span> <span data-ttu-id="73938-172">Queste modalità possono essere classificate nelle categorie seguenti:</span><span class="sxs-lookup"><span data-stu-id="73938-172">These can be classified into the following categories:</span></span>  
  
- <span data-ttu-id="73938-173">Recupero dell'intero corpo del messaggio scritto tutto in sola volta in un writer XML.</span><span class="sxs-lookup"><span data-stu-id="73938-173">Getting the entire message body written out at once to an XML writer.</span></span> <span data-ttu-id="73938-174">Questa operazione viene definita *scrittura di un messaggio*.</span><span class="sxs-lookup"><span data-stu-id="73938-174">This is referred to as *writing a message*.</span></span>  
  
- <span data-ttu-id="73938-175">Recupero di un lettore XML sul corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-175">Getting an XML reader over the message body.</span></span> <span data-ttu-id="73938-176">Questo consente di accedere in seguito al corpo del messaggio un pezzo alla volta, come richiesto.</span><span class="sxs-lookup"><span data-stu-id="73938-176">This enables you to later access the message body piece-by-piece as required.</span></span> <span data-ttu-id="73938-177">Questa operazione viene definita *lettura di un messaggio*.</span><span class="sxs-lookup"><span data-stu-id="73938-177">This is referred to as *reading a message*.</span></span>  
  
- <span data-ttu-id="73938-178">L'intero messaggio, incluso il corpo, può essere copiato in un buffer in memoria di tipo <xref:System.ServiceModel.Channels.MessageBuffer>.</span><span class="sxs-lookup"><span data-stu-id="73938-178">The entire message, including its body, can be copied to an in-memory buffer of the <xref:System.ServiceModel.Channels.MessageBuffer> type.</span></span> <span data-ttu-id="73938-179">Questa operazione viene definita *copia di un messaggio*.</span><span class="sxs-lookup"><span data-stu-id="73938-179">This is referred to as *copying a message*.</span></span>  
  
 <span data-ttu-id="73938-180">È possibile accedere al corpo di una classe `Message` una sola volta, indipendentemente dalla modalità di accesso.</span><span class="sxs-lookup"><span data-stu-id="73938-180">You can access the body of a `Message` only once, regardless of how it is accessed.</span></span> <span data-ttu-id="73938-181">Un oggetto messaggio ha una proprietà `State`, impostata inizialmente su Creato.</span><span class="sxs-lookup"><span data-stu-id="73938-181">A message object has a `State` property, which is initially set to Created.</span></span> <span data-ttu-id="73938-182">I tre metodi di accesso descritti nell'elenco precedente impostano lo stato rispettivamente su Scritto, Letto e Copiato.</span><span class="sxs-lookup"><span data-stu-id="73938-182">The three access methods described in the preceding list set the state to Written, Read, and Copied, respectively.</span></span> <span data-ttu-id="73938-183">Inoltre, un metodo `Close` può impostare lo stato su Chiuso, quando il contenuto del corpo del messaggio non è più necessario.</span><span class="sxs-lookup"><span data-stu-id="73938-183">Additionally, a `Close` method can set the state to Closed when the message body contents are no longer required.</span></span> <span data-ttu-id="73938-184">Il corpo del messaggio è accessibile solo nello stato Creato e non c'è alcun modo per tornare allo stato Creato dopo che è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="73938-184">The message body can be accessed only in the Created state, and there is no way to go back to the Created state after the state has changed.</span></span>  
  
## <a name="writing-messages"></a><span data-ttu-id="73938-185">Scrittura di messaggi</span><span class="sxs-lookup"><span data-stu-id="73938-185">Writing Messages</span></span>  
 <span data-ttu-id="73938-186">Il metodo <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> scrive il contenuto del corpo di un'istanza di `Message` in un determinato writer XML.</span><span class="sxs-lookup"><span data-stu-id="73938-186">The <xref:System.ServiceModel.Channels.Message.WriteBodyContents%28System.Xml.XmlDictionaryWriter%29> method writes out the body contents of a given `Message` instance to a given XML writer.</span></span> <span data-ttu-id="73938-187">Il <xref:System.ServiceModel.Channels.Message.WriteBody%2A> metodo esegue la stessa operazione, ad eccezione del fatto che racchiude il contenuto del corpo nell'elemento wrapper appropriato, ad esempio <`soap:body`>.</span><span class="sxs-lookup"><span data-stu-id="73938-187">The <xref:System.ServiceModel.Channels.Message.WriteBody%2A> method does the same, except that it encloses the body contents in the appropriate wrapper element (for example, <`soap:body`>).</span></span> <span data-ttu-id="73938-188">Infine, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> scrive l'intero messaggio, incluse l'envelope SOAP di wrapping e le intestazioni.</span><span class="sxs-lookup"><span data-stu-id="73938-188">Finally, <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> writes out the entire message, including the wrapping SOAP envelope and the headers.</span></span> <span data-ttu-id="73938-189">Se SOAP è disattivato ( <xref:System.ServiceModel.Channels.Message.Version> is <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType> ), tutti e tre i metodi eseguono la stessa operazione: scrivono il contenuto del corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-189">If SOAP is turned off (<xref:System.ServiceModel.Channels.Message.Version> is <xref:System.ServiceModel.Channels.MessageVersion.None?displayProperty=nameWithType>), all three methods do the same thing: they write out the message body contents.</span></span>  
  
 <span data-ttu-id="73938-190">Ad esempio, nel codice seguente viene scritto il corpo di un messaggio in ingresso in un file.</span><span class="sxs-lookup"><span data-stu-id="73938-190">For example, the following code writes out the body of an incoming message to a file.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#5)]
 [!code-vb[C_UsingTheMessageClass#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#5)]  
  
 <span data-ttu-id="73938-191">Due metodi di supporto aggiuntivi scrivono determinati tag di elemento iniziali SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-191">Two additional helper methods write out certain SOAP start element tags.</span></span> <span data-ttu-id="73938-192">Questi metodi non accedono al corpo del messaggio, pertanto non modificano lo stato del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-192">These methods do not access the message body and so they do not change the message state.</span></span> <span data-ttu-id="73938-193">Sono inclusi:</span><span class="sxs-lookup"><span data-stu-id="73938-193">These include:</span></span>  
  
- <span data-ttu-id="73938-194"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> scrive l'elemento del corpo iniziale, ad esempio, `<soap:Body>`.</span><span class="sxs-lookup"><span data-stu-id="73938-194"><xref:System.ServiceModel.Channels.Message.WriteStartBody%2A> writes the start body element, for example, `<soap:Body>`.</span></span>  
  
- <span data-ttu-id="73938-195"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> scrive l'elemento envelope iniziale, ad esempio, `<soap:Envelope>`.</span><span class="sxs-lookup"><span data-stu-id="73938-195"><xref:System.ServiceModel.Channels.Message.WriteStartEnvelope%2A> writes the start envelope element, for example, `<soap:Envelope>`.</span></span>  
  
 <span data-ttu-id="73938-196">Per scrivere i corrispondenti tag di elemento finali, chiamare `WriteEndElement` sul writer XML corrispondente.</span><span class="sxs-lookup"><span data-stu-id="73938-196">To write the corresponding end element tags, call `WriteEndElement` on the corresponding XML writer.</span></span> <span data-ttu-id="73938-197">È raro che questi metodi vengano chiamati direttamente.</span><span class="sxs-lookup"><span data-stu-id="73938-197">These methods are rarely called directly.</span></span>  
  
## <a name="reading-messages"></a><span data-ttu-id="73938-198">Lettura di messaggi</span><span class="sxs-lookup"><span data-stu-id="73938-198">Reading Messages</span></span>  
 <span data-ttu-id="73938-199">La modalità principale per leggere il corpo di un messaggio consiste nel chiamare <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-199">The primary way to read a message body is to call <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>.</span></span> <span data-ttu-id="73938-200">Si ottiene una classe <xref:System.Xml.XmlDictionaryReader> usabile per leggere il corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-200">You get back an <xref:System.Xml.XmlDictionaryReader> that you can use to read the message body.</span></span> <span data-ttu-id="73938-201">Si noti che <xref:System.ServiceModel.Channels.Message> passa allo stato Letto non appena viene chiamato <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A>, non quando si usa il lettore XML restituito.</span><span class="sxs-lookup"><span data-stu-id="73938-201">Note that the <xref:System.ServiceModel.Channels.Message> transitions to the Read state as soon as <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> is called, and not when you use the returned XML reader.</span></span>  
  
 <span data-ttu-id="73938-202">Il metodo <xref:System.ServiceModel.Channels.Message.GetBody%2A> consente anche di accedere al corpo del messaggio come oggetto tipizzato.</span><span class="sxs-lookup"><span data-stu-id="73938-202">The <xref:System.ServiceModel.Channels.Message.GetBody%2A> method also enables you to access the message body as a typed object.</span></span> <span data-ttu-id="73938-203">Internamente, questo metodo usa `GetReaderAtBodyContents` e quindi esegue anche la transizione dello stato del messaggio allo stato <xref:System.ServiceModel.Channels.MessageState.Read> (vedere la proprietà <xref:System.ServiceModel.Channels.Message.State%2A>).</span><span class="sxs-lookup"><span data-stu-id="73938-203">Internally, this method uses `GetReaderAtBodyContents`, and so it also transitions the message state to the <xref:System.ServiceModel.Channels.MessageState.Read> state (see the <xref:System.ServiceModel.Channels.Message.State%2A> property).</span></span>  
  
 <span data-ttu-id="73938-204">È buona norma controllare la proprietà <xref:System.ServiceModel.Channels.Message.IsEmpty%2A>, caso in cui il corpo del messaggio è vuoto e <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> genera una <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="73938-204">It is good practice to check the <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property, in which case the message body is empty and <xref:System.ServiceModel.Channels.Message.GetReaderAtBodyContents%2A> throws an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="73938-205">Inoltre, se si tratta di un messaggio ricevuto (ad esempio una risposta), può essere necessario controllare anche <xref:System.ServiceModel.Channels.Message.IsFault%2A>, che indica se il messaggio contiene un errore.</span><span class="sxs-lookup"><span data-stu-id="73938-205">Also, if it is a received message (for example, the reply), you may also want to check <xref:System.ServiceModel.Channels.Message.IsFault%2A>, which indicates whether the message contains a fault.</span></span>  
  
 <span data-ttu-id="73938-206">L'overload più elementare di <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserializza il corpo del messaggio in un'istanza di un tipo (indicato dal parametro generico) usando un oggetto <xref:System.Runtime.Serialization.DataContractSerializer> configurato con le impostazioni predefinite e con la quota <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> disabilitata.</span><span class="sxs-lookup"><span data-stu-id="73938-206">The most basic overload of <xref:System.ServiceModel.Channels.Message.GetBody%2A> deserializes the message body into an instance of a type (indicated by the generic parameter) using a <xref:System.Runtime.Serialization.DataContractSerializer> configured with the default settings and with the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> quota disabled.</span></span> <span data-ttu-id="73938-207">Se si desidera usare un altro motore di serializzazione o configurare `DataContractSerializer` in modo non predefinito, usare l'overload <xref:System.ServiceModel.Channels.Message.GetBody%2A> che accetta una classe <xref:System.Runtime.Serialization.XmlObjectSerializer>.</span><span class="sxs-lookup"><span data-stu-id="73938-207">If you want to use a different serialization engine, or configure the `DataContractSerializer` in a non-default way, use the <xref:System.ServiceModel.Channels.Message.GetBody%2A> overload that takes an <xref:System.Runtime.Serialization.XmlObjectSerializer>.</span></span>  
  
 <span data-ttu-id="73938-208">Ad esempio, nel codice seguente vengono estratti i dati dal corpo di un messaggio che contiene un oggetto `Person` serializzato e viene stampato il nome della persona.</span><span class="sxs-lookup"><span data-stu-id="73938-208">For example, the following code extracts data from a message body that contains a serialized `Person` object and prints out the person’s name.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#6)]
 [!code-vb[C_UsingTheMessageClass#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#6)]  
  
## <a name="copying-a-message-into-a-buffer"></a><span data-ttu-id="73938-209">Copia di un messaggio in un buffer</span><span class="sxs-lookup"><span data-stu-id="73938-209">Copying a Message into a Buffer</span></span>  
 <span data-ttu-id="73938-210">Talvolta è necessario accedere al corpo del messaggio più di una volta, ad esempio per inoltrare lo stesso messaggio a più destinazioni come parte di un sistema di pubblicazione-sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="73938-210">Sometimes it is necessary to access the message body more than once, for example, to forward the same message to multiple destinations as part of a publisher-subscriber system.</span></span> <span data-ttu-id="73938-211">In questo caso è necessario memorizzare nel buffer l'intero messaggio (incluso il corpo) in memoria.</span><span class="sxs-lookup"><span data-stu-id="73938-211">In this case, it is necessary to buffer the entire message (including the body) in memory.</span></span> <span data-ttu-id="73938-212">A questo scopo è possibile chiamare <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29>.</span><span class="sxs-lookup"><span data-stu-id="73938-212">You can do this by calling <xref:System.ServiceModel.Channels.Message.CreateBufferedCopy%28System.Int32%29>.</span></span> <span data-ttu-id="73938-213">Questo metodo accetta un parametro integer che rappresenta la dimensione massima del buffer e crea un buffer che non supera tale dimensione.</span><span class="sxs-lookup"><span data-stu-id="73938-213">This method takes an integer parameter that represents the maximum buffer size, and creates a buffer not larger than this size.</span></span> <span data-ttu-id="73938-214">È importante impostare il parametro su un valore sicuro, se il messaggio proviene da un'origine non attendibile.</span><span class="sxs-lookup"><span data-stu-id="73938-214">It is important to set this to a safe value if the message is coming from an untrusted source.</span></span>  
  
 <span data-ttu-id="73938-215">Il buffer viene restituito come istanza di <xref:System.ServiceModel.Channels.MessageBuffer>.</span><span class="sxs-lookup"><span data-stu-id="73938-215">The buffer is returned as a <xref:System.ServiceModel.Channels.MessageBuffer> instance.</span></span> <span data-ttu-id="73938-216">È possibile accedere ai dati nel buffer in diversi modi.</span><span class="sxs-lookup"><span data-stu-id="73938-216">You can access data in the buffer in several ways.</span></span> <span data-ttu-id="73938-217">Il modo principale consiste nel chiamare <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> per creare istanze di `Message` dal buffer.</span><span class="sxs-lookup"><span data-stu-id="73938-217">The primary way is to call <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> to create `Message` instances from the buffer.</span></span>  
  
 <span data-ttu-id="73938-218">Un altro modo per accedere ai dati nel buffer consiste nell'implementare l'interfaccia <xref:System.Xml.XPath.IXPathNavigable> implementata dalla classe <xref:System.ServiceModel.Channels.MessageBuffer> per accedere direttamente al codice XML sottostante.</span><span class="sxs-lookup"><span data-stu-id="73938-218">Another way to access the data in the buffer is to implement the <xref:System.Xml.XPath.IXPathNavigable> interface that the <xref:System.ServiceModel.Channels.MessageBuffer> class implements to access the underlying XML directly.</span></span> <span data-ttu-id="73938-219">Alcuni overload di <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> consentono di creare strumenti di spostamento <xref:System.Xml.XPath> protetti da una quota del nodo, limitando il numero di nodi XML che è possibile visitare.</span><span class="sxs-lookup"><span data-stu-id="73938-219">Some <xref:System.ServiceModel.Channels.MessageBuffer.CreateNavigator%2A> overloads allow you to create <xref:System.Xml.XPath> navigators protected by a node quota, limiting the number of XML nodes that can be visited.</span></span> <span data-ttu-id="73938-220">Questo consente di impedire attacchi di tipo Denial of Service basati su lunghi tempi di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="73938-220">This helps prevent denial of service attacks based on lengthy processing time.</span></span> <span data-ttu-id="73938-221">Questa quota è disattivata per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="73938-221">This quote is disabled by default.</span></span> <span data-ttu-id="73938-222">Alcuni overload `CreateNavigator` consentono di specificare la modalità di gestione dello spazio vuoto nel codice XML usando l'enumerazione <xref:System.Xml.XmlSpace>, con l'impostazione predefinita `XmlSpace.None`.</span><span class="sxs-lookup"><span data-stu-id="73938-222">Some `CreateNavigator` overloads allow you to specify how white space should be handled in the XML using the <xref:System.Xml.XmlSpace> enumeration, with the default being `XmlSpace.None`.</span></span>  
  
 <span data-ttu-id="73938-223">Un modo finale per accedere al contenuto di un buffer dei messaggi consiste nello scriverne il contenuto in un flusso usando <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-223">A final way to access the contents of a message buffer is to write out its contents to a stream using <xref:System.ServiceModel.Channels.Message.WriteMessage%2A>.</span></span>  
  
 <span data-ttu-id="73938-224">Nell'esempio seguente viene illustrato il processo d'uso di `MessageBuffer`: un messaggio in ingresso viene inoltrato a più destinatari e quindi registrato in un file.</span><span class="sxs-lookup"><span data-stu-id="73938-224">The following example demonstrates the process of working with a `MessageBuffer`: an incoming message is forwarded to multiple recipients, and then logged to a file.</span></span> <span data-ttu-id="73938-225">Senza la memorizzazione nel buffer, questa operazione non può essere eseguita, perché è possibile accedere al corpo del messaggio una sola volta.</span><span class="sxs-lookup"><span data-stu-id="73938-225">Without buffering, this is not possible, because the message body can then be accessed only once.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#7)]
 [!code-vb[C_UsingTheMessageClass#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#7)]  
  
 <span data-ttu-id="73938-226">La classe `MessageBuffer` ha altri membri non degni di nota.</span><span class="sxs-lookup"><span data-stu-id="73938-226">The `MessageBuffer` class has other members worth noting.</span></span> <span data-ttu-id="73938-227">È possibile chiamare il metodo <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> per liberare risorse quando il contenuto del buffer non è più necessario.</span><span class="sxs-lookup"><span data-stu-id="73938-227">The <xref:System.ServiceModel.Channels.MessageBuffer.Close%2A> method can be called to free resources when the buffer contents are no longer required.</span></span> <span data-ttu-id="73938-228">La proprietà <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> restituisce la dimensione del buffer allocato.</span><span class="sxs-lookup"><span data-stu-id="73938-228">The <xref:System.ServiceModel.Channels.MessageBuffer.BufferSize%2A> property returns the size of the allocated buffer.</span></span> <span data-ttu-id="73938-229">La proprietà <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> restituisce il tipo di contenuti MIME del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-229">The <xref:System.ServiceModel.Channels.MessageBuffer.MessageContentType%2A> property returns the MIME content type of the message.</span></span>  
  
## <a name="accessing-the-message-body-for-debugging"></a><span data-ttu-id="73938-230">Accesso al corpo del messaggio a scopo di debug</span><span class="sxs-lookup"><span data-stu-id="73938-230">Accessing the Message Body for Debugging</span></span>  
 <span data-ttu-id="73938-231">A scopo di debug, è possibile chiamare il metodo <xref:System.ServiceModel.Channels.Message.ToString%2A> per ottenere una rappresentazione del messaggio come stringa.</span><span class="sxs-lookup"><span data-stu-id="73938-231">For debugging purposes, you can call the <xref:System.ServiceModel.Channels.Message.ToString%2A> method to get a representation of the message as a string.</span></span> <span data-ttu-id="73938-232">Questa rappresentazione corrisponde in genere all'aspetto che avrebbe il messaggio in transito se fosse codificato con il codificatore di testo, eccetto per il fatto che il codice XML sarebbe formattato in modo leggibile.</span><span class="sxs-lookup"><span data-stu-id="73938-232">This representation generally matches the way a message would look on the wire if it were encoded with the text encoder, except that the XML would be better formatted for human readability.</span></span> <span data-ttu-id="73938-233">L'unica eccezione è il corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-233">The one exception to this is the message body.</span></span> <span data-ttu-id="73938-234">Il corpo può essere letto una sola volta e `ToString` non modifica lo stato del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-234">The body can be read only once, and `ToString` does not change the message state.</span></span> <span data-ttu-id="73938-235">Pertanto, il `ToString` metodo potrebbe non essere in grado di accedere al corpo e potrebbe sostituire un segnaposto, ad esempio "..." o tre punti) invece del corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-235">Therefore, the `ToString` method might not be able to access the body and might substitute a placeholder (for example, "…" or three dots) instead of the message body.</span></span> <span data-ttu-id="73938-236">Non usare quindi `ToString` per registrare messaggi con contenuto del corpo importante.</span><span class="sxs-lookup"><span data-stu-id="73938-236">Therefore, do not use `ToString` to log messages if the body content of the messages is important.</span></span>  
  
## <a name="accessing-other-message-parts"></a><span data-ttu-id="73938-237">Accesso ad altre parti del messaggio</span><span class="sxs-lookup"><span data-stu-id="73938-237">Accessing Other Message Parts</span></span>  
 <span data-ttu-id="73938-238">Vengono fornite varie proprietà per accedere a informazioni sul messaggio diverse dal contenuto del corpo.</span><span class="sxs-lookup"><span data-stu-id="73938-238">Various properties are provided to access information about the message other than its body contents.</span></span> <span data-ttu-id="73938-239">Queste proprietà non possono tuttavia essere chiamate dopo la chiusura del messaggio:</span><span class="sxs-lookup"><span data-stu-id="73938-239">However, these cannot be called once the message has been closed:</span></span>  
  
- <span data-ttu-id="73938-240">La proprietà <xref:System.ServiceModel.Channels.Message.Headers%2A> rappresenta le intestazioni del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-240">The <xref:System.ServiceModel.Channels.Message.Headers%2A> property represents the message headers.</span></span> <span data-ttu-id="73938-241">Vedere la sezione "utilizzo delle intestazioni" più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="73938-241">See the section on "Working with Headers" later in this topic.</span></span>  
  
- <span data-ttu-id="73938-242">La proprietà <xref:System.ServiceModel.Channels.Message.Properties%2A> rappresenta le proprietà del messaggio, che sono pezzi di dati denominati collegati al messaggio che non vengono generalmente generati quando il messaggio viene inviato.</span><span class="sxs-lookup"><span data-stu-id="73938-242">The <xref:System.ServiceModel.Channels.Message.Properties%2A> property represents the message properties, which are pieces of named data attached to the message that do not generally get emitted when the message is sent.</span></span> <span data-ttu-id="73938-243">Vedere la sezione sull'uso di proprietà più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="73938-243">See the section on "Working with Properties" later in this topic.</span></span>  
  
- <span data-ttu-id="73938-244">La proprietà <xref:System.ServiceModel.Channels.Message.Version%2A> indica la versione SOAP e WS-Addressing associata al messaggio o `None` se SOAP è disattivato.</span><span class="sxs-lookup"><span data-stu-id="73938-244">The <xref:System.ServiceModel.Channels.Message.Version%2A> property indicates the SOAP and WS-Addressing version associated with the message, or `None` if SOAP is disabled.</span></span>  
  
- <span data-ttu-id="73938-245">La proprietà <xref:System.ServiceModel.Channels.Message.IsFault%2A> restituisce `true` se il messaggio e un messaggio di errore SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-245">The <xref:System.ServiceModel.Channels.Message.IsFault%2A> property returns `true` if the message is a SOAP fault message.</span></span>  
  
- <span data-ttu-id="73938-246">La proprietà <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> restituisce `true` se il messaggio è vuoto.</span><span class="sxs-lookup"><span data-stu-id="73938-246">The <xref:System.ServiceModel.Channels.Message.IsEmpty%2A> property returns `true` if the message is empty.</span></span>  
  
 <span data-ttu-id="73938-247">È possibile usare il metodo <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> per accedere a un particolare attributo sull'elemento wrapper del corpo, ad esempio, `<soap:Body>`, identificato da un nome e uno spazio dei nomi particolari.</span><span class="sxs-lookup"><span data-stu-id="73938-247">You can use the <xref:System.ServiceModel.Channels.Message.GetBodyAttribute%28System.String%2CSystem.String%29> method to access a particular attribute on the body wrapper element (for example, `<soap:Body>`) identified by a particular name and namespace.</span></span> <span data-ttu-id="73938-248">Se tale attributo non viene trovato, verrà restituito `null`.</span><span class="sxs-lookup"><span data-stu-id="73938-248">If such an attribute is not found, `null` is returned.</span></span> <span data-ttu-id="73938-249">Questo metodo può essere chiamato solo quando `Message` si trova nello stato Creato, ovvero quando non si è ancora avuto accesso al corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-249">This method can be called only when the `Message` is in the Created state (when the message body has not yet been accessed).</span></span>  
  
## <a name="working-with-headers"></a><span data-ttu-id="73938-250">Uso di intestazioni</span><span class="sxs-lookup"><span data-stu-id="73938-250">Working with Headers</span></span>  
 <span data-ttu-id="73938-251">Un oggetto `Message` può contenere un numero qualsiasi di frammenti XML denominati, denominati *intestazioni*.</span><span class="sxs-lookup"><span data-stu-id="73938-251">A `Message` can contain any number of named XML fragments, called *headers*.</span></span> <span data-ttu-id="73938-252">Ogni frammento è normalmente mappato a un'intestazione SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-252">Each fragment normally maps to a SOAP header.</span></span> <span data-ttu-id="73938-253">Alle intestazioni si accede tramite la proprietà `Headers` di tipo <xref:System.ServiceModel.Channels.MessageHeaders>.</span><span class="sxs-lookup"><span data-stu-id="73938-253">Headers are accessed through the `Headers` property of type <xref:System.ServiceModel.Channels.MessageHeaders>.</span></span> <span data-ttu-id="73938-254"><xref:System.ServiceModel.Channels.MessageHeaders> è una raccolta di oggetti <xref:System.ServiceModel.Channels.MessageHeaderInfo> e le singole intestazioni sono accessibili tramite la relativa interfaccia <xref:System.Collections.IEnumerable> o il relativo indicizzatore.</span><span class="sxs-lookup"><span data-stu-id="73938-254"><xref:System.ServiceModel.Channels.MessageHeaders> is a collection of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects, and individual headers can be accessed through its <xref:System.Collections.IEnumerable> interface or through its indexer.</span></span> <span data-ttu-id="73938-255">Nel codice seguente vengono, ad esempio, elencati i nomi di tutte le intestazioni in una classe `Message`.</span><span class="sxs-lookup"><span data-stu-id="73938-255">For example, the following code lists the names of all the headers in a `Message`.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#8)]
 [!code-vb[C_UsingTheMessageClass#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#8)]  
  
#### <a name="adding-removing-finding-headers"></a><span data-ttu-id="73938-256">Aggiunta, rimozione e individuazione di intestazioni</span><span class="sxs-lookup"><span data-stu-id="73938-256">Adding, Removing, Finding Headers</span></span>  
 <span data-ttu-id="73938-257">È possibile aggiungere una nuova intestazione alla fine di tutte le intestazioni esistenti usando il metodo <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-257">You can add a new header at the end of all existing headers using the <xref:System.ServiceModel.Channels.MessageHeaders.Add%2A> method.</span></span> <span data-ttu-id="73938-258">È possibile usare il metodo <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> per inserire un'intestazione all'altezza di un particolare indice.</span><span class="sxs-lookup"><span data-stu-id="73938-258">You can use the <xref:System.ServiceModel.Channels.MessageHeaders.Insert%2A> method to insert a header at a particular index.</span></span> <span data-ttu-id="73938-259">Le intestazioni esistenti vengono spostate per adattare l'elemento inserito.</span><span class="sxs-lookup"><span data-stu-id="73938-259">Existing headers are shifted for the inserted item.</span></span> <span data-ttu-id="73938-260">Le intestazioni vengono ordinate secondo il proprio indice e il primo indice disponibile è 0.</span><span class="sxs-lookup"><span data-stu-id="73938-260">Headers are ordered according to their index, and the first available index is 0.</span></span> <span data-ttu-id="73938-261">È possibile usare i vari overload del metodo <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> per aggiungere intestazioni da una diversa istanza di un oggetto `Message` o `MessageHeaders`.</span><span class="sxs-lookup"><span data-stu-id="73938-261">You can use the various <xref:System.ServiceModel.Channels.MessageHeaders.CopyHeadersFrom%2A> method overloads to add headers from a different `Message` or `MessageHeaders` instance.</span></span> <span data-ttu-id="73938-262">Alcuni overload copiano una sola intestazione, mentre altri le copiano tutte.</span><span class="sxs-lookup"><span data-stu-id="73938-262">Some overloads copy one individual header, while others copy all of them.</span></span> <span data-ttu-id="73938-263">Il metodo <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> rimuove tutte le intestazioni.</span><span class="sxs-lookup"><span data-stu-id="73938-263">The <xref:System.ServiceModel.Channels.MessageHeaders.Clear%2A> method removes all headers.</span></span> <span data-ttu-id="73938-264">Il metodo <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> rimuove un'intestazione all'altezza di un particolare indice, spostando tutte le intestazioni dopo di essa.</span><span class="sxs-lookup"><span data-stu-id="73938-264">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAt%2A> method removes a header at a particular index (shifting all headers after it).</span></span> <span data-ttu-id="73938-265">Il metodo <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> rimuove tutte le intestazioni con un nome e un spazio dei nomi particolari.</span><span class="sxs-lookup"><span data-stu-id="73938-265">The <xref:System.ServiceModel.Channels.MessageHeaders.RemoveAll%2A> method removes all headers with a particular name and namespace.</span></span>  
  
 <span data-ttu-id="73938-266">Recuperare una particolare intestazione usando il metodo <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-266">Retrieve a particular header using the <xref:System.ServiceModel.Channels.MessageHeaders.FindHeader%2A> method.</span></span> <span data-ttu-id="73938-267">Questo metodo accetta il nome e lo spazio dei nomi dell'intestazione da cercare e restituisce l'indice.</span><span class="sxs-lookup"><span data-stu-id="73938-267">This method takes the name and namespace of the header to find, and returns its index.</span></span> <span data-ttu-id="73938-268">Se l'intestazione ricorre più di una volta, verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="73938-268">If the header occurs more than once, an exception is thrown.</span></span> <span data-ttu-id="73938-269">Se l'intestazione non viene trovata, verrà restituito -1.</span><span class="sxs-lookup"><span data-stu-id="73938-269">If the header is not found, it returns -1.</span></span>  
  
 <span data-ttu-id="73938-270">Nel modello di intestazione SOAP, le intestazioni possono avere un valore `Actor` che specifica il destinatario desiderato dell'intestazione.</span><span class="sxs-lookup"><span data-stu-id="73938-270">In the SOAP header model, headers can have an `Actor` value that specifies the intended recipient of the header.</span></span> <span data-ttu-id="73938-271">L'overload `FindHeader` più elementare ricerca solo le intestazioni indirizzate al destinatario finale del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-271">The most basic `FindHeader` overload searches only headers intended for the ultimate receiver of the message.</span></span> <span data-ttu-id="73938-272">Tuttavia, un altro overload consente di specificare quali valori `Actor` sono inclusi nella ricerca.</span><span class="sxs-lookup"><span data-stu-id="73938-272">However, another overload enables you to specify which `Actor` values are included in the search.</span></span> <span data-ttu-id="73938-273">Per ulteriori informazioni, vedere la specifica SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-273">For more information, see the SOAP specification.</span></span>  
  
 <span data-ttu-id="73938-274">Viene fornito un metodo <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> per copiare intestazioni da una raccolta <xref:System.ServiceModel.Channels.MessageHeaders> a una matrice di oggetti <xref:System.ServiceModel.Channels.MessageHeaderInfo>.</span><span class="sxs-lookup"><span data-stu-id="73938-274">A <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> method is provided to copy headers from a <xref:System.ServiceModel.Channels.MessageHeaders> collection to an array of <xref:System.ServiceModel.Channels.MessageHeaderInfo> objects.</span></span>  
  
 <span data-ttu-id="73938-275">Per accedere ai dati XML in un'intestazione è possibile chiamare <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> e restituire un lettore XML per l'indice dell'intestazione specifico.</span><span class="sxs-lookup"><span data-stu-id="73938-275">To access the XML data in a header, you can call <xref:System.ServiceModel.Channels.MessageHeaders.GetReaderAtHeader%2A> and return an XML reader for the specific header index.</span></span> <span data-ttu-id="73938-276">Se si desidera deserializzare il contenuto dell'intestazione in un oggetto, usare <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> o uno degli altri overload.</span><span class="sxs-lookup"><span data-stu-id="73938-276">If you want to deserialize the header contents into an object, use <xref:System.ServiceModel.Channels.MessageHeaders.GetHeader%60%601%28System.Int32%29> or one of the other overloads.</span></span> <span data-ttu-id="73938-277">Gli overload più elementari deserializzano le intestazioni tramite l'oggetto <xref:System.Runtime.Serialization.DataContractSerializer> configurato in modalità predefinita.</span><span class="sxs-lookup"><span data-stu-id="73938-277">The most basic overloads deserialize headers using the <xref:System.Runtime.Serialization.DataContractSerializer> configured in the default way.</span></span> <span data-ttu-id="73938-278">Se si desidera usare un serializzatore diverso o una differente configurazione della classe `DataContractSerializer`, usare uno degli overload che accettano un `XmlObjectSerializer`.</span><span class="sxs-lookup"><span data-stu-id="73938-278">If you want to use a different serializer or a different configuration of the `DataContractSerializer`, use one of the overloads that take an `XmlObjectSerializer`.</span></span> <span data-ttu-id="73938-279">Esistono anche overload che accettano il nome e lo spazio dei nomi dell'intestazione e, facoltativamente, un elenco di valori `Actor` invece di un indice; si tratta di una combinazione di `FindHeader` e `GetHeader`.</span><span class="sxs-lookup"><span data-stu-id="73938-279">There are also overloads that take the header name, namespace, and optionally a list of `Actor` values instead of an index; this is a combination of `FindHeader` and `GetHeader`.</span></span>  
  
## <a name="working-with-properties"></a><span data-ttu-id="73938-280">Uso di proprietà</span><span class="sxs-lookup"><span data-stu-id="73938-280">Working with Properties</span></span>  
 <span data-ttu-id="73938-281">Un'istanza di `Message` può contenere un numero arbitrario di oggetti denominati di tipi arbitrari.</span><span class="sxs-lookup"><span data-stu-id="73938-281">A `Message` instance can contain an arbitrary number of named objects of arbitrary types.</span></span> <span data-ttu-id="73938-282">Questa raccolta è accessibile tramite la proprietà `Properties` di tipo `MessageProperties`.</span><span class="sxs-lookup"><span data-stu-id="73938-282">This collection is accessed through the `Properties` property of type `MessageProperties`.</span></span> <span data-ttu-id="73938-283">La raccolta implementa l'interfaccia <xref:System.Collections.Generic.IDictionary%602> e agisce da mapping da <xref:System.String> a <xref:System.Object>.</span><span class="sxs-lookup"><span data-stu-id="73938-283">The collection implements the <xref:System.Collections.Generic.IDictionary%602> interface and acts as a mapping from <xref:System.String> to <xref:System.Object>.</span></span> <span data-ttu-id="73938-284">In genere, i valori delle proprietà non vengono mappati direttamente a una parte del messaggio in transito, ma forniscono diversi hint di elaborazione dei messaggi ai vari canali nello stack dei canali WCF o al <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> Framework del servizio.</span><span class="sxs-lookup"><span data-stu-id="73938-284">Normally, property values do not map directly to any part of the message on the wire, but rather provide various message processing hints to the various channels in the WCF channel stack or to the <xref:System.ServiceModel.Channels.MessageHeaders.CopyTo%28System.ServiceModel.Channels.MessageHeaderInfo%5B%5D%2CSystem.Int32%29> service framework.</span></span> <span data-ttu-id="73938-285">Per un esempio, vedere [Cenni preliminari sull'architettura trasferimento dati](data-transfer-architectural-overview.md).</span><span class="sxs-lookup"><span data-stu-id="73938-285">For an example, see [Data Transfer Architectural Overview](data-transfer-architectural-overview.md).</span></span>  
  
## <a name="inheriting-from-the-message-class"></a><span data-ttu-id="73938-286">Eredità dalla classe Message</span><span class="sxs-lookup"><span data-stu-id="73938-286">Inheriting from the Message Class</span></span>  
 <span data-ttu-id="73938-287">Se i tipi di messaggio incorporati creati usando `CreateMessage` non soddisfano i requisiti, creare una classe che deriva dalla classe `Message`.</span><span class="sxs-lookup"><span data-stu-id="73938-287">If the built-in message types created using `CreateMessage` do not meet your requirements, create a class that derives from the `Message` class.</span></span>  
  
### <a name="defining-the-message-body-contents"></a><span data-ttu-id="73938-288">Definizione del contenuto del corpo del messaggio</span><span class="sxs-lookup"><span data-stu-id="73938-288">Defining the Message Body Contents</span></span>  
 <span data-ttu-id="73938-289">Esistono tre tecniche principali per accedere ai dati all'interno del corpo di un messaggio: scrittura, lettura e copia in un buffer.</span><span class="sxs-lookup"><span data-stu-id="73938-289">Three primary techniques exist for accessing data within a message body: writing, reading, and copying it to a buffer.</span></span> <span data-ttu-id="73938-290">Queste operazioni implicano, in ultima istanza, la chiamata dei metodi <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A> e <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A>, rispettivamente, nella classe derivata di `Message`.</span><span class="sxs-lookup"><span data-stu-id="73938-290">These operations ultimately result in the <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents%2A>, and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods being called, respectively, on your derived class of `Message`.</span></span> <span data-ttu-id="73938-291">La classe di base `Message` garantisce che venga chiamato uno solo di questi metodi, una sola volta, per ogni istanza di `Message` .</span><span class="sxs-lookup"><span data-stu-id="73938-291">The base `Message` class guarantees that only one of these methods is called for each `Message` instance, and that it is not called more than once.</span></span> <span data-ttu-id="73938-292">La classe di base assicura inoltre che i metodi non vengano chiamati su un messaggio chiuso.</span><span class="sxs-lookup"><span data-stu-id="73938-292">The base class also ensures that the methods are not called on a closed message.</span></span> <span data-ttu-id="73938-293">Non c'è alcuna necessità di tenere traccia dello stato del messaggio nell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="73938-293">There is no need to track the message state in your implementation.</span></span>  
  
 <span data-ttu-id="73938-294"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> è un metodo astratto e deve essere implementato.</span><span class="sxs-lookup"><span data-stu-id="73938-294"><xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> is an abstract method and must be implemented.</span></span> <span data-ttu-id="73938-295">L'uso di questo metodo è il modo più elementare per definire il contenuto del corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="73938-295">The most basic way to define the body contents of your message is to write using this method.</span></span> <span data-ttu-id="73938-296">Il messaggio seguente contiene, ad esempio, 100.000 numeri casuali da 1 a 20.</span><span class="sxs-lookup"><span data-stu-id="73938-296">For example, the following message contains 100,000 random numbers from 1 to 20.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#9)]
 [!code-vb[C_UsingTheMessageClass#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#9)]  
  
 <span data-ttu-id="73938-297">Per i metodi <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> e <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> sono disponibili implementazioni predefinite che funzionano nella maggior parte dei casi.</span><span class="sxs-lookup"><span data-stu-id="73938-297">The <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> and <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> methods have default implementations that work for most cases.</span></span> <span data-ttu-id="73938-298">Le implementazioni predefinite chiamano <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, memorizzano i risultati nel buffer e usano il buffer prodotto.</span><span class="sxs-lookup"><span data-stu-id="73938-298">The default implementations call <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A>, buffer the results, and work with the resulting buffer.</span></span> <span data-ttu-id="73938-299">Tuttavia, in alcuni casi, questo potrebbe non essere sufficiente.</span><span class="sxs-lookup"><span data-stu-id="73938-299">However, in some cases this may not be enough.</span></span> <span data-ttu-id="73938-300">Nell'esempio precedente, la lettura del messaggio comporta la memorizzazione nel buffer di 100.000 elementi XML, operazione che potrebbe non essere desiderabile.</span><span class="sxs-lookup"><span data-stu-id="73938-300">In the preceding example, reading the message results in 100,000 XML elements being buffered, which might not be desirable.</span></span> <span data-ttu-id="73938-301">Potrebbe essere necessario eseguire l'override di <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> per restituire una classe derivata <xref:System.Xml.XmlDictionaryReader> personalizzata che fornisca numeri casuali.</span><span class="sxs-lookup"><span data-stu-id="73938-301">You might want to override <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> to return a custom <xref:System.Xml.XmlDictionaryReader> derived class that serves up random numbers.</span></span> <span data-ttu-id="73938-302">È quindi possibile eseguire l'override <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> di per usare il lettore <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> restituito dal metodo, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="73938-302">You can then override <xref:System.ServiceModel.Channels.Message.OnWriteBodyContents%2A> to use the reader that the <xref:System.ServiceModel.Channels.Message.OnGetReaderAtBodyContents> method returns, as shown in the following example.</span></span>  
  
 [!code-csharp[C_UsingTheMessageClass#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_usingthemessageclass/cs/source.cs#10)]
 [!code-vb[C_UsingTheMessageClass#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_usingthemessageclass/vb/source.vb#10)]  
  
 <span data-ttu-id="73938-303">Allo stesso modo, potrebbe essere necessario eseguire l'override di `OnCreateBufferedCopy` per restituire la classe derivata `MessageBuffer` personalizzata.</span><span class="sxs-lookup"><span data-stu-id="73938-303">Similarly, you might want to override `OnCreateBufferedCopy` to return your own `MessageBuffer` derived class.</span></span>  
  
 <span data-ttu-id="73938-304">Oltre a fornire il contenuto del corpo del messaggio, la classe derivata del messaggio deve anche eseguire l'override delle proprietà `Version`, `Headers` e `Properties`.</span><span class="sxs-lookup"><span data-stu-id="73938-304">In addition to providing message body contents, your message derived class must also override the `Version`, `Headers`, and `Properties` properties.</span></span>  
  
 <span data-ttu-id="73938-305">Si noti che se si crea una copia di un messaggio, la copia usa le intestazioni del messaggio dell'originale.</span><span class="sxs-lookup"><span data-stu-id="73938-305">Note that if you create a copy of a message, the copy uses the message headers from the original.</span></span>  
  
### <a name="other-members-that-can-be-overridden"></a><span data-ttu-id="73938-306">Altri membri di cui è possibile eseguire l'override</span><span class="sxs-lookup"><span data-stu-id="73938-306">Other Members that Can Be Overridden</span></span>  
 <span data-ttu-id="73938-307">È possibile eseguire l'override dei <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A> <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> metodi, e <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> per specificare come vengono scritti la busta SOAP, le intestazioni SOAP e i tag di inizio dell'elemento del corpo SOAP. Normalmente corrispondono a `<soap:Envelope>` , `<soap:Header>` e `<soap:Body>` .</span><span class="sxs-lookup"><span data-stu-id="73938-307">You can override the <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.Message.OnWriteStartBody%2A> methods to specify how the SOAP envelope, SOAP headers, and SOAP body element start tags are written out. These normally correspond to `<soap:Envelope>`, `<soap:Header>`, and `<soap:Body>`.</span></span> <span data-ttu-id="73938-308">In genere, questi metodi non scrivono alcun elemento se la proprietà <xref:System.ServiceModel.Channels.Message.Version> restituisce <xref:System.ServiceModel.Channels.MessageVersion.None>.</span><span class="sxs-lookup"><span data-stu-id="73938-308">These methods should normally not write anything out if the <xref:System.ServiceModel.Channels.Message.Version> property returns <xref:System.ServiceModel.Channels.MessageVersion.None>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="73938-309">L'implementazione predefinita di `OnGetReaderAtBodyContents` chiama `OnWriteStartEnvelope` e `OnWriteStartBody` prima di chiamare `OnWriteBodyContents` e memorizzare i risultati nel buffer.</span><span class="sxs-lookup"><span data-stu-id="73938-309">The default implementation of `OnGetReaderAtBodyContents` calls `OnWriteStartEnvelope` and `OnWriteStartBody` before calling `OnWriteBodyContents` and buffering the results.</span></span> <span data-ttu-id="73938-310">Le intestazioni non vengono scritte.</span><span class="sxs-lookup"><span data-stu-id="73938-310">Headers are not written out.</span></span>  
  
 <span data-ttu-id="73938-311">Eseguire l'override del metodo <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> per modificare il modo in cui viene costruito l'intero messaggio dai diversi pezzi.</span><span class="sxs-lookup"><span data-stu-id="73938-311">Override the <xref:System.ServiceModel.Channels.Message.OnWriteMessage%2A> method to change the way the entire message is constructed from its various pieces.</span></span> <span data-ttu-id="73938-312">Il metodo `OnWriteMessage` viene chiamato da <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> e dall'implementazione di <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> predefinita.</span><span class="sxs-lookup"><span data-stu-id="73938-312">The `OnWriteMessage` method is called from <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> and from the default <xref:System.ServiceModel.Channels.Message.OnCreateBufferedCopy%2A> implementation.</span></span> <span data-ttu-id="73938-313">Si noti che l'esecuzione dell'ovverride di <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> non è una procedura consigliata.</span><span class="sxs-lookup"><span data-stu-id="73938-313">Note that overriding <xref:System.ServiceModel.Channels.Message.WriteMessage%2A> is not a best practice.</span></span> <span data-ttu-id="73938-314">È preferibile eseguire l'override dei metodi `On` appropriati, ad esempio, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A> e <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-314">It is better to override the appropriate `On` methods (for example, <xref:System.ServiceModel.Channels.Message.OnWriteStartEnvelope%2A>, <xref:System.ServiceModel.Channels.Message.OnWriteStartHeaders%2A>, and <xref:System.ServiceModel.Channels.BodyWriter.OnWriteBodyContents%2A>.</span></span>  
  
 <span data-ttu-id="73938-315">Eseguire l'override di <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> per ignorare come viene rappresentato il corpo del messaggio durante il debug.</span><span class="sxs-lookup"><span data-stu-id="73938-315">Override <xref:System.ServiceModel.Channels.Message.OnBodyToString%2A> to override how your message body is represented during debugging.</span></span> <span data-ttu-id="73938-316">L'impostazione predefinita consiste nel rappresentarlo come tre punti ("...").</span><span class="sxs-lookup"><span data-stu-id="73938-316">The default is to represent it as three dots ("…").</span></span> <span data-ttu-id="73938-317">Si noti che questo metodo può essere chiamato più volte, quando lo stato del messaggio è diverso da Chiuso.</span><span class="sxs-lookup"><span data-stu-id="73938-317">Note that this method can be called multiple times when the message state is anything other than Closed.</span></span> <span data-ttu-id="73938-318">Un'implementazione di questo metodo non dovrebbe mai provocare un'azione che deve essere eseguita una sola volta, ad esempio la lettura da un flusso forward-only.</span><span class="sxs-lookup"><span data-stu-id="73938-318">An implementation of this method should never cause any action that must be performed only once (such as reading from a forward-only stream).</span></span>  
  
 <span data-ttu-id="73938-319">Eseguire l'override del metodo <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> per consentire l'accesso agli attributi sull'elemento corpo SOAP.</span><span class="sxs-lookup"><span data-stu-id="73938-319">Override the <xref:System.ServiceModel.Channels.Message.OnGetBodyAttribute%2A> method to allow access to attributes on the SOAP body element.</span></span> <span data-ttu-id="73938-320">Questo metodo può essere chiamato il numero di volte desiderato, ma il tipo `Message` di base garantisce che venga chiamato solo quando il messaggio si trova nello stato Creato.</span><span class="sxs-lookup"><span data-stu-id="73938-320">This method can be called any number of times, but the `Message` base type guarantees that it is only called when the message is in the Created state.</span></span> <span data-ttu-id="73938-321">Non è necessario per controllare lo stato in un'implementazione.</span><span class="sxs-lookup"><span data-stu-id="73938-321">It is not required to check the state in an implementation.</span></span> <span data-ttu-id="73938-322">L'implementazione predefinita restituisce sempre `null`, per indicare che non sono presenti attributi sull'elemento corpo.</span><span class="sxs-lookup"><span data-stu-id="73938-322">The default implementation always returns `null`, which indicates that there are no attributes on the body element.</span></span>  
  
 <span data-ttu-id="73938-323">Se l'oggetto `Message` deve eseguire particolari operazioni di pulitura quando il corpo del messaggio non è più necessario, è possibile eseguire l'override di <xref:System.ServiceModel.Channels.Message.OnClose%2A>.</span><span class="sxs-lookup"><span data-stu-id="73938-323">If your `Message` object must do any special cleanup when the message body is no longer required, you can override <xref:System.ServiceModel.Channels.Message.OnClose%2A>.</span></span> <span data-ttu-id="73938-324">L'implementazione predefinita non esegue alcuna operazione.</span><span class="sxs-lookup"><span data-stu-id="73938-324">The default implementation does nothing.</span></span>  
  
 <span data-ttu-id="73938-325">Le proprietà `IsEmpty` e `IsFault` possono essere sottoposte a override.</span><span class="sxs-lookup"><span data-stu-id="73938-325">The `IsEmpty` and `IsFault` properties can be overridden.</span></span> <span data-ttu-id="73938-326">Per impostazione predefinita, entrambe restituiscono `false`.</span><span class="sxs-lookup"><span data-stu-id="73938-326">By default, both return `false`.</span></span>
