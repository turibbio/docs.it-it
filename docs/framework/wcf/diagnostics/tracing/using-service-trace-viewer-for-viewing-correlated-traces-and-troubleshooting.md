---
title: Uso di Service Trace Viewer per la visualizzazione di tracce correlate e risoluzione dei problemi
ms.date: 03/30/2017
ms.assetid: 05d2321c-8acb-49d7-a6cd-8ef2220c6775
ms.openlocfilehash: e1cd1443e96e7195127cb95e7ef1b2c4d6d9c176
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84587755"
---
# <a name="using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting"></a><span data-ttu-id="420be-102">Uso di Service Trace Viewer per la visualizzazione di tracce correlate e risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="420be-102">Using Service Trace Viewer for Viewing Correlated Traces and Troubleshooting</span></span>

<span data-ttu-id="420be-103">In questo argomento viene illustrato il formato dei dati di traccia, come visualizzarlo e gli approcci che utilizzano Service Trace Viewer per risolvere i problemi dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="420be-103">This topic describes the format of trace data, how to view it, and approaches that use the Service Trace Viewer to troubleshoot your application.</span></span>

## <a name="using-the-service-trace-viewer-tool"></a><span data-ttu-id="420be-104">Uso dello strumento Visualizzatore di tracce dei servizi</span><span class="sxs-lookup"><span data-stu-id="420be-104">Using the Service Trace Viewer Tool</span></span>

<span data-ttu-id="420be-105">Lo strumento Visualizzatore di tracce dei servizi Windows Communication Foundation (WCF) consente di correlare le tracce diagnostiche generate dai listener WCF per individuare la causa radice di un errore.</span><span class="sxs-lookup"><span data-stu-id="420be-105">The Windows Communication Foundation (WCF) Service Trace Viewer tool helps you correlate diagnostic traces produced by WCF listeners to locate the root cause of an error.</span></span> <span data-ttu-id="420be-106">Lo strumento consente di visualizzare, raggruppare e filtrare facilmente le tracce in modo da poter diagnosticare, ripristinare e verificare i problemi relativi ai servizi WCF.</span><span class="sxs-lookup"><span data-stu-id="420be-106">The tool gives you a way to easily view, group, and filter traces so that you can diagnose, repair and verify issues with WCF services.</span></span> <span data-ttu-id="420be-107">Per ulteriori informazioni sull'utilizzo di questo strumento, vedere [strumento Visualizzatore di tracce dei servizi (SvcTraceViewer. exe)](../../service-trace-viewer-tool-svctraceviewer-exe.md).</span><span class="sxs-lookup"><span data-stu-id="420be-107">For more information about using this tool, see [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../service-trace-viewer-tool-svctraceviewer-exe.md).</span></span>

<span data-ttu-id="420be-108">In questo argomento sono contenute schermate delle tracce generate eseguendo l'esempio di [traccia e registrazione dei messaggi](../../samples/tracing-and-message-logging.md) , quando vengono visualizzate tramite lo [strumento Visualizzatore di tracce dei servizi (SvcTraceViewer. exe)](../../service-trace-viewer-tool-svctraceviewer-exe.md).</span><span class="sxs-lookup"><span data-stu-id="420be-108">This topic contains screenshots of traces generated by running the [Tracing and Message Logging](../../samples/tracing-and-message-logging.md) sample, when viewed using the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../service-trace-viewer-tool-svctraceviewer-exe.md).</span></span> <span data-ttu-id="420be-109">In questo argomento viene dimostrato come capire il contenuto della traccia, le attività e la loro correlazione e come analizzare moltissime tracce in caso di risoluzione dei problemi.</span><span class="sxs-lookup"><span data-stu-id="420be-109">This topic demonstrates how to understand trace content, activities and their correlation, and how to analyze large numbers of traces when troubleshooting.</span></span>

## <a name="viewing-trace-content"></a><span data-ttu-id="420be-110">Visualizzazione del contenuto di una traccia</span><span class="sxs-lookup"><span data-stu-id="420be-110">Viewing Trace Content</span></span>

<span data-ttu-id="420be-111">Un evento traccia contiene le seguenti informazioni più significative:</span><span class="sxs-lookup"><span data-stu-id="420be-111">A trace event contains the following most significant information:</span></span>

- <span data-ttu-id="420be-112">Nome dell'attività quando impostato.</span><span class="sxs-lookup"><span data-stu-id="420be-112">Activity name when set.</span></span>

- <span data-ttu-id="420be-113">Ora di emissione.</span><span class="sxs-lookup"><span data-stu-id="420be-113">Emission time.</span></span>

- <span data-ttu-id="420be-114">Livello di traccia.</span><span class="sxs-lookup"><span data-stu-id="420be-114">Trace level.</span></span>

- <span data-ttu-id="420be-115">Nome di origine della traccia.</span><span class="sxs-lookup"><span data-stu-id="420be-115">Trace source name.</span></span>

- <span data-ttu-id="420be-116">Nome processo.</span><span class="sxs-lookup"><span data-stu-id="420be-116">Process name.</span></span>

- <span data-ttu-id="420be-117">ID thread.</span><span class="sxs-lookup"><span data-stu-id="420be-117">Thread id.</span></span>

- <span data-ttu-id="420be-118">Identificatore di traccia univoco, ovvero un URL che punta a una destinazione in Microsoft Docs, da cui è possibile ottenere ulteriori informazioni correlate alla traccia.</span><span class="sxs-lookup"><span data-stu-id="420be-118">A unique trace identifier, which is a URL that points to a destination in Microsoft Docs, from which you can obtain more information related to the trace.</span></span>

 <span data-ttu-id="420be-119">Tutti questi elementi possono essere visualizzati nel riquadro superiore destro del Visualizzatore di tracce dei servizi o nella sezione **informazioni di base** della visualizzazione formattata del riquadro inferiore destro quando si seleziona una traccia.</span><span class="sxs-lookup"><span data-stu-id="420be-119">All of these can be seen in the upper right panel in the Service Trace Viewer, or in the **Basic Information** section in the formatted view of the lower-right panel when selecting a trace.</span></span>

> [!NOTE]
> <span data-ttu-id="420be-120">Se il client e il servizio si trovano nello stesso computer, saranno presenti le tracce per entrambe le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="420be-120">If the client and the service are on the same machine, the traces for both applications will be present.</span></span> <span data-ttu-id="420be-121">Questi possono essere filtrati usando la colonna **nome processo** .</span><span class="sxs-lookup"><span data-stu-id="420be-121">These can be filtered using the **Process Name** column.</span></span>

<span data-ttu-id="420be-122">La visualizzazione formattata fornisce inoltre anche una descrizione per la traccia e ulteriori informazioni dettagliate quando disponibili.</span><span class="sxs-lookup"><span data-stu-id="420be-122">In addition, the formatted view also provides a description for the trace and additional detailed information when available.</span></span> <span data-ttu-id="420be-123">Le informazioni possono includere il tipo di eccezione e il messaggio, gli stack di chiamate, l'azione del messaggio, i campi da/a e altre informazioni sull'eccezione.</span><span class="sxs-lookup"><span data-stu-id="420be-123">The latter can include exception type and message, call stacks, message action, from/to fields, and other exception information.</span></span>

<span data-ttu-id="420be-124">Nella visualizzazione XML, i tag xml utili includono gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="420be-124">In the XML view, useful xml tags include the following:</span></span>

- <span data-ttu-id="420be-125">`<SubType>`(livello di traccia).</span><span class="sxs-lookup"><span data-stu-id="420be-125">`<SubType>` (trace level).</span></span>

- <span data-ttu-id="420be-126">`<TimeCreated>`.</span><span class="sxs-lookup"><span data-stu-id="420be-126">`<TimeCreated>`.</span></span>

- <span data-ttu-id="420be-127">`<Source>`(nome dell'origine di traccia).</span><span class="sxs-lookup"><span data-stu-id="420be-127">`<Source>` (trace source name).</span></span>

- <span data-ttu-id="420be-128">`<Correlation>`(ID attività impostato quando si emette la traccia).</span><span class="sxs-lookup"><span data-stu-id="420be-128">`<Correlation>` (activity id set when emitting the trace).</span></span>

- <span data-ttu-id="420be-129">`<Execution>`(processo e ID thread).</span><span class="sxs-lookup"><span data-stu-id="420be-129">`<Execution>` (process and thread id).</span></span>

- <span data-ttu-id="420be-130">`<Computer>`.</span><span class="sxs-lookup"><span data-stu-id="420be-130">`<Computer>`.</span></span>

- <span data-ttu-id="420be-131">`<ExtendedData>`, tra `<Action>` cui `<MessageID>` e il `<ActivityId>` set nell'intestazione del messaggio quando si invia un messaggio.</span><span class="sxs-lookup"><span data-stu-id="420be-131">`<ExtendedData>`, including `<Action>`, `<MessageID>` and the `<ActivityId>` set in the message header when sending a message.</span></span>

<span data-ttu-id="420be-132">Se si esamina la traccia "Messaggio inviato tramite canale", è possibile vedere il contenuto seguente.</span><span class="sxs-lookup"><span data-stu-id="420be-132">If you examine the "Sent a message over a channel" trace, you may see the following content.</span></span>

```xml
<E2ETraceEvent xmlns="http://schemas.microsoft.com/2004/06/E2ETraceEvent">
   <System xmlns="http://schemas.microsoft.com/2004/06/windows/eventlog/system">
      <EventID>262163</EventID>
      <Type>3</Type>
      <SubType Name="Information">0</SubType>
      <Level>8</Level>
      <TimeCreated SystemTime="2006-08-04T18:45:30.8491051Z" />
      <Source Name="System.ServiceModel" />
       <Correlation ActivityID="{27c6331d-8998-43aa-a382-03239013a6bd}"/>
       <Execution ProcessName="client" ProcessID="1808" ThreadID="1" />
       <Channel />
       <Computer>TEST1</Computer>
   </System>
   <ApplicationData>
       <TraceData>
          <DataItem>
             <TraceRecord xmlns="http://schemas.microsoft.com/2004/10/E2ETraceEvent/TraceRecord" Severity="Information">
                 <TraceIdentifier>http://msdn.microsoft.com/library/System.ServiceModel.Channels.MessageSent.aspx</TraceIdentifier>
                 <Description>Sent a message over a channel.</Description>
                 <AppDomain>client.exe</AppDomain>
                 <Source>System.ServiceModel.Channels.ClientFramingDuplexSessionChannel/35191196</Source>
                <ExtendedData xmlns="http://schemas.microsoft.com/2006/08/ServiceModel/MessageTransmitTraceRecord">

                  <MessageProperties>
                     <AllowOutputBatching>False</AllowOutputBatching>
                  </MessageProperties>
                  <MessageHeaders>
                     <Action d4p1:mustUnderstand="1" xmlns:d4p1="http://www.w3.org/2003/05/soap-envelope" xmlns="http://www.w3.org/2005/08/addressing">http://Microsoft.ServiceModel.Samples/ICalculator/Multiply</Action>
                     <MessageID xmlns="http://www.w3.org/2005/08/addressing">urn:uuid:7c6670d8-4c9c-496e-b6a0-2ceb6db35338</MessageID>
                     <ActivityId CorrelationId="b02e2189-0816-4387-980c-dd8e306440f5" xmlns="http://schemas.microsoft.com/2004/09/ServiceModel/Diagnostics">27c6331d-8998-43aa-a382-03239013a6bd</ActivityId>
                     <ReplyTo xmlns="http://www.w3.org/2005/08/addressing">
                        <Address>http://www.w3.org/2005/08/addressing/anonymous</Address>
                    </ReplyTo>
                    <To d4p1:mustUnderstand="1" xmlns:d4p1="http://www.w3.org/2003/05/soap-envelope" xmlns="http://www.w3.org/2005/08/addressing">net.tcp://localhost/servicemodelsamples/service</To>
                  </MessageHeaders>
                  <RemoteAddress>net.tcp://localhost/servicemodelsamples/service</RemoteAddress>
                </ExtendedData>
            </TraceRecord>
          </DataItem>
       </TraceData>
   </ApplicationData>
</E2ETraceEvent>
```

## <a name="servicemodel-e2e-tracing"></a><span data-ttu-id="420be-133">Traccia E2E ServiceModel</span><span class="sxs-lookup"><span data-stu-id="420be-133">ServiceModel E2E Tracing</span></span>

<span data-ttu-id="420be-134">Quando l' `System.ServiceModel` origine di traccia è impostata su un valore `switchValue` diverso da off e `ActivityTracing` , WCF crea attività e trasferimenti per l'elaborazione WCF.</span><span class="sxs-lookup"><span data-stu-id="420be-134">When the `System.ServiceModel` trace source is set with a `switchValue` other than Off, and `ActivityTracing`, WCF creates activities and transfers for WCF processing.</span></span>

<span data-ttu-id="420be-135">Un'attività è un'unità logica di elaborazione che raggruppa tutte le tracce relative a quell'unità di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="420be-135">An activity is a logical unit of processing that groups all traces related to that processing unit.</span></span> <span data-ttu-id="420be-136">È possibile definire, ad esempio, un'attività per ogni richiesta.</span><span class="sxs-lookup"><span data-stu-id="420be-136">For example, you can define one activity for each request.</span></span> <span data-ttu-id="420be-137">I trasferimenti creano una relazione causale tra le attività all'interno di endpoint.</span><span class="sxs-lookup"><span data-stu-id="420be-137">Transfers create a causal relationship between activities within endpoints.</span></span> <span data-ttu-id="420be-138">La propagazione dell'ID attività consente di correlare le attività attraverso gli endpoint.</span><span class="sxs-lookup"><span data-stu-id="420be-138">Propagating the activity ID enables you to relate activities across endpoints.</span></span> <span data-ttu-id="420be-139">Questa operazione può essere eseguita impostando `propagateActivity` = `true` nella configurazione in ogni endpoint.</span><span class="sxs-lookup"><span data-stu-id="420be-139">This can be done by setting `propagateActivity`=`true` in configuration at every endpoint.</span></span> <span data-ttu-id="420be-140">Attività, trasferimenti e propagazione consentono di eseguire la correlazione degli errori.</span><span class="sxs-lookup"><span data-stu-id="420be-140">Activities, transfers, and propagation allow you to perform error correlation.</span></span> <span data-ttu-id="420be-141">In questo modo è possibile individuare più rapidamente la causa radice di un errore.</span><span class="sxs-lookup"><span data-stu-id="420be-141">In this way, you can find the root cause of an error more quickly.</span></span>

<span data-ttu-id="420be-142">Sul client viene creata un'attività WCF per ogni chiamata del modello a oggetti (ad esempio, Open ChannelFactory, Add, divide e così via). Ogni chiamata all'operazione viene elaborata in un'attività "Elaborazione azione".</span><span class="sxs-lookup"><span data-stu-id="420be-142">On the client, one WCF activity is created for each object model call (for example, Open ChannelFactory, Add, Divide, and so on.) Each of the operation calls is processed in a "Process Action" activity.</span></span>

<span data-ttu-id="420be-143">Nello screenshot seguente, estratto dall'esempio di [traccia e registrazione dei messaggi](../../samples/tracing-and-message-logging.md) , nel pannello di sinistra viene visualizzato l'elenco delle attività create nel processo client, ordinate in base all'ora di creazione.</span><span class="sxs-lookup"><span data-stu-id="420be-143">In the following screenshot, extracted from the [Tracing and Message Logging](../../samples/tracing-and-message-logging.md) sample the left panel displays the list of activities created in the client process, sorted by creation time.</span></span> <span data-ttu-id="420be-144">Di seguito è riportato un elenco cronologico delle attività:</span><span class="sxs-lookup"><span data-stu-id="420be-144">The following is a chronological list of activities:</span></span>

- <span data-ttu-id="420be-145">È stata costruita la channel factory (ClientBase).</span><span class="sxs-lookup"><span data-stu-id="420be-145">Constructed the channel factory (ClientBase).</span></span>

- <span data-ttu-id="420be-146">È stata aperta la channel factory.</span><span class="sxs-lookup"><span data-stu-id="420be-146">Opened the channel factory.</span></span>

- <span data-ttu-id="420be-147">È stata elaborata l'azione di addizione.</span><span class="sxs-lookup"><span data-stu-id="420be-147">Processed the Add action.</span></span>

- <span data-ttu-id="420be-148">È stata impostata la sessione di sicurezza (questo si è VERIFICATO alla prima richiesta) e sono stati elaborati tre messaggi di risposta dell'infrastruttura di sicurezza: RST, RSTR, SCT (elaborazione messaggio 1, 2, 3).</span><span class="sxs-lookup"><span data-stu-id="420be-148">Set up the Secure Session (this OCCURRED on the first request) and processed three security infrastructure response messages: RST, RSTR, SCT (Process message 1, 2, 3).</span></span>

- <span data-ttu-id="420be-149">Sono state elaborate le richieste di sottrazione, moltiplicazione e divisione.</span><span class="sxs-lookup"><span data-stu-id="420be-149">Processed the Subtract, Multiply, and Divide requests.</span></span>

- <span data-ttu-id="420be-150">È stata chiusa la channel factory e, così facendo, è stata chiusa la sessione di sicurezza ed è stata elaborata la risposta del messaggio di sicurezza di annullamento.</span><span class="sxs-lookup"><span data-stu-id="420be-150">Closed the channel factory, and doing so closed the Secure session and processed the security message response Cancel.</span></span>

 <span data-ttu-id="420be-151">La visualizzazione dei messaggi dell'infrastruttura di sicurezza è resa possibile da wsHttpBinding.</span><span class="sxs-lookup"><span data-stu-id="420be-151">We see the security infrastructure messages because of the wsHttpBinding.</span></span>

> [!NOTE]
> <span data-ttu-id="420be-152">In WCF vengono mostrati i messaggi di risposta elaborati inizialmente in un'attività separata (messaggio di processo) prima di essere correlati all'attività dell'azione di elaborazione corrispondente che include il messaggio di richiesta, tramite un trasferimento.</span><span class="sxs-lookup"><span data-stu-id="420be-152">In WCF, we show response messages being processed initially in a separate activity (Process message) before we correlate them to the corresponding Process Action activity that includes the request message, through a transfer.</span></span> <span data-ttu-id="420be-153">Ciò vale per i messaggi dell'infrastruttura e le richieste asincrone ed è dovuto al fatto che è necessario ispezionare il messaggio, leggere l'intestazione activityId e identificare l'attività Elaborazione azione esistente con quell'ID per correlarla ad esso.</span><span class="sxs-lookup"><span data-stu-id="420be-153">This happens for infrastructure messages and asynchronous requests and is due to the fact that we must inspect the message, read the activityId header, and identify the existing Process Action activity with that id to correlate to it.</span></span> <span data-ttu-id="420be-154">Per le richieste sincrone, viene bloccata la risposta e pertanto viene riconosciuta a quale Elaborazione azione è correlata la risposta.</span><span class="sxs-lookup"><span data-stu-id="420be-154">For synchronous requests, we are blocking for the response and hence know which Process action the response relates to.</span></span>

<span data-ttu-id="420be-155">Nella figura seguente vengono illustrate le attività del client WCF elencate in base all'ora di creazione (riquadro sinistro) e alle relative attività e tracce annidate (riquadro superiore destro):</span><span class="sxs-lookup"><span data-stu-id="420be-155">The following image shows WCF client activities listed by creation time (left panel) and their nested activities and traces (upper right panel):</span></span>

![Screenshot che mostra le attività del client WCF elencate in base all'ora di creazione.](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/wcf-client-activities-creation-time.gif)

<span data-ttu-id="420be-157">Quando si seleziona un'attività nel riquadro sinistro, le tracce e le attività annidate compaiono nel riquadro in alto a destra.</span><span class="sxs-lookup"><span data-stu-id="420be-157">When we select an activity in the left panel, we can see nested activities and traces on the upper right panel.</span></span> <span data-ttu-id="420be-158">Questa è pertanto una visualizzazione gerarchica ridotta dell'elenco delle attività sulla sinistra, basato sull'attività padre selezionata.</span><span class="sxs-lookup"><span data-stu-id="420be-158">Therefore, this is a reduced hierarchical view of the list of activities on the left, based on the selected parent activity.</span></span> <span data-ttu-id="420be-159">Dato che l'Elaborazione azione di aggiunta è la prima richiesta fatta, questa attività contiene l'attività Impostazione sessione di sicurezza (trasferimento a, trasferimento da) e le tracce per l'elaborazione effettiva dell'azione di aggiunta.</span><span class="sxs-lookup"><span data-stu-id="420be-159">Because the selected Process action Add is the first request made, this activity contains the Set Up Secure Session activity (transfer to, transfer back from), and traces for the actual processing of the Add action.</span></span>

<span data-ttu-id="420be-160">Se si fa doppio clic sull'attività elabora l'operazione Aggiungi nel riquadro a sinistra, è possibile visualizzare una rappresentazione grafica delle attività WCF del client correlate a Aggiungi.</span><span class="sxs-lookup"><span data-stu-id="420be-160">If we double click the Process action Add activity in the left panel, we can see a graphical representation of the client WCF activities related to Add.</span></span> <span data-ttu-id="420be-161">La prima attività sulla sinistra è l'attività radice (0000), che è l'attività predefinita.</span><span class="sxs-lookup"><span data-stu-id="420be-161">The first activity on the left is the root activity (0000), which is the default activity.</span></span> <span data-ttu-id="420be-162">WCF si trasferisce fuori dall'attività di ambiente.</span><span class="sxs-lookup"><span data-stu-id="420be-162">WCF transfers out of the ambient activity.</span></span> <span data-ttu-id="420be-163">Se non è definito, WCF trasferisce da 0000.</span><span class="sxs-lookup"><span data-stu-id="420be-163">If this is not defined, WCF transfers out of 0000.</span></span> <span data-ttu-id="420be-164">Qui, la seconda attività, Add di Elaborazione azione, viene trasferita fuori da 0.</span><span class="sxs-lookup"><span data-stu-id="420be-164">Here, the second activity, Process Action Add, transfers out of 0.</span></span> <span data-ttu-id="420be-165">Quindi si vede l'attività di impostazione della sessione di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="420be-165">Then we see Setup Secure Session.</span></span>

<span data-ttu-id="420be-166">Nella figura seguente viene illustrata una visualizzazione grafico delle attività del client WCF, in particolare l'attività di ambiente (qui 0), l'azione di elaborazione e la configurazione della sessione protetta:</span><span class="sxs-lookup"><span data-stu-id="420be-166">The following image shows a graph view of WCF client activities, specifically Ambient Activity (here 0), Process action, and Set Up Secure Session:</span></span>

![Grafico nel Visualizzatore di tracce che mostra l'attività di ambiente e l'azione di elaborazione.](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/wcf-activities-graph-ambient-process.gif)

<span data-ttu-id="420be-168">Nel riquadro in alto a destra, è possibile vedere tutte le tracce relative all'attività Add di Elaborazione azione.</span><span class="sxs-lookup"><span data-stu-id="420be-168">On the upper right panel, we can see all traces related to the Process Action Add activity.</span></span> <span data-ttu-id="420be-169">In particolare, è stato inviato il messaggio di richiesta ("Messaggio inviato tramite canale") ed è stata ricevuta la risposta ("Ricevuto un messaggio tramite canale") nella stessa attività,</span><span class="sxs-lookup"><span data-stu-id="420be-169">Specifically, we have sent the request message ("Sent a message over a channel") and received the response ("Received a message over a channel") in the same activity.</span></span> <span data-ttu-id="420be-170">come illustrato nel grafico seguente.</span><span class="sxs-lookup"><span data-stu-id="420be-170">This is shown in the following graph.</span></span> <span data-ttu-id="420be-171">Per maggiore chiarezza, nel grafico l'attività Impostazione sessione di sicurezza è compressa.</span><span class="sxs-lookup"><span data-stu-id="420be-171">For clarity, the Set up Secure Session activity is collapsed in the graph.</span></span>

<span data-ttu-id="420be-172">Nell'immagine seguente viene illustrato un elenco di tracce per l'attività elabora azione.</span><span class="sxs-lookup"><span data-stu-id="420be-172">The following image shows a list of traces for the Process Action activity.</span></span> <span data-ttu-id="420be-173">Si invia la richiesta e si riceve la risposta nella stessa attività.</span><span class="sxs-lookup"><span data-stu-id="420be-173">We send the request and receive the response in the same activity.</span></span>

![Screenshot del Visualizzatore di tracce che mostra un elenco di tracce per l'attività elabora azione](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/process-action-traces.gif)

<span data-ttu-id="420be-175">In questo caso, le tracce client vengono caricate solo per maggiore chiarezza, ma le tracce dei servizi (messaggio di richiesta ricevuto e messaggio di risposta inviato) vengono visualizzate nella stessa attività se vengono caricate anche nello strumento ed `propagateActivity` è stato impostato su `true.` questa operazione viene mostrata in un'illustrazione successiva.</span><span class="sxs-lookup"><span data-stu-id="420be-175">Here, we load client traces only for clarity, but service traces (request message received and response message sent) appear in the same activity if they are also loaded in the tool and `propagateActivity` was set to `true.` This is shown in a later illustration.</span></span>

<span data-ttu-id="420be-176">Nel servizio, il modello di attività esegue il mapping ai concetti WCF come segue:</span><span class="sxs-lookup"><span data-stu-id="420be-176">On the service, the activity model maps to the WCF concepts as follows:</span></span>

1. <span data-ttu-id="420be-177">Viene costruito e aperto un ServiceHost (ciò può creare diverse attività correlate all'host, ad esempio, nel caso della protezione).</span><span class="sxs-lookup"><span data-stu-id="420be-177">We construct and open a ServiceHost (this may create several host-related activities, for instance, in the case of security).</span></span>

2. <span data-ttu-id="420be-178">Viene creata un'attività di ascolto per ogni listener in ServiceHost (con trasferimenti dentro e fuori da Apertura ServiceHost).</span><span class="sxs-lookup"><span data-stu-id="420be-178">We create a Listen At activity for each listener in the ServiceHost (with transfers in and out of Open ServiceHost).</span></span>

3. <span data-ttu-id="420be-179">Quando il listener rileva una richiesta di comunicazione avviata dal client, viene trasferita a un'attività "Receive bytes", in cui vengono elaborati tutti i byte inviati dal client.</span><span class="sxs-lookup"><span data-stu-id="420be-179">When the listener detects a communication request initiated by the client, it transfers to a "Receive Bytes" activity, in which all bytes sent from the client are processed.</span></span> <span data-ttu-id="420be-180">In questa attività, è possibile vedere qualsiasi errore di connessione che si sia verificato durante l'interazione tra client e servizio.</span><span class="sxs-lookup"><span data-stu-id="420be-180">In this activity, we can see any connection errors that have happened during the client-service interaction.</span></span>

4. <span data-ttu-id="420be-181">Per ogni set di byte ricevuto che corrisponde a un messaggio, questi byte vengono elaborati in un'attività di "processo messaggio", in cui viene creato l'oggetto messaggio WCF.</span><span class="sxs-lookup"><span data-stu-id="420be-181">For each set of bytes that is received that corresponds to a message, we process these bytes in a "Process Message" activity, where we create the WCF Message object.</span></span> <span data-ttu-id="420be-182">In questa attività vengono visualizzati gli errori correlati a una envelope errata o a un messaggio in formato non valido.</span><span class="sxs-lookup"><span data-stu-id="420be-182">In this activity, we see errors related to a bad envelope or a malformed message.</span></span>

5. <span data-ttu-id="420be-183">Quando il messaggio è formato, viene trasferito a un'attività Elaborazione azione.</span><span class="sxs-lookup"><span data-stu-id="420be-183">Once the message is formed, we transfer to a Process Action activity.</span></span> <span data-ttu-id="420be-184">Se `propagateActivity` è impostato su `true` sia nel client che nel servizio, l'ID di questa attività è identico a quello definito nel client e descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="420be-184">If `propagateActivity` is set to `true` on both the client and service, this activity has the same id as the one defined in the client, and described previously.</span></span> <span data-ttu-id="420be-185">Da questa fase si inizia a trarre vantaggio dalla correlazione diretta tra gli endpoint, perché tutte le tracce emesse in WCF correlate alla richiesta si trovano nella stessa attività, inclusa l'elaborazione del messaggio di risposta.</span><span class="sxs-lookup"><span data-stu-id="420be-185">From this stage we start to benefit from direct correlation across endpoints, because all traces emitted in WCF that are related to the request are in that same activity, including the response message processing.</span></span>

6. <span data-ttu-id="420be-186">Per l'azione out-of-process, viene creata un'attività "Esegui codice utente" per isolare le tracce emesse nel codice utente da quelle emesse in WCF.</span><span class="sxs-lookup"><span data-stu-id="420be-186">For out-of-process action, we create an "Execute user code" activity to isolate traces emitted in user code from the ones emitted in WCF.</span></span> <span data-ttu-id="420be-187">Nell'esempio precedente, la traccia "service Send Add Response" viene emessa nell'attività "Execute User Code" non nell'attività propagata dal client, se applicabile.</span><span class="sxs-lookup"><span data-stu-id="420be-187">In the preceding example, the "Service sends Add response" trace is emitted in the "Execute User code" activity not in the activity propagated by the client, if applicable.</span></span>

<span data-ttu-id="420be-188">Nella figura seguente, la prima attività sulla sinistra è l'attività radice (0000), ed è l'attività predefinita.</span><span class="sxs-lookup"><span data-stu-id="420be-188">In the illustration that follows, the first activity on the left is the root activity (0000), which is the default activity.</span></span> <span data-ttu-id="420be-189">Le tre attività seguenti interessano l'apertura di ServiceHost.</span><span class="sxs-lookup"><span data-stu-id="420be-189">The next three activities are to open the ServiceHost.</span></span> <span data-ttu-id="420be-190">L'attività nella colonna 5 è il listener e le attività rimanenti (da 6 a 8) descrivono l'elaborazione WCF di un messaggio, dall'elaborazione dei byte all'attivazione del codice utente.</span><span class="sxs-lookup"><span data-stu-id="420be-190">The activity in column 5 is the listener, and the remaining activities (6 to 8) describe the WCF processing of a message, from bytes processing to user code activation.</span></span>

<span data-ttu-id="420be-191">Nell'immagine seguente viene illustrata una visualizzazione grafico delle attività del servizio WCF:</span><span class="sxs-lookup"><span data-stu-id="420be-191">The following image shows a graph view of WCF service activities:</span></span>

![Screenshot del Visualizzatore di tracce che mostra un elenco di attività del servizio WCF](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/wcf-service-activities.gif)

<span data-ttu-id="420be-193">Nella schermata seguente vengono illustrate le attività sia per il client che per il servizio e viene evidenziata l'attività Add di Elaborazione azione nei processi (arancione).</span><span class="sxs-lookup"><span data-stu-id="420be-193">The following screenshot shows the activities for both the client and service, and highlights the Process Action Add activity across processes (orange).</span></span> <span data-ttu-id="420be-194">Le frecce indicano i messaggi di richiesta e di risposta inviati e ricevuti dal client e dal servizio.</span><span class="sxs-lookup"><span data-stu-id="420be-194">Arrows relate the request and response messages sent and received by the client and service.</span></span> <span data-ttu-id="420be-195">Le tracce di Elaborazione azione sono separate nei processi nel grafico, ma sono riportate come parte della stessa attività nel riquadro in alto a destra.</span><span class="sxs-lookup"><span data-stu-id="420be-195">The traces of Process Action are separated across processes in the graph, but shown as part of the same activity in the upper-right panel.</span></span> <span data-ttu-id="420be-196">In questo riquadro è possibile vedere le tracce del client per i messaggi inviati, seguite dalle tracce del servizio per i messaggi ricevuti ed elaborati.</span><span class="sxs-lookup"><span data-stu-id="420be-196">In this panel, we can see client traces for sent messages followed by service traces for received and processed messages.</span></span>

<span data-ttu-id="420be-197">Nelle immagini seguenti viene illustrata una visualizzazione grafica delle attività del client e del servizio WCF</span><span class="sxs-lookup"><span data-stu-id="420be-197">The following images shows a graph view of both WCF client and service activities</span></span>

![Grafico del Visualizzatore di tracce che mostra le attività del client e del servizio WCF.](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/wcf-client-service-activities.gif)

<span data-ttu-id="420be-199">Nello scenario di errore seguente, le tracce di errore e di avviso nel servizio e nel client sono correlate.</span><span class="sxs-lookup"><span data-stu-id="420be-199">In the following error scenario, error and warning traces at the service and client are related.</span></span> <span data-ttu-id="420be-200">Un'eccezione viene generata prima nel codice utente nel servizio (attività verde più a destra che include una traccia di avviso per l'eccezione relativa all'impossibilità per il servizio di elaborare la richiesta nel codice utente).</span><span class="sxs-lookup"><span data-stu-id="420be-200">An exception is first thrown in user code on the service (right-most green activity that includes a warning trace for the exception "The service cannot process this request in user code.").</span></span> <span data-ttu-id="420be-201">Quando la risposta viene inviata al client, viene emessa di nuovo una traccia di avviso per indicare il messaggio di errore (attività rosa a sinistra).</span><span class="sxs-lookup"><span data-stu-id="420be-201">When the response is sent to the client, a warning trace is again emitted to denote the fault message (left pink activity).</span></span> <span data-ttu-id="420be-202">Il client chiude quindi il proprio client WCF (attività gialla in basso a sinistra), causando l'interruzione della connessione al servizio.</span><span class="sxs-lookup"><span data-stu-id="420be-202">The client then closes its WCF client (yellow activity on the lower-left side), which aborts the connection to the service.</span></span> <span data-ttu-id="420be-203">Il servizio genera un errore (attività rosa più lunga a destra).</span><span class="sxs-lookup"><span data-stu-id="420be-203">The service throws an error (longest pink activity on the right).</span></span>

<span data-ttu-id="420be-204">![Utilizzo del visualizzatore di tracce](media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span><span class="sxs-lookup"><span data-stu-id="420be-204">![Using the Trace Viewer](media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span></span>

<span data-ttu-id="420be-205">Correlazione dell'errore tra il servizio e il client</span><span class="sxs-lookup"><span data-stu-id="420be-205">Error correlation across the service and client</span></span>

<span data-ttu-id="420be-206">L'esempio usato per generare queste tracce è una serie di richieste sincrone tramite wsHttpBinding.</span><span class="sxs-lookup"><span data-stu-id="420be-206">The sample used to generate these traces is a series of synchronous requests using the wsHttpBinding.</span></span> <span data-ttu-id="420be-207">Il grafico si presenta diversamente in caso di scenari senza protezione o con richieste asincrone, in cui l'attività Elaborazione azione include le operazioni di inizio e fine che costituiscono la chiamata asincrona e mostra i trasferimenti a un'attività di callback.</span><span class="sxs-lookup"><span data-stu-id="420be-207">There are deviations from this graph for scenarios without security, or with asynchronous requests, where the Process Action activity encompasses the begin and end operations that constitute the asynchronous call, and shows transfers to a callback activity.</span></span> <span data-ttu-id="420be-208">Per ulteriori informazioni sugli scenari aggiuntivi, vedere [scenari di traccia end-to-end](end-to-end-tracing-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="420be-208">For more information about additional scenarios, see [End-To-End Tracing Scenarios](end-to-end-tracing-scenarios.md).</span></span>

## <a name="troubleshooting-using-the-service-trace-viewer"></a><span data-ttu-id="420be-209">Risoluzione dei problemi tramite Service Trace Viewer</span><span class="sxs-lookup"><span data-stu-id="420be-209">Troubleshooting Using the Service Trace Viewer</span></span>

<span data-ttu-id="420be-210">Quando si caricano file di traccia nello strumento Servize Trace Viewer, è possibile selezionare qualsiasi attività rossa o gialla nel riquadro di sinistra per individuare la causa di un problema nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="420be-210">When you load trace files in the Service Trace Viewer Tool, you can select any red or yellow activity on the left panel to track down the cause of a problem in your application.</span></span> <span data-ttu-id="420be-211">L'attività 000 in genere ha eccezioni non gestite che vengono visualizzate all'utente.</span><span class="sxs-lookup"><span data-stu-id="420be-211">The 000 activity typically has unhandled exceptions that bubble up to the user.</span></span>

<span data-ttu-id="420be-212">Nell'immagine seguente viene illustrato come selezionare un'attività rossa o gialla per individuare la radice di un problema.</span><span class="sxs-lookup"><span data-stu-id="420be-212">The following image shows how to select a red or yellow activity to locate the root of a problem.</span></span>
<span data-ttu-id="420be-213">![Screenshot delle attività rosse o gialle per individuare la radice di un problema.](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/service-trace-viewer.gif)</span><span class="sxs-lookup"><span data-stu-id="420be-213">![Screenshot of red or yellow activities for locating the root of a problem.](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/service-trace-viewer.gif)</span></span>

<span data-ttu-id="420be-214">Nel riquadro in alto a destra, è possibile esaminare le tracce per l'attività selezionata nel riquadro di sinistra.</span><span class="sxs-lookup"><span data-stu-id="420be-214">On the upper right panel, you can examine traces for the activity you selected on the left.</span></span> <span data-ttu-id="420be-215">È quindi possibile esaminare le tracce rosse o gialle in quel riquadro e vedere come sono correlate.</span><span class="sxs-lookup"><span data-stu-id="420be-215">You can then examine red or yellow traces in that panel and see how they are correlated.</span></span> <span data-ttu-id="420be-216">Nel grafico precedente, le tracce di avviso sia per il client che per il servizio sono riportate nella stessa attività Elaborazione azione.</span><span class="sxs-lookup"><span data-stu-id="420be-216">In the preceding graph, we see warning traces both for the client and service in the same Process Action activity.</span></span>

<span data-ttu-id="420be-217">Se queste tracce non forniscono la causa radice dell'errore, è possibile usare il grafico facendo doppio clic sull'attività selezionata nel riquadro di sinistra (qui Elaborazione azione).</span><span class="sxs-lookup"><span data-stu-id="420be-217">If these traces do not provide you with the root cause of the error, you can utilize the graph by double-clicking the selected activity on the left panel (here Process action).</span></span> <span data-ttu-id="420be-218">Viene quindi visualizzato il grafico con attività correlate.</span><span class="sxs-lookup"><span data-stu-id="420be-218">The graph with related activities is then displayed.</span></span> <span data-ttu-id="420be-219">È quindi possibile espandere le attività correlate (facendo clic sui segni "+") per trovare la prima traccia emessa in rosso o giallo in un'attività correlata.</span><span class="sxs-lookup"><span data-stu-id="420be-219">You can then expand related activities (by clicking the "+" signs) to find the first emitted trace in red or yellow in a related activity.</span></span> <span data-ttu-id="420be-220">Continuare a espandere le attività che si verificano subito prima della traccia rossa o gialla di interesse, seguendo i trasferimenti alle attività correlate o il flusso dei messaggi tra gli endpoint, fino a individuare la causa principale del problema.</span><span class="sxs-lookup"><span data-stu-id="420be-220">Keep expanding the activities that happened just before the red or yellow trace of interest, following transfers to related activities or message flows across endpoints, until you track the root cause of the problem.</span></span>

<span data-ttu-id="420be-221">![Utilizzo del visualizzatore di tracce](media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span><span class="sxs-lookup"><span data-stu-id="420be-221">![Using the Trace Viewer](media/wcfc-e2etrace9s.gif "wcfc_e2etrace9s")</span></span>

<span data-ttu-id="420be-222">Espansione delle attività per individuare la causa principale di un problema</span><span class="sxs-lookup"><span data-stu-id="420be-222">Expanding activities to track the root cause of a problem</span></span>

<span data-ttu-id="420be-223">Se `ActivityTracing` di ServiceModel è disattivata, ma la traccia di ServiceModel è attiva, è possibile visualizzare le tracce di ServiceModel emesse nell'attività 0000.</span><span class="sxs-lookup"><span data-stu-id="420be-223">If ServiceModel `ActivityTracing` is off but ServiceModel tracing is on, you can see ServiceModel traces emitted in the 0000 activity.</span></span> <span data-ttu-id="420be-224">In questo caso, tuttavia, è richiesto un maggior impegno per comprendere la correlazione di queste tracce.</span><span class="sxs-lookup"><span data-stu-id="420be-224">However, this requires more effort to understand the correlation of these traces.</span></span>

<span data-ttu-id="420be-225">Se Registrazione messaggi è attivata, è possibile utilizzare la scheda Messaggio per vedere qual è il messaggio su cui influisce l'errore.</span><span class="sxs-lookup"><span data-stu-id="420be-225">If Message Logging is enabled, you can use the Message Tab to see which message is impacted by the error.</span></span> <span data-ttu-id="420be-226">Facendo doppio clic su un messaggio in rosso o in giallo, è possibile visualizzare la rappresentazione grafica delle attività correlate.</span><span class="sxs-lookup"><span data-stu-id="420be-226">By double-clicking a message in red or yellow, you can see the graph view of the related activities.</span></span> <span data-ttu-id="420be-227">Queste attività sono quelle più strettamente legate alla richiesta in cui si è verificato un errore.</span><span class="sxs-lookup"><span data-stu-id="420be-227">These activities are the ones most closely related to the request where an error happened.</span></span>

![Screenshot del Visualizzatore di tracce con la registrazione dei messaggi abilitata.](./media/using-service-trace-viewer-for-viewing-correlated-traces-and-troubleshooting/message-logging-enabled.gif)

<span data-ttu-id="420be-229">Per avviare la risoluzione dei problemi, è anche possibile scegliere una traccia dei messaggi rossa o gialla e fare doppio clic su di essa per rilevare la causa radice.</span><span class="sxs-lookup"><span data-stu-id="420be-229">To start troubleshooting, you can also pick a red or yellow message trace and double click it to track the root cause.</span></span>

## <a name="see-also"></a><span data-ttu-id="420be-230">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="420be-230">See also</span></span>

- [<span data-ttu-id="420be-231">Scenari di analisi end-to-end</span><span class="sxs-lookup"><span data-stu-id="420be-231">End-To-End Tracing Scenarios</span></span>](end-to-end-tracing-scenarios.md)
- [<span data-ttu-id="420be-232">Strumento Visualizzatore di tracce dei servizi (SvcTraceViewer.exe)</span><span class="sxs-lookup"><span data-stu-id="420be-232">Service Trace Viewer Tool (SvcTraceViewer.exe)</span></span>](../../service-trace-viewer-tool-svctraceviewer-exe.md)
- [<span data-ttu-id="420be-233">Traccia</span><span class="sxs-lookup"><span data-stu-id="420be-233">Tracing</span></span>](index.md)
