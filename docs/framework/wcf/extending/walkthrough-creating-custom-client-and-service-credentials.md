---
title: 'Procedura: creare credenziali client e del servizio personalizzate'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 2b5ba5c3-0c6c-48e9-9e46-54acaec443ba
ms.openlocfilehash: ddd9f03e26f7a8345f1070715e4877c533c361fb
ms.sourcegitcommit: 59e36e65ac81cdd094a5a84617625b2a0ff3506e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/27/2020
ms.locfileid: "80345271"
---
# <a name="walkthrough-creating-custom-client-and-service-credentials"></a><span data-ttu-id="805ae-102">Procedura: creare credenziali client e del servizio personalizzate</span><span class="sxs-lookup"><span data-stu-id="805ae-102">Walkthrough: Creating Custom Client and Service Credentials</span></span>

<span data-ttu-id="805ae-103">In questo argomento viene illustrato come implementare credenziali client e del servizio personalizzate e come utilizzare credenziali personalizzate dal codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-103">This topic shows how to implement custom client and service credentials and how to use custom credentials from application code.</span></span>

## <a name="credentials-extensibility-classes"></a><span data-ttu-id="805ae-104">Classi di estensibilità delle credenziali</span><span class="sxs-lookup"><span data-stu-id="805ae-104">Credentials Extensibility Classes</span></span>

<span data-ttu-id="805ae-105">Le <xref:System.ServiceModel.Description.ClientCredentials> <xref:System.ServiceModel.Description.ServiceCredentials> classi e sono i punti di ingresso principali per l'estensibilità della sicurezza di Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="805ae-105">The <xref:System.ServiceModel.Description.ClientCredentials> and <xref:System.ServiceModel.Description.ServiceCredentials> classes are the main entry points to the Windows Communication Foundation (WCF) security extensibility.</span></span> <span data-ttu-id="805ae-106">Queste classi delle credenziali forniscono le API che consentono al codice dell'applicazione di impostare le informazioni sulle credenziali e convertire i tipi di credenziali in token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="805ae-106">These credentials classes provide the APIs that enable application code to set credentials information and to convert credential types into security tokens.</span></span> <span data-ttu-id="805ae-107">I token di*sicurezza* sono il formato utilizzato per trasmettere le informazioni sulle credenziali all'interno di messaggi SOAP. Le responsabilità di queste classi di credenziali possono essere suddivise in due aree:</span><span class="sxs-lookup"><span data-stu-id="805ae-107">(*Security tokens* are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:</span></span>

- <span data-ttu-id="805ae-108">Fornire le API affinché le applicazioni impostino le informazioni sulle credenziali.</span><span class="sxs-lookup"><span data-stu-id="805ae-108">Provide the APIs for applications to set credentials information.</span></span>

- <span data-ttu-id="805ae-109">Fungere da factory per le implementazioni <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="805ae-109">Perform as a factory for <xref:System.IdentityModel.Selectors.SecurityTokenManager> implementations.</span></span>

<span data-ttu-id="805ae-110">Le implementazioni predefinite fornite in WCF supportano i tipi di credenziali fornite dal sistema e creano un gestore di token di sicurezza in grado di gestire tali tipi di credenziali.</span><span class="sxs-lookup"><span data-stu-id="805ae-110">The default implementations provided in WCF support the system-provided credential types and create a security token manager that is capable of handling those credentials types.</span></span>

## <a name="reasons-to-customize"></a><span data-ttu-id="805ae-111">Motivi di personalizzazione</span><span class="sxs-lookup"><span data-stu-id="805ae-111">Reasons to Customize</span></span>

<span data-ttu-id="805ae-112">Esistono più motivi per personalizzare classi di credenziali client o del servizio.</span><span class="sxs-lookup"><span data-stu-id="805ae-112">There are multiple reasons for customizing either client or service credential classes.</span></span> <span data-ttu-id="805ae-113">Principale è il requisito di modificare il comportamento di sicurezza WCF predefinito per quanto riguarda la gestione dei tipi di credenziali fornite dal sistema, in particolare per i motivi seguenti:Foremost is the requirement to change the default WCF security behavior with regard to handling system-provided credential types, especially for the following reasons:</span><span class="sxs-lookup"><span data-stu-id="805ae-113">Foremost is the requirement to change the default WCF security behavior with regard to handling system-provided credential types, especially for the following reasons:</span></span>

- <span data-ttu-id="805ae-114">Necessità di modifiche che non sono possibili utilizzando altri punti di estensibilità.</span><span class="sxs-lookup"><span data-stu-id="805ae-114">Changes that are not possible using other extensibility points.</span></span>

- <span data-ttu-id="805ae-115">Aggiunta di nuovi tipi di credenziali.</span><span class="sxs-lookup"><span data-stu-id="805ae-115">Adding new credential types.</span></span>

- <span data-ttu-id="805ae-116">Aggiunta di nuovi tipi di token di sicurezza personalizzati.</span><span class="sxs-lookup"><span data-stu-id="805ae-116">Adding new custom security token types.</span></span>

<span data-ttu-id="805ae-117">In questo argomento viene illustrato come implementare credenziali client e del servizio personalizzate e come utilizzarle dal codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-117">This topic describes how to implement custom client and service credentials and how to use them from application code.</span></span>

## <a name="first-in-a-series"></a><span data-ttu-id="805ae-118">Primo passaggio</span><span class="sxs-lookup"><span data-stu-id="805ae-118">First in a Series</span></span>

<span data-ttu-id="805ae-119">La creazione di una classe di credenziali personalizzate è solo il primo passaggio, perché il motivo per la personalizzazione delle credenziali consiste nel modificare il comportamento WCF per quanto riguarda il provisioning delle credenziali, la serializzazione del token di sicurezza o l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-119">Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change WCF behavior regarding credentials provisioning, security token serialization, or authentication.</span></span> <span data-ttu-id="805ae-120">Negli altri argomenti di questa sezione viene descritto come creare serializzatori e autenticatori personalizzati.</span><span class="sxs-lookup"><span data-stu-id="805ae-120">Other topics in this section describe how to create custom serializers and authenticators.</span></span> <span data-ttu-id="805ae-121">In questo caso, la creazione di una classe di credenziali personalizzate è il primo tema dei passaggi.</span><span class="sxs-lookup"><span data-stu-id="805ae-121">In this regard, creating custom credential class is the first topic in the series.</span></span> <span data-ttu-id="805ae-122">Le azioni successive (creazione di serializzatori e autenticatori personalizzati) possono essere eseguite solo dopo avere creato credenziali personalizzate.</span><span class="sxs-lookup"><span data-stu-id="805ae-122">Subsequent actions (creating custom serializers and authenticators) can be done only after creating custom credentials.</span></span> <span data-ttu-id="805ae-123">Gli argomenti aggiuntivi basati su questo argomento includono:</span><span class="sxs-lookup"><span data-stu-id="805ae-123">Additional topics that build upon this topic include:</span></span>

- [<span data-ttu-id="805ae-124">Procedura: creare un provider di token di sicurezza personalizzati</span><span class="sxs-lookup"><span data-stu-id="805ae-124">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)

- [<span data-ttu-id="805ae-125">Procedura: Creare un autenticatore del token di sicurezza personalizzato</span><span class="sxs-lookup"><span data-stu-id="805ae-125">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)

- <span data-ttu-id="805ae-126">[Procedura: creare un token personalizzato](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="805ae-126">[How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

## <a name="procedures"></a><span data-ttu-id="805ae-127">Procedure</span><span class="sxs-lookup"><span data-stu-id="805ae-127">Procedures</span></span>

#### <a name="to-implement-custom-client-credentials"></a><span data-ttu-id="805ae-128">Per implementare le credenziali client personalizzate</span><span class="sxs-lookup"><span data-stu-id="805ae-128">To implement custom client credentials</span></span>

1. <span data-ttu-id="805ae-129">Definire una nuova classe derivata dalla classe <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="805ae-129">Define a new class derived from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span>

2. <span data-ttu-id="805ae-130">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-130">Optional.</span></span> <span data-ttu-id="805ae-131">Aggiungere nuovi metodi o proprietà per nuovi tipi di credenziali.</span><span class="sxs-lookup"><span data-stu-id="805ae-131">Add new methods or properties for new credential types.</span></span> <span data-ttu-id="805ae-132">Se non vengono aggiunti nuovi tipi di credenziali, ignorare questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="805ae-132">If you do not add new credential types, skip this step.</span></span> <span data-ttu-id="805ae-133">Nell'esempio seguente viene aggiunta una proprietà `CreditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="805ae-133">The following example adds a `CreditCardNumber` property.</span></span>

3. <span data-ttu-id="805ae-134">Eseguire l'override del metodo <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> .</span><span class="sxs-lookup"><span data-stu-id="805ae-134">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="805ae-135">Questo metodo viene chiamato automaticamente dall'infrastruttura di sicurezza WCF quando viene utilizzata la credenziale client personalizzata.</span><span class="sxs-lookup"><span data-stu-id="805ae-135">This method is automatically called by WCF security infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="805ae-136">Questo metodo è responsabile della creazione e della restituzione di un'istanza di un'implementazione della classe <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="805ae-136">This method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="805ae-137">È importante da notare che l'override del metodo <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> viene eseguito per creare un gestore del token di sicurezza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="805ae-137">It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager.</span></span> <span data-ttu-id="805ae-138">Il gestore del token di sicurezza, derivato da <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> deve restituire un provider del token di sicurezza personalizzato, derivato da <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, per creare il token di sicurezza effettivo.</span><span class="sxs-lookup"><span data-stu-id="805ae-138">The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token.</span></span> <span data-ttu-id="805ae-139">Se non si segue questo modello per creare token di sicurezza, l'applicazione potrebbe funzionare in modo non corretto quando gli oggetti <xref:System.ServiceModel.ChannelFactory> vengono memorizzati nella cache (comportamento predefinito dei proxy client WCF), provocando un potenziale attacco di tipo elevazione dei privilegi.</span><span class="sxs-lookup"><span data-stu-id="805ae-139">If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack.</span></span> <span data-ttu-id="805ae-140">L'oggetto credenziale personalizzata viene memorizzato nella cache come parte dell'oggetto <xref:System.ServiceModel.ChannelFactory>.</span><span class="sxs-lookup"><span data-stu-id="805ae-140">The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>.</span></span> <span data-ttu-id="805ae-141">L'oggetto <xref:System.IdentityModel.Selectors.SecurityTokenManager> personalizzato viene creato tuttavia a ogni chiamata in modo da limitare la minaccia alla sicurezza se la logica di creazione del token è presente nell'oggetto <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="805ae-141">However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span></span>

4. <span data-ttu-id="805ae-142">Eseguire l'override del metodo <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="805ae-142">Override the <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> method.</span></span>

    [!code-csharp[c_CustomCredentials#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)]
    [!code-vb[c_CustomCredentials#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)]

#### <a name="to-implement-a-custom-client-security-token-manager"></a><span data-ttu-id="805ae-143">Per implementare un gestore del token di sicurezza client personalizzato</span><span class="sxs-lookup"><span data-stu-id="805ae-143">To implement a custom client security token manager</span></span>

1. <span data-ttu-id="805ae-144">Definire una nuova classe derivata da <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="805ae-144">Define a new class derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>

2. <span data-ttu-id="805ae-145">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-145">Optional.</span></span> <span data-ttu-id="805ae-146">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> se è necessario creare un'implementazione <xref:System.IdentityModel.Selectors.SecurityTokenProvider> personalizzata.</span><span class="sxs-lookup"><span data-stu-id="805ae-146">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="805ae-147">Per ulteriori informazioni sui provider di token di sicurezza personalizzati, vedere [Procedura: creare un provider](how-to-create-a-custom-security-token-provider.md)di token di sicurezza personalizzato .</span><span class="sxs-lookup"><span data-stu-id="805ae-147">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>

3. <span data-ttu-id="805ae-148">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-148">Optional.</span></span> <span data-ttu-id="805ae-149">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> se è necessario creare un'implementazione <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> personalizzata.</span><span class="sxs-lookup"><span data-stu-id="805ae-149">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="805ae-150">Per ulteriori informazioni sugli autenticatori di token di sicurezza personalizzati, vedere [Procedura: creare un autenticatore](how-to-create-a-custom-security-token-authenticator.md)di token di sicurezza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="805ae-150">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md).</span></span>

4. <span data-ttu-id="805ae-151">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-151">Optional.</span></span> <span data-ttu-id="805ae-152">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> se è necessario creare un oggetto <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> personalizzato.</span><span class="sxs-lookup"><span data-stu-id="805ae-152">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="805ae-153">Per ulteriori informazioni sui token di sicurezza personalizzati e sui serializzatori di token di sicurezza personalizzati, vedere [Procedura: creare un token personalizzato](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="805ae-153">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

    [!code-csharp[c_CustomCredentials#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)]
    [!code-vb[c_CustomCredentials#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)]

#### <a name="to-use-a-custom-client-credentials-from-application-code"></a><span data-ttu-id="805ae-154">Per utilizzare credenziali client personalizzate dal codice dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="805ae-154">To use a custom client credentials from application code</span></span>

1. <span data-ttu-id="805ae-155">Creare un'istanza del client generato che rappresenta l'interfaccia del servizio oppure creare un'istanza di <xref:System.ServiceModel.ChannelFactory> che punta a un servizio con il quale si desidera comunicare.</span><span class="sxs-lookup"><span data-stu-id="805ae-155">Either create an instance of the generated client that represents the service interface, or create an instance of the <xref:System.ServiceModel.ChannelFactory> pointing to a service you want to communicate with.</span></span>

2. <span data-ttu-id="805ae-156">Rimuovere il comportamento delle credenziali client fornite dal sistema dalla raccolta <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>, alla quale è possibile accedere tramite la proprietà <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>.</span><span class="sxs-lookup"><span data-stu-id="805ae-156">Remove the system-provided client credentials behavior from the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>

3. <span data-ttu-id="805ae-157">Creare una nuova istanza di una classe di credenziali client personalizzate e aggiungerla alla raccolta <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>, alla quale è possibile accedere tramite la proprietà <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>.</span><span class="sxs-lookup"><span data-stu-id="805ae-157">Create a new instance of a custom client credentials class and add it to the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>

    [!code-csharp[c_CustomCredentials#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)]
    [!code-vb[c_CustomCredentials#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)]

<span data-ttu-id="805ae-158">Nella procedura precedente viene illustrato come utilizzare credenziali client dal codice dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-158">The previous procedure shows how to use client credentials from application code.</span></span> <span data-ttu-id="805ae-159">Le credenziali WCF possono essere configurate anche usando il file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-159">WCF credentials can also be configured using the application configuration file.</span></span> <span data-ttu-id="805ae-160">Spesso è preferibile utilizzare la configurazione dell'applicazione anziché la specifica a livello di codice, perché consente di modificare i parametri dell'applicazione senza dovere modificare l'origine, ricompilare e ridistribuire.</span><span class="sxs-lookup"><span data-stu-id="805ae-160">Using application configuration is often preferable to hard-coding because it enables modification of application parameters without having to modify the source, recompiling, and redeployment.</span></span>

<span data-ttu-id="805ae-161">Nella prossima procedura viene illustrato come fornire supporto per la configurazione di credenziali personalizzate.</span><span class="sxs-lookup"><span data-stu-id="805ae-161">The next procedure describes how to provide support for configuration of custom credentials.</span></span>

#### <a name="creating-a-configuration-handler-for-custom-client-credentials"></a><span data-ttu-id="805ae-162">Creazione di un gestore di configurazione per credenziali client personalizzate</span><span class="sxs-lookup"><span data-stu-id="805ae-162">Creating a configuration handler for custom client credentials</span></span>

1. <span data-ttu-id="805ae-163">Definire una nuova classe derivata da <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span><span class="sxs-lookup"><span data-stu-id="805ae-163">Define a new class derived from <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span></span>

2. <span data-ttu-id="805ae-164">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-164">Optional.</span></span> <span data-ttu-id="805ae-165">Aggiungere proprietà per tutti i parametri di configurazione aggiuntivi che si desidera esporre tramite la configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-165">Add properties for all additional configuration parameters that you want to expose through application configuration.</span></span> <span data-ttu-id="805ae-166">Nell'esempio seguente viene aggiunta una proprietà denominata `CreditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="805ae-166">The example below adds one property named `CreditCardNumber`.</span></span>

3. <span data-ttu-id="805ae-167">Eseguire l'override della proprietà <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> per restituire il tipo di classe di credenziali client personalizzate creata con l'elemento di configurazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-167">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> property to return the type of the custom client credentials class created with the configuration element.</span></span>

4. <span data-ttu-id="805ae-168">Eseguire l'override del metodo <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> .</span><span class="sxs-lookup"><span data-stu-id="805ae-168">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> method.</span></span> <span data-ttu-id="805ae-169">Il metodo è responsabile della creazione e restituzione di un'istanza della classe di credenziali personalizzati basata sulle impostazioni caricate dal file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-169">The method is responsible for creating and returning an instance of the custom credential class based on the settings loaded from the configuration file.</span></span> <span data-ttu-id="805ae-170">Chiamare il metodo <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> di base da questo metodo per recuperare le impostazioni delle credenziali fornite dal sistema caricate nell'istanza delle credenziali client personalizzate.</span><span class="sxs-lookup"><span data-stu-id="805ae-170">Call the base <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance.</span></span>

5. <span data-ttu-id="805ae-171">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-171">Optional.</span></span> <span data-ttu-id="805ae-172">Se nel passaggio 2 sono state aggiunte altre proprietà, è necessario eseguire l'override della proprietà <xref:System.Configuration.ConfigurationElement.Properties%2A> per registrare le impostazioni di configurazione aggiuntive affinché il framework di configurazione le riconosca.</span><span class="sxs-lookup"><span data-stu-id="805ae-172">If you added additional properties in step 2, you need to override the <xref:System.Configuration.ConfigurationElement.Properties%2A> property in order to register your additional configuration settings for the configuration framework to recognize them.</span></span> <span data-ttu-id="805ae-173">Combinare le proprietà con le proprietà della classe di base per consentire la configurazione delle impostazioni fornite dal sistema tramite questo elemento di configurazione delle credenziali client personalizzate.</span><span class="sxs-lookup"><span data-stu-id="805ae-173">Combine your properties with the base class properties to allow the system-provided settings to be configured through this custom client credentials configuration element.</span></span>

    [!code-csharp[c_CustomCredentials#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)]
    [!code-vb[c_CustomCredentials#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)]

<span data-ttu-id="805ae-174">Una volta che si dispone della classe del gestore di configurazione, può essere integrata nel framework di configurazione WCF.</span><span class="sxs-lookup"><span data-stu-id="805ae-174">Once you have the configuration handler class, it can be integrated into the WCF configuration framework.</span></span> <span data-ttu-id="805ae-175">Ciò consente di utilizzare le credenziali client personalizzate negli elementi di comportamento dell'endpoint client, come illustrato nella procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="805ae-175">That enables the custom client credentials to be used in the client endpoint behavior elements, as shown in the next procedure.</span></span>

#### <a name="to-register-and-use-a-custom-client-credentials-configuration-handler-in-the-application-configuration"></a><span data-ttu-id="805ae-176">Per registrare e utilizzare un gestore di configurazione di credenziali client personalizzate nella configurazione dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="805ae-176">To register and use a custom client credentials configuration handler in the application configuration</span></span>

1. <span data-ttu-id="805ae-177">Aggiungere un `extensions` elemento> `behaviorExtensions` <e un elemento> <al file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-177">Add an <`extensions`> element and a <`behaviorExtensions`> element to the configuration file.</span></span>

2. <span data-ttu-id="805ae-178">Aggiungere un `add` elemento> `behaviorExtensions` <all'elemento `name`> <e impostare l'attributo su un valore appropriato.</span><span class="sxs-lookup"><span data-stu-id="805ae-178">Add an <`add`> element to the <`behaviorExtensions`> element and set the `name` attribute to an appropriate value.</span></span>

3. <span data-ttu-id="805ae-179">Impostare l'attributo `type` sul nome del tipo completo.</span><span class="sxs-lookup"><span data-stu-id="805ae-179">Set the `type` attribute to the fully-qualified type name.</span></span> <span data-ttu-id="805ae-180">Includere inoltre il nome e altri attributi dell'assembly.</span><span class="sxs-lookup"><span data-stu-id="805ae-180">Also include the assembly name and other assembly attributes.</span></span>

    ```xml
    <system.serviceModel>
      <extensions>
        <behaviorExtensions>
          <add name="myClientCredentials" type="Microsoft.ServiceModel.Samples.MyClientCredentialsConfigHandler, CustomCredentials, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
        </behaviorExtensions>
      </extensions>
    </system.serviceModel>
    ```

4. <span data-ttu-id="805ae-181">Dopo aver registrato il gestore di configurazione, l'elemento delle credenziali personalizzate può `clientCredentials` essere utilizzato all'interno dello stesso file di configurazione anziché l'elemento> <fornito dal sistema.</span><span class="sxs-lookup"><span data-stu-id="805ae-181">After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided <`clientCredentials`> element.</span></span> <span data-ttu-id="805ae-182">È possibile utilizzare sia le proprietà fornite dal sistema che qualsiasi nuova proprietà aggiunta all'implementazione del gestore di configurazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-182">You can use both the system-provided properties and any new properties that you have added to your configuration handler implementation.</span></span> <span data-ttu-id="805ae-183">Nell'esempio seguente viene impostato il valore di una proprietà personalizzata utilizzando l'attributo `creditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="805ae-183">The following example sets the value of a custom property using the `creditCardNumber` attribute.</span></span>

    ```xml
    <behaviors>
      <endpointBehaviors>
        <behavior name="myClientCredentialsBehavior">
          <myClientCredentials creditCardNumber="123-123-123"/>
        </behavior>
      </endpointBehaviors>
    </behaviors>
    ```

#### <a name="to-implement-custom-service-credentials"></a><span data-ttu-id="805ae-184">Per implementare credenziali del servizio personalizzate</span><span class="sxs-lookup"><span data-stu-id="805ae-184">To implement custom service credentials</span></span>

1. <span data-ttu-id="805ae-185">Definire una nuova classe derivata da <xref:System.ServiceModel.Description.ServiceCredentials>.</span><span class="sxs-lookup"><span data-stu-id="805ae-185">Define a new class derived from <xref:System.ServiceModel.Description.ServiceCredentials>.</span></span>

2. <span data-ttu-id="805ae-186">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-186">Optional.</span></span> <span data-ttu-id="805ae-187">Aggiungere nuove proprietà per fornire API per i nuovi valori delle credenziali che vengono aggiunte.</span><span class="sxs-lookup"><span data-stu-id="805ae-187">Add new properties to provide APIs for new credential values that are being added.</span></span> <span data-ttu-id="805ae-188">Se non vengono aggiunti nuovi valori delle credenziali, ignorare questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="805ae-188">If you do not add new credential values, skip this step.</span></span> <span data-ttu-id="805ae-189">Nell'esempio seguente viene aggiunta una proprietà `AdditionalCertificate`.</span><span class="sxs-lookup"><span data-stu-id="805ae-189">The following example adds an `AdditionalCertificate` property.</span></span>

3. <span data-ttu-id="805ae-190">Eseguire l'override del metodo <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> .</span><span class="sxs-lookup"><span data-stu-id="805ae-190">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="805ae-191">Questo metodo viene chiamato automaticamente dall'infrastruttura WCF quando viene utilizzata la credenziale client personalizzata.</span><span class="sxs-lookup"><span data-stu-id="805ae-191">This method is automatically called by the WCF infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="805ae-192">Il metodo è responsabile della creazione e della restituzione di un'istanza di un'implementazione della classe <xref:System.IdentityModel.Selectors.SecurityTokenManager>, descritta nella procedura seguente.</span><span class="sxs-lookup"><span data-stu-id="805ae-192">The method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class (described in the next procedure).</span></span>

4. <span data-ttu-id="805ae-193">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-193">Optional.</span></span> <span data-ttu-id="805ae-194">Eseguire l'override del metodo <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="805ae-194">Override the <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> method.</span></span> <span data-ttu-id="805ae-195">È richiesto solo se si aggiungono nuove proprietà o campi interni all'implementazione delle credenziali client personalizzate.</span><span class="sxs-lookup"><span data-stu-id="805ae-195">This is required only if adding new properties or internal fields to the custom client credentials implementation.</span></span>

    [!code-csharp[c_CustomCredentials#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)]
    [!code-vb[c_CustomCredentials#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)]

#### <a name="to-implement-a-custom-service-security-token-manager"></a><span data-ttu-id="805ae-196">Per implementare un gestore del token di sicurezza del servizio personalizzato</span><span class="sxs-lookup"><span data-stu-id="805ae-196">To implement a custom service security token manager</span></span>

1. <span data-ttu-id="805ae-197">Definire una nuova classe derivata dalla classe <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="805ae-197">Define a new class derived from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span>

2. <span data-ttu-id="805ae-198">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-198">Optional.</span></span> <span data-ttu-id="805ae-199">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> se è necessario creare un'implementazione <xref:System.IdentityModel.Selectors.SecurityTokenProvider> personalizzata.</span><span class="sxs-lookup"><span data-stu-id="805ae-199">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="805ae-200">Per ulteriori informazioni sui provider di token di sicurezza personalizzati, vedere [Procedura: creare un provider](how-to-create-a-custom-security-token-provider.md)di token di sicurezza personalizzato .</span><span class="sxs-lookup"><span data-stu-id="805ae-200">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>

3. <span data-ttu-id="805ae-201">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-201">Optional.</span></span> <span data-ttu-id="805ae-202">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> se è necessario creare un'implementazione <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> personalizzata.</span><span class="sxs-lookup"><span data-stu-id="805ae-202">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="805ae-203">Per altre informazioni sugli autenticatori di token di sicurezza personalizzati, vedere [procedura: creare un autenticatore](how-to-create-a-custom-security-token-authenticator.md) di token di sicurezza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="805ae-203">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](how-to-create-a-custom-security-token-authenticator.md) topic.</span></span>

4. <span data-ttu-id="805ae-204">Facoltativa.</span><span class="sxs-lookup"><span data-stu-id="805ae-204">Optional.</span></span> <span data-ttu-id="805ae-205">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> se è necessario creare un oggetto <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> personalizzato.</span><span class="sxs-lookup"><span data-stu-id="805ae-205">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="805ae-206">Per ulteriori informazioni sui token di sicurezza personalizzati e sui serializzatori di token di sicurezza personalizzati, vedere [Procedura: creare un token personalizzato](how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="805ae-206">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>

    [!code-csharp[c_CustomCredentials#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)]
    [!code-vb[c_CustomCredentials#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)]

#### <a name="to-use-custom-service-credentials-from-application-code"></a><span data-ttu-id="805ae-207">Per utilizzare credenziali del servizio personalizzate dal codice dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="805ae-207">To use custom service credentials from application code</span></span>

1. <span data-ttu-id="805ae-208">Creare un'istanza di <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="805ae-208">Create an instance of the <xref:System.ServiceModel.ServiceHost>.</span></span>

2. <span data-ttu-id="805ae-209">Rimuovere il comportamento delle credenziali del servizio fornite dal sistema dalla raccolta <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>.</span><span class="sxs-lookup"><span data-stu-id="805ae-209">Remove the system-provided service credentials behavior from the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>

3. <span data-ttu-id="805ae-210">Creare una nuova istanza della classe di credenziali del servizio personalizzate e aggiungerla alla raccolta <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>.</span><span class="sxs-lookup"><span data-stu-id="805ae-210">Create a new instance of the custom service credentials class and add it to the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>

    [!code-csharp[c_CustomCredentials#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)]
    [!code-vb[c_CustomCredentials#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)]

<span data-ttu-id="805ae-211">Aggiungere il supporto per la configurazione utilizzando`To create a configuration handler for custom client credentials`i`To register and use a custom client credentials configuration handler in the application configuration`passaggi descritti in precedenza nelle procedure " " e " ". L'unica differenza consiste <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> nell'utilizzare <xref:System.ServiceModel.Configuration.ClientCredentialsElement> la classe anziché la classe come classe base per il gestore di configurazione.</span><span class="sxs-lookup"><span data-stu-id="805ae-211">Add support for configuration using the steps described previously in the procedures "`To create a configuration handler for custom client credentials`" and "`To register and use a custom client credentials configuration handler in the application configuration`." The only difference is to use the <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> class instead of the <xref:System.ServiceModel.Configuration.ClientCredentialsElement> class as a base class for the configuration handler.</span></span> <span data-ttu-id="805ae-212">L'elemento credenziale personalizzata del servizio può quindi essere utilizzato ovunque sia utilizzato l'elemento `<serviceCredentials>` fornito dal sistema.</span><span class="sxs-lookup"><span data-stu-id="805ae-212">The custom service credential element can then be used wherever the system-provided `<serviceCredentials>` element is used.</span></span>

## <a name="see-also"></a><span data-ttu-id="805ae-213">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="805ae-213">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.Security.SecurityCredentialsManager>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.ServiceModel.Configuration.ClientCredentialsElement>
- <xref:System.ServiceModel.Configuration.ServiceCredentialsElement>
- [<span data-ttu-id="805ae-214">Procedura: creare un provider di token di sicurezza personalizzati</span><span class="sxs-lookup"><span data-stu-id="805ae-214">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="805ae-215">Procedura: Creare un autenticatore del token di sicurezza personalizzato</span><span class="sxs-lookup"><span data-stu-id="805ae-215">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="805ae-216">Procedura: creare un token personalizzato</span><span class="sxs-lookup"><span data-stu-id="805ae-216">How to: Create a Custom Token</span></span>](how-to-create-a-custom-token.md)
