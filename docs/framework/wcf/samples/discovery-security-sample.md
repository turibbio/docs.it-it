---
title: Esempio di sicurezza di individuazione
ms.date: 03/30/2017
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
ms.openlocfilehash: 94de324469d0d649a184dec5847e1a5c4cbba2cc
ms.sourcegitcommit: 839777281a281684a7e2906dccb3acd7f6a32023
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/24/2020
ms.locfileid: "82141162"
---
# <a name="discovery-security-sample"></a><span data-ttu-id="df833-102">Esempio di sicurezza di individuazione</span><span class="sxs-lookup"><span data-stu-id="df833-102">Discovery Security Sample</span></span>

<span data-ttu-id="df833-103">La specifica Discovery non richiede che gli endpoint che partecipano al processo di individuazione siano sicuri.</span><span class="sxs-lookup"><span data-stu-id="df833-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="df833-104">Il potenziamento dei messaggi di individuazione tramite la sicurezza riduce tuttavia la possibilità di vari tipi di attacchi (modifica del messaggio, Denial of Service, replay, spoofing).</span><span class="sxs-lookup"><span data-stu-id="df833-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="df833-105">In questo esempio vengono implementati canali personalizzati che calcolano e verificano le firme dei messaggi usando il formato di firma compatto (descritto nella Sezione 8.2 della specifica WS-Discovery).</span><span class="sxs-lookup"><span data-stu-id="df833-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="df833-106">L'esempio supporta sia la [specifica di individuazione 2005](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) che la [versione 1,1](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf).</span><span class="sxs-lookup"><span data-stu-id="df833-106">The sample supports both the [2005 Discovery specification](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) and the [1.1 version](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf).</span></span>  
  
 <span data-ttu-id="df833-107">Il canale personalizzato viene applicato sullo stack di canali esistente per gli endpoint di individuazione e degli annunci.</span><span class="sxs-lookup"><span data-stu-id="df833-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="df833-108">In questo modo, per ogni messaggio inviato viene applicata un'intestazione di firma.</span><span class="sxs-lookup"><span data-stu-id="df833-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="df833-109">La firma viene verificata nei messaggi ricevuti e quando non corrisponde oppure quando i messaggi non presentano una firma, i messaggi vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="df833-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="df833-110">Nell'esempio per firmare e verificare i messaggi vengono usati i certificati.</span><span class="sxs-lookup"><span data-stu-id="df833-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="df833-111">Discussione</span><span class="sxs-lookup"><span data-stu-id="df833-111">Discussion</span></span>  
 <span data-ttu-id="df833-112">WCF è molto estensibile e offre agli utenti la possibilità di personalizzare i canali nel modo desiderato.</span><span class="sxs-lookup"><span data-stu-id="df833-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="df833-113">Nell'esempio viene implementato un elemento di associazione protetta dell'individuazione che consente la compilazione di canali sicuri.</span><span class="sxs-lookup"><span data-stu-id="df833-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="df833-114">I canali sicuri verificano le firme dei messaggi e vengono applicati sullo stack corrente.</span><span class="sxs-lookup"><span data-stu-id="df833-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="df833-115">L'elemento di associazione protetta compila le channel factory e i listener di canale sicuri.</span><span class="sxs-lookup"><span data-stu-id="df833-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="df833-116">Channel factory protetta</span><span class="sxs-lookup"><span data-stu-id="df833-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="df833-117">La channel factory protetta crea output o canali duplex che aggiungono una firma compatta alle intestazioni dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="df833-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="df833-118">Per contenere il più possibile le dimensioni dei messaggi, viene usato il formato della firma compatto.</span><span class="sxs-lookup"><span data-stu-id="df833-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="df833-119">La struttura di una firma compatta viene illustrata nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="df833-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >
  [<d:Sig Scheme="xs:anyURI"
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"
          Sig="xs:base64Binary"
          ... />]?  
  ...
</d:Security>  
```  
  
> [!NOTE]
> <span data-ttu-id="df833-120">Alla versione 2008 del protocollo Discovery è stato aggiunto `PrefixList`.</span><span class="sxs-lookup"><span data-stu-id="df833-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="df833-121">Per calcolare la firma, nell'esempio vengono determinati gli elementi della firma espansi.</span><span class="sxs-lookup"><span data-stu-id="df833-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="df833-122">Viene creata una firma XML (`SignedInfo`) usando il prefisso dello spazio dei nomi `ds`, come richiesto dalla specifica WS-Discovery.</span><span class="sxs-lookup"><span data-stu-id="df833-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="df833-123">Al corpo e a tutte le intestazioni presenti negli spazi dei nomi di individuazione e indirizzamento viene fatto riferimento nella firma, impedendone pertanto l'alterazione.</span><span class="sxs-lookup"><span data-stu-id="df833-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="df833-124">Ogni elemento a cui viene fatto riferimento viene trasformato usando la canonizzazione esclusivahttp://www.w3.org/2001/10/xml-exc-c14n# () e quindi viene calcolato un valore digest SHA-1 (http://www.w3.org/2000/09/xmldsig#sha1 ).</span><span class="sxs-lookup"><span data-stu-id="df833-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="df833-125">In base a tutti gli elementi a cui viene fatto riferimento e ai relativi valori di digest, il valore della firmahttp://www.w3.org/2000/09/xmldsig#rsa-sha1 viene calcolato usando l'algoritmo RSA ().</span><span class="sxs-lookup"><span data-stu-id="df833-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="df833-126">I messaggi vengono firmati con un certificato specificato dal client.</span><span class="sxs-lookup"><span data-stu-id="df833-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="df833-127">Il percorso e il nome dell'archivio, nonché il nome del soggetto del certificato devono essere specificati al momento della creazione dell'elemento di associazione.</span><span class="sxs-lookup"><span data-stu-id="df833-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="df833-128">`KeyId` nella firma compressa rappresenta l'identificatore di chiave del token di firma e corrisponde all'identificatore di chiave del soggetto (SKI, Subject Key Identifier) del token di firma oppure (se l'identificatore SKI non esiste) a un hash SHA-1 della chiave pubblica del token di firma.</span><span class="sxs-lookup"><span data-stu-id="df833-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="df833-129">Listener del canale protetto</span><span class="sxs-lookup"><span data-stu-id="df833-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="df833-130">Il listener del canale protetto crea l'input o i canali duplex che verificano la firma compatta nei messaggi ricevuti.</span><span class="sxs-lookup"><span data-stu-id="df833-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="df833-131">Per verificare la firma, l'elemento `KeyId` specificato nella firma compatta allegata al messaggio viene usato per selezionare un certificato nell'archivio specificato.</span><span class="sxs-lookup"><span data-stu-id="df833-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="df833-132">Se il messaggio non presenta una firma o il controllo della firma ha esito negativo, i messaggi vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="df833-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="df833-133">Per usare l'associazione protetta, nell'esempio viene definita una factory che crea gli oggetti <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> e <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> personalizzati a cui è stato aggiunto l'elemento di individuazione dell'associazione protetta.</span><span class="sxs-lookup"><span data-stu-id="df833-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="df833-134">Questi endpoint sicuri possono essere usati nei listener degli annunci di individuazione e nei servizi individuabili.</span><span class="sxs-lookup"><span data-stu-id="df833-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="df833-135">Dettagli dell'esempio</span><span class="sxs-lookup"><span data-stu-id="df833-135">Sample Details</span></span>  
 <span data-ttu-id="df833-136">In questo esempio sono incluse un'applicazione di libreria e 4 applicazioni console:</span><span class="sxs-lookup"><span data-stu-id="df833-136">The sample includes a library and 4 console applications:</span></span>
  
- <span data-ttu-id="df833-137">**DiscoverySecurityChannels**: raccolta che espone l'associazione protetta.</span><span class="sxs-lookup"><span data-stu-id="df833-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="df833-138">La libreria calcola e verifica la firma compatta per i messaggi in uscita/in arrivo.</span><span class="sxs-lookup"><span data-stu-id="df833-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
- <span data-ttu-id="df833-139">**Servizio**: un servizio che espone il contratto ICalculatorService, self hosted.</span><span class="sxs-lookup"><span data-stu-id="df833-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="df833-140">Il servizio è contrassegnato come individuabile.</span><span class="sxs-lookup"><span data-stu-id="df833-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="df833-141">L'utente specifica i dettagli del certificato usato per firmare i messaggi specificando il percorso e il nome dell'archivio e il nome del soggetto o di un altro identificatore univoco per il certificato, nonché l'archivio in cui si trovano i certificati client (i certificati usati per il controllo della firma dei messaggi in arrivo).</span><span class="sxs-lookup"><span data-stu-id="df833-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="df833-142">In base a questi dettagli, viene compilato e usato un oggetto UdpDiscoveryEndpoint con sicurezza aggiunta.</span><span class="sxs-lookup"><span data-stu-id="df833-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
- <span data-ttu-id="df833-143">**Client**: questa classe tenta di individuare un ICalculatorService e di chiamare i metodi nel servizio.</span><span class="sxs-lookup"><span data-stu-id="df833-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="df833-144">Un <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> con sicurezza aggiunta viene di nuovo compilato e usato per firmare e verificare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="df833-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
- <span data-ttu-id="df833-145">**AnnouncementListener**: un servizio indipendente che rimane in ascolto degli annunci online e offline e usa l'endpoint di annuncio protetto.</span><span class="sxs-lookup"><span data-stu-id="df833-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="df833-146">Se Setup.bat viene eseguito più volte, il gestore di certificati richiederà di scegliere un certificato da aggiungere, in quanto esistono certificati duplicati.</span><span class="sxs-lookup"><span data-stu-id="df833-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="df833-147">In tal caso, Setup.bat dovrà essere interrotto e sarà necessario chiamare Cleanup.bat, poiché i duplicati sono già stati creati.</span><span class="sxs-lookup"><span data-stu-id="df833-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="df833-148">Cleanup.bat richiederà inoltre di scegliere un certificato da eliminare.</span><span class="sxs-lookup"><span data-stu-id="df833-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="df833-149">Selezionare un certificato nell'elenco e continuare a eseguire Cleanup.bat fino a quando non rimarrà alcun certificato.</span><span class="sxs-lookup"><span data-stu-id="df833-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="df833-150">Per usare questo esempio</span><span class="sxs-lookup"><span data-stu-id="df833-150">To use this sample</span></span>  
  
1. <span data-ttu-id="df833-151">Eseguire lo script Setup. bat da un Prompt dei comandi per gli sviluppatori per Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="df833-151">Execute the Setup.bat script from a Developer Command Prompt for Visual Studio.</span></span> <span data-ttu-id="df833-152">Nell'esempio vengono usati certificati per firmare e verificare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="df833-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="df833-153">Lo script crea i certificati usando Makecert.exe, quindi li installa usando Certmgr.exe.</span><span class="sxs-lookup"><span data-stu-id="df833-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="df833-154">Lo script deve essere eseguito con i privilegi di amministratore.</span><span class="sxs-lookup"><span data-stu-id="df833-154">The script must be run with administrator privileges.</span></span>  
  
2. <span data-ttu-id="df833-155">Per compilare ed eseguire l'esempio, aprire il file Security. sln in Visual Studio e scegliere **Ricompila tutto**.</span><span class="sxs-lookup"><span data-stu-id="df833-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="df833-156">Aggiornare le proprietà della soluzione per avviare più progetti: selezionare **Avvia** per tutti i progetti ad eccezione di DiscoverySecureChannels.</span><span class="sxs-lookup"><span data-stu-id="df833-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="df833-157">Eseguire la soluzione in modo normale.</span><span class="sxs-lookup"><span data-stu-id="df833-157">Run the solution normally.</span></span>  
  
3. <span data-ttu-id="df833-158">Dopo aver completato l'esempio, eseguire lo script Cleanup.bat per rimuovere i certificati creati per questo esempio.</span><span class="sxs-lookup"><span data-stu-id="df833-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="df833-159">È possibile che gli esempi siano già installati nel computer.</span><span class="sxs-lookup"><span data-stu-id="df833-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="df833-160">Verificare la directory seguente (impostazione predefinita) prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="df833-160">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="df833-161">Se questa directory non esiste, passare a [Windows Communication Foundation (WCF) ed esempi di Windows Workflow Foundation (WF) per .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) per scaricare tutti i Windows Communication Foundation (WCF) [!INCLUDE[wf1](../../../../includes/wf1-md.md)] ed esempi.</span><span class="sxs-lookup"><span data-stu-id="df833-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="df833-162">Questo esempio si trova nella directory seguente.</span><span class="sxs-lookup"><span data-stu-id="df833-162">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
