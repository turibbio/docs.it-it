---
title: 'Procedura dettagliata: Chiamata delle API di Windows'
ms.date: 07/20/2015
helpviewer_keywords:
- DLLs, calling
- Windows API, walkthroughs
- platform invoke, walkthroughs
- API calls [Visual Basic], walkthroughs [Visual Basic]
- Windows API, calling
- walkthroughs [Visual Basic], API calls
- DllImport attribute, calling Windows API
- Declare statement [Visual Basic], declaring DLL functions
ms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb
ms.openlocfilehash: c7b84a3bb12329ae235e5ea03dc5e86f921112c4
ms.sourcegitcommit: f8c270376ed905f6a8896ce0fe25b4f4b38ff498
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/04/2020
ms.locfileid: "84396753"
---
# <a name="walkthrough-calling-windows-apis-visual-basic"></a><span data-ttu-id="d8a62-102">Procedura dettagliata: chiamata delle API di Windows (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="d8a62-102">Walkthrough: Calling Windows APIs (Visual Basic)</span></span>
<span data-ttu-id="d8a62-103">Le API di Windows sono librerie a collegamento dinamico (dll) che fanno parte del sistema operativo Windows.</span><span class="sxs-lookup"><span data-stu-id="d8a62-103">Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.</span></span> <span data-ttu-id="d8a62-104">Vengono usati per eseguire attività quando è difficile scrivere procedure equivalenti personalizzate.</span><span class="sxs-lookup"><span data-stu-id="d8a62-104">You use them to perform tasks when it is difficult to write equivalent procedures of your own.</span></span> <span data-ttu-id="d8a62-105">Windows, ad esempio, fornisce una funzione denominata `FlashWindowEx` che consente di fare in modo che la barra del titolo di un'applicazione venga alternata tra le tonalità chiaro e scuro.</span><span class="sxs-lookup"><span data-stu-id="d8a62-105">For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.</span></span>  
  
 <span data-ttu-id="d8a62-106">Il vantaggio di usare le API di Windows nel codice è che consentono di risparmiare tempo di sviluppo perché contengono dozzine di funzioni utili già scritte e in attesa di essere usate.</span><span class="sxs-lookup"><span data-stu-id="d8a62-106">The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.</span></span> <span data-ttu-id="d8a62-107">Lo svantaggio è che le API di Windows possono essere difficili da utilizzare e non perdonare quando si verificano problemi.</span><span class="sxs-lookup"><span data-stu-id="d8a62-107">The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.</span></span>  
  
 <span data-ttu-id="d8a62-108">Le API di Windows rappresentano una categoria speciale di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="d8a62-108">Windows APIs represent a special category of interoperability.</span></span> <span data-ttu-id="d8a62-109">Le API Windows non utilizzano codice gestito, non dispongono di librerie dei tipi predefinite e utilizzano tipi di dati diversi da quelli utilizzati con Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d8a62-109">Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.</span></span> <span data-ttu-id="d8a62-110">A causa di queste differenze, e poiché le API di Windows non sono oggetti COM, l'interoperabilità con le API Windows e la .NET Framework viene eseguita utilizzando platform invoke o PInvoke.</span><span class="sxs-lookup"><span data-stu-id="d8a62-110">Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the .NET Framework is performed using platform invoke, or PInvoke.</span></span> <span data-ttu-id="d8a62-111">Platform Invoke è un servizio che consente al codice gestito di chiamare funzioni non gestite implementate in dll.</span><span class="sxs-lookup"><span data-stu-id="d8a62-111">Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.</span></span> <span data-ttu-id="d8a62-112">Per ulteriori informazioni, vedere [utilizzo di funzioni dll non gestite](../../../framework/interop/consuming-unmanaged-dll-functions.md).</span><span class="sxs-lookup"><span data-stu-id="d8a62-112">For more information, see [Consuming Unmanaged DLL Functions](../../../framework/interop/consuming-unmanaged-dll-functions.md).</span></span> <span data-ttu-id="d8a62-113">È possibile utilizzare PInvoke in Visual Basic utilizzando l' `Declare` istruzione o applicando l' `DllImport` attributo a una routine vuota.</span><span class="sxs-lookup"><span data-stu-id="d8a62-113">You can use PInvoke in Visual Basic by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.</span></span>  
  
 <span data-ttu-id="d8a62-114">Le chiamate all'API di Windows rappresentano una parte importante della programmazione Visual Basic in passato, ma sono raramente necessarie con Visual Basic .NET.</span><span class="sxs-lookup"><span data-stu-id="d8a62-114">Windows API calls were an important part of Visual Basic programming in the past, but are seldom necessary with Visual Basic .NET.</span></span> <span data-ttu-id="d8a62-115">Quando possibile, è consigliabile usare codice gestito dal .NET Framework per eseguire attività, anziché chiamate API Windows.</span><span class="sxs-lookup"><span data-stu-id="d8a62-115">Whenever possible, you should use managed code from the .NET Framework to perform tasks, instead of Windows API calls.</span></span> <span data-ttu-id="d8a62-116">In questa procedura dettagliata vengono fornite informazioni sulle situazioni in cui è necessario utilizzare le API di Windows.</span><span class="sxs-lookup"><span data-stu-id="d8a62-116">This walkthrough provides information for those situations in which using Windows APIs is necessary.</span></span>  
  
[!INCLUDE[note_settings_general](~/includes/note-settings-general-md.md)]  
  
## <a name="api-calls-using-declare"></a><span data-ttu-id="d8a62-117">Chiamate API con DECLARE</span><span class="sxs-lookup"><span data-stu-id="d8a62-117">API Calls Using Declare</span></span>  
 <span data-ttu-id="d8a62-118">Il modo più comune per chiamare le API Windows consiste nell'utilizzare l' `Declare` istruzione.</span><span class="sxs-lookup"><span data-stu-id="d8a62-118">The most common way to call Windows APIs is by using the `Declare` statement.</span></span>  
  
### <a name="to-declare-a-dll-procedure"></a><span data-ttu-id="d8a62-119">Per dichiarare una procedura DLL</span><span class="sxs-lookup"><span data-stu-id="d8a62-119">To declare a DLL procedure</span></span>  
  
1. <span data-ttu-id="d8a62-120">Determinare il nome della funzione che si desidera chiamare, più gli argomenti, i tipi di argomento e il valore restituito, nonché il nome e il percorso della DLL che lo contiene.</span><span class="sxs-lookup"><span data-stu-id="d8a62-120">Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="d8a62-121">Per informazioni complete sulle API Windows, vedere la documentazione di Win32 SDK nell'API Windows di Platform SDK.</span><span class="sxs-lookup"><span data-stu-id="d8a62-121">For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.</span></span> <span data-ttu-id="d8a62-122">Per ulteriori informazioni sulle costanti utilizzate dalle API di Windows, esaminare i file di intestazione come Windows. h inclusi in Platform SDK.</span><span class="sxs-lookup"><span data-stu-id="d8a62-122">For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.</span></span>  
  
2. <span data-ttu-id="d8a62-123">Aprire un nuovo progetto di applicazione Windows scegliendo **nuovo** dal menu **file** , quindi fare clic su **progetto**.</span><span class="sxs-lookup"><span data-stu-id="d8a62-123">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="d8a62-124">Verrà visualizzata la finestra di dialogo **Nuovo progetto** .</span><span class="sxs-lookup"><span data-stu-id="d8a62-124">The **New Project** dialog box appears.</span></span>  
  
3. <span data-ttu-id="d8a62-125">Selezionare **applicazione Windows** dall'elenco dei modelli di progetto Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="d8a62-125">Select **Windows Application** from the list of Visual Basic project templates.</span></span> <span data-ttu-id="d8a62-126">Verrà visualizzato il nuovo progetto.</span><span class="sxs-lookup"><span data-stu-id="d8a62-126">The new project is displayed.</span></span>  
  
4. <span data-ttu-id="d8a62-127">Aggiungere la `Declare` funzione seguente alla classe o al modulo in cui si vuole usare la dll:</span><span class="sxs-lookup"><span data-stu-id="d8a62-127">Add the following `Declare` function either to the class or module in which you want to use the DLL:</span></span>  
  
     [!code-vb[VbVbalrInterop#9](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#9)]  
  
### <a name="parts-of-the-declare-statement"></a><span data-ttu-id="d8a62-128">Parti dell'istruzione Declare</span><span class="sxs-lookup"><span data-stu-id="d8a62-128">Parts of the Declare Statement</span></span>  
 <span data-ttu-id="d8a62-129">L' `Declare` istruzione include gli elementi seguenti.</span><span class="sxs-lookup"><span data-stu-id="d8a62-129">The `Declare` statement includes the following elements.</span></span>  
  
#### <a name="auto-modifier"></a><span data-ttu-id="d8a62-130">Modificatore automatico</span><span class="sxs-lookup"><span data-stu-id="d8a62-130">Auto modifier</span></span>  
 <span data-ttu-id="d8a62-131">Il `Auto` modificatore indica al runtime di convertire la stringa in base al nome del metodo in base alle regole Common Language Runtime (o al nome alias, se specificato).</span><span class="sxs-lookup"><span data-stu-id="d8a62-131">The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).</span></span>  
  
#### <a name="lib-and-alias-keywords"></a><span data-ttu-id="d8a62-132">Parole chiave lib e alias</span><span class="sxs-lookup"><span data-stu-id="d8a62-132">Lib and Alias keywords</span></span>  
 <span data-ttu-id="d8a62-133">Il nome che segue la `Function` parola chiave è il nome usato dal programma per accedere alla funzione importata.</span><span class="sxs-lookup"><span data-stu-id="d8a62-133">The name following the `Function` keyword is the name your program uses to access the imported function.</span></span> <span data-ttu-id="d8a62-134">Può corrispondere al nome reale della funzione che si sta chiamando oppure è possibile utilizzare qualsiasi nome di routine valido e quindi utilizzare la `Alias` parola chiave per specificare il nome reale della funzione che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="d8a62-134">It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.</span></span>  
  
 <span data-ttu-id="d8a62-135">Specificare la `Lib` parola chiave, seguita dal nome e dal percorso della dll che contiene la funzione che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="d8a62-135">Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling.</span></span> <span data-ttu-id="d8a62-136">Non è necessario specificare il percorso per i file presenti nelle directory di sistema di Windows.</span><span class="sxs-lookup"><span data-stu-id="d8a62-136">You do not need to specify the path for files located in the Windows system directories.</span></span>  
  
 <span data-ttu-id="d8a62-137">Usare la `Alias` parola chiave se il nome della funzione che si sta chiamando non è un nome di stored procedure Visual Basic valido o è in conflitto con il nome di altri elementi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8a62-137">Use the `Alias` keyword if the name of the function you are calling is not a valid Visual Basic procedure name, or conflicts with the name of other items in your application.</span></span> <span data-ttu-id="d8a62-138">`Alias`indica il nome true della funzione chiamata.</span><span class="sxs-lookup"><span data-stu-id="d8a62-138">`Alias` indicates the true name of the function being called.</span></span>  
  
#### <a name="argument-and-data-type-declarations"></a><span data-ttu-id="d8a62-139">Dichiarazioni di argomenti e tipi di dati</span><span class="sxs-lookup"><span data-stu-id="d8a62-139">Argument and Data Type Declarations</span></span>  
 <span data-ttu-id="d8a62-140">Dichiarare gli argomenti e i relativi tipi di dati.</span><span class="sxs-lookup"><span data-stu-id="d8a62-140">Declare the arguments and their data types.</span></span> <span data-ttu-id="d8a62-141">Questa parte può essere complessa perché i tipi di dati usati da Windows non corrispondono ai tipi di dati di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d8a62-141">This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.</span></span> <span data-ttu-id="d8a62-142">Visual Basic esegue una grande parte del lavoro convertendo gli argomenti in tipi di dati compatibili, un processo denominato *marshalling*.</span><span class="sxs-lookup"><span data-stu-id="d8a62-142">Visual Basic does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*.</span></span> <span data-ttu-id="d8a62-143">È possibile controllare in modo esplicito il modo in cui viene eseguito il marshalling degli argomenti utilizzando l' <xref:System.Runtime.InteropServices.MarshalAsAttribute> attributo definito nello <xref:System.Runtime.InteropServices> spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="d8a62-143">You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d8a62-144">Le versioni precedenti di Visual Basic consentivano di dichiarare parametri `As Any` , vale a dire che potevano essere utilizzati dati di qualsiasi tipo di dati.</span><span class="sxs-lookup"><span data-stu-id="d8a62-144">Previous versions of Visual Basic allowed you to declare parameters `As Any`, meaning that data of any data type could be used.</span></span> <span data-ttu-id="d8a62-145">Visual Basic richiede l'utilizzo di un tipo di dati specifico per tutte le `Declare` istruzioni.</span><span class="sxs-lookup"><span data-stu-id="d8a62-145">Visual Basic requires that you use a specific data type for all `Declare` statements.</span></span>  
  
#### <a name="windows-api-constants"></a><span data-ttu-id="d8a62-146">Costanti API Windows</span><span class="sxs-lookup"><span data-stu-id="d8a62-146">Windows API Constants</span></span>  
 <span data-ttu-id="d8a62-147">Alcuni argomenti sono combinazioni di costanti.</span><span class="sxs-lookup"><span data-stu-id="d8a62-147">Some arguments are combinations of constants.</span></span> <span data-ttu-id="d8a62-148">Ad esempio, l' `MessageBox` API mostrata in questa procedura dettagliata accetta un argomento integer denominato `Typ` che controlla la modalità di visualizzazione della finestra di messaggio.</span><span class="sxs-lookup"><span data-stu-id="d8a62-148">For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed.</span></span> <span data-ttu-id="d8a62-149">È possibile determinare il valore numerico di queste costanti esaminando le `#define` istruzioni nel file WinUser. h.</span><span class="sxs-lookup"><span data-stu-id="d8a62-149">You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h.</span></span> <span data-ttu-id="d8a62-150">I valori numerici sono in genere visualizzati in formato esadecimale, quindi è consigliabile usare un calcolatore per aggiungerli e convertirli in decimali.</span><span class="sxs-lookup"><span data-stu-id="d8a62-150">The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.</span></span> <span data-ttu-id="d8a62-151">Se, ad esempio, si desidera combinare le costanti per il punto esclamativo `MB_ICONEXCLAMATION` 0x00000030 e il 0x00000004 di stile Yes/No `MB_YESNO` , è possibile aggiungere i numeri e ottenere un risultato di 0x00000034 o 52 Decimal.</span><span class="sxs-lookup"><span data-stu-id="d8a62-151">For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.</span></span> <span data-ttu-id="d8a62-152">Sebbene sia possibile usare direttamente il risultato Decimal, è preferibile dichiarare questi valori come costanti nell'applicazione e combinarli usando l' `Or` operatore.</span><span class="sxs-lookup"><span data-stu-id="d8a62-152">Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.</span></span>  
  
##### <a name="to-declare-constants-for-windows-api-calls"></a><span data-ttu-id="d8a62-153">Per dichiarare costanti per le chiamate API Windows</span><span class="sxs-lookup"><span data-stu-id="d8a62-153">To declare constants for Windows API calls</span></span>  
  
1. <span data-ttu-id="d8a62-154">Consultare la documentazione per la funzione di Windows che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="d8a62-154">Consult the documentation for the Windows function you are calling.</span></span> <span data-ttu-id="d8a62-155">Determinare il nome delle costanti utilizzate e il nome del file con estensione h che contiene i valori numerici per queste costanti.</span><span class="sxs-lookup"><span data-stu-id="d8a62-155">Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.</span></span>  
  
2. <span data-ttu-id="d8a62-156">Utilizzare un editor di testo, ad esempio Blocco note, per visualizzare il contenuto del file di intestazione (. h) e individuare i valori associati alle costanti utilizzate.</span><span class="sxs-lookup"><span data-stu-id="d8a62-156">Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.</span></span> <span data-ttu-id="d8a62-157">Ad esempio, l' `MessageBox` API usa la costante `MB_ICONQUESTION` per visualizzare un punto interrogativo nella finestra di messaggio.</span><span class="sxs-lookup"><span data-stu-id="d8a62-157">For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box.</span></span> <span data-ttu-id="d8a62-158">La definizione di `MB_ICONQUESTION` si trova in winuser. h e viene visualizzata come segue:</span><span class="sxs-lookup"><span data-stu-id="d8a62-158">The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:</span></span>  
  
     `#define MB_ICONQUESTION             0x00000020L`  
  
3. <span data-ttu-id="d8a62-159">Aggiungere istruzioni equivalenti `Const` alla classe o al modulo per rendere queste costanti disponibili per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8a62-159">Add equivalent `Const` statements to your class or module to make these constants available to your application.</span></span> <span data-ttu-id="d8a62-160">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="d8a62-160">For example:</span></span>  
  
     [!code-vb[VbVbalrInterop#11](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#11)]  
  
###### <a name="to-call-the-dll-procedure"></a><span data-ttu-id="d8a62-161">Per chiamare la procedura DLL</span><span class="sxs-lookup"><span data-stu-id="d8a62-161">To call the DLL procedure</span></span>  
  
1. <span data-ttu-id="d8a62-162">Aggiungere un pulsante denominato `Button1` al modulo di avvio per il progetto, quindi fare doppio clic su di esso per visualizzarne il codice.</span><span class="sxs-lookup"><span data-stu-id="d8a62-162">Add a button named `Button1` to the startup form for your project, and then double-click it to view its code.</span></span> <span data-ttu-id="d8a62-163">Viene visualizzato il gestore eventi per il pulsante.</span><span class="sxs-lookup"><span data-stu-id="d8a62-163">The event handler for the button is displayed.</span></span>  
  
2. <span data-ttu-id="d8a62-164">Aggiungere il codice al `Click` gestore eventi per il pulsante aggiunto, per chiamare la procedura e fornire gli argomenti appropriati:</span><span class="sxs-lookup"><span data-stu-id="d8a62-164">Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:</span></span>  
  
     [!code-vb[VbVbalrInterop#12](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#12)]  
  
3. <span data-ttu-id="d8a62-165">Eseguire il progetto premendo F5.</span><span class="sxs-lookup"><span data-stu-id="d8a62-165">Run the project by pressing F5.</span></span> <span data-ttu-id="d8a62-166">La finestra di messaggio viene visualizzata con i pulsanti **Sì** e **Nessuna** risposta.</span><span class="sxs-lookup"><span data-stu-id="d8a62-166">The message box is displayed with both **Yes** and **No** response buttons.</span></span> <span data-ttu-id="d8a62-167">Fare clic su una delle due.</span><span class="sxs-lookup"><span data-stu-id="d8a62-167">Click either one.</span></span>  
  
#### <a name="data-marshaling"></a><span data-ttu-id="d8a62-168">Marshalling dei dati</span><span class="sxs-lookup"><span data-stu-id="d8a62-168">Data Marshaling</span></span>  
 <span data-ttu-id="d8a62-169">Visual Basic converte automaticamente i tipi di dati dei parametri e i valori restituiti per le chiamate API Windows, ma è possibile usare l' `MarshalAs` attributo per specificare in modo esplicito i tipi di dati non gestiti previsti da un'API.</span><span class="sxs-lookup"><span data-stu-id="d8a62-169">Visual Basic automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects.</span></span> <span data-ttu-id="d8a62-170">Per ulteriori informazioni sul marshalling di interoperabilità, vedere [marshalling di interoperabilità](../../../framework/interop/interop-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="d8a62-170">For more information about interop marshaling, see [Interop Marshaling](../../../framework/interop/interop-marshaling.md).</span></span>  
  
##### <a name="to-use-declare-and-marshalas-in-an-api-call"></a><span data-ttu-id="d8a62-171">Per usare DECLARE e marshalling in una chiamata API</span><span class="sxs-lookup"><span data-stu-id="d8a62-171">To use Declare and MarshalAs in an API call</span></span>  
  
1. <span data-ttu-id="d8a62-172">Determinare il nome della funzione che si desidera chiamare, più gli argomenti, i tipi di dati e il valore restituito.</span><span class="sxs-lookup"><span data-stu-id="d8a62-172">Determine the name of the function you want to call, plus its arguments, data types, and return value.</span></span>  
  
2. <span data-ttu-id="d8a62-173">Per semplificare l'accesso all' `MarshalAs` attributo, aggiungere un' `Imports` istruzione all'inizio del codice per la classe o il modulo, come nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="d8a62-173">To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:</span></span>  
  
     [!code-vb[VbVbalrInterop#13](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#13)]  
  
3. <span data-ttu-id="d8a62-174">Aggiungere un prototipo di funzione per la funzione importata alla classe o al modulo in uso e applicare l' `MarshalAs` attributo ai parametri o al valore restituito.</span><span class="sxs-lookup"><span data-stu-id="d8a62-174">Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value.</span></span> <span data-ttu-id="d8a62-175">Nell'esempio seguente viene effettuato il marshalling di una chiamata API che prevede il tipo `void*` `AsAny` :</span><span class="sxs-lookup"><span data-stu-id="d8a62-175">In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:</span></span>  
  
     [!code-vb[VbVbalrInterop#14](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#14)]  
  
## <a name="api-calls-using-dllimport"></a><span data-ttu-id="d8a62-176">Chiamate API con DllImport</span><span class="sxs-lookup"><span data-stu-id="d8a62-176">API Calls Using DllImport</span></span>  
 <span data-ttu-id="d8a62-177">L' `DllImport` attributo fornisce un secondo modo per chiamare le funzioni nelle DLL senza librerie dei tipi.</span><span class="sxs-lookup"><span data-stu-id="d8a62-177">The `DllImport` attribute provides a second way to call functions in DLLs without type libraries.</span></span> <span data-ttu-id="d8a62-178">`DllImport`è approssimativamente equivalente all'uso di un' `Declare` istruzione, ma offre un maggiore controllo sulla modalità di chiamata delle funzioni.</span><span class="sxs-lookup"><span data-stu-id="d8a62-178">`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.</span></span>  
  
 <span data-ttu-id="d8a62-179">È possibile utilizzare `DllImport` con la maggior parte delle chiamate API Windows purché la chiamata faccia riferimento a un metodo condiviso (talvolta chiamato *statico*).</span><span class="sxs-lookup"><span data-stu-id="d8a62-179">You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method.</span></span> <span data-ttu-id="d8a62-180">Non è possibile usare metodi che richiedono un'istanza di una classe.</span><span class="sxs-lookup"><span data-stu-id="d8a62-180">You cannot use methods that require an instance of a class.</span></span> <span data-ttu-id="d8a62-181">Diversamente dalle `Declare` istruzioni, `DllImport` le chiamate non possono utilizzare l' `MarshalAs` attributo.</span><span class="sxs-lookup"><span data-stu-id="d8a62-181">Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.</span></span>  
  
### <a name="to-call-a-windows-api-using-the-dllimport-attribute"></a><span data-ttu-id="d8a62-182">Per chiamare un'API Windows utilizzando l'attributo DllImport</span><span class="sxs-lookup"><span data-stu-id="d8a62-182">To call a Windows API using the DllImport attribute</span></span>  
  
1. <span data-ttu-id="d8a62-183">Aprire un nuovo progetto di applicazione Windows scegliendo **nuovo** dal menu **file** , quindi fare clic su **progetto**.</span><span class="sxs-lookup"><span data-stu-id="d8a62-183">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="d8a62-184">Verrà visualizzata la finestra di dialogo **Nuovo progetto** .</span><span class="sxs-lookup"><span data-stu-id="d8a62-184">The **New Project** dialog box appears.</span></span>  
  
2. <span data-ttu-id="d8a62-185">Selezionare **applicazione Windows** dall'elenco dei modelli di progetto Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="d8a62-185">Select **Windows Application** from the list of Visual Basic project templates.</span></span> <span data-ttu-id="d8a62-186">Verrà visualizzato il nuovo progetto.</span><span class="sxs-lookup"><span data-stu-id="d8a62-186">The new project is displayed.</span></span>  
  
3. <span data-ttu-id="d8a62-187">Aggiungere un pulsante denominato `Button2` al modulo di avvio.</span><span class="sxs-lookup"><span data-stu-id="d8a62-187">Add a button named `Button2` to the startup form.</span></span>  
  
4. <span data-ttu-id="d8a62-188">Fare doppio clic `Button2` per aprire la visualizzazione codice per il form.</span><span class="sxs-lookup"><span data-stu-id="d8a62-188">Double-click `Button2` to open the code view for the form.</span></span>  
  
5. <span data-ttu-id="d8a62-189">Per semplificare l'accesso a `DllImport` , aggiungere un' `Imports` istruzione all'inizio del codice per la classe del form di avvio:</span><span class="sxs-lookup"><span data-stu-id="d8a62-189">To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:</span></span>  
  
     [!code-vb[VbVbalrInterop#13](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#13)]  
  
6. <span data-ttu-id="d8a62-190">Dichiarare una funzione vuota che precede l' `End Class` istruzione per il form e assegnare un nome alla funzione `MoveFile` .</span><span class="sxs-lookup"><span data-stu-id="d8a62-190">Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.</span></span>  
  
7. <span data-ttu-id="d8a62-191">Applicare i `Public` `Shared` modificatori e alla dichiarazione di funzione e impostare i parametri per `MoveFile` in base agli argomenti utilizzati dalla funzione API di Windows:</span><span class="sxs-lookup"><span data-stu-id="d8a62-191">Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:</span></span>  
  
     [!code-vb[VbVbalrInterop#16](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#16)]  
  
     <span data-ttu-id="d8a62-192">La funzione può avere qualsiasi nome di routine valido; l' `DllImport` attributo specifica il nome nella dll.</span><span class="sxs-lookup"><span data-stu-id="d8a62-192">Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL.</span></span> <span data-ttu-id="d8a62-193">Gestisce anche il marshalling di interoperabilità per i parametri e i valori restituiti, quindi è possibile scegliere i tipi di dati di Visual Studio simili ai tipi di dati usati dall'API.</span><span class="sxs-lookup"><span data-stu-id="d8a62-193">It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.</span></span>  
  
8. <span data-ttu-id="d8a62-194">Applicare l' `DllImport` attributo alla funzione vuota.</span><span class="sxs-lookup"><span data-stu-id="d8a62-194">Apply the `DllImport` attribute to the empty function.</span></span> <span data-ttu-id="d8a62-195">Il primo parametro è il nome e il percorso della DLL che contiene la funzione che si sta chiamando.</span><span class="sxs-lookup"><span data-stu-id="d8a62-195">The first parameter is the name and location of the DLL containing the function you are calling.</span></span> <span data-ttu-id="d8a62-196">Non è necessario specificare il percorso per i file presenti nelle directory di sistema di Windows.</span><span class="sxs-lookup"><span data-stu-id="d8a62-196">You do not need to specify the path for files located in the Windows system directories.</span></span> <span data-ttu-id="d8a62-197">Il secondo parametro è un argomento denominato che specifica il nome della funzione nell'API Windows.</span><span class="sxs-lookup"><span data-stu-id="d8a62-197">The second parameter is a named argument that specifies the name of the function in the Windows API.</span></span> <span data-ttu-id="d8a62-198">In questo esempio, l' `DllImport` attributo impone che le chiamate a `MoveFile` vengano trasmesse a `MoveFileW` in Kernel32. DLL.</span><span class="sxs-lookup"><span data-stu-id="d8a62-198">In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL.</span></span> <span data-ttu-id="d8a62-199">Il `MoveFileW` metodo copia un file dal percorso `src` al percorso `dst` .</span><span class="sxs-lookup"><span data-stu-id="d8a62-199">The `MoveFileW` method copies a file from the path `src` to the path `dst`.</span></span>  
  
     [!code-vb[VbVbalrInterop#17](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#17)]  
  
9. <span data-ttu-id="d8a62-200">Aggiungere il codice al `Button2_Click` gestore eventi per chiamare la funzione:</span><span class="sxs-lookup"><span data-stu-id="d8a62-200">Add code to the `Button2_Click` event handler to call the function:</span></span>  
  
     [!code-vb[VbVbalrInterop#18](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbVbalrInterop/VB/Class1.vb#18)]  
  
10. <span data-ttu-id="d8a62-201">Creare un file denominato test. txt e inserirlo nella directory C:\Tmp sul disco rigido.</span><span class="sxs-lookup"><span data-stu-id="d8a62-201">Create a file named Test.txt and place it in the C:\Tmp directory on your hard drive.</span></span> <span data-ttu-id="d8a62-202">Se necessario, creare la directory tmp.</span><span class="sxs-lookup"><span data-stu-id="d8a62-202">Create the Tmp directory if necessary.</span></span>  
  
11. <span data-ttu-id="d8a62-203">Premere F5 per avviare l’applicazione.</span><span class="sxs-lookup"><span data-stu-id="d8a62-203">Press F5 to start the application.</span></span> <span data-ttu-id="d8a62-204">Viene visualizzato il form principale.</span><span class="sxs-lookup"><span data-stu-id="d8a62-204">The main form appears.</span></span>  
  
12. <span data-ttu-id="d8a62-205">Fare clic su **Button2**.</span><span class="sxs-lookup"><span data-stu-id="d8a62-205">Click **Button2**.</span></span> <span data-ttu-id="d8a62-206">Il messaggio "il file è stato spostato correttamente" viene visualizzato se il file può essere spostato.</span><span class="sxs-lookup"><span data-stu-id="d8a62-206">The message "The file was moved successfully" is displayed if the file can be moved.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d8a62-207">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d8a62-207">See also</span></span>

- <xref:System.Runtime.InteropServices.DllImportAttribute>
- <xref:System.Runtime.InteropServices.MarshalAsAttribute>
- [<span data-ttu-id="d8a62-208">Declare Statement</span><span class="sxs-lookup"><span data-stu-id="d8a62-208">Declare Statement</span></span>](../../language-reference/statements/declare-statement.md)
- [<span data-ttu-id="d8a62-209">Auto</span><span class="sxs-lookup"><span data-stu-id="d8a62-209">Auto</span></span>](../../language-reference/modifiers/auto.md)
- [<span data-ttu-id="d8a62-210">Alias</span><span class="sxs-lookup"><span data-stu-id="d8a62-210">Alias</span></span>](../../language-reference/statements/alias-clause.md)
- [<span data-ttu-id="d8a62-211">Interoperabilità COM</span><span class="sxs-lookup"><span data-stu-id="d8a62-211">COM Interop</span></span>](index.md)
- [<span data-ttu-id="d8a62-212">Creazione di prototipi nel codice gestito</span><span class="sxs-lookup"><span data-stu-id="d8a62-212">Creating Prototypes in Managed Code</span></span>](../../../framework/interop/creating-prototypes-in-managed-code.md)
- [<span data-ttu-id="d8a62-213">Marshalling di un delegato come metodo di callback</span><span class="sxs-lookup"><span data-stu-id="d8a62-213">Marshaling a Delegate as a Callback Method</span></span>](../../../framework/interop/marshaling-a-delegate-as-a-callback-method.md)
