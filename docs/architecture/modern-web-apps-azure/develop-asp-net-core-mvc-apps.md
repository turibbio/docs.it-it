---
title: Sviluppo di app ASP.NET Core MVC
description: Progettare applicazioni Web moderne con ASP.NET Core e Azure | Sviluppo di app ASP.NET Core MVC
author: ardalis
ms.author: wiwagn
ms.date: 12/04/2019
ms.openlocfilehash: 3de70af23206b0ae0525541b3d2cb480dc5bb882
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/09/2020
ms.locfileid: "80987907"
---
# <a name="develop-aspnet-core-mvc-apps"></a><span data-ttu-id="22270-103">Sviluppare app ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="22270-103">Develop ASP.NET Core MVC apps</span></span>

> <span data-ttu-id="22270-104">"Non è importante ottenere il risultato desiderato al primo tentativo.</span><span class="sxs-lookup"><span data-stu-id="22270-104">"It's not important to get it right the first time.</span></span> <span data-ttu-id="22270-105">L'importante è ottenerlo all'ultimo".</span><span class="sxs-lookup"><span data-stu-id="22270-105">It's vitally important to get it right the last time."</span></span>  
> <span data-ttu-id="22270-106">_- Andrew Hunt e David Thomas_</span><span class="sxs-lookup"><span data-stu-id="22270-106">_- Andrew Hunt and David Thomas_</span></span>

<span data-ttu-id="22270-107">ASP.NET Core è un framework multipiattaforma open source per la compilazione di moderne applicazioni Web ottimizzate per il cloud.</span><span class="sxs-lookup"><span data-stu-id="22270-107">ASP.NET Core is a cross-platform, open-source framework for building modern cloud-optimized web applications.</span></span> <span data-ttu-id="22270-108">Le app ASP.NET Core sono leggere e modulari, con supporto incorporato per l'inserimento di dipendenze, e offrono maggiore testabilità e gestibilità.</span><span class="sxs-lookup"><span data-stu-id="22270-108">ASP.NET Core apps are lightweight and modular, with built-in support for dependency injection, enabling greater testability and maintainability.</span></span> <span data-ttu-id="22270-109">In associazione a MVC, che supporta la compilazione di API Web moderne oltre che di app basate su visualizzazione, ASP.NET Core è un framework potente per la compilazione di applicazioni Web aziendali.</span><span class="sxs-lookup"><span data-stu-id="22270-109">Combined with MVC, which supports building modern web APIs in addition to view-based apps, ASP.NET Core is a powerful framework with which to build enterprise web applications.</span></span>

## <a name="mvc-and-razor-pages"></a><span data-ttu-id="22270-110">MVC e Razor Pages</span><span class="sxs-lookup"><span data-stu-id="22270-110">MVC and Razor Pages</span></span>

<span data-ttu-id="22270-111">ASP.NET Core MVC offre molte funzionalità utili per la compilazione di API e app basate sul Web.</span><span class="sxs-lookup"><span data-stu-id="22270-111">ASP.NET Core MVC offers many features that are useful for building web-based APIs and apps.</span></span> <span data-ttu-id="22270-112">Il termine MVC è l'acronimo di "Model-View-Controller", un modello UI che suddivide le responsabilità della risposta alle richieste degli utenti in più sezioni.</span><span class="sxs-lookup"><span data-stu-id="22270-112">The term MVC stands for "Model-View-Controller", a UI pattern that breaks up the responsibilities of responding to user requests into several parts.</span></span> <span data-ttu-id="22270-113">Oltre a seguire questo modello è possibile implementare funzionalità nelle app ASP.NET Core come Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="22270-113">In addition to following this pattern, you can also implement features in your ASP.NET Core apps as Razor Pages.</span></span> <span data-ttu-id="22270-114">Le pagine Razor sono incorporate in ASP.NET Core MVC e usano le stesse funzionalità per il routing, l'associazione di modelli e così via. Tuttavia, anziché disporre di cartelle e file separati per controller, visualizzazioni e così via e utilizzando il routing basato su attributi, le pagine Razor vengono inserite in un'unica cartella ("/Pages"), instradare in base alla posizione relativa in questa cartella e gestire le richieste con i gestori anziché le azioni del controller.</span><span class="sxs-lookup"><span data-stu-id="22270-114">Razor Pages are built into ASP.NET Core MVC, and use the same features for routing, model binding, etc. However, instead of having separate folders and files for Controllers, Views, etc. and using attribute-based routing, Razor Pages are placed in a single folder ("/Pages"), route based on their relative location in this folder, and handle requests with handlers instead of controller actions.</span></span>

<span data-ttu-id="22270-115">Quando si crea una nuova app ASP.NET Core è importante avere determinato il tipo di app che si vuole creare.</span><span class="sxs-lookup"><span data-stu-id="22270-115">When you create a new ASP.NET Core App, you should have a plan in mind for the kind of app you want to build.</span></span> <span data-ttu-id="22270-116">In Visual Studio è possibile scegliere tra diversi modelli.</span><span class="sxs-lookup"><span data-stu-id="22270-116">In Visual Studio, you'll choose from several templates.</span></span> <span data-ttu-id="22270-117">I tre modelli di progetto più comuni sono API Web, Applicazione Web e Applicazione Web (MVC).</span><span class="sxs-lookup"><span data-stu-id="22270-117">The three most common project templates are Web API, Web Application, and Web Application (Model-View-Controller).</span></span> <span data-ttu-id="22270-118">Anche se è possibile prendere questa decisione solo quando si crea un progetto per la prima volta, non è una decisione irrevocabile.</span><span class="sxs-lookup"><span data-stu-id="22270-118">Although you can only make this decision when you first create a project, it's not an irrevocable decision.</span></span> <span data-ttu-id="22270-119">Il progetto API Web usa controller MVC standard, ma per impostazione predefinita non dispone di una cartella Views.</span><span class="sxs-lookup"><span data-stu-id="22270-119">The Web API project uses standard Model-View-Controller controllers – it just lacks Views by default.</span></span> <span data-ttu-id="22270-120">Allo stesso modo il modello Applicazione Web predefinito usa Razor Pages e pertanto non dispone di una cartella Views.</span><span class="sxs-lookup"><span data-stu-id="22270-120">Likewise, the default Web Application template uses Razor Pages, and so also lacks a Views folder.</span></span> <span data-ttu-id="22270-121">È possibile aggiungere una cartella Views a questi progetti in un secondo momento per supportare il comportamento basato sulle visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="22270-121">You can add a Views folder to these projects later to support view-based behavior.</span></span> <span data-ttu-id="22270-122">I progetti API Web e MVC non includono una cartella Pages per impostazione predefinita, ma è possibile aggiungerne una in un secondo momento per supportare i comportamenti basati su Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="22270-122">Web API and Model-View-Controller projects don't include a Pages folder by default, but you can add one later to support Razor Pages-based behavior.</span></span> <span data-ttu-id="22270-123">Considerare questi tre modelli come origini del supporto per tre tipi diversi di interazione dell'utente predefinita: dati (API Web), basata sulle pagine e basata sulle visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="22270-123">You can think of these three templates as supporting three different kinds of default user interaction: data (web API), page-based, and view-based.</span></span> <span data-ttu-id="22270-124">Se si vuole è tuttavia possibile combinare e associare alcuni o tutti questi modelli in un singolo progetto.</span><span class="sxs-lookup"><span data-stu-id="22270-124">However, you can mix and match any or all of these within a single project if you wish.</span></span>

### <a name="why-razor-pages"></a><span data-ttu-id="22270-125">Perché Razor Pages?</span><span class="sxs-lookup"><span data-stu-id="22270-125">Why Razor Pages?</span></span>

<span data-ttu-id="22270-126">Razor Pages è l'approccio predefinito per le nuove applicazioni Web in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="22270-126">Razor Pages is the default approach for new web applications in Visual Studio.</span></span> <span data-ttu-id="22270-127">Razor Pages offre una modalità più semplice per la creazione di funzionalità dell'applicazione basate sulle pagine, ad esempio moduli non SPA.</span><span class="sxs-lookup"><span data-stu-id="22270-127">Razor Pages offers a simpler way of building page-based application features, such as non-SPA forms.</span></span> <span data-ttu-id="22270-128">Con i controller e le visualizzazioni capitava spesso di avere applicazioni con controller molto grandi, che funzionavano con molte dipendenze e modelli di visualizzazione diversi e restituivano molte visualizzazioni diverse.</span><span class="sxs-lookup"><span data-stu-id="22270-128">Using controllers and views, it was common for applications to have very large controllers that worked with many different dependencies and view models and returned many different views.</span></span> <span data-ttu-id="22270-129">Ciò ha comportato una maggiore complessità e spesso ha portato a controller che non hanno seguito il principio di responsabilità singola o principi aperti/chiusi in modo efficace.</span><span class="sxs-lookup"><span data-stu-id="22270-129">This resulted in more complexity and often resulted in controllers that didn’t follow the Single Responsibility Principle or Open/Closed Principles effectively.</span></span> <span data-ttu-id="22270-130">Razor Pages risolve questo problema incapsulando la logica lato server di una determinata "pagina" logica in un'applicazione Web con markup Razor.</span><span class="sxs-lookup"><span data-stu-id="22270-130">Razor Pages addresses this issue by encapsulating the server-side logic for a given logical "page" in a web application with its Razor markup.</span></span> <span data-ttu-id="22270-131">Una pagina Razor che non include logica lato server può essere costituita semplicemente da un file Razor (ad esempio "Index.cshtml").</span><span class="sxs-lookup"><span data-stu-id="22270-131">A Razor Page that has no server-side logic can simply consist of a Razor file (for instance, "Index.cshtml").</span></span> <span data-ttu-id="22270-132">Tuttavia la maggior parte delle pagine Razor non elementari include una classe modello pagina associata, che per convenzione ha lo stesso nome del file Razor seguito dall'estensione "cs", ad esempio "Index.cshtml.cs".</span><span class="sxs-lookup"><span data-stu-id="22270-132">However, most non-trivial Razor Pages will have an associated page model class, which by convention is named the same as the Razor file with a ".cs" extension (for example, "Index.cshtml.cs").</span></span>

<span data-ttu-id="22270-133">Modello di pagina di una pagina Razor combina le responsabilità di un controller MVC e un modello di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="22270-133">A Razor Page's page model combines the responsibilities of an MVC controller and a viewmodel.</span></span> <span data-ttu-id="22270-134">Anziché gestire le richieste con metodi di azione del controller, vengono eseguiti gestori modello di pagina come "OnGet()" che eseguono il rendering della pagina associata per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="22270-134">Instead of handling requests with controller action methods, page model handlers like "OnGet()" are executed, rendering their associated page by default.</span></span> <span data-ttu-id="22270-135">Razor Pages semplifica il processo di creazione di pagine singole in un'app ASP.NET Core, pur garantendo tutte le funzionalità architettoniche di ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="22270-135">Razor Pages simplifies the process of building individual pages in an ASP.NET Core app, while still providing all the architectural features of ASP.NET Core MVC.</span></span> <span data-ttu-id="22270-136">Si tratta di una scelta predefinita ottimale per nuove funzionalità basate sulle pagine.</span><span class="sxs-lookup"><span data-stu-id="22270-136">They're a good default choice for new page-based functionality.</span></span>

### <a name="when-to-use-mvc"></a><span data-ttu-id="22270-137">Quando usare MVC</span><span class="sxs-lookup"><span data-stu-id="22270-137">When to use MVC</span></span>

<span data-ttu-id="22270-138">Se si creano API Web, il modello MVC ha più senso che provare a usare pagine Razor.If you're building web APIs, the MVC pattern makes more sense than trying to use Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="22270-138">If you're building web APIs, the MVC pattern makes more sense than trying to use Razor Pages.</span></span> <span data-ttu-id="22270-139">Se il progetto esporrà solo gli endpoint API Web, è consigliabile iniziare dal modello di progetto API Web.</span><span class="sxs-lookup"><span data-stu-id="22270-139">If your project will only expose web API endpoints, you should ideally start from the Web API project template.</span></span> <span data-ttu-id="22270-140">In caso contrario, è facile aggiungere controller ed endpoint API associati a qualsiasi app ASP.NET Core.Otherwise, it's easy to add controllers and associated API endpoints to any ASP.NET Core app.</span><span class="sxs-lookup"><span data-stu-id="22270-140">Otherwise, it's easy to add controllers and associated API endpoints to any ASP.NET Core app.</span></span> <span data-ttu-id="22270-141">Utilizzare l'approccio MVC basato sulla visualizzazione se si esegue la migrazione di un'applicazione esistente da ASP.NET MVC 5 o versioni precedenti per ASP.NET MVC di base e si desidera eseguire questa operazione con il minimo sforzo.</span><span class="sxs-lookup"><span data-stu-id="22270-141">Use the view-based MVC approach if you're migrating an existing application from ASP.NET MVC 5 or earlier to ASP.NET Core MVC and you want to do so with the least amount of effort.</span></span> <span data-ttu-id="22270-142">Dopo aver effettuato la migrazione iniziale, è possibile valutare se ha senso adottare pagine Razor per nuove funzionalità o anche come migrazione all'ingrosso.</span><span class="sxs-lookup"><span data-stu-id="22270-142">Once you've made the initial migration, you can evaluate whether it makes sense to adopt Razor Pages for new features or even as a wholesale migration.</span></span>

<span data-ttu-id="22270-143">Se scegli di compilare l'app Web usando le pagine Razor o le visualizzazioni MVC, l'app avrà prestazioni simili e includerà il supporto per l'inserimento di dipendenze, i filtri, l'associazione di modelli, la convalida e così via.</span><span class="sxs-lookup"><span data-stu-id="22270-143">Whether you choose to build your web app using Razor Pages or MVC views, your app will have similar performance and will include support for dependency injection, filters, model binding, validation, and so on.</span></span>

## <a name="mapping-requests-to-responses"></a><span data-ttu-id="22270-144">Mapping delle richieste alle risposte</span><span class="sxs-lookup"><span data-stu-id="22270-144">Mapping requests to responses</span></span>

<span data-ttu-id="22270-145">Fondamentalmente, le app ASP.NET Core mappano le richieste in ingresso alle risposte in uscita.</span><span class="sxs-lookup"><span data-stu-id="22270-145">At its heart, ASP.NET Core apps map incoming requests to outgoing responses.</span></span> <span data-ttu-id="22270-146">Questa operazione viene eseguita tramite middleware e le semplici app ASP.NET Core e i microservizi possono essere costituiti esclusivamente da middleware personalizzato.</span><span class="sxs-lookup"><span data-stu-id="22270-146">At a low level, this is done with middleware, and simple ASP.NET Core apps and microservices may be comprised solely of custom middleware.</span></span> <span data-ttu-id="22270-147">Quando si usa ASP.NET Core MVC, è possibile lavorare a un livello avanzato con _route_, _controller_ e _azioni_.</span><span class="sxs-lookup"><span data-stu-id="22270-147">When using ASP.NET Core MVC, you can work at a somewhat higher level, thinking in terms of _routes_, _controllers_, and _actions_.</span></span> <span data-ttu-id="22270-148">Ogni richiesta in ingresso viene confrontata con la tabella di routing dell'applicazione e se viene trovata una route corrispondente, viene chiamato il metodo di azione associato (appartenente a un controller) per gestire la richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-148">Each incoming request is compared with the application's routing table, and if a matching route is found, the associated action method (belonging to a controller) is called to handle the request.</span></span> <span data-ttu-id="22270-149">Se non viene trovata alcuna route corrispondente, viene chiamato un gestore degli errori (in questo caso, viene restituito un risultato NotFound).</span><span class="sxs-lookup"><span data-stu-id="22270-149">If no matching route is found, an error handler (in this case, returning a NotFound result) is called.</span></span>

<span data-ttu-id="22270-150">Le app ASP.NET Core MVC possono usare route convenzionali, route di attributi o entrambi i tipi di route.</span><span class="sxs-lookup"><span data-stu-id="22270-150">ASP.NET Core MVC apps can use conventional routes, attribute routes, or both.</span></span> <span data-ttu-id="22270-151">Le route convenzionali sono definite nel codice tramite la specifica delle _convenzioni_ di routing usando una sintassi simile a quella dell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="22270-151">Conventional routes are defined in code, specifying routing _conventions_ using syntax like in the example below:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="22270-152">In questo esempio è stata aggiunta una route denominata "default" alla tabella di routing.</span><span class="sxs-lookup"><span data-stu-id="22270-152">In this example, a route named "default" has been added to the routing table.</span></span> <span data-ttu-id="22270-153">Definisce un modello di route con segnaposto per _controller_, _action_e _id_. I segnaposto del controller e dell'azione sono specificati per impostazione predefinita ("Home" e "Index", rispettivamente) e il segnaposto id è facoltativo (in virtù di un "?" applicato ad esso).</span><span class="sxs-lookup"><span data-stu-id="22270-153">It defines a route template with placeholders for _controller_, _action_, and _id_. The controller and action placeholders have default specified ("Home" and "Index", respectively), and the id placeholder is optional (by virtue of a "?" applied to it).</span></span> <span data-ttu-id="22270-154">La convenzione definita in questo caso stabilisce che la prima parte di una richiesta deve corrispondere al nome del controller, la seconda parte all'azione e, se necessaria, una terza parte al parametro dell'ID.</span><span class="sxs-lookup"><span data-stu-id="22270-154">The convention defined here states that the first part of a request should correspond to the name of the controller, the second part to the action, and then if necessary a third part will represent an id parameter.</span></span> <span data-ttu-id="22270-155">Le route convenzionali vengono in genere definite in un'unica posizione per l'applicazione, ad esempio nel metodo Configure della classe Startup.</span><span class="sxs-lookup"><span data-stu-id="22270-155">Conventional routes are typically defined in one place for the application, such as in the Configure method in the Startup class.</span></span>

<span data-ttu-id="22270-156">Le route di attributi vengono applicate a controller e azioni direttamente anziché essere specificate a livello globale.</span><span class="sxs-lookup"><span data-stu-id="22270-156">Attribute routes are applied to controllers and actions directly, rather than specified globally.</span></span> <span data-ttu-id="22270-157">Ciò offre il vantaggio di renderle più facilmente individuabili durante la ricerca di un metodo specifico, ma significa che le informazioni di routing non vengono mantenute in un'unica posizione nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-157">This has the advantage of making them much more discoverable when you're looking at a particular method, but does mean that routing information is not kept in one place in the application.</span></span> <span data-ttu-id="22270-158">Con le route di attributi, è possibile specificare in modo semplice più route per una determinata azione nonché combinare le route tra i controller e le azioni.</span><span class="sxs-lookup"><span data-stu-id="22270-158">With attribute routes, you can easily specify multiple routes for a given action, as well as combine routes between controllers and actions.</span></span> <span data-ttu-id="22270-159">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="22270-159">For example:</span></span>

```csharp
[Route("Home")]
public class HomeController : Controller
{
    [Route("")] // Combines to define the route template "Home"
    [Route("Index")] // Combines to define route template "Home/Index"
    [Route("/")] // Does not combine, defines the route template ""
    public IActionResult Index() {}
}
```

<span data-ttu-id="22270-160">Le route possono essere specificate in [HttpGet] e attributi simili, evitando la necessità di aggiungere attributi [Route] separati.</span><span class="sxs-lookup"><span data-stu-id="22270-160">Routes can be specified on [HttpGet] and similar attributes, avoiding the need to add separate [Route] attributes.</span></span> <span data-ttu-id="22270-161">Le route di attributi possono anche usare i token per ridurre la necessità di ripetere i nomi di controller o azioni, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="22270-161">Attribute routes can also use tokens to reduce the need to repeat controller or action names, as shown below:</span></span>

```csharp
[Route("[controller]")]
public class ProductsController : Controller
{
    [Route("")] // Matches 'Products'
    [Route("Index")] // Matches 'Products/Index'
    public IActionResult Index() {}
}
```

<span data-ttu-id="22270-162">Le pagine Razor non utilizzano il routing degli attributi.</span><span class="sxs-lookup"><span data-stu-id="22270-162">Razor Pages doesn't use attribute routing.</span></span> <span data-ttu-id="22270-163">È possibile specificare informazioni aggiuntive sul modello di route per una pagina Razor nel contesto della direttiva `@page` corrispondente:</span><span class="sxs-lookup"><span data-stu-id="22270-163">You can specify additional route template information for a Razor Page as part of its `@page` directive:</span></span>

```csharp
@page "{id:int}"
```

<span data-ttu-id="22270-164">Nell'esempio precedente, la pagina in questione corrisponderà a una route con un parametro `id` intero.</span><span class="sxs-lookup"><span data-stu-id="22270-164">In the previous example, the page in question would match a route with an integer `id` parameter.</span></span> <span data-ttu-id="22270-165">Ad esempio la pagina *Products.cshtml* nel percorso radice di `/Pages` ha la route seguente:</span><span class="sxs-lookup"><span data-stu-id="22270-165">For example, the *Products.cshtml* page located in the root of `/Pages` would have this route:</span></span>

```csharp
"/Products/123"
```

<span data-ttu-id="22270-166">Dopo aver individuato una determinata richiesta corrispondente a una route e prima della chiamata al metodo di azione, ASP.NET Core MVC eseguirà l'[associazione del modello](/aspnet/core/mvc/models/model-binding) e la [convalida del modello](/aspnet/core/mvc/models/validation) nella richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-166">Once a given request has been matched to a route, but before the action method is called, ASP.NET Core MVC will perform [model binding](/aspnet/core/mvc/models/model-binding) and [model validation](/aspnet/core/mvc/models/validation) on the request.</span></span> <span data-ttu-id="22270-167">L'associazione del modello converte i dati HTTP in ingresso nei tipi .NET specificati come parametri del metodo di azione da chiamare.</span><span class="sxs-lookup"><span data-stu-id="22270-167">Model binding is responsible for converting incoming HTTP data into the .NET types specified as parameters of the action method to be called.</span></span> <span data-ttu-id="22270-168">Ad esempio, se il metodo di azione prevede un parametro ID di tipo int, l'associazione del modello tenterà di usare questo parametro in base a un valore specificato come parte della richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-168">For example, if the action method expects an int id parameter, model binding will attempt to provide this parameter from a value provided as part of the request.</span></span> <span data-ttu-id="22270-169">A tale scopo, l'associazione del modello cerca i valori in un form pubblicato, i valori nella route e i valori di stringa di query.</span><span class="sxs-lookup"><span data-stu-id="22270-169">To do so, model binding looks for values in a posted form, values in the route itself, and query string values.</span></span> <span data-ttu-id="22270-170">Se viene trovato un valore ID, il valore viene convertito in un intero prima di essere passato nel metodo di azione.</span><span class="sxs-lookup"><span data-stu-id="22270-170">Assuming an id value is found, it will be converted to an integer before being passed into the action method.</span></span>

<span data-ttu-id="22270-171">Dopo l'associazione del modello ma prima della chiamata al metodo di azione, viene eseguita la convalida del modello.</span><span class="sxs-lookup"><span data-stu-id="22270-171">After binding the model but before calling the action method, model validation occurs.</span></span> <span data-ttu-id="22270-172">La convalida del modello usa gli attributi facoltativi del tipo di modello e contribuisce a garantire che l'oggetto di modello specificato sia conforme a determinati requisiti dei dati.</span><span class="sxs-lookup"><span data-stu-id="22270-172">Model validation uses optional attributes on the model type, and can help ensure that the provided model object conforms to certain data requirements.</span></span> <span data-ttu-id="22270-173">Alcuni valori possono essere specificati come richiesto, o limitati a una certa lunghezza o intervallo numerico, ecc. Se vengono specificati attributi di convalida ma il modello non è conforme ai requisiti, la proprietà ModelState.IsValid sarà false e il set di regole di convalida non riuscite sarà disponibile per l'invio al client che effettua la richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-173">Certain values may be specified as required, or limited to a certain length or numeric range, etc. If validation attributes are specified but the model does not conform to their requirements, the property ModelState.IsValid will be false, and the set of failing validation rules will be available to send to the client making the request.</span></span>

<span data-ttu-id="22270-174">Se viene usata la convalida del modello, è necessario verificare sempre che il modello sia valido prima di eseguire i comandi di modifica dello stato per garantire che l'app non sia danneggiata da dati non validi.</span><span class="sxs-lookup"><span data-stu-id="22270-174">If you're using model validation, you should be sure to always check that the model is valid before performing any state-altering commands, to ensure your app is not corrupted by invalid data.</span></span> <span data-ttu-id="22270-175">È possibile usare un [filtro](/aspnet/core/mvc/controllers/filters) per evitare di aggiungere il codice necessario in ogni azione.</span><span class="sxs-lookup"><span data-stu-id="22270-175">You can use a [filter](/aspnet/core/mvc/controllers/filters) to avoid the need to add code for this in every action.</span></span> <span data-ttu-id="22270-176">I filtri di ASP.NET Core MVC consentono di intercettare i gruppi di richieste in modo che sia possibile applicare alla base di destinazione i criteri e gli aspetti comuni.</span><span class="sxs-lookup"><span data-stu-id="22270-176">ASP.NET Core MVC filters offer a way of intercepting groups of requests, so that common policies and cross-cutting concerns can be applied on a targeted basis.</span></span> <span data-ttu-id="22270-177">I filtri possono essere applicati alle singole azioni, a interi controller o a livello globale per un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-177">Filters can be applied to individual actions, whole controllers, or globally for an application.</span></span>

<span data-ttu-id="22270-178">Per le API Web, ASP.NET Core MVC supporta la [_negoziazione del contenuto_](/aspnet/core/mvc/models/formatting) consentendo alle richieste di specificare la formattazione delle risposte.</span><span class="sxs-lookup"><span data-stu-id="22270-178">For web APIs, ASP.NET Core MVC supports [_content negotiation_](/aspnet/core/mvc/models/formatting), allowing requests to specify how responses should be formatted.</span></span> <span data-ttu-id="22270-179">In base alle intestazioni specificate nella richiesta, le azioni che restituiscono dati formattano la risposta nel formato XML, JSON o un altro formato supportato.</span><span class="sxs-lookup"><span data-stu-id="22270-179">Based on headers provided in the request, actions returning data will format the response in XML, JSON, or another supported format.</span></span> <span data-ttu-id="22270-180">Questa funzionalità consente a più client con requisiti diversi di formattazione dei dati di usare la stessa API.</span><span class="sxs-lookup"><span data-stu-id="22270-180">This feature enables the same API to be used by multiple clients with different data format requirements.</span></span>

<span data-ttu-id="22270-181">Per i progetti API Web può essere utile usare l'attributo `[ApiController]`, applicabile a singoli controller, a una classe controller di base o all'intero assembly.</span><span class="sxs-lookup"><span data-stu-id="22270-181">Web API projects should consider using the `[ApiController]` attribute, which can be applied to individual controllers, to a base controller class, or to the entire assembly.</span></span> <span data-ttu-id="22270-182">Questo attributo aggiunge il controllo di convalida modello automatico e qualsiasi azione con un modello non valido restituisce BadRequest con i dettagli degli errori di convalida.</span><span class="sxs-lookup"><span data-stu-id="22270-182">This attribute adds automatic model validation checking and any action with an invalid model will return a BadRequest with the details of the validation errors.</span></span> <span data-ttu-id="22270-183">L'attributo richiede anche che tutte le azioni abbiano una route di attributo (anziché usare una route convenzionale) e restituisce informazioni ProblemDetails più dettagliate in caso di errori.</span><span class="sxs-lookup"><span data-stu-id="22270-183">The attribute also requires all actions have an attribute route, rather than using a conventional route, and returns more detailed ProblemDetails information in response to errors.</span></span>

> ### <a name="references--mapping-requests-to-responses"></a><span data-ttu-id="22270-184">Riferimenti - Mapping delle richieste alle risposte</span><span class="sxs-lookup"><span data-stu-id="22270-184">References – Mapping Requests to Responses</span></span>
>
> - <span data-ttu-id="22270-185">**Routing alle azioni del controller**
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/routing></span><span class="sxs-lookup"><span data-stu-id="22270-185">**Routing to Controller Actions**
<https://docs.microsoft.com/aspnet/core/mvc/controllers/routing></span></span>
> - <span data-ttu-id="22270-186">**Associazione del modello**
 > <https://docs.microsoft.com/aspnet/core/mvc/models/model-binding></span><span class="sxs-lookup"><span data-stu-id="22270-186">**Model Binding**
<https://docs.microsoft.com/aspnet/core/mvc/models/model-binding></span></span>
> - <span data-ttu-id="22270-187">**Convalida del modello**
 > <https://docs.microsoft.com/aspnet/core/mvc/models/validation></span><span class="sxs-lookup"><span data-stu-id="22270-187">**Model Validation**
<https://docs.microsoft.com/aspnet/core/mvc/models/validation></span></span>
> - <span data-ttu-id="22270-188">**Filtri**
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters></span><span class="sxs-lookup"><span data-stu-id="22270-188">**Filters**
<https://docs.microsoft.com/aspnet/core/mvc/controllers/filters></span></span>
> - <span data-ttu-id="22270-189">**Attributo ApiController**
 > <https://docs.microsoft.com/aspnet/core/web-api/></span><span class="sxs-lookup"><span data-stu-id="22270-189">**ApiController Attribute**
<https://docs.microsoft.com/aspnet/core/web-api/></span></span>

## <a name="working-with-dependencies"></a><span data-ttu-id="22270-190">Uso delle dipendenze</span><span class="sxs-lookup"><span data-stu-id="22270-190">Working with dependencies</span></span>

<span data-ttu-id="22270-191">ASP.NET Core include il supporto incorporato e usa internamente una tecnica chiamata [inserimento di dipendenze](/aspnet/core/fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="22270-191">ASP.NET Core has built-in support for and internally makes use of a technique known as [dependency injection](/aspnet/core/fundamentals/dependency-injection).</span></span> <span data-ttu-id="22270-192">L'inserimento di dipendenze è una tecnica che abilita l'accoppiamento libero tra parti diverse di un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-192">Dependency injection is a technique that enables loose coupling between different parts of an application.</span></span> <span data-ttu-id="22270-193">L'accoppiamento libero può essere utile perché rende più semplice isolare le parti dell'applicazione per il test o la sostituzione.</span><span class="sxs-lookup"><span data-stu-id="22270-193">Looser coupling is desirable because it makes it easier to isolate parts of the application, allowing for testing or replacement.</span></span> <span data-ttu-id="22270-194">Rende anche meno probabile che una modifica in una parte dell'applicazione abbia un impatto imprevisto in un'altra posizione nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-194">It also makes it less likely that a change in one part of the application will have an unexpected impact somewhere else in the application.</span></span> <span data-ttu-id="22270-195">L'inserimento di dipendenze si basa sul principio di inversione della dipendenza e rappresenta spesso la chiave per ottenere il principio di apertura/chiusura.</span><span class="sxs-lookup"><span data-stu-id="22270-195">Dependency injection is based on the dependency inversion principle, and is often key to achieving the open/closed principle.</span></span> <span data-ttu-id="22270-196">Quando si valuta il funzionamento dell'applicazione con le dipendenze, prestare attenzione al codice [static cling](https://deviq.com/static-cling/) e ricordare la frase "[New is Glue](https://ardalis.com/new-is-glue)".</span><span class="sxs-lookup"><span data-stu-id="22270-196">When evaluating how your application works with its dependencies, beware of the [static cling](https://deviq.com/static-cling/) code smell, and remember the aphorism "[new is glue](https://ardalis.com/new-is-glue)."</span></span>

<span data-ttu-id="22270-197">Lo static cling si verifica quando le classi chiamano metodi statici o accedono a proprietà statiche, un'operazione che comporta effetti collaterali o dipendenze nell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="22270-197">Static cling occurs when your classes make calls to static methods, or access static properties, which have side effects or dependencies on infrastructure.</span></span> <span data-ttu-id="22270-198">Ad esempio, se è presente un metodo che chiama un metodo statico che a sua volta scrive in un database, il metodo è strettamente accoppiato al database.</span><span class="sxs-lookup"><span data-stu-id="22270-198">For example, if you have a method that calls a static method, which in turn writes to a database, your method is tightly coupled to the database.</span></span> <span data-ttu-id="22270-199">Qualsiasi elemento che interrompe la chiamata al database interromperà il metodo.</span><span class="sxs-lookup"><span data-stu-id="22270-199">Anything that breaks that database call will break your method.</span></span> <span data-ttu-id="22270-200">Eseguire i test di questi tipi di metodi è notoriamente difficile poiché i test richiedono librerie di simulazione commerciali per simulare le chiamate statiche oppure possono essere eseguiti solo con un database di prova.</span><span class="sxs-lookup"><span data-stu-id="22270-200">Testing such methods is notoriously difficult, since such tests either require commercial mocking libraries to mock the static calls, or can only be tested with a test database in place.</span></span> <span data-ttu-id="22270-201">Le chiamate statiche che non hanno alcuna dipendenza nell'infrastruttura, in particolare quelle che sono completamente senza stato, possono essere eseguite senza problemi e non hanno alcun effetto sull'accoppiamento o la testabilità (oltre all'accoppiamento del codice alla chiamata statica).</span><span class="sxs-lookup"><span data-stu-id="22270-201">Static calls that don't have any dependence on infrastructure, especially those that are completely stateless, are fine to call and have no impact on coupling or testability (beyond coupling code to the static call itself).</span></span>

<span data-ttu-id="22270-202">Sebbene conoscano i rischi dello static cling e dello stato globale, molti sviluppatori eseguono comunque uno stretto accoppiamento del codice a implementazioni specifiche attraverso la creazione diretta delle istanze.</span><span class="sxs-lookup"><span data-stu-id="22270-202">Many developers understand the risks of static cling and global state, but will still tightly couple their code to specific implementations through direct instantiation.</span></span> <span data-ttu-id="22270-203">"New is glue" vuole essere un promemoria di questo accoppiamento e non una condanna generale dell'uso della parola chiave `new`.</span><span class="sxs-lookup"><span data-stu-id="22270-203">"New is glue" is meant to be a reminder of this coupling, and not a general condemnation of the use of the `new` keyword.</span></span> <span data-ttu-id="22270-204">Come con le chiamate a metodi statici, le nuove istanze dei tipi che non hanno dipendenze esterne in genere non accoppiano strettamente il codice ai dettagli di implementazione o rendono più difficile il test.</span><span class="sxs-lookup"><span data-stu-id="22270-204">Just as with static method calls, new instances of types that have no external dependencies typically do not tightly couple code to implementation details or make testing more difficult.</span></span> <span data-ttu-id="22270-205">Tuttavia, ogni volta che viene creata un'istanza di una classe, fermarsi a considerare se è consigliabile impostare come hardcoded l'istanza specifica in quella determinata posizione oppure richiedere l'istanza come dipendenza.</span><span class="sxs-lookup"><span data-stu-id="22270-205">But each time a class is instantiated, take just a brief moment to consider whether it makes sense to hard-code that specific instance in that particular location, or if it would be a better design to request that instance as a dependency.</span></span>

### <a name="declare-your-dependencies"></a><span data-ttu-id="22270-206">Dichiarare le dipendenze</span><span class="sxs-lookup"><span data-stu-id="22270-206">Declare your dependencies</span></span>

<span data-ttu-id="22270-207">ASP.NET Core si basa su metodi e classi che dichiarano le relative dipendenze richiedendole come argomenti.</span><span class="sxs-lookup"><span data-stu-id="22270-207">ASP.NET Core is built around having methods and classes declare their dependencies, requesting them as arguments.</span></span> <span data-ttu-id="22270-208">Le applicazioni ASP.NET sono in genere configurate in una classe Startup che è a sua volta configurata per supportare l'inserimento di dipendenze in punti diversi.</span><span class="sxs-lookup"><span data-stu-id="22270-208">ASP.NET applications are typically set up in a Startup class, which itself is configured to support dependency injection at several points.</span></span> <span data-ttu-id="22270-209">Se la classe Startup ha un costruttore, può richiedere le dipendenze mediante il costruttore, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="22270-209">If your Startup class has a constructor, it can request dependencies through the constructor, like so:</span></span>

```csharp
public class Startup
{
    public Startup(IHostingEnvironment env)
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(env.ContentRootPath)
            .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
            .AddJsonFile($"appsettings.{env.EnvironmentName}.json", optional: true);
    }
}
```

<span data-ttu-id="22270-210">La classe Startup è particolare perché non include requisiti di tipo espliciti per la classe.</span><span class="sxs-lookup"><span data-stu-id="22270-210">The Startup class is interesting in that there are no explicit type requirements for it.</span></span> <span data-ttu-id="22270-211">Non eredita da una classe di base Startup, né implementa alcuna interfaccia specifica.</span><span class="sxs-lookup"><span data-stu-id="22270-211">It doesn't inherit from a special Startup base class, nor does it implement any particular interface.</span></span> <span data-ttu-id="22270-212">È possibile assegnare o meno alla classe un costruttore ed è possibile specificare il numero di parametri desiderato nel costruttore.</span><span class="sxs-lookup"><span data-stu-id="22270-212">You can give it a constructor, or not, and you can specify as many parameters on the constructor as you want.</span></span> <span data-ttu-id="22270-213">Quando viene avviato l'host Web configurato per l'applicazione, l'host chiama la classe Startup specificata e usa l'inserimento di dipendenze per popolare le dipendenze richieste dalla classe Startup.</span><span class="sxs-lookup"><span data-stu-id="22270-213">When the web host you've configured for your application starts, it will call the Startup class you've told it to use, and will use dependency injection to populate any dependencies the Startup class requires.</span></span> <span data-ttu-id="22270-214">Naturalmente, se si richiedono parametri che non sono configurati nel contenitore dei servizi usato da ASP.NET Core, viene generata un'eccezione, ma se le richieste si limitano alle dipendenze riconosciute dal contenitore, sarà possibile richiedere qualsiasi elemento.</span><span class="sxs-lookup"><span data-stu-id="22270-214">Of course, if you request parameters that aren't configured in the services container used by ASP.NET Core, you'll get an exception, but as long as you stick to dependencies the container knows about, you can request anything you want.</span></span>

<span data-ttu-id="22270-215">L'inserimento di dipendenze è incorporato nelle app ASP.NET Core sin dall'inizio, ovvero dalla creazione dell'istanza di Startup.</span><span class="sxs-lookup"><span data-stu-id="22270-215">Dependency injection is built into your ASP.NET Core apps right from the start, when you create the Startup instance.</span></span> <span data-ttu-id="22270-216">Non viene interrotto per la classe Startup.</span><span class="sxs-lookup"><span data-stu-id="22270-216">It doesn't stop there for the Startup class.</span></span> <span data-ttu-id="22270-217">È possibile richiedere le dipendenze anche nel metodo Configure:</span><span class="sxs-lookup"><span data-stu-id="22270-217">You can also request dependencies in the Configure method:</span></span>

```csharp
public void Configure(IApplicationBuilder app,
    IHostingEnvironment env,
    ILoggerFactory loggerFactory)
{

}
```

<span data-ttu-id="22270-218">Il metodo ConfigureServices rappresenta l'eccezione a questo comportamento. Il metodo deve ricevere un solo parametro di tipo IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="22270-218">The ConfigureServices method is the exception to this behavior; it must take just one parameter of type IServiceCollection.</span></span> <span data-ttu-id="22270-219">Non necessita del supporto dell'inserimento delle dipendenze poiché da un lato è responsabile dell'aggiunta degli oggetti al contenitore dei servizi e dall'altro ha accesso a tutti i servizi correntemente configurati tramite il parametro IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="22270-219">It doesn't really need to support dependency injection, since on the one hand it is responsible for adding objects to the services container, and on the other it has access to all currently configured services via the IServiceCollection parameter.</span></span> <span data-ttu-id="22270-220">Per questa ragione, è possibile usare le dipendenze definite nella raccolta di servizi di ASP.NET Core in ogni parte della classe Startup, richiedendo il servizi necessario come parametro o usando IServiceCollection in ConfigureServices.</span><span class="sxs-lookup"><span data-stu-id="22270-220">Thus, you can work with dependencies defined in the ASP.NET Core services collection in every part of the Startup class, either by requesting the needed service as a parameter or by working with the IServiceCollection in ConfigureServices.</span></span>

> [!NOTE]
> <span data-ttu-id="22270-221">Se è necessario assicurarsi che determinati servizi siano disponibili per la classe Startup, è possibile configurarli utilizzando un IWebHostBuilder e il relativo metodo ConfigureServices all'interno della chiamata CreateDefaultBuilder.</span><span class="sxs-lookup"><span data-stu-id="22270-221">If you need to ensure certain services are available to your Startup class, you can configure them using an IWebHostBuilder and its ConfigureServices method inside the CreateDefaultBuilder call.</span></span>

<span data-ttu-id="22270-222">La classe Startup costituisce un modello per la struttura delle altre parti dell'applicazione ASP.NET Core, dai controller al middleware e dai filtri ai servizi.</span><span class="sxs-lookup"><span data-stu-id="22270-222">The Startup class is a model for how you should structure other parts of your ASP.NET Core application, from Controllers to Middleware to Filters to your own Services.</span></span> <span data-ttu-id="22270-223">In ogni caso, è necessario seguire il [principio delle dipendenze esplicite](https://deviq.com/explicit-dependencies-principle/) richiedendo le dipendenze anziché crearle direttamente e usando l'inserimento di dipendenze in tutta l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-223">In each case, you should follow the [Explicit Dependencies Principle](https://deviq.com/explicit-dependencies-principle/), requesting your dependencies rather than directly creating them, and leveraging dependency injection throughout your application.</span></span> <span data-ttu-id="22270-224">Prestare attenzione alla posizione e alla modalità di creazione diretta delle istanze delle implementazioni, in particolare dei servizi e degli oggetti che usano l'infrastruttura o presentano effetti collaterali.</span><span class="sxs-lookup"><span data-stu-id="22270-224">Be careful of where and how you directly instantiate implementations, especially services and objects that work with infrastructure or have side effects.</span></span> <span data-ttu-id="22270-225">Preferire l'uso di astrazioni definite nell'applicazione e passate come argomenti anziché l'uso di riferimenti hardcoded a tipi di implementazione specifici.</span><span class="sxs-lookup"><span data-stu-id="22270-225">Prefer working with abstractions defined in your application core and passed in as arguments to hardcoding references to specific implementation types.</span></span>

## <a name="structuring-the-application"></a><span data-ttu-id="22270-226">Creazione della struttura dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="22270-226">Structuring the application</span></span>

<span data-ttu-id="22270-227">Le applicazioni monolitiche hanno in genere un singolo punto di ingresso.</span><span class="sxs-lookup"><span data-stu-id="22270-227">Monolithic applications typically have a single entry point.</span></span> <span data-ttu-id="22270-228">In un'applicazione Web ASP.NET Core il punto di ingresso sarà il progetto Web ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="22270-228">In the case of an ASP.NET Core web application, the entry point will be the ASP.NET Core web project.</span></span> <span data-ttu-id="22270-229">Tuttavia, ciò non significa che la soluzione deve essere costituita da un singolo progetto.</span><span class="sxs-lookup"><span data-stu-id="22270-229">However, that doesn't mean the solution should consist of just a single project.</span></span> <span data-ttu-id="22270-230">È utile suddividere l'applicazione in livelli diversi per riflettere la separazione delle competenze.</span><span class="sxs-lookup"><span data-stu-id="22270-230">It's useful to break up the application into different layers in order to follow separation of concerns.</span></span> <span data-ttu-id="22270-231">Dopo la suddivisione in livelli, è utile andare oltre le cartelle per separare i progetti per ottenere un miglior incapsulamento.</span><span class="sxs-lookup"><span data-stu-id="22270-231">Once broken up into layers, it's helpful to go beyond folders to separate projects, which can help achieve better encapsulation.</span></span> <span data-ttu-id="22270-232">L'approccio migliore per raggiungere questi obiettivi con un'applicazione ASP.NET Core è una variante dell'architettura "pulita" descritta nel capitolo 5.</span><span class="sxs-lookup"><span data-stu-id="22270-232">The best approach to achieve these goals with an ASP.NET Core application is a variation of the Clean Architecture discussed in chapter 5.</span></span> <span data-ttu-id="22270-233">Seguendo questo approccio, la soluzione dell'applicazione sarà costituita da librerie separate per interfaccia utente, infrastruttura e ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="22270-233">Following this approach, the application's solution will be comprised of separate libraries for the UI, Infrastructure, and ApplicationCore.</span></span>

<span data-ttu-id="22270-234">Oltre a questi progetti, sono inclusi anche i progetti di test separati (i test sono descritti nel capitolo 9).</span><span class="sxs-lookup"><span data-stu-id="22270-234">In addition to these projects, separate test projects are included as well (Testing is discussed in Chapter 9).</span></span>

<span data-ttu-id="22270-235">Il modello a oggetti e le interfacce dell'applicazione devono trovarsi nel progetto ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="22270-235">The application's object model and interfaces should be placed in the ApplicationCore project.</span></span> <span data-ttu-id="22270-236">Questo progetto avrà il minor numero possibile di dipendenze e gli altri progetti nella soluzione faranno riferimento ad esso.</span><span class="sxs-lookup"><span data-stu-id="22270-236">This project will have as few dependencies as possible, and the other projects in the solution will reference it.</span></span> <span data-ttu-id="22270-237">Le entità di business che devono essere mantenute sono definite nel progetto ApplicationCore, analogamente ai servizi che non dipendono direttamente dall'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="22270-237">Business entities that need to be persisted are defined in the ApplicationCore project, as are services that do not directly depend on infrastructure.</span></span>

<span data-ttu-id="22270-238">I dettagli di implementazione, ad esempio la modalità di persistenza o di invio delle notifiche a un utente, si trovano nel progetto Infrastructure.</span><span class="sxs-lookup"><span data-stu-id="22270-238">Implementation details, such as how persistence is performed or how notifications might be sent to a user, are kept in the Infrastructure project.</span></span> <span data-ttu-id="22270-239">Il progetto farà riferimento a pacchetti specifici dell'implementazione, ad esempio Entity Framework Core, ma non deve esporre informazioni dettagliate su queste implementazioni all'esterno del progetto.</span><span class="sxs-lookup"><span data-stu-id="22270-239">This project will reference implementation-specific packages such as Entity Framework Core, but should not expose details about these implementations outside of the project.</span></span> <span data-ttu-id="22270-240">I servizi e i repository dell'infrastruttura devono implementare interfacce definite nel progetto ApplicationCore e le relative implementazioni della persistenza sono responsabili del recupero e dell'archiviazione delle entità definite in ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="22270-240">Infrastructure services and repositories should implement interfaces that are defined in the ApplicationCore project, and its persistence implementations are responsible for retrieving and storing entities defined in ApplicationCore.</span></span>

<span data-ttu-id="22270-241">Il progetto dell'interfaccia utente ASP.NET Core è responsabile di tutte le competenze a livello dell'interfaccia utente, ma non deve includere la logica di business o i dettagli dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="22270-241">The ASP.NET Core UI project is responsible for any UI level concerns, but should not include business logic or infrastructure details.</span></span> <span data-ttu-id="22270-242">Di fatto, il progetto non deve includere alcuna dipendenza nel progetto Infrastructure in modo che non venga inserita accidentalmente alcuna dipendenza tra i due progetti.</span><span class="sxs-lookup"><span data-stu-id="22270-242">In fact, ideally it shouldn't even have a dependency on the Infrastructure project, which will help ensure no dependency between the two projects is introduced accidentally.</span></span> <span data-ttu-id="22270-243">Questo obiettivo può essere raggiunto usando un contenitore DI di terze parti come Autofac, che consente di definire le regole DI nelle classi Module in ogni progetto.</span><span class="sxs-lookup"><span data-stu-id="22270-243">This can be achieved using a third-party DI container like Autofac, which allows you to define DI rules in Module classes in each project.</span></span>

<span data-ttu-id="22270-244">Un altro approccio per disaccoppiare l'applicazione dai dettagli di implementazione consiste nel fare in modo che l'applicazione chiami i microservizi, forse distribuiti in singoli contenitori Docker.</span><span class="sxs-lookup"><span data-stu-id="22270-244">Another approach to decoupling the application from implementation details is to have the application call microservices, perhaps deployed in individual Docker containers.</span></span> <span data-ttu-id="22270-245">Ciò offre una separazione delle competenze e un disaccoppiamento maggiori rispetto all'utilizzo di DI tra due progetti ma comporta una maggiore complessità.</span><span class="sxs-lookup"><span data-stu-id="22270-245">This provides even greater separation of concerns and decoupling than leveraging DI between two projects, but has additional complexity.</span></span>

### <a name="feature-organization"></a><span data-ttu-id="22270-246">Organizzazione basata sulle funzionalità</span><span class="sxs-lookup"><span data-stu-id="22270-246">Feature organization</span></span>

<span data-ttu-id="22270-247">Per impostazione predefinita, le applicazioni ASP.NET Core organizzano la struttura delle cartelle in modo da includere controller e visualizzazioni e spesso modelli di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="22270-247">By default, ASP.NET Core applications organize their folder structure to include Controllers and Views, and frequently ViewModels.</span></span> <span data-ttu-id="22270-248">Il codice lato client per supportare queste strutture lato server è in genere archiviato separatamente nella cartella wwwroot.</span><span class="sxs-lookup"><span data-stu-id="22270-248">Client-side code to support these server-side structures is typically stored separately in the wwwroot folder.</span></span> <span data-ttu-id="22270-249">Questa organizzazione, tuttavia, può creare problemi nelle applicazioni di grandi dimensioni poiché l'utilizzo di qualsiasi funzionalità specificata richiede spesso il passaggio da una cartella all'altra.</span><span class="sxs-lookup"><span data-stu-id="22270-249">However, large applications may encounter problems with this organization, since working on any given feature often requires jumping between these folders.</span></span> <span data-ttu-id="22270-250">Questa operazione diventa ancora più complessa con un numero più elevato di file e sottocartelle in ogni cartella richiedendo un maggior esplorazione in Esplora soluzioni.</span><span class="sxs-lookup"><span data-stu-id="22270-250">This gets more and more difficult as the number of files and subfolders in each folder grows, resulting in a great deal of scrolling through Solution Explorer.</span></span> <span data-ttu-id="22270-251">Per risolvere questo problema è possibile organizzare il codice dell'applicazione per _funzionalità_ anziché per tipo di file.</span><span class="sxs-lookup"><span data-stu-id="22270-251">One solution to this problem is to organize application code by _feature_ instead of by file type.</span></span> <span data-ttu-id="22270-252">Questo stile organizzativo viene in genere definito cartelle di entità geografiche o sezioni di [entità geografiche](https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (vedere anche: [Sezioni verticali).](https://deviq.com/vertical-slices/)</span><span class="sxs-lookup"><span data-stu-id="22270-252">This organizational style is typically referred to as feature folders or [feature slices](https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (see also: [Vertical Slices](https://deviq.com/vertical-slices/)).</span></span>

<span data-ttu-id="22270-253">A tale scopo, ASP.NET Core MVC supporta le aree.</span><span class="sxs-lookup"><span data-stu-id="22270-253">ASP.NET Core MVC supports Areas for this purpose.</span></span> <span data-ttu-id="22270-254">Usando le aree è possibile creare set separati di cartelle di controller e visualizzazioni, inclusi i modelli associati, in ogni cartella Area.</span><span class="sxs-lookup"><span data-stu-id="22270-254">Using areas, you can create separate sets of Controllers and Views folders (as well as any associated models) in each Area folder.</span></span> <span data-ttu-id="22270-255">La figure 7-1 illustra un esempio di struttura di cartelle con aree.</span><span class="sxs-lookup"><span data-stu-id="22270-255">Figure 7-1 shows an example folder structure, using Areas.</span></span>

![Organizzazione dell'area di esempio](./media/image7-1.png)

<span data-ttu-id="22270-257">**Figura 7-1**.</span><span class="sxs-lookup"><span data-stu-id="22270-257">**Figure 7-1**.</span></span> <span data-ttu-id="22270-258">Organizzazione dell'area di esempio</span><span class="sxs-lookup"><span data-stu-id="22270-258">Sample Area Organization</span></span>

<span data-ttu-id="22270-259">Quando si usano le aree, è necessario usare gli attributi per decorare i controller con il nome dell'area a cui appartengono:</span><span class="sxs-lookup"><span data-stu-id="22270-259">When using Areas, you must use attributes to decorate your controllers with the name of the area to which they belong:</span></span>

```csharp
[Area("Catalog")]
public class HomeController
{}
```

<span data-ttu-id="22270-260">È anche necessario aggiungere il supporto delle aree alle route:</span><span class="sxs-lookup"><span data-stu-id="22270-260">You also need to add area support to your routes:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "areaRoute", pattern: "{area:exists}/{controller=Home}/{action=Index}/{id?}");
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="22270-261">Oltre al supporto incorporato per le aree, è possibile usare anche la propria struttura di cartelle e le convenzioni al posto di attributi e route personalizzate.</span><span class="sxs-lookup"><span data-stu-id="22270-261">In addition to the built-in support for Areas, you can also use your own folder structure, and conventions in place of attributes and custom routes.</span></span> <span data-ttu-id="22270-262">Ciò consentirebbe di avere cartelle di funzionalità che non includano cartelle separate per le visualizzazioni, i controller e così via, creando in questo modo una gerarchia più piana e rendendo più semplice visualizzare tutti i file correlati in un'unica posizione per ogni funzionalità.</span><span class="sxs-lookup"><span data-stu-id="22270-262">This would allow you to have feature folders that didn't include separate folders for Views, Controllers, etc., keeping the hierarchy flatter and making it easier to see all related files in a single place for each feature.</span></span>

<span data-ttu-id="22270-263">ASP.NET Core usa tipi convenzione predefiniti per controllare il comportamento.</span><span class="sxs-lookup"><span data-stu-id="22270-263">ASP.NET Core uses built-in convention types to control its behavior.</span></span> <span data-ttu-id="22270-264">È possibile modificare o sostituire queste convenzioni.</span><span class="sxs-lookup"><span data-stu-id="22270-264">You can modify or replace these conventions.</span></span> <span data-ttu-id="22270-265">Ad esempio, è possibile creare una convenzione che ottiene automaticamente il nome della funzionalità per un controller specifico in base al relativo spazio dei nomi (che in genere è correlato alla cartella in cui si trova il controller):</span><span class="sxs-lookup"><span data-stu-id="22270-265">For example, you can create a convention that will automatically get the feature name for a given controller based on its namespace (which typically correlates to the folder in which the controller is located):</span></span>

```csharp
public class FeatureConvention : IControllerModelConvention
{
    public void Apply(ControllerModel controller)
    {
        controller.Properties.Add("feature",
        GetFeatureName(controller.ControllerType));
    }

    private string GetFeatureName(TypeInfo controllerType)
    {
        string[] tokens = controllerType.FullName.Split('.');
        if (!tokens.Any(t => t == "Features")) return "";
        string featureName = tokens
        .SkipWhile(t => !t.Equals("features",
        StringComparison.CurrentCultureIgnoreCase))
        .Skip(1)
        .Take(1)
        .FirstOrDefault();
        return featureName;
    }
}
```

<span data-ttu-id="22270-266">Specificare quindi questa convenzione come opzione quando si aggiunge il supporto per MVC all'applicazione in ConfigureServices:</span><span class="sxs-lookup"><span data-stu-id="22270-266">You then specify this convention as an option when you add support for MVC to your application in ConfigureServices:</span></span>

```csharp
services.AddMvc(o => o.Conventions.Add(new FeatureConvention()));
```

<span data-ttu-id="22270-267">ASP.NET Core MVC usa una convenzione anche per individuare le visualizzazioni.</span><span class="sxs-lookup"><span data-stu-id="22270-267">ASP.NET Core MVC also uses a convention to locate views.</span></span> <span data-ttu-id="22270-268">Questa convenzione può essere sostituita con una convenzione personalizzata in modo che le visualizzazioni vengano inserite nelle cartelle delle funzionalità (usando il nome della funzionalità specificato da FeatureConvention).</span><span class="sxs-lookup"><span data-stu-id="22270-268">You can override it with a custom convention so that views will be located in your feature folders (using the feature name provided by the FeatureConvention, above).</span></span> <span data-ttu-id="22270-269">È possibile ottenere ulteriori informazioni su questo approccio e scaricare un esempio funzionante dall'articolo di MSDN Magazine, [Feature Slices for ASP.NET Core MVC](https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span><span class="sxs-lookup"><span data-stu-id="22270-269">You can learn more about this approach and download a working sample from the MSDN Magazine article, [Feature Slices for ASP.NET Core MVC](https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span></span>

### <a name="cross-cutting-concerns"></a><span data-ttu-id="22270-270">Problematiche trasversali</span><span class="sxs-lookup"><span data-stu-id="22270-270">Cross-cutting concerns</span></span>

<span data-ttu-id="22270-271">Con l'aumento delle dimensioni delle applicazioni, diventa sempre più importante evitare i problemi di cross-cutting per eliminare la duplicazione e mantenere la coerenza.</span><span class="sxs-lookup"><span data-stu-id="22270-271">As applications grow, it becomes increasingly important to factor out cross-cutting concerns to eliminate duplication and maintain consistency.</span></span> <span data-ttu-id="22270-272">Alcuni esempi di problemi di cross-cutting nelle applicazioni ASP.NET Core sono, tra gli altri, l'autenticazione, le regole di convalida del modello, la memorizzazione nella cache dell'output e la gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="22270-272">Some examples of cross-cutting concerns in ASP.NET Core applications are authentication, model validation rules, output caching, and error handling, though there are many others.</span></span> <span data-ttu-id="22270-273">I [filtri](/aspnet/core/mvc/controllers/filters) di ASP.NET Core MVC consentono di eseguire codice prima o dopo determinate fasi della pipeline di elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-273">ASP.NET Core MVC [filters](/aspnet/core/mvc/controllers/filters) allow you to run code before or after certain steps in the request processing pipeline.</span></span> <span data-ttu-id="22270-274">Ad esempio, un filtro può essere eseguito prima e dopo l'associazione di modelli, prima e dopo un'azione o prima e dopo il risultato di un'azione.</span><span class="sxs-lookup"><span data-stu-id="22270-274">For instance, a filter can run before and after model binding, before and after an action, or before and after an action's result.</span></span> <span data-ttu-id="22270-275">È anche possibile usare un filtro di autorizzazione per controllare l'accesso alla parte rimanente della pipeline.</span><span class="sxs-lookup"><span data-stu-id="22270-275">You can also use an authorization filter to control access to the rest of the pipeline.</span></span> <span data-ttu-id="22270-276">La figura 7-2 mostra l'esecuzione della richiesta attraverso i filtri, se configurati.</span><span class="sxs-lookup"><span data-stu-id="22270-276">Figures 7-2 shows how request execution flows through filters, if configured.</span></span>

![La richiesta passa attraverso i filtri autorizzazione, i filtri risorse, l'associazione di modelli, i filtri azione, l'esecuzione dell'azione e la conversione del risultato dell'azione, i filtri eccezioni, i filtri risultato e l'esecuzione del risultato.](./media/image7-2.png)

<span data-ttu-id="22270-279">**Figura 7-2**.</span><span class="sxs-lookup"><span data-stu-id="22270-279">**Figure 7-2**.</span></span> <span data-ttu-id="22270-280">Richiedere l'esecuzione tramite filtri e pipeline di richieste.</span><span class="sxs-lookup"><span data-stu-id="22270-280">Request execution through filters and request pipeline.</span></span>

<span data-ttu-id="22270-281">I filtri vengono in genere implementati come attributi, quindi è possibile applicarli a controller o azioni (o persino a livello globale).</span><span class="sxs-lookup"><span data-stu-id="22270-281">Filters are usually implemented as attributes, so you can apply them to controllers or actions (or even globally).</span></span> <span data-ttu-id="22270-282">Quando vengono aggiunti in questo modo, i filtri specificati a livello di azione sostituiscono o sono basati sui filtri specificati a livello di controller che a loro volta sostituiscono i filtri globali.</span><span class="sxs-lookup"><span data-stu-id="22270-282">When added in this fashion, filters specified at the action level override or build upon filters specified at the controller level, which themselves override global filters.</span></span> <span data-ttu-id="22270-283">È possibile ad esempio usare l'attributo \[Route\] per creare route tra i controller e le azioni.</span><span class="sxs-lookup"><span data-stu-id="22270-283">For example, the \[Route\] attribute can be used to build up routes between controllers and actions.</span></span> <span data-ttu-id="22270-284">Analogamente, l'autorizzazione può essere configurata a livello di controller e quindi sostituita da singole azioni, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="22270-284">Likewise, authorization can be configured at the controller level, and then overridden by individual actions, as the following sample demonstrates:</span></span>

```csharp
[Authorize]
public class AccountController : Controller

{
    [AllowAnonymous] // overrides the Authorize attribute
    public async Task<IActionResult> Login() {}
    public async Task<IActionResult> ForgotPassword() {}
}
```

<span data-ttu-id="22270-285">Il primo metodo, Login, usa il filtro AllowAnonymous (attributo) per sostituire il filtro Authorize impostato a livello di controller.</span><span class="sxs-lookup"><span data-stu-id="22270-285">The first method, Login, uses the AllowAnonymous filter (attribute) to override the Authorize filter set at the controller level.</span></span> <span data-ttu-id="22270-286">L'azione ForgotPassword (e qualsiasi altra azione nella classe che non ha un attributo AllowAnonymous) richiederà una richiesta autenticata.</span><span class="sxs-lookup"><span data-stu-id="22270-286">The ForgotPassword action (and any other action in the class that doesn't have an AllowAnonymous attribute) will require an authenticated request.</span></span>

<span data-ttu-id="22270-287">È possibile usare i filtri per eliminare la duplicazione come criteri di gestione degli errori comuni delle API.</span><span class="sxs-lookup"><span data-stu-id="22270-287">Filters can be used to eliminate duplication in the form of common error handling policies for APIs.</span></span> <span data-ttu-id="22270-288">Ad esempio, un criterio di API tipico consiste nel restituire una risposta NotFound alle richieste che fanno riferimento a chiavi non esistenti e una risposta BadRequest nei casi in cui la convalida del modello ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="22270-288">For example, a typical API policy is to return a NotFound response to requests referencing keys that do not exist, and a BadRequest response if model validation fails.</span></span> <span data-ttu-id="22270-289">L'esempio seguente illustrate questi due criteri:</span><span class="sxs-lookup"><span data-stu-id="22270-289">The following example demonstrates these two policies in action:</span></span>

```csharp
[HttpPut("{id}")]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    if ((await _authorRepository.ListAsync()).All(a => a.Id != id))
    {
        return NotFound(id);
    }
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    author.Id = id;
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="22270-290">Evitare che i metodi di azione diventino troppo pieni con codice condizionale di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="22270-290">Don't allow your action methods to become cluttered with conditional code like this.</span></span> <span data-ttu-id="22270-291">Eseguire invece il pull dei criteri nei filtri che possono essere applicati quando necessario.</span><span class="sxs-lookup"><span data-stu-id="22270-291">Instead, pull the policies into filters that can be applied on an as-needed basis.</span></span> <span data-ttu-id="22270-292">In questo esempio, il controllo di convalida del modello, che deve essere eseguito ogni volta che un comando viene inviato all'API, può essere sostituito dall'attributo seguente:In this example, the model validation check, which should occur anytime a command is sent to the API, can be replaced by the following attribute:</span><span class="sxs-lookup"><span data-stu-id="22270-292">In this example, the model validation check, which should occur anytime a command is sent to the API, can be replaced by the following attribute:</span></span>

```csharp
public class ValidateModelAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext context)
    {
        if (!context.ModelState.IsValid)
        {
            context.Result = new BadRequestObjectResult(context.ModelState);
        }
    }
}
```

<span data-ttu-id="22270-293">È possibile aggiungere `ValidateModelAttribute` al progetto come dipendenza NuGet includendo il pacchetto [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel).</span><span class="sxs-lookup"><span data-stu-id="22270-293">You can add the `ValidateModelAttribute` to your project as a NuGet dependency by including the [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel) package.</span></span> <span data-ttu-id="22270-294">Per le API è possibile usare l'attributo `ApiController` per applicare questo comportamento senza la necessità di un filtro `ValidateModel` separato.</span><span class="sxs-lookup"><span data-stu-id="22270-294">For APIs, you can use the `ApiController` attribute to enforce this behavior without the need for a separate `ValidateModel` filter.</span></span>

<span data-ttu-id="22270-295">Analogamente, è possibile usare un filtro per verificare l'esistenza di un record e restituire un errore 404 prima che venga eseguita l'azione, eliminando la necessità di eseguire questi controlli nell'azione.</span><span class="sxs-lookup"><span data-stu-id="22270-295">Likewise, a filter can be used to check if a record exists and return a 404 before the action is executed, eliminating the need to perform these checks in the action.</span></span> <span data-ttu-id="22270-296">Dopo aver estratto le convenzioni comuni e aver organizzato la soluzione per separare il codice dell'infrastruttura e la logica di business dall'interfaccia utente, i metodi delle azioni MVC dovrebbero essere estremamente snelli:</span><span class="sxs-lookup"><span data-stu-id="22270-296">Once you've pulled out common conventions and organized your solution to separate infrastructure code and business logic from your UI, your MVC action methods should be extremely thin:</span></span>

```csharp
[HttpPut("{id}")]
[ValidateAuthorExists]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="22270-297">Per ulteriori informazioni sull'implementazione dei filtri e sul download di un esempio funzionante, vedere l'articolo di MSDN Magazine [Real-World ASP.NET Core MVC](https://docs.microsoft.com/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span><span class="sxs-lookup"><span data-stu-id="22270-297">You can read more about implementing filters and download a working sample from the MSDN Magazine article, [Real-World ASP.NET Core MVC Filters](https://docs.microsoft.com/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span></span>

> ### <a name="references--structuring-applications"></a><span data-ttu-id="22270-298">Riferimenti - Creazione della struttura delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="22270-298">References – Structuring applications</span></span>
>
> - <span data-ttu-id="22270-299">**Aree**</span><span class="sxs-lookup"><span data-stu-id="22270-299">**Areas**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/areas>
> - <span data-ttu-id="22270-300">**MSDN Magazine - Funzionalità Feature Slices per ASP.NET Core MVC**</span><span class="sxs-lookup"><span data-stu-id="22270-300">**MSDN Magazine – Feature Slices for ASP.NET Core MVC**</span></span>  
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc>
> - <span data-ttu-id="22270-301">**Filtri**</span><span class="sxs-lookup"><span data-stu-id="22270-301">**Filters**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters>
> - <span data-ttu-id="22270-302">**MSDN Magazine – Filtri MVC di base ASP.NET del mondo reale**</span><span class="sxs-lookup"><span data-stu-id="22270-302">**MSDN Magazine – Real World ASP.NET Core MVC Filters**</span></span>  
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters>

## <a name="security"></a><span data-ttu-id="22270-303">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="22270-303">Security</span></span>

<span data-ttu-id="22270-304">La protezione delle applicazioni Web è un argomento molto ampio con numerose considerazioni.</span><span class="sxs-lookup"><span data-stu-id="22270-304">Securing web applications is a large topic, with many considerations.</span></span> <span data-ttu-id="22270-305">A un livello di base, per garantire la sicurezza è necessario conoscere l'identità dell'utente da cui proviene una determinata richiesta e assicurarsi che la richiesta abbia accesso solo alle risorse necessarie.</span><span class="sxs-lookup"><span data-stu-id="22270-305">At its most basic level, security involves ensuring you know who a given request is coming from, and then ensuring that the request only has access to resources it should.</span></span> <span data-ttu-id="22270-306">L'autenticazione è il processo di confronto delle credenziali specificate con una richiesta con quelle di un archivio di dati attendibili per verificare se la richiesta deve essere trattata come proveniente da un'entità nota.</span><span class="sxs-lookup"><span data-stu-id="22270-306">Authentication is the process of comparing credentials provided with a request to those in a trusted data store, to see if the request should be treated as coming from a known entity.</span></span> <span data-ttu-id="22270-307">L'autorizzazione è il processo di limitazione dell'accesso a determinate risorse in base all'identità utente.</span><span class="sxs-lookup"><span data-stu-id="22270-307">Authorization is the process of restricting access to certain resources based on user identity.</span></span> <span data-ttu-id="22270-308">Un terzo aspetto relativo alla sicurezza è la protezione delle richieste dall'intercettazione da terze parti per cui è necessario [assicurarsi che l'applicazione usi SSL](/aspnet/core/security/enforcing-ssl).</span><span class="sxs-lookup"><span data-stu-id="22270-308">A third security concern is protecting requests from eavesdropping by third parties, for which you should at least [ensure that SSL is used by your application](/aspnet/core/security/enforcing-ssl).</span></span>

### <a name="authentication"></a><span data-ttu-id="22270-309">Authentication</span><span class="sxs-lookup"><span data-stu-id="22270-309">Authentication</span></span>

<span data-ttu-id="22270-310">ASP.NET Core Identity è un sistema di appartenenza che è possibile usare per supportare la funzionalità di accesso per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-310">ASP.NET Core Identity is a membership system you can use to support login functionality for your application.</span></span> <span data-ttu-id="22270-311">Include il supporto degli account utente locali e il supporto dei provider di accesso esterni come l'account Microsoft, Twitter, Facebook, Google e altri ancora.</span><span class="sxs-lookup"><span data-stu-id="22270-311">It has support for local user accounts as well as external login provider support from providers like Microsoft Account, Twitter, Facebook, Google, and more.</span></span> <span data-ttu-id="22270-312">Oltre a ASP.NET Core Identity, l'applicazione può usare l'autenticazione di Windows o un provider di identità di terze parti come [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span><span class="sxs-lookup"><span data-stu-id="22270-312">In addition to ASP.NET Core Identity, your application can use windows authentication, or a third-party identity provider like [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span></span>

<span data-ttu-id="22270-313">ASP.NET Core Identity è incluso nei nuovi modelli di progetto se l'opzione Account utente individuali è selezionata.</span><span class="sxs-lookup"><span data-stu-id="22270-313">ASP.NET Core Identity is included in new project templates if the Individual User Accounts option is selected.</span></span> <span data-ttu-id="22270-314">Questo modello include il supporto per la registrazione, l'accesso, gli accessi esterni, le password dimenticate e funzionalità aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="22270-314">This template includes support for registration, login, external logins, forgotten passwords, and additional functionality.</span></span>

![Selezionare Singoli account utente per avere l'identità preconfigurata](./media/image7-3.png)

<span data-ttu-id="22270-316">**Figura 7-3**.</span><span class="sxs-lookup"><span data-stu-id="22270-316">**Figure 7-3**.</span></span> <span data-ttu-id="22270-317">Selezionare Singoli account utente per avere Identity preconfigurata.</span><span class="sxs-lookup"><span data-stu-id="22270-317">Select Individual User Accounts to have Identity preconfigured.</span></span>

<span data-ttu-id="22270-318">Il supporto di Identity è configurato in Startup, sia in ConfigureServices che in Configure:</span><span class="sxs-lookup"><span data-stu-id="22270-318">Identity support is configured in Startup, both in ConfigureServices and Configure:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));
    services.AddIdentity<ApplicationUser, IdentityRole>()
    .AddEntityFrameworkStores<ApplicationDbContext>()
    .AddDefaultTokenProviders();
    services.AddMvc();
}

public void Configure(IApplicationBuilder app)
{
    app.UseStaticFiles();
    app.UseIdentity();
    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="22270-319">È importante che UseIdentity si trovi prima di UseMvc nel metodo Configure.</span><span class="sxs-lookup"><span data-stu-id="22270-319">It's important that UseIdentity appear before UseMvc in the Configure method.</span></span> <span data-ttu-id="22270-320">Quando si configura Identity in ConfigureServices, è possibile notare una chiamata ad AddDefaultTokenProviders.</span><span class="sxs-lookup"><span data-stu-id="22270-320">When configuring Identity in ConfigureServices, you'll notice a call to AddDefaultTokenProviders.</span></span> <span data-ttu-id="22270-321">La chiamata non è correlata ai token che possono essere usati per proteggere le connessioni Web, ma fa riferimento ai provider che creano prompt che è possibile inviare agli utenti tramite SMS o posta elettronica per la conferma dell'identità.</span><span class="sxs-lookup"><span data-stu-id="22270-321">This has nothing to do with tokens that may be used to secure web communications, but instead refers to providers that create prompts that can be sent to users via SMS or email in order for them to confirm their identity.</span></span>

<span data-ttu-id="22270-322">Per altre informazioni sulla [configurazione dell'autenticazione a due fattori](/aspnet/core/security/authentication/2fa) e l'[abilitazione di provider di accesso esterni](/aspnet/core/security/authentication/social/), vedere la documentazione ufficiale di ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="22270-322">You can learn more about [configuring two-factor authentication](/aspnet/core/security/authentication/2fa) and [enabling external login providers](/aspnet/core/security/authentication/social/) from the official ASP.NET Core docs.</span></span>

### <a name="authorization"></a><span data-ttu-id="22270-323">Autorizzazione</span><span class="sxs-lookup"><span data-stu-id="22270-323">Authorization</span></span>

<span data-ttu-id="22270-324">La forma di autorizzazione più semplice prevede la limitazione dell'accesso per gli utenti anonimi.</span><span class="sxs-lookup"><span data-stu-id="22270-324">The simplest form of authorization involves restricting access to anonymous users.</span></span> <span data-ttu-id="22270-325">La limitazione può essere ottenuta semplicemente applicando l'attributo \[Authorize\] a determinati controller o azioni.</span><span class="sxs-lookup"><span data-stu-id="22270-325">This can be achieved by simply applying the \[Authorize\] attribute to certain controllers or actions.</span></span> <span data-ttu-id="22270-326">Se vengono usati i ruoli, è possibile estendere ulteriormente l'attributo per limitare l'accesso agli utenti che appartengono a determinati ruoli, come illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="22270-326">If roles are being used, the attribute can be further extended to restrict access to users who belong to certain roles, as shown:</span></span>

```csharp
[Authorize(Roles = "HRManager,Finance")]
public class SalaryController : Controller
{

}
```

<span data-ttu-id="22270-327">In questo caso gli utenti che appartengono al ruolo HRManager o Finance o a entrambi i ruoli hanno accesso a SalaryController.</span><span class="sxs-lookup"><span data-stu-id="22270-327">In this case, users belonging to either the HRManager or Finance roles (or both) would have access to the SalaryController.</span></span> <span data-ttu-id="22270-328">Per richiedere l'appartenenza di un utente a più ruoli e non a un solo ruolo, è possibile applicare l'attributo più volte specificando ogni volta il ruolo richiesto.</span><span class="sxs-lookup"><span data-stu-id="22270-328">To require that a user belong to multiple roles (not just one of several), you can apply the attribute multiple times, specifying a required role each time.</span></span>

<span data-ttu-id="22270-329">La specifica di determinati set di ruoli come stringhe in diversi controller e azioni può causare una ripetizione indesiderata.</span><span class="sxs-lookup"><span data-stu-id="22270-329">Specifying certain sets of roles as strings in many different controllers and actions can lead to undesirable repetition.</span></span> <span data-ttu-id="22270-330">È possibile configurare criteri di autorizzazione che incapsulano regole di autorizzazione e quindi specificare i criteri anziché i singoli ruoli durante l'applicazione dell'attributo \[Authorize\]:</span><span class="sxs-lookup"><span data-stu-id="22270-330">You can configure authorization policies, which encapsulate authorization rules, and then specify the policy instead of individual roles when applying the \[Authorize\] attribute:</span></span>

```csharp
[Authorize(Policy = "CanViewPrivateReport")]
public IActionResult ExecutiveSalaryReport()
{
    return View();
}
```

<span data-ttu-id="22270-331">Questa modalità di utilizzo dei criteri consente di suddividere i tipi di azione limitati dai ruoli o dalle regole specifiche applicate.</span><span class="sxs-lookup"><span data-stu-id="22270-331">Using policies in this way, you can separate the kinds of actions being restricted from the specific roles or rules that apply to it.</span></span> <span data-ttu-id="22270-332">In seguito, se si crea un nuovo ruolo che necessita dell'accesso a determinate risorse, sarà sufficiente aggiornare i criteri anziché aggiornare ogni elenco di ruoli in ogni attributo \[Authorize\].</span><span class="sxs-lookup"><span data-stu-id="22270-332">Later, if you create a new role that needs to have access to certain resources, you can just update a policy, rather than updating every list of roles on every \[Authorize\] attribute.</span></span>

#### <a name="claims"></a><span data-ttu-id="22270-333">Claims</span><span class="sxs-lookup"><span data-stu-id="22270-333">Claims</span></span>

<span data-ttu-id="22270-334">Le attestazioni sono coppie nome-valore che rappresentano le proprietà di un utente autenticato.</span><span class="sxs-lookup"><span data-stu-id="22270-334">Claims are name value pairs that represent properties of an authenticated user.</span></span> <span data-ttu-id="22270-335">Ad esempio, è possibile archiviare il numero di dipendente degli utenti come attestazione.</span><span class="sxs-lookup"><span data-stu-id="22270-335">For example, you might store users' employee number as a claim.</span></span> <span data-ttu-id="22270-336">Le attestazioni possono quindi essere usate come parte dei criteri di autorizzazione.</span><span class="sxs-lookup"><span data-stu-id="22270-336">Claims can then be used as part of authorization policies.</span></span> <span data-ttu-id="22270-337">È possibile creare un criterio denominato "EmployeeOnly" che richiede l'esistenza di un'attestazione denominata "EmployeeNumber", come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="22270-337">You could create a policy called "EmployeeOnly" that requires the existence of a claim called "EmployeeNumber", as shown in this example:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    services.AddAuthorization(options =>
    {
        options.AddPolicy("EmployeeOnly", policy => policy.RequireClaim("EmployeeNumber"));
    });
}
```

<span data-ttu-id="22270-338">Questo criterio può quindi essere usato con l'attributo \[Authorize\] per proteggere qualsiasi controller e/o azione, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="22270-338">This policy could then be used with the \[Authorize\] attribute to protect any controller and/or action, as described above.</span></span>

#### <a name="securing-web-apis"></a><span data-ttu-id="22270-339">Protezione delle API Web</span><span class="sxs-lookup"><span data-stu-id="22270-339">Securing web APIs</span></span>

<span data-ttu-id="22270-340">La maggior parte delle API Web deve implementare un sistema di autenticazione basato su token.</span><span class="sxs-lookup"><span data-stu-id="22270-340">Most web APIs should implement a token-based authentication system.</span></span> <span data-ttu-id="22270-341">L'autenticazione del token è progettata per essere scalabile e senza stato.</span><span class="sxs-lookup"><span data-stu-id="22270-341">Token authentication is stateless and designed to be scalable.</span></span> <span data-ttu-id="22270-342">In un sistema di autenticazione basato su token, è necessario che il client esegua prima l'autenticazione nel provider di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="22270-342">In a token-based authentication system, the client must first authenticate with the authentication provider.</span></span> <span data-ttu-id="22270-343">Se l'autenticazione ha esito positivo, per il client viene emesso un token che è costituito semplicemente da una stringa di caratteri crittograficamente significativa.</span><span class="sxs-lookup"><span data-stu-id="22270-343">If successful, the client is issued a token, which is simply a cryptographically meaningful string of characters.</span></span> <span data-ttu-id="22270-344">Per inviare una richiesta a un'API, il client aggiunge il token come intestazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-344">When the client then needs to issue a request to an API, it adds this token as a header on the request.</span></span> <span data-ttu-id="22270-345">Il server convalida il token individuato nell'intestazione della richiesta prima di eseguire la richiesta.</span><span class="sxs-lookup"><span data-stu-id="22270-345">The server then validates the token found in the request header before completing the request.</span></span> <span data-ttu-id="22270-346">La figura 7-4 illustra questo processo.</span><span class="sxs-lookup"><span data-stu-id="22270-346">Figure 7-4 demonstrates this process.</span></span>

![TokenAuth](./media/image7-4.png)

<span data-ttu-id="22270-348">**Figura 7-4.**</span><span class="sxs-lookup"><span data-stu-id="22270-348">**Figure 7-4.**</span></span> <span data-ttu-id="22270-349">Autenticazione basata su token per le API Web.</span><span class="sxs-lookup"><span data-stu-id="22270-349">Token-based authentication for Web APIs.</span></span>

<span data-ttu-id="22270-350">È possibile creare il proprio servizio di autenticazione, integrarsi con Azure AD e OAuth o implementare un servizio usando uno strumento open source come [IdentityServer](https://github.com/IdentityServer).</span><span class="sxs-lookup"><span data-stu-id="22270-350">You can create your own authentication service, integrate with Azure AD and OAuth, or implement a service using an open-source tool like [IdentityServer](https://github.com/IdentityServer).</span></span>

#### <a name="custom-security"></a><span data-ttu-id="22270-351">Sicurezza personalizzata</span><span class="sxs-lookup"><span data-stu-id="22270-351">Custom Security</span></span>

<span data-ttu-id="22270-352">Prestare particolare attenzione alle implementazioni personalizzate della crittografia, dell'appartenenza degli utenti o del sistema di generazione di token.</span><span class="sxs-lookup"><span data-stu-id="22270-352">Be especially careful about "rolling your own" implementation of cryptography, user membership, or token generation system.</span></span> <span data-ttu-id="22270-353">Esistono molte alternative commerciali e open source che nella maggior parte dei casi offrono una sicurezza migliore rispetto a quella di un'implementazione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="22270-353">There are many commercial and open-source alternatives available, which will almost certainly have better security than a custom implementation.</span></span>

> ### <a name="references--security"></a><span data-ttu-id="22270-354">Riferimenti - Sicurezza</span><span class="sxs-lookup"><span data-stu-id="22270-354">References – Security</span></span>
>
> - <span data-ttu-id="22270-355">**Panoramica della documentazione sulla sicurezza**</span><span class="sxs-lookup"><span data-stu-id="22270-355">**Security Docs Overview**</span></span>  
>   https://docs.microsoft.com/aspnet/core/security/
> - <span data-ttu-id="22270-356">**Applicazione di SSL in un'app ASP.NET Core**</span><span class="sxs-lookup"><span data-stu-id="22270-356">**Enforcing SSL in an ASP.NET Core App**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/enforcing-ssl>
> - <span data-ttu-id="22270-357">**Introduzione a Identity**</span><span class="sxs-lookup"><span data-stu-id="22270-357">**Introduction to Identity**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity>
> - <span data-ttu-id="22270-358">**Introduzione alle autorizzazioni**</span><span class="sxs-lookup"><span data-stu-id="22270-358">**Introduction to Authorization**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/security/authorization/introduction>
> - <span data-ttu-id="22270-359">**Autenticazione e autorizzazione per app per le API nel servizio app di Azure**</span><span class="sxs-lookup"><span data-stu-id="22270-359">**Authentication and Authorization for API Apps in Azure App Service**</span></span>  
>   <https://docs.microsoft.com/azure/app-service-api/app-service-api-authentication>
> - <span data-ttu-id="22270-360">**Identity Server**</span><span class="sxs-lookup"><span data-stu-id="22270-360">**Identity Server**</span></span>  
>   <https://github.com/IdentityServer>

## <a name="client-communication"></a><span data-ttu-id="22270-361">Comunicazione con i client</span><span class="sxs-lookup"><span data-stu-id="22270-361">Client communication</span></span>

<span data-ttu-id="22270-362">Oltre a visualizzare le pagine e a rispondere alle richieste di dati tramite le API Web, le app ASP.NET Core possono comunicare direttamente con i client connessi.</span><span class="sxs-lookup"><span data-stu-id="22270-362">In addition to serving pages and responding to requests for data via web APIs, ASP.NET Core apps can communicate directly with connected clients.</span></span> <span data-ttu-id="22270-363">Questa comunicazione in uscita può usare diverse tecnologie di trasporto, tra cui la più comune sono i WebSocket.</span><span class="sxs-lookup"><span data-stu-id="22270-363">This outbound communication can use a variety of transport technologies, the most common being WebSockets.</span></span> <span data-ttu-id="22270-364">ASP.NET ASP.NET Core SignalR è una libreria che semplifica l'aggiunta della funzionalità di comunicazione da server a client in tempo reale alle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="22270-364">ASP.NET Core SignalR is a library that makes it simple to add real-time server-to-client communication functionality to your applications.</span></span> <span data-ttu-id="22270-365">SignalR supporta diverse tecnologie di trasporto, inclusi i WebSocket, ed elimina molti dei dettagli di implementazione specificati dallo sviluppatore.</span><span class="sxs-lookup"><span data-stu-id="22270-365">SignalR supports a variety of transport technologies, including WebSockets, and abstracts away many of the implementation details from the developer.</span></span>

<span data-ttu-id="22270-366">La comunicazione con il client in tempo reale, con l'utilizzo diretto di WebSocket o altre tecniche, è utile in diversi scenari di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="22270-366">Real-time client communication, whether using WebSockets directly or other techniques, are useful in a variety of application scenarios.</span></span> <span data-ttu-id="22270-367">Di seguito sono riportati alcuni esempi:</span><span class="sxs-lookup"><span data-stu-id="22270-367">Some examples include:</span></span>

- <span data-ttu-id="22270-368">Applicazioni live chat room</span><span class="sxs-lookup"><span data-stu-id="22270-368">Live chat room applications</span></span>

- <span data-ttu-id="22270-369">Applicazioni di monitoraggio</span><span class="sxs-lookup"><span data-stu-id="22270-369">Monitoring applications</span></span>

- <span data-ttu-id="22270-370">Aggiornamenti dello stato di processo</span><span class="sxs-lookup"><span data-stu-id="22270-370">Job progress updates</span></span>

- <span data-ttu-id="22270-371">Notifiche</span><span class="sxs-lookup"><span data-stu-id="22270-371">Notifications</span></span>

- <span data-ttu-id="22270-372">Applicazioni di moduli interattivi</span><span class="sxs-lookup"><span data-stu-id="22270-372">Interactive forms applications</span></span>

<span data-ttu-id="22270-373">Quando si definisce la comunicazione con i client nelle applicazioni, vengono in genere usati due componenti:</span><span class="sxs-lookup"><span data-stu-id="22270-373">When building client communication into your applications, there are typically two components:</span></span>

- <span data-ttu-id="22270-374">Gestione della connessione sul lato server (hub SignalR, WebSocketManager, WebSocketHandler)</span><span class="sxs-lookup"><span data-stu-id="22270-374">Server-side connection manager (SignalR Hub, WebSocketManager WebSocketHandler)</span></span>

- <span data-ttu-id="22270-375">Libreria lato client</span><span class="sxs-lookup"><span data-stu-id="22270-375">Client-side library</span></span>

<span data-ttu-id="22270-376">I client non sono costituiti solo da browser. Anche le app per dispositivi mobili, le app della console e altre app native possono comunicare tramite SignalR/WebSocket.</span><span class="sxs-lookup"><span data-stu-id="22270-376">Clients aren't limited to browsers – mobile apps, console apps, and other native apps can also communicate using SignalR/WebSockets.</span></span> <span data-ttu-id="22270-377">Il semplice programma seguente ripete tutto il contenuto inviato a un'applicazione chat alla console, come parte di un'applicazione di esempio WebSocketManager:</span><span class="sxs-lookup"><span data-stu-id="22270-377">The following simple program echoes all content sent to a chat application to the console, as part of a WebSocketManager sample application:</span></span>

```csharp
public class Program
{
    private static Connection _connection;
    public static void Main(string[] args)
    {
        StartConnectionAsync();
        _connection.On("receiveMessage", (arguments) =>
        {
            Console.WriteLine($"{arguments[0]} said: {arguments[1]}");
        });
        Console.ReadLine();
        StopConnectionAsync();
    }

    public static async Task StartConnectionAsync()
    {
        _connection = new Connection();
        await _connection.StartConnectionAsync("ws://localhost:65110/chat");
    }

    public static async Task StopConnectionAsync()
    {
        await _connection.StopConnectionAsync();
    }
}
```

<span data-ttu-id="22270-378">Esaminare i modi in cui le applicazioni comunicano direttamente con le applicazioni client e considerare se la comunicazione in tempo reale migliorerebbe l'esperienza utente dell'app.</span><span class="sxs-lookup"><span data-stu-id="22270-378">Consider ways in which your applications communicate directly with client applications, and consider whether real-time communication would improve your app's user experience.</span></span>

> ### <a name="references--client-communication"></a><span data-ttu-id="22270-379">Riferimenti - Comunicazione con i client</span><span class="sxs-lookup"><span data-stu-id="22270-379">References – Client Communication</span></span>
>
> - <span data-ttu-id="22270-380">**ASP.NET Core SignalR**</span><span class="sxs-lookup"><span data-stu-id="22270-380">**ASP.NET Core SignalR**</span></span>  
>   <https://github.com/dotnet/aspnetcore/tree/master/src/SignalR>
> - <span data-ttu-id="22270-381">**WebSocket Manager**</span><span class="sxs-lookup"><span data-stu-id="22270-381">**WebSocket Manager**</span></span>  
>   https://github.com/radu-matei/websocket-manager

## <a name="domain-driven-design--should-you-apply-it"></a><span data-ttu-id="22270-382">Quando usare la progettazione basata su domini</span><span class="sxs-lookup"><span data-stu-id="22270-382">Domain-driven design – Should you apply it?</span></span>

<span data-ttu-id="22270-383">La progettazione basata su domini (Domain-Driven Design, DDD) è un approccio semplice alla creazione di software che pone l'attenzione sul _dominio aziendale_.</span><span class="sxs-lookup"><span data-stu-id="22270-383">Domain-Driven Design (DDD) is an agile approach to building software that emphasizes focusing on the _business domain_.</span></span> <span data-ttu-id="22270-384">Evidenzia in particolare la comunicazione e l'interazione con gli esperti dei domini aziendali che possono indicare agli sviluppatori come funziona il sistema nel mondo reale.</span><span class="sxs-lookup"><span data-stu-id="22270-384">It places a heavy emphasis on communication and interaction with business domain expert(s) who can relate to the developers how the real-world system works.</span></span> <span data-ttu-id="22270-385">Ad esempio, se si crea un sistema per la gestione dei titoli azionari, l'esperto del dominio potrebbe essere un agente di cambio.</span><span class="sxs-lookup"><span data-stu-id="22270-385">For example, if you're building a system that handles stock trades, your domain expert might be an experienced stock broker.</span></span> <span data-ttu-id="22270-386">La progettazione basata su domini (DDD) è indirizzata alla soluzione di problemi aziendali estesi e complessi e spesso non è adatta ad applicazioni più semplici e di piccole dimensioni poiché l'investimento nella conoscenza e nella modellazione del dominio potrebbe essere eccessivo.</span><span class="sxs-lookup"><span data-stu-id="22270-386">DDD is designed to address large, complex business problems, and is often not appropriate for smaller, simpler applications, as the investment in understanding and modeling the domain is not worth it.</span></span>

<span data-ttu-id="22270-387">Quando si compila un software seguendo un approccio DDD, è necessario che il team, inclusi gli utenti e i collaboratori non tecnici, sviluppi un _linguaggio universale_ per l'area dei problemi.</span><span class="sxs-lookup"><span data-stu-id="22270-387">When building software following a DDD approach, your team (including non-technical stakeholders and contributors) should develop a _ubiquitous language_ for the problem space.</span></span> <span data-ttu-id="22270-388">Ciò significa che è necessario usare la stessa terminologia per il concetto del mondo reale modellato, l'equivalente software ed eventuali strutture esistenti per il mantenimento del concetto, ad esempio le tabelle di database.</span><span class="sxs-lookup"><span data-stu-id="22270-388">That is, the same terminology should be used for the real-world concept being modeled, the software equivalent, and any structures that might exist to persist the concept (for example, database tables).</span></span> <span data-ttu-id="22270-389">Di conseguenza, i concetti descritti in linguaggio universale devono costituire la base del _modello di dominio_.</span><span class="sxs-lookup"><span data-stu-id="22270-389">Thus, the concepts described in the ubiquitous language should form the basis for your _domain model_.</span></span>

<span data-ttu-id="22270-390">Il modello di dominio è costituito da oggetti che interagiscono tra loro per rappresentare il comportamento del sistema.</span><span class="sxs-lookup"><span data-stu-id="22270-390">Your domain model is comprised of objects that interact with one another to represent the behavior of the system.</span></span> <span data-ttu-id="22270-391">Gli oggetti sono suddivisi nelle categorie seguenti:</span><span class="sxs-lookup"><span data-stu-id="22270-391">These objects may fall into the following categories:</span></span>

- <span data-ttu-id="22270-392">[Entità](https://deviq.com/entity/) che rappresentano gli oggetti con un thread di identità.</span><span class="sxs-lookup"><span data-stu-id="22270-392">[Entities](https://deviq.com/entity/), which represent objects with a thread of identity.</span></span> <span data-ttu-id="22270-393">Le entità sono in genere salvate in modo permanente con una chiave con cui possono essere recuperate in seguito.</span><span class="sxs-lookup"><span data-stu-id="22270-393">Entities are typically stored in persistence with a key by which they can later be retrieved.</span></span>

- <span data-ttu-id="22270-394">[Aggregazioni](https://deviq.com/aggregate-pattern/) che rappresentano gruppi di oggetti che devono essere salvati in modo permanente come unità.</span><span class="sxs-lookup"><span data-stu-id="22270-394">[Aggregates](https://deviq.com/aggregate-pattern/), which represent groups of objects that should be persisted as a unit.</span></span>

- <span data-ttu-id="22270-395">[Oggetti valore](https://deviq.com/value-object/) che rappresentano i concetti che possono essere confrontati mediante la somma dei valori delle relative proprietà.</span><span class="sxs-lookup"><span data-stu-id="22270-395">[Value objects](https://deviq.com/value-object/), which represent concepts that can be compared on the basis of the sum of their property values.</span></span> <span data-ttu-id="22270-396">Ad esempio, DateRange costituito da una data di inizio e di fine.</span><span class="sxs-lookup"><span data-stu-id="22270-396">For example, DateRange consisting of a start and end date.</span></span>

- <span data-ttu-id="22270-397">[Eventi del dominio](https://martinfowler.com/eaaDev/DomainEvent.html) che rappresentano operazioni eseguite all'interno del sistema di interesse ad altre parti del sistema.</span><span class="sxs-lookup"><span data-stu-id="22270-397">[Domain events](https://martinfowler.com/eaaDev/DomainEvent.html), which represent things happening within the system that are of interest to other parts of the system.</span></span>

<span data-ttu-id="22270-398">Un modello di dominio DDD deve incapsulare un comportamento complesso all'interno del modello.</span><span class="sxs-lookup"><span data-stu-id="22270-398">A DDD domain model should encapsulate complex behavior within the model.</span></span> <span data-ttu-id="22270-399">Le entità, in particolare, non devono essere semplici raccolte di proprietà.</span><span class="sxs-lookup"><span data-stu-id="22270-399">Entities, in particular, should not merely be collections of properties.</span></span> <span data-ttu-id="22270-400">Quando il modello di dominio non include il comportamento e rappresenta solo lo stato del sistema viene definito un [modello anemico](https://deviq.com/anemic-model/) non adatto per la progettazione DDD.</span><span class="sxs-lookup"><span data-stu-id="22270-400">When the domain model lacks behavior and merely represents the state of the system, it is said to be an [anemic model](https://deviq.com/anemic-model/), which is undesirable in DDD.</span></span>

<span data-ttu-id="22270-401">Oltre a questi tipi di modello, la progettazione DDD usa in genere un'ampia gamma di modelli:</span><span class="sxs-lookup"><span data-stu-id="22270-401">In addition to these model types, DDD typically employs a variety of patterns:</span></span>

- <span data-ttu-id="22270-402">[Repository](https://deviq.com/repository-pattern/), per fornire l'astrazione dei dettagli di persistenza.</span><span class="sxs-lookup"><span data-stu-id="22270-402">[Repository](https://deviq.com/repository-pattern/), for abstracting persistence details.</span></span>

- <span data-ttu-id="22270-403">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern), per incapsulare la creazione di oggetti complessi.</span><span class="sxs-lookup"><span data-stu-id="22270-403">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern), for encapsulating complex object creation.</span></span>

- <span data-ttu-id="22270-404">Eventi di dominio, per separare il comportamento dipendente dal comportamento di attivazione.</span><span class="sxs-lookup"><span data-stu-id="22270-404">Domain events, for decoupling dependent behavior from triggering behavior.</span></span>

- <span data-ttu-id="22270-405">[Servizi](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), per incapsulare un comportamento complesso e/o i dettagli di implementazione dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="22270-405">[Services](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), for encapsulating complex behavior and/or infrastructure implementation details.</span></span>

- <span data-ttu-id="22270-406">[Comando](https://en.wikipedia.org/wiki/Command_pattern), per separare l'invio dei comandi e l'esecuzione del comando.</span><span class="sxs-lookup"><span data-stu-id="22270-406">[Command](https://en.wikipedia.org/wiki/Command_pattern), for decoupling issuing commands and executing the command itself.</span></span>

- <span data-ttu-id="22270-407">[Specifica](https://deviq.com/specification-pattern/), per incapsulare i dettagli di query.</span><span class="sxs-lookup"><span data-stu-id="22270-407">[Specification](https://deviq.com/specification-pattern/), for encapsulating query details.</span></span>

<span data-ttu-id="22270-408">Con la progettazione DDD è inoltre consigliabile usare l'architettura "pulita" descritta in precedenza che offre l'accoppiamento libero, l'incapsulamento e un codice che può essere facilmente verificato tramite unit test.</span><span class="sxs-lookup"><span data-stu-id="22270-408">DDD also recommends the use of the Clean Architecture discussed previously, allowing for loose coupling, encapsulation, and code that can easily be verified using unit tests.</span></span>

### <a name="when-should-you-apply-ddd"></a><span data-ttu-id="22270-409">Quando applicare la progettazione basata su domini (DDD)</span><span class="sxs-lookup"><span data-stu-id="22270-409">When should you apply DDD</span></span>

<span data-ttu-id="22270-410">DDD è adatto ad applicazioni di grandi dimensioni con una complessità aziendale significativa (non solo tecnica).</span><span class="sxs-lookup"><span data-stu-id="22270-410">DDD is well suited to large applications with significant business (not just technical) complexity.</span></span> <span data-ttu-id="22270-411">L'applicazione deve richiedere la competenza degli esperti di dominio.</span><span class="sxs-lookup"><span data-stu-id="22270-411">The application should require the knowledge of domain experts.</span></span> <span data-ttu-id="22270-412">Deve inoltre essere presente un comportamento significativo nel modello di dominio stesso, che rappresenta le regole business e le interazioni e non si limita all'archiviazione e al recupero dello stato corrente dei diversi record dagli archivi dati.</span><span class="sxs-lookup"><span data-stu-id="22270-412">There should be significant behavior in the domain model itself, representing business rules and interactions beyond simply storing and retrieving the current state of various records from data stores.</span></span>

### <a name="when-shouldnt-you-apply-ddd"></a><span data-ttu-id="22270-413">Quando non applicare la progettazione basata su domini (DDD)</span><span class="sxs-lookup"><span data-stu-id="22270-413">When shouldn't you apply DDD</span></span>

<span data-ttu-id="22270-414">La progettazione DDD prevede investimenti nella modellazione, nell'architettura e nella comunicazione non sempre garantiti per le applicazioni di piccole dimensioni o le applicazioni CRUD (Create/Read/Update/Delete).</span><span class="sxs-lookup"><span data-stu-id="22270-414">DDD involves investments in modeling, architecture, and communication that may not be warranted for smaller applications or applications that are essentially just CRUD (create/read/update/delete).</span></span> <span data-ttu-id="22270-415">Se si sceglie un approccio basato sulla progettazione DDD per l'applicazione e si scopre che il dominio ha un modello anemico senza comportamento, potrebbe essere necessario cambiare approccio.</span><span class="sxs-lookup"><span data-stu-id="22270-415">If you choose to approach your application following DDD, but find that your domain has an anemic model with no behavior, you may need to rethink your approach.</span></span> <span data-ttu-id="22270-416">È possibile che l'applicazione non richieda la progettazione DDD oppure potrebbe essere necessario ricevere assistenza per effettuare il refactoring dell'applicazione in modo da incapsulare la logica di business nel modello di dominio anziché nel database o nell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="22270-416">Either your application may not need DDD, or you may need assistance refactoring your application to encapsulate business logic in the domain model, rather than in your database or user interface.</span></span>

<span data-ttu-id="22270-417">Un approccio ibrido potrebbe essere quello di usare la progettazione DDD solo per le aree transazionali o più complesse dell'applicazione e di non usarla per le parti più semplici CRUD o di sola lettura dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-417">A hybrid approach would be to only use DDD for the transactional or more complex areas of the application, but not for simpler CRUD or read-only portions of the application.</span></span> <span data-ttu-id="22270-418">Ad esempio, non sono necessari i vincoli di un'aggregazione quando si eseguono query sui dati per visualizzare un report o i dati di un dashboard.</span><span class="sxs-lookup"><span data-stu-id="22270-418">For instance, you needn't have the constraints of an Aggregate if you're querying data to display a report or to visualize data for a dashboard.</span></span> <span data-ttu-id="22270-419">Per questo tipo di requisiti è possibile avere un modello di lettura più semplice separato.</span><span class="sxs-lookup"><span data-stu-id="22270-419">It's perfectly acceptable to have a separate, simpler read model for such requirements.</span></span>

> ### <a name="references--domain-driven-design"></a><span data-ttu-id="22270-420">Riferimenti - Progettazione basata su domini (DDD)</span><span class="sxs-lookup"><span data-stu-id="22270-420">References – Domain-Driven Design</span></span>
>
> - <span data-ttu-id="22270-421">**DDD in Plain English (StackOverflow Answer)** (Progettazione basata su domini (risposta StackOverflow))</span><span class="sxs-lookup"><span data-stu-id="22270-421">**DDD in Plain English (StackOverflow Answer)**</span></span>  
>   <https://stackoverflow.com/questions/1222392/can-someone-explain-domain-driven-design-ddd-in-plain-english-please/1222488#1222488>

## <a name="deployment"></a><span data-ttu-id="22270-422">Distribuzione</span><span class="sxs-lookup"><span data-stu-id="22270-422">Deployment</span></span>

<span data-ttu-id="22270-423">Il processo di distribuzione di un'applicazione ASP.NET Core prevede alcuni passaggi, indipendentemente dalla posizione in cui verrà ospitata.</span><span class="sxs-lookup"><span data-stu-id="22270-423">There are a few steps involved in the process of deploying your ASP.NET Core application, regardless of where it will be hosted.</span></span> <span data-ttu-id="22270-424">Il primo passaggio consiste nel pubblicare l'applicazione, che può essere eseguita utilizzando il `dotnet publish` comando CLI.</span><span class="sxs-lookup"><span data-stu-id="22270-424">The first step is to publish the application, which can be done using the `dotnet publish` CLI command.</span></span> <span data-ttu-id="22270-425">Viene compilata l'applicazione e tutti i file necessari per eseguire l'applicazione vengono inseriti in una cartella specificata.</span><span class="sxs-lookup"><span data-stu-id="22270-425">This will compile the application and place all of the files needed to run the application into a designated folder.</span></span> <span data-ttu-id="22270-426">Per le distribuzioni da Visual Studio, questo passaggio viene eseguito automaticamente.</span><span class="sxs-lookup"><span data-stu-id="22270-426">When you deploy from Visual Studio, this step is performed for you automatically.</span></span> <span data-ttu-id="22270-427">La cartella di publish contiene i file con estensione exe e dll dell'applicazione e le relative dipendenze.</span><span class="sxs-lookup"><span data-stu-id="22270-427">The publish folder contains .exe and .dll files for the application and its dependencies.</span></span> <span data-ttu-id="22270-428">Un'applicazione indipendente includerà anche una versione del runtime .NET.</span><span class="sxs-lookup"><span data-stu-id="22270-428">A self-contained application will also include a version of the .NET runtime.</span></span> <span data-ttu-id="22270-429">Le applicazioni ASP.NET Core includeranno anche i file di configurazione, gli asset client statici e le visualizzazioni MVC.</span><span class="sxs-lookup"><span data-stu-id="22270-429">ASP.NET Core applications will also include configuration files, static client assets, and MVC views.</span></span>

<span data-ttu-id="22270-430">Le applicazioni ASP.NET Core sono applicazioni console che devono essere avviate all'avvio del server e riavviate in caso di arresto anomalo dell'applicazione o del server.</span><span class="sxs-lookup"><span data-stu-id="22270-430">ASP.NET Core applications are console applications that must be started when the server boots and restarted if the application (or server) crashes.</span></span> <span data-ttu-id="22270-431">È possibile usare un'utilità di gestione dei processi per automatizzare questo processo.</span><span class="sxs-lookup"><span data-stu-id="22270-431">A process manager can be used to automate this process.</span></span> <span data-ttu-id="22270-432">Le utilità di gestione dei processi più comuni per ASP.NET Core sono Nginx e Apache in Linux e IIS o Windows Service in Windows.</span><span class="sxs-lookup"><span data-stu-id="22270-432">The most common process managers for ASP.NET Core are Nginx and Apache on Linux and IIS or Windows Service on Windows.</span></span>

<span data-ttu-id="22270-433">Oltre a un gestore di processi, ASP.NET applicazioni Core possono utilizzare un server proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="22270-433">In addition to a process manager, ASP.NET Core applications may use a reverse proxy server.</span></span> <span data-ttu-id="22270-434">Un server proxy inverso riceve le richieste HTTP da Internet e le inoltra a Kestrel dopo alcune operazioni di gestione preliminari.</span><span class="sxs-lookup"><span data-stu-id="22270-434">A reverse proxy server receives HTTP requests from the Internet and forwards them to Kestrel after some preliminary handling.</span></span> <span data-ttu-id="22270-435">I server proxy inversi forniscono un livello di sicurezza per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="22270-435">Reverse proxy servers provide a layer of security for the application.</span></span> <span data-ttu-id="22270-436">Inoltre, poiché Kestrel non supporta l'hosting di più applicazioni sulla stessa porta, non è possibile usare tecniche come le intestazioni host per abilitare l'hosting di più applicazioni sulla stessa porta e sullo stesso indirizzo IP.</span><span class="sxs-lookup"><span data-stu-id="22270-436">Kestrel also doesn't support hosting multiple applications on the same port, so techniques like host headers cannot be used with it to enable hosting multiple applications on the same port and IP address.</span></span>

![Kestrel in Internet](./media/image7-5.png)

<span data-ttu-id="22270-438">**Figura 7-5.**</span><span class="sxs-lookup"><span data-stu-id="22270-438">**Figure 7-5**.</span></span> <span data-ttu-id="22270-439">ASP.NET ospitati in Kestrel dietro un server proxy inverso</span><span class="sxs-lookup"><span data-stu-id="22270-439">ASP.NET hosted in Kestrel behind a reverse proxy server</span></span>

<span data-ttu-id="22270-440">Un proxy inverso può risultare utile anche in uno scenario in cui è necessario proteggere più applicazioni con SSL e HTTPS.</span><span class="sxs-lookup"><span data-stu-id="22270-440">Another scenario in which a reverse proxy can be helpful is to secure multiple applications using SSL/HTTPS.</span></span> <span data-ttu-id="22270-441">In questo caso è necessario configurare SSL solo per il proxy inverso.</span><span class="sxs-lookup"><span data-stu-id="22270-441">In this case, only the reverse proxy would need to have SSL configured.</span></span> <span data-ttu-id="22270-442">La comunicazione tra il server proxy inverso e Kestrel può avvenire su HTTP, come illustrato nella figura 7-6.</span><span class="sxs-lookup"><span data-stu-id="22270-442">Communication between the reverse proxy server and Kestrel could take place over HTTP, as shown in Figure 7-6.</span></span>

![ASP.NET ospitato dietro un server proxy inverso protetto da HTTPS](./media/image7-6.png)

<span data-ttu-id="22270-444">**Figura 7-6**.</span><span class="sxs-lookup"><span data-stu-id="22270-444">**Figure 7-6**.</span></span> <span data-ttu-id="22270-445">ASP.NET ospitato dietro un server proxy inverso protetto da HTTPS</span><span class="sxs-lookup"><span data-stu-id="22270-445">ASP.NET hosted behind an HTTPS-secured reverse proxy server</span></span>

<span data-ttu-id="22270-446">Un approccio sempre più diffuso consiste nell'ospitare l'applicazione ASP.NET Core in un contenitore Docker che può essere ospitato in locale o distribuito in Azure per l'hosting basato su cloud.</span><span class="sxs-lookup"><span data-stu-id="22270-446">An increasingly popular approach is to host your ASP.NET Core application in a Docker container, which then can be hosted locally or deployed to Azure for cloud-based hosting.</span></span> <span data-ttu-id="22270-447">Il contenitore Docker può contenere il codice dell'applicazione in esecuzione su Kestrel e può essere distribuito in un server proxy inverso, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="22270-447">The Docker container could contain your application code, running on Kestrel, and would be deployed behind a reverse proxy server, as shown above.</span></span>

<span data-ttu-id="22270-448">Se l'applicazione è ospitata in Azure, è possibile usare il gateway applicazione di Microsoft Azure come appliance virtuale dedicata per offrire servizi diversi.</span><span class="sxs-lookup"><span data-stu-id="22270-448">If you're hosting your application on Azure, you can use Microsoft Azure Application Gateway as a dedicated virtual appliance to provide several services.</span></span> <span data-ttu-id="22270-449">Oltre a svolgere la funzione di proxy inverso per le singole applicazioni, il gateway applicazione può offrire anche le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="22270-449">In addition to acting as a reverse proxy for individual applications, Application Gateway can also offer the following features:</span></span>

- <span data-ttu-id="22270-450">Bilanciamento del carico HTTP</span><span class="sxs-lookup"><span data-stu-id="22270-450">HTTP load balancing</span></span>

- <span data-ttu-id="22270-451">Ripartizione del carico di lavoro SSL (SSL sono in Internet)</span><span class="sxs-lookup"><span data-stu-id="22270-451">SSL offload (SSL only to Internet)</span></span>

- <span data-ttu-id="22270-452">SSL end-to-end</span><span class="sxs-lookup"><span data-stu-id="22270-452">End to End SSL</span></span>

- <span data-ttu-id="22270-453">Routing multisito (consolidare fino a 20 siti in un unico gateway applicazione)</span><span class="sxs-lookup"><span data-stu-id="22270-453">Multi-site routing (consolidate up to 20 sites on a single Application Gateway)</span></span>

- <span data-ttu-id="22270-454">Web application firewall</span><span class="sxs-lookup"><span data-stu-id="22270-454">Web application firewall</span></span>

- <span data-ttu-id="22270-455">Supporto di WebSocket</span><span class="sxs-lookup"><span data-stu-id="22270-455">Websocket support</span></span>

- <span data-ttu-id="22270-456">Diagnostica avanzata</span><span class="sxs-lookup"><span data-stu-id="22270-456">Advanced diagnostics</span></span>

<span data-ttu-id="22270-457">_Altre informazioni sulle opzioni di distribuzione di Azure sono disponibili nel [capitolo 10](development-process-for-azure.md)._</span><span class="sxs-lookup"><span data-stu-id="22270-457">_Learn more about Azure deployment options in [Chapter 10](development-process-for-azure.md)._</span></span>

> ### <a name="references--deployment"></a><span data-ttu-id="22270-458">Riferimenti - Distribuzione</span><span class="sxs-lookup"><span data-stu-id="22270-458">References – Deployment</span></span>
>
> - <span data-ttu-id="22270-459">**Panoramica sull'hosting e la distribuzione**</span><span class="sxs-lookup"><span data-stu-id="22270-459">**Hosting and Deployment Overview**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/publishing/>
> - <span data-ttu-id="22270-460">**Quando usare Kestrel con un proxy inverso**</span><span class="sxs-lookup"><span data-stu-id="22270-460">**When to use Kestrel with a reverse proxy**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel#when-to-use-kestrel-with-a-reverse-proxy>
> - <span data-ttu-id="22270-461">**Ospitare app ASP.NET Core in Docker**</span><span class="sxs-lookup"><span data-stu-id="22270-461">**Host ASP.NET Core apps in Docker**</span></span>  
>   <https://docs.microsoft.com/aspnet/core/publishing/docker>
> - <span data-ttu-id="22270-462">**Introduzione al gateway applicazione di Azure**</span><span class="sxs-lookup"><span data-stu-id="22270-462">**Introducing Azure Application Gateway**</span></span>  
>   <https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction>

>[!div class="step-by-step"]
><span data-ttu-id="22270-463">[Successivo](common-client-side-web-technologies.md)
>[precedente](work-with-data-in-asp-net-core-apps.md)</span><span class="sxs-lookup"><span data-stu-id="22270-463">[Previous](common-client-side-web-technologies.md)
[Next](work-with-data-in-asp-net-core-apps.md)</span></span>
