---
title: Architetture di applicazioni Web comuni
description: Progettare applicazioni Web moderne con ASP.NET Core e Azure | Esplorare le architetture delle applicazioni Web comuni
author: ardalis
ms.author: wiwagn
ms.date: 12/04/2019
ms.openlocfilehash: c9a8e9450d81ac2e63a8c8ea54592ed81e646e05
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/09/2020
ms.locfileid: "80988128"
---
# <a name="common-web-application-architectures"></a><span data-ttu-id="ef8cf-103">Architetture di applicazioni Web comuni</span><span class="sxs-lookup"><span data-stu-id="ef8cf-103">Common web application architectures</span></span>

> <span data-ttu-id="ef8cf-104">"Se pensi che una buona architettura sia costosa, prova la cattiva architettura."</span><span class="sxs-lookup"><span data-stu-id="ef8cf-104">"If you think good architecture is expensive, try bad architecture."</span></span>  
> <span data-ttu-id="ef8cf-105">_- Brian Foote e Joseph Yoder_</span><span class="sxs-lookup"><span data-stu-id="ef8cf-105">_- Brian Foote and Joseph Yoder_</span></span>

<span data-ttu-id="ef8cf-106">La maggior parte delle applicazioni .NET tradizionali viene distribuita come singole unità corrispondenti a un file eseguibile o a un'unica applicazione Web in esecuzione all'interno di un unico AppDomain IIS.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-106">Most traditional .NET applications are deployed as single units corresponding to an executable or a single web application running within a single IIS appdomain.</span></span> <span data-ttu-id="ef8cf-107">Questo è il modello di distribuzione più semplice che funziona molto bene per molte piccole applicazioni pubbliche e interne.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-107">This is the simplest deployment model and serves many internal and smaller public applications very well.</span></span> <span data-ttu-id="ef8cf-108">Tuttavia, anche tenendo presente questa singola unità di distribuzione, la maggior parte delle applicazioni aziendali complesse trae vantaggio dalla separazione logica in diversi livelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-108">However, even given this single unit of deployment, most non-trivial business applications benefit from some logical separation into several layers.</span></span>

## <a name="what-is-a-monolithic-application"></a><span data-ttu-id="ef8cf-109">Cos'è un'applicazione monolitica?</span><span class="sxs-lookup"><span data-stu-id="ef8cf-109">What is a monolithic application?</span></span>

<span data-ttu-id="ef8cf-110">Un'applicazione monolitica è totalmente autonoma in termini di comportamento.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-110">A monolithic application is one that is entirely self-contained, in terms of its behavior.</span></span> <span data-ttu-id="ef8cf-111">Può interagire con altri servizi o archivi dati durante l'esecuzione delle operazioni, ma la base del suo comportamento si trova all'interno del proprio processo e l'intera applicazione viene in genere distribuita come singola unità.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-111">It may interact with other services or data stores in the course of performing its operations, but the core of its behavior runs within its own process and the entire application is typically deployed as a single unit.</span></span> <span data-ttu-id="ef8cf-112">Se è necessario scalare questo tipo di applicazione orizzontalmente, l'intera applicazione viene in genere duplicata in più server o macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-112">If such an application needs to scale horizontally, typically the entire application is duplicated across multiple servers or virtual machines.</span></span>

## <a name="all-in-one-applications"></a><span data-ttu-id="ef8cf-113">Applicazioni all-in-one</span><span class="sxs-lookup"><span data-stu-id="ef8cf-113">All-in-one applications</span></span>

<span data-ttu-id="ef8cf-114">Il minor numero possibile di progetti per l'architettura di un'applicazione è uno.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-114">The smallest possible number of projects for an application architecture is one.</span></span> <span data-ttu-id="ef8cf-115">In questa architettura l'intera logica dell'applicazione è contenuta in un unico progetto, compilata in un unico assembly e distribuita come singola unità.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-115">In this architecture, the entire logic of the application is contained in a single project, compiled to a single assembly, and deployed as a single unit.</span></span>

<span data-ttu-id="ef8cf-116">Un nuovo progetto ASP.NET Core, creato in Visual Studio o dalla riga di comando, inizia come un semplice monolito "all-in-one".</span><span class="sxs-lookup"><span data-stu-id="ef8cf-116">A new ASP.NET Core project, whether created in Visual Studio or from the command line, starts out as a simple "all-in-one" monolith.</span></span> <span data-ttu-id="ef8cf-117">Contiene tutti i comportamenti dell'applicazione, incluse la presentazione, la logica di business e quella di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-117">It contains all of the behavior of the application, including presentation, business, and data access logic.</span></span> <span data-ttu-id="ef8cf-118">La figura 5-1 illustra la struttura di file di un'app con un unico progetto.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-118">Figure 5-1 shows the file structure of a single-project app.</span></span>

![App ASP.NET Core con un unico progetto](./media/image5-1.png)

<span data-ttu-id="ef8cf-120">**Come illustrato nella figura 5-1.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-120">**Figure 5-1.**</span></span> <span data-ttu-id="ef8cf-121">App ASP.NET Core con un unico progetto.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-121">A single project ASP.NET Core app.</span></span>

<span data-ttu-id="ef8cf-122">In uno scenario basato su un unico progetto la separazione delle competenze si ottiene tramite l'uso di cartelle.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-122">In a single project scenario, separation of concerns is achieved through the use of folders.</span></span> <span data-ttu-id="ef8cf-123">Il modello predefinito include cartelle separate per le responsabilità di modelli, visualizzazioni e controller dello schema MVC, nonché altre cartelle per dati e servizi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-123">The default template includes separate folders for MVC pattern responsibilities of Models, Views, and Controllers, as well as additional folders for Data and Services.</span></span> <span data-ttu-id="ef8cf-124">In questa disposizione, i dettagli di presentazione devono essere limitati il più possibile alla cartella delle visualizzazioni e i dettagli di implementazione dell'accesso ai dati devono essere limitati alle classi contenute nella cartella dei dati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-124">In this arrangement, presentation details should be limited as much as possible to the Views folder, and data access implementation details should be limited to classes kept in the Data folder.</span></span> <span data-ttu-id="ef8cf-125">La logica di business deve risiedere nei servizi e le classi nella cartella dei modelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-125">Business logic should reside in services and classes within the Models folder.</span></span>

<span data-ttu-id="ef8cf-126">Anche se semplice, la soluzione monolitica in un unico progetto presenta alcuni svantaggi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-126">Although simple, the single-project monolithic solution has some disadvantages.</span></span> <span data-ttu-id="ef8cf-127">Con l'aumento delle dimensioni e della complessità del progetto, anche il numero di file e cartelle continuerà ad aumentare.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-127">As the project's size and complexity grows, the number of files and folders will continue to grow as well.</span></span> <span data-ttu-id="ef8cf-128">Le competenze dell'interfaccia utente, ovvero modelli, visualizzazioni e controller, risiedono in più cartelle che non sono raggruppate in ordine alfabetico.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-128">User interface (UI) concerns (models, views, controllers) reside in multiple folders, which aren't grouped together alphabetically.</span></span> <span data-ttu-id="ef8cf-129">Il problema si complica quando altri costrutti a livello di interfaccia utente, ad esempio filtri o strumenti di associazione di modelli, vengono aggiunti nelle rispettive cartelle.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-129">This issue only gets worse when additional UI-level constructs, such as Filters or ModelBinders, are added in their own folders.</span></span> <span data-ttu-id="ef8cf-130">La logica di business è distribuita tra le cartelle di modelli e servizi e non esiste alcuna indicazione chiara della dipendenza tra le classi e delle cartelle in cui trovano le classi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-130">Business logic is scattered between the Models and Services folders, and there's no clear indication of which classes in which folders should depend on which others.</span></span> <span data-ttu-id="ef8cf-131">Questa mancanza di organizzazione a livello di progetto spesso determina ciò che viene definito [spaghetti code](https://deviq.com/spaghetti-code/) (blocchi di codice complicati).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-131">This lack of organization at the project level frequently leads to [spaghetti code](https://deviq.com/spaghetti-code/).</span></span>

<span data-ttu-id="ef8cf-132">Per risolvere questi problemi, spesso le applicazioni si evolvono in soluzioni costituite da più progetti, in cui si considera che ogni progetto risieda in un determinato _livello_ dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-132">To address these issues, applications often evolve into multi-project solutions, where each project is considered to reside in a particular _layer_ of the application.</span></span>

## <a name="what-are-layers"></a><span data-ttu-id="ef8cf-133">Cosa sono i livelli?</span><span class="sxs-lookup"><span data-stu-id="ef8cf-133">What are layers?</span></span>

<span data-ttu-id="ef8cf-134">Un modo per gestire la crescente complessità delle applicazioni consiste nel suddividere l'applicazione in base a responsabilità o competenze.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-134">As applications grow in complexity, one way to manage that complexity is to break up the application according to its responsibilities or concerns.</span></span> <span data-ttu-id="ef8cf-135">Questo segue il principio di separazione delle preoccupazioni e può aiutare a mantenere una base di codice in crescita organizzata in modo che gli sviluppatori possono facilmente trovare dove vengono implementate determinate funzionalità.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-135">This follows the separation of concerns principle and can help keep a growing codebase organized so that developers can easily find where certain functionality is implemented.</span></span> <span data-ttu-id="ef8cf-136">Oltre alla semplice organizzazione del codice, l'architettura a livelli offre una serie di vantaggi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-136">Layered architecture offers a number of advantages beyond just code organization, though.</span></span>

<span data-ttu-id="ef8cf-137">L'organizzazione del codice in livelli consente di riusare le funzionalità comuni di basso livello all'interno dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-137">By organizing code into layers, common low-level functionality can be reused throughout the application.</span></span> <span data-ttu-id="ef8cf-138">Questa possibilità di riutilizzo è utile poiché consente di scrivere meno codice e di standardizzare l'applicazione su una singola implementazione, osservando il principio [DRY (Don't Repeat Yourself)](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-138">This reuse is beneficial because it means less code needs to be written and because it can allow the application to standardize on a single implementation, following the [don't repeat yourself (DRY)](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) principle.</span></span>

<span data-ttu-id="ef8cf-139">Con un'architettura a livelli, le applicazioni possono imporre restrizioni su quali livelli possono comunicare con altri livelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-139">With a layered architecture, applications can enforce restrictions on which layers can communicate with other layers.</span></span> <span data-ttu-id="ef8cf-140">Ciò aiuta a realizzare l'incapsulamento.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-140">This helps to achieve encapsulation.</span></span> <span data-ttu-id="ef8cf-141">Quando un livello viene modificato o sostituito, dovrebbero essere interessati solo i livelli a esso correlati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-141">When a layer is changed or replaced, only those layers that work with it should be impacted.</span></span> <span data-ttu-id="ef8cf-142">Limitando i livelli che dipendono da altri livelli, l'impatto delle modifiche può essere ridotto in modo da evitare che un'unica modifica influisca sull'intera applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-142">By limiting which layers depend on which other layers, the impact of changes can be mitigated so that a single change doesn't impact the entire application.</span></span>

<span data-ttu-id="ef8cf-143">I livelli, e l'incapsulamento, facilitano la sostituzione delle funzionalità all'interno dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-143">Layers (and encapsulation) make it much easier to replace functionality within the application.</span></span> <span data-ttu-id="ef8cf-144">Un'applicazione potrebbe ad esempio usare inizialmente il proprio database SQL Server per il salvataggio permanente, ma in seguito potrebbe scegliere di usare una strategia di salvataggio permanente basata sul cloud o su un'API Web.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-144">For example, an application might initially use its own SQL Server database for persistence, but later could choose to use a cloud-based persistence strategy, or one behind a web API.</span></span> <span data-ttu-id="ef8cf-145">Se l'applicazione ha incapsulato correttamente l'implementazione del salvataggio permanente all'interno di un livello logico, quello specifico livello di SQL Server potrà essere sostituito da un nuovo livello che implementa la stessa interfaccia pubblica.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-145">If the application has properly encapsulated its persistence implementation within a logical layer, that SQL Server specific layer could be replaced by a new one implementing the same public interface.</span></span>

<span data-ttu-id="ef8cf-146">Oltre al potenziale per la sostituzione delle implementazioni in risposta alle future modifiche dei requisiti, i livelli dell'applicazione possono anche semplificare la sostituzione delle implementazioni a scopo di test.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-146">In addition to the potential of swapping out implementations in response to future changes in requirements, application layers can also make it easier to swap out implementations for testing purposes.</span></span> <span data-ttu-id="ef8cf-147">Anziché scrivere test che operano sul livello dei dati reali o dell'interfaccia utente dell'applicazione, questi livelli possono essere sostituiti in fase di test con false implementazioni che restituiscono risposte note alle richieste.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-147">Instead of having to write tests that operate against the real data layer or UI layer of the application, these layers can be replaced at test time with fake implementations that provide known responses to requests.</span></span> <span data-ttu-id="ef8cf-148">In questo modo, la scrittura dei test risulta molto più semplice e la relativa esecuzione molto più veloce rispetto all'esecuzione di test sull'infrastruttura reale dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-148">This typically makes tests much easier to write and much faster to run when compared to running tests against the application's real infrastructure.</span></span>

<span data-ttu-id="ef8cf-149">I livelli logici sono una tecnica comune per migliorare l'organizzazione del codice nelle applicazioni software aziendali ed esistono molti modi per organizzare il codice in livelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-149">Logical layering is a common technique for improving the organization of code in enterprise software applications, and there are several ways in which code can be organized into layers.</span></span>

> [!NOTE]
 > <span data-ttu-id="ef8cf-150">I _livelli_ rappresentano la separazione logica all'interno dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-150">_Layers_ represent logical separation within the application.</span></span> <span data-ttu-id="ef8cf-151">Nel caso in cui la logica dell'applicazione sia fisicamente distribuita in server o processi separati, queste destinazioni di distribuzione fisiche separate sono denominate _livelli_.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-151">In the event that application logic is physically distributed to separate servers or processes, these separate physical deployment targets are referred to as _tiers_.</span></span> <span data-ttu-id="ef8cf-152">È possibile, e piuttosto comune, che un'applicazione a più livelli sia distribuita in un singolo livello.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-152">It's possible, and quite common, to have an N-Layer application that is deployed to a single tier.</span></span>

## <a name="traditional-n-layer-architecture-applications"></a><span data-ttu-id="ef8cf-153">Applicazioni con architettura a più livelli tradizionali</span><span class="sxs-lookup"><span data-stu-id="ef8cf-153">Traditional "N-Layer" architecture applications</span></span>

<span data-ttu-id="ef8cf-154">L'organizzazione più comune della logica dell'applicazione in livelli è illustrata nella figura 5-2.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-154">The most common organization of application logic into layers is shown in Figure 5-2.</span></span>

![Livelli applicativi tipici](./media/image5-2.png)

<span data-ttu-id="ef8cf-156">**Come illustrato nella Figura 5-2.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-156">**Figure 5-2.**</span></span> <span data-ttu-id="ef8cf-157">Livelli di un'applicazione tipica.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-157">Typical application layers.</span></span>

<span data-ttu-id="ef8cf-158">Questi livelli vengono spesso abbreviati: UI (User Interface, interfaccia utente), BLL (Business Logic Layer, livello logica di business ) e DAL (Data Access Layer, livello accesso dati).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-158">These layers are frequently abbreviated as UI, BLL (Business Logic Layer), and DAL (Data Access Layer).</span></span> <span data-ttu-id="ef8cf-159">In questa architettura gli utenti inviano le richieste tramite il livello UI che interagisce solo con il livello BLL.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-159">Using this architecture, users make requests through the UI layer, which interacts only with the BLL.</span></span> <span data-ttu-id="ef8cf-160">Il livello BLL, a sua volta, può chiamare il livello DAL per le richieste di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-160">The BLL, in turn, can call the DAL for data access requests.</span></span> <span data-ttu-id="ef8cf-161">Il livello UI non deve inviare richieste direttamente al livello DAL, né deve interagire direttamente con il salvataggio permanente attraverso altri mezzi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-161">The UI layer shouldn't make any requests to the DAL directly, nor should it interact with persistence directly through other means.</span></span> <span data-ttu-id="ef8cf-162">In modo analogo, il livello BLL deve interagire con il salvataggio permanente solo passando tramite il livello DAL.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-162">Likewise, the BLL should only interact with persistence by going through the DAL.</span></span> <span data-ttu-id="ef8cf-163">In questo modo, ogni livello avrà responsabilità ben distinte.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-163">In this way, each layer has its own well-known responsibility.</span></span>

<span data-ttu-id="ef8cf-164">Uno svantaggio di questo approccio tradizionale a livelli è l'esecuzione delle dipendenze dall'alto verso il basso in fase di compilazione,</span><span class="sxs-lookup"><span data-stu-id="ef8cf-164">One disadvantage of this traditional layering approach is that compile-time dependencies run from the top to the bottom.</span></span> <span data-ttu-id="ef8cf-165">ovvero il livello UI dipende dal livello BLL che a sua volta dipende dal livello DAL.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-165">That is, the UI layer depends on the BLL, which depends on the DAL.</span></span> <span data-ttu-id="ef8cf-166">Ciò significa che il livello BLL, che in genere contiene la logica più importante nell'applicazione, dipende dai dettagli di implementazione dell'accesso ai dati e spesso dall'esistenza di un database.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-166">This means that the BLL, which usually holds the most important logic in the application, is dependent on data access implementation details (and often on the existence of a database).</span></span> <span data-ttu-id="ef8cf-167">Testare la logica di business in questo tipo di architettura è spesso difficile e richiede un database di test.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-167">Testing business logic in such an architecture is often difficult, requiring a test database.</span></span> <span data-ttu-id="ef8cf-168">Per risolvere questo problema è possibile usare il principio di inversione delle dipendenze, come si vedrà nella prossima sezione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-168">The dependency inversion principle can be used to address this issue, as you'll see in the next section.</span></span>

<span data-ttu-id="ef8cf-169">La figura 5-3 illustra una soluzione di esempio in cui l'applicazione viene suddivisa in tre progetti in base alla responsabilità (o al livello).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-169">Figure 5-3 shows an example solution, breaking the application into three projects by responsibility (or layer).</span></span>

![Una semplice applicazione monolitica con tre progetti](./media/image5-3.png)

<span data-ttu-id="ef8cf-171">**Figura 5-3.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-171">**Figure 5-3.**</span></span> <span data-ttu-id="ef8cf-172">Semplice applicazione monolitica con tre progetti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-172">A simple monolithic application with three projects.</span></span>

<span data-ttu-id="ef8cf-173">Anche se questa applicazione usa diversi progetti ai fini organizzativi, viene comunque distribuita come singola unità e i client interagiranno con essa come singola app Web.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-173">Although this application uses several projects for organizational purposes, it's still deployed as a single unit and its clients will interact with it as a single web app.</span></span> <span data-ttu-id="ef8cf-174">Ciò consente un processo di distribuzione molto semplice.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-174">This allows for very simple deployment process.</span></span> <span data-ttu-id="ef8cf-175">La figura 5-4 illustra come è possibile ospitare questa app usando Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-175">Figure 5-4 shows how such an app might be hosted using Azure.</span></span>

![Semplice distribuzione dell'app Web di Azure](./media/image5-4.png)

<span data-ttu-id="ef8cf-177">**Figura 5-4.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-177">**Figure 5-4.**</span></span> <span data-ttu-id="ef8cf-178">Semplice distribuzione dell'app Web di Azure</span><span class="sxs-lookup"><span data-stu-id="ef8cf-178">Simple deployment of Azure Web App</span></span>

<span data-ttu-id="ef8cf-179">L'aumento dei requisiti dell'applicazione può determinare la necessità di soluzioni di distribuzione più solide e complesse.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-179">As application needs grow, more complex and robust deployment solutions may be required.</span></span> <span data-ttu-id="ef8cf-180">La figura 5-5 illustra un esempio di un piano di distribuzione più complesso che supporta funzionalità aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-180">Figure 5-5 shows an example of a more complex deployment plan that supports additional capabilities.</span></span>

![Distribuzione di un'app Web in un servizio app di Azure](./media/image5-5.png)

<span data-ttu-id="ef8cf-182">**Figura 5-5.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-182">**Figure 5-5.**</span></span> <span data-ttu-id="ef8cf-183">Distribuzione di un'app Web in un servizio app di Azure</span><span class="sxs-lookup"><span data-stu-id="ef8cf-183">Deploying a web app to an Azure App Service</span></span>

<span data-ttu-id="ef8cf-184">L'organizzazione di questo progetto in più progetti basati sulla responsabilità consente di migliorare internamente la manutenibilità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-184">Internally, this project's organization into multiple projects based on responsibility improves the maintainability of the application.</span></span>

<span data-ttu-id="ef8cf-185">Per trarre vantaggio dalla scalabilità su richiesta basata sul cloud è possibile scalare questa unità verticalmente oppure orizzontalmente.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-185">This unit can be scaled up or out to take advantage of cloud-based on-demand scalability.</span></span> <span data-ttu-id="ef8cf-186">Per scalabilità verticale si intende l'aggiunta di CPU, memoria, spazio su disco o altre risorse aggiuntive ai server che ospitano l'app.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-186">Scaling up means adding additional CPU, memory, disk space, or other resources to the server(s) hosting your app.</span></span> <span data-ttu-id="ef8cf-187">Per scalabilità orizzontale si intende l'aggiunta di istanze aggiuntive di questi server, che si tratti di server fisici, macchine virtuali o contenitori.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-187">Scaling out means adding additional instances of such servers, whether these are physical servers, virtual machines, or containers.</span></span> <span data-ttu-id="ef8cf-188">Quando l'app è ospitata in più istanze viene usato un servizio di bilanciamento del carico per assegnare le richieste alle istanze individuali dell'app.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-188">When your app is hosted across multiple instances, a load balancer is used to assign requests to individual app instances.</span></span>

<span data-ttu-id="ef8cf-189">L'approccio più semplice alla scalabilità di un'applicazione Web in Azure consiste nel configurare la scalabilità manualmente nel piano di servizio app dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-189">The simplest approach to scaling a web application in Azure is to configure scaling manually in the application's App Service Plan.</span></span> <span data-ttu-id="ef8cf-190">La figura 5-6 illustra la schermata appropriata del dashboard di Azure in cui configurare il numero di istanze in uso per un'app.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-190">Figure 5-6 shows the appropriate Azure dashboard screen to configure how many instances are serving an app.</span></span>

![App Service Plan scaling in Azure](./media/image5-6.png)

<span data-ttu-id="ef8cf-192">**Figura 5-6.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-192">**Figure 5-6.**</span></span> <span data-ttu-id="ef8cf-193">Scalabilità nel piano di servizio app in Azure.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-193">App Service Plan scaling in Azure.</span></span>

## <a name="clean-architecture"></a><span data-ttu-id="ef8cf-194">Architettura pulita</span><span class="sxs-lookup"><span data-stu-id="ef8cf-194">Clean architecture</span></span>

<span data-ttu-id="ef8cf-195">Le applicazioni che osservano il principio DIP (Dependency Inversion Principle, principio di inversione delle dipendenze) e il principio DDD (Domain-Driven Design, progettazione basata su domini) tendono ad arrivare a un'architettura simile.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-195">Applications that follow the Dependency Inversion Principle as well as the Domain-Driven Design (DDD) principles tend to arrive at a similar architecture.</span></span> <span data-ttu-id="ef8cf-196">Nel corso degli anni, questa architettura è stata indicata con molti nomi diversi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-196">This architecture has gone by many names over the years.</span></span> <span data-ttu-id="ef8cf-197">Uno dei primi nomi è stato Architettura esagonale, seguito da "Porte-e-adattatori".</span><span class="sxs-lookup"><span data-stu-id="ef8cf-197">One of the first names was Hexagonal Architecture, followed by Ports-and-Adapters.</span></span> <span data-ttu-id="ef8cf-198">Più di recente, è stata indicata come [Onion Architecture](https://jeffreypalermo.com/blog/the-onion-architecture-part-1/) (Architettura ad anelli) o [Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html) (Architettura pulita).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-198">More recently, it's been cited as the [Onion Architecture](https://jeffreypalermo.com/blog/the-onion-architecture-part-1/) or [Clean Architecture](https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html).</span></span> <span data-ttu-id="ef8cf-199">In questo e-book viene usato quest'ultimo nome, ovvero Architettura pulita.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-199">The latter name, Clean Architecture, is used as the name for this architecture in this e-book.</span></span>

<span data-ttu-id="ef8cf-200">L'applicazione di riferimento eShopOnWeb utilizza l'approccio Clean Architecture nell'organizzazione del codice nei progetti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-200">The eShopOnWeb reference application uses the Clean Architecture approach in organizing its code into projects.</span></span> <span data-ttu-id="ef8cf-201">È possibile trovare un modello di soluzione che è possibile utilizzare come punto di partenza per il proprio ASP.NET Core nel repository [GitHub ardalis/cleanarchitecture.](https://github.com/ardalis/cleanarchitecture)</span><span class="sxs-lookup"><span data-stu-id="ef8cf-201">You can find a solution template you can use as a starting point for your own ASP.NET Core on the [ardalis/cleanarchitecture](https://github.com/ardalis/cleanarchitecture) GitHub repository.</span></span>

<span data-ttu-id="ef8cf-202">Nell'Architettura pulita la logica di business e il modello applicativo sono posti al centro dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-202">Clean architecture puts the business logic and application model at the center of the application.</span></span> <span data-ttu-id="ef8cf-203">La logica di business non dipende dall'accesso ai dati o da altre competenze dell'infrastruttura. Questa dipendenza viene invece invertita: i dettagli relativi all'infrastruttura e all'implementazione dipendono dal nucleo applicativo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-203">Instead of having business logic depend on data access or other infrastructure concerns, this dependency is inverted: infrastructure and implementation details depend on the Application Core.</span></span> <span data-ttu-id="ef8cf-204">Ciò si ottiene definendo le astrazioni, o interfacce, nel nucleo applicativo. Queste vengono quindi implementate dai tipi definiti nel livello infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-204">This is achieved by defining abstractions, or interfaces, in the Application Core, which are then implemented by types defined in the Infrastructure layer.</span></span> <span data-ttu-id="ef8cf-205">Un modo comune per visualizzare questa architettura è l'uso di una serie di cerchi concentrici, simile a una struttura ad anelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-205">A common way of visualizing this architecture is to use a series of concentric circles, similar to an onion.</span></span> <span data-ttu-id="ef8cf-206">La figura 5-7 illustra un esempio di questo stile di rappresentazione dell'architettura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-206">Figure 5-7 shows an example of this style of architectural representation.</span></span>

![Architettura pulita, visualizzazione ad anelli](./media/image5-7.png)

<span data-ttu-id="ef8cf-208">**Figura 5-7.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-208">**Figure 5-7.**</span></span> <span data-ttu-id="ef8cf-209">Architettura pulita, visualizzazione ad anelli</span><span class="sxs-lookup"><span data-stu-id="ef8cf-209">Clean Architecture; onion view</span></span>

<span data-ttu-id="ef8cf-210">In questo diagramma le dipendenze fluiscono verso il cerchio più interno.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-210">In this diagram, dependencies flow toward the innermost circle.</span></span> <span data-ttu-id="ef8cf-211">Il nucleo applicativo prende il nome dalla sua posizione in questo diagramma.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-211">The Application Core takes its name from its position at the core of this diagram.</span></span> <span data-ttu-id="ef8cf-212">È inoltre possibile vedere dal diagramma che il nucleo applicativo non ha dipendenze da altri livelli dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-212">And you can see on the diagram that the Application Core has no dependencies on other application layers.</span></span> <span data-ttu-id="ef8cf-213">Le entità e le interfacce dell'applicazione si trovano nella parte più centrale.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-213">The application's entities and interfaces are at the very center.</span></span> <span data-ttu-id="ef8cf-214">All'esterno, ma ancora nel nucleo applicativo, si trovano i servizi di dominio che in genere implementano le interfacce definite nel cerchio più interno.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-214">Just outside, but still in the Application Core, are domain services, which typically implement interfaces defined in the inner circle.</span></span> <span data-ttu-id="ef8cf-215">All'esterno del nucleo applicativo, i livelli UI e Infrastruttura dipendono dal nucleo applicativo, ma non hanno dipendenze reciproche (necessariamente).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-215">Outside of the Application Core, both the UI and the Infrastructure layers depend on the Application Core, but not on one another (necessarily).</span></span>

<span data-ttu-id="ef8cf-216">La figura 5-8 illustra un diagramma più tradizionale con livelli orizzontali che riflette meglio la dipendenza tra il livello UI e gli altri livelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-216">Figure 5-8 shows a more traditional horizontal layer diagram that better reflects the dependency between the UI and other layers.</span></span>

![Architettura pulita, visualizzazione con livelli orizzontali](./media/image5-8.png)

<span data-ttu-id="ef8cf-218">**Figura 5-8.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-218">**Figure 5-8.**</span></span> <span data-ttu-id="ef8cf-219">Architettura pulita, visualizzazione con livelli orizzontali</span><span class="sxs-lookup"><span data-stu-id="ef8cf-219">Clean Architecture; horizontal layer view</span></span>

<span data-ttu-id="ef8cf-220">Si noti che le frecce continue rappresentano le dipendenze in fase di compilazione, mentre la freccia tratteggiata rappresenta una dipendenza solo di runtime.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-220">Note that the solid arrows represent compile-time dependencies, while the dashed arrow represents a runtime-only dependency.</span></span> <span data-ttu-id="ef8cf-221">Nell'Architettura pulita il livello UI usa le interfacce definite nel nucleo applicativo in fase di compilazione e idealmente non dovrebbe avere alcuna conoscenza dei tipi di implementazione definiti nel livello infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-221">With the clean architecture, the UI layer works with interfaces defined in the Application Core at compile time, and ideally shouldn't know about the implementation types defined in the Infrastructure layer.</span></span> <span data-ttu-id="ef8cf-222">In fase di runtime, tuttavia, questi tipi di implementazione sono necessari per l'esecuzione dell'app e devono quindi essere presenti e associati alle interfacce del nucleo applicativo tramite l'inserimento di dipendenze.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-222">At run time, however, these implementation types are required for the app to execute, so they need to be present and wired up to the Application Core interfaces via dependency injection.</span></span>

<span data-ttu-id="ef8cf-223">La figura 5-9 illustra una visualizzazione più dettagliata dell'architettura di un'applicazione ASP.NET Core quando viene compilata seguendo queste indicazioni.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-223">Figure 5-9 shows a more detailed view of an ASP.NET Core application's architecture when built following these recommendations.</span></span>

![Diagramma dell'architettura di ASP.NET Core dopo l'architettura pulita](./media/image5-9.png)

<span data-ttu-id="ef8cf-225">**Figura 5-9.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-225">**Figure 5-9.**</span></span> <span data-ttu-id="ef8cf-226">Diagramma dell'architettura ASP.NET Core in base all'Architettura pulita.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-226">ASP.NET Core architecture diagram following Clean Architecture.</span></span>

<span data-ttu-id="ef8cf-227">Poiché il nucleo applicativo non dipende dall'infrastruttura, la scrittura di unit test automatizzati per questo livello risulta molto semplice.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-227">Because the Application Core doesn't depend on Infrastructure, it's very easy to write automated unit tests for this layer.</span></span> <span data-ttu-id="ef8cf-228">Le figure 5-10 e 5-11 illustrano come i test si inseriscono in questa architettura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-228">Figures 5-10 and 5-11 show how tests fit into this architecture.</span></span>

![UnitTestCore](./media/image5-10.png)

<span data-ttu-id="ef8cf-230">**Figura 5-10.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-230">**Figure 5-10.**</span></span> <span data-ttu-id="ef8cf-231">Testing unità del nucleo applicativo in isolamento.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-231">Unit testing Application Core in isolation.</span></span>

![IntegrationTests](./media/image5-11.png)

<span data-ttu-id="ef8cf-233">**Figura 5-11.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-233">**Figure 5-11.**</span></span> <span data-ttu-id="ef8cf-234">Test di integrazione delle implementazioni di infrastruttura con dipendenze esterne.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-234">Integration testing Infrastructure implementations with external dependencies.</span></span>

<span data-ttu-id="ef8cf-235">Poiché il livello UI non ha alcuna dipendenza diretta dai tipi definiti nel progetto di infrastruttura, la sostituzione delle implementazioni per facilitare i test o in risposta a eventuali modifiche dei requisiti dell'applicazione risulta molto semplice.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-235">Since the UI layer doesn't have any direct dependency on types defined in the Infrastructure project, it's likewise very easy to swap out implementations, either to facilitate testing or in response to changing application requirements.</span></span> <span data-ttu-id="ef8cf-236">Grazie all'uso predefinito e al supporto dell'inserimento delle dipendenze offerti da ASP.NET Core, questa architettura rappresenta il modo più appropriato di strutturare applicazioni monolitiche complesse.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-236">ASP.NET Core's built-in use of and support for dependency injection makes this architecture the most appropriate way to structure non-trivial monolithic applications.</span></span>

<span data-ttu-id="ef8cf-237">Per le applicazioni monolitiche, i progetti relativi al nucleo applicativo, all'infrastruttura e all'interfaccia utente vengono tutti eseguiti come singola applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-237">For monolithic applications the Application Core, Infrastructure, and UI projects are all run as a single application.</span></span> <span data-ttu-id="ef8cf-238">L'architettura di runtime dell'applicazione può essere simile a quella illustrata nella figura 5-12.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-238">The runtime application architecture might look something like Figure 5-12.</span></span>

![Architettura ASP.NET Core 2](./media/image5-12.png)

<span data-ttu-id="ef8cf-240">**Figura 5-12.**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-240">**Figure 5-12.**</span></span> <span data-ttu-id="ef8cf-241">Architettura di runtime di un'app ASP.NET Core di esempio.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-241">A sample ASP.NET Core app's runtime architecture.</span></span>

### <a name="organizing-code-in-clean-architecture"></a><span data-ttu-id="ef8cf-242">Organizzazione del codice nell'Architettura pulita</span><span class="sxs-lookup"><span data-stu-id="ef8cf-242">Organizing code in Clean Architecture</span></span>

<span data-ttu-id="ef8cf-243">In una soluzione di Architettura pulita ogni progetto ha responsabilità chiare.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-243">In a Clean Architecture solution, each project has clear responsibilities.</span></span> <span data-ttu-id="ef8cf-244">A ogni progetto appartengono quindi determinati tipi e si troveranno spesso cartelle corrispondenti a questi tipi nel progetto appropriato.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-244">As such, certain types belong in each project and you'll frequently find folders corresponding to these types in the appropriate project.</span></span>

<span data-ttu-id="ef8cf-245">Il nucleo applicativo contiene il modello aziendale che include entità, servizi e interfacce.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-245">The Application Core holds the business model, which includes entities, services, and interfaces.</span></span> <span data-ttu-id="ef8cf-246">Queste interfacce includono astrazioni per le operazioni che verranno eseguite utilizzando Infrastructure, ad esempio l'accesso ai dati, l'accesso al file system, le chiamate di rete e così via. A volte i servizi o le interfacce definite a questo livello dovranno funzionare con tipi non di entità che non hanno dipendenze dall'interfaccia utente o dall'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-246">These interfaces include abstractions for operations that will be performed using Infrastructure, such as data access, file system access, network calls, etc. Sometimes services or interfaces defined at this layer will need to work with non-entity types that have no dependencies on UI or Infrastructure.</span></span> <span data-ttu-id="ef8cf-247">Questi tipi possono essere definiti come semplici DTO (Data Transfer Object).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-247">These can be defined as simple Data Transfer Objects (DTOs).</span></span>

### <a name="application-core-types"></a><span data-ttu-id="ef8cf-248">Tipi del nucleo applicativo</span><span class="sxs-lookup"><span data-stu-id="ef8cf-248">Application Core types</span></span>

- <span data-ttu-id="ef8cf-249">Entità (classi del modello aziendale persistenti)</span><span class="sxs-lookup"><span data-stu-id="ef8cf-249">Entities (business model classes that are persisted)</span></span>
- <span data-ttu-id="ef8cf-250">Interfacce</span><span class="sxs-lookup"><span data-stu-id="ef8cf-250">Interfaces</span></span>
- <span data-ttu-id="ef8cf-251">Servizi</span><span class="sxs-lookup"><span data-stu-id="ef8cf-251">Services</span></span>
- <span data-ttu-id="ef8cf-252">DTO</span><span class="sxs-lookup"><span data-stu-id="ef8cf-252">DTOs</span></span>

<span data-ttu-id="ef8cf-253">Il progetto di infrastruttura include in genere le implementazioni di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-253">The Infrastructure project typically includes data access implementations.</span></span> <span data-ttu-id="ef8cf-254">In una tipica applicazione Web ASP.NET Core queste implementazioni includono la classe DbContext di Entity Framework, gli eventuali oggetti `Migration` EF Core che sono stati definiti e le classi delle implementazioni di accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-254">In a typical ASP.NET Core web application, these implementations include the Entity Framework (EF) DbContext, any EF Core `Migration` objects that have been defined, and data access implementation classes.</span></span> <span data-ttu-id="ef8cf-255">Il metodo più comune per l'astrazione del codice di implementazione di accesso ai dati è tramite l'uso dello [schema progettuale repository](https://deviq.com/repository-pattern/).</span><span class="sxs-lookup"><span data-stu-id="ef8cf-255">The most common way to abstract data access implementation code is through the use of the [Repository design pattern](https://deviq.com/repository-pattern/).</span></span>

<span data-ttu-id="ef8cf-256">Oltre alle implementazioni di accesso ai dati, il progetto di infrastruttura deve contenere le implementazioni dei servizi che devono interagire con le competenze dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-256">In addition to data access implementations, the Infrastructure project should contain implementations of services that must interact with infrastructure concerns.</span></span> <span data-ttu-id="ef8cf-257">Questi servizi devono implementare le interfacce definite nel nucleo applicativo. Di conseguenza, l'infrastruttura deve contenere un riferimento al progetto del nucleo applicativo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-257">These services should implement interfaces defined in the Application Core, and so Infrastructure should have a reference to the Application Core project.</span></span>

### <a name="infrastructure-types"></a><span data-ttu-id="ef8cf-258">Tipi dell'infrastruttura</span><span class="sxs-lookup"><span data-stu-id="ef8cf-258">Infrastructure types</span></span>

- <span data-ttu-id="ef8cf-259">Tipi EF Core (`DbContext`, `Migration`)</span><span class="sxs-lookup"><span data-stu-id="ef8cf-259">EF Core types (`DbContext`, `Migration`)</span></span>
- <span data-ttu-id="ef8cf-260">Tipi di implementazione di accesso ai dati (repository)</span><span class="sxs-lookup"><span data-stu-id="ef8cf-260">Data access implementation types (Repositories)</span></span>
- <span data-ttu-id="ef8cf-261">Servizi specifici dell'infrastruttura (ad esempio, `FileLogger` o `SmtpNotifier`)</span><span class="sxs-lookup"><span data-stu-id="ef8cf-261">Infrastructure-specific services (for example, `FileLogger` or `SmtpNotifier`)</span></span>

<span data-ttu-id="ef8cf-262">Il livello UI in un'applicazione MVC ASP.NET Core rappresenta il punto di ingresso per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-262">The user interface layer in an ASP.NET Core MVC application is the entry point for the application.</span></span> <span data-ttu-id="ef8cf-263">Questo progetto deve fare riferimento al progetto del nucleo applicativo e i relativi tipi devono interagire con l'infrastruttura esclusivamente tramite le interfacce definite nel nucleo applicativo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-263">This project should reference the Application Core project, and its types should interact with infrastructure strictly through interfaces defined in Application Core.</span></span> <span data-ttu-id="ef8cf-264">Nel livello UI non devono essere consentite creazioni di istanze dirette o chiamate statiche ai tipi del livello infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-264">No direct instantiation of or static calls to the Infrastructure layer types should be allowed in the UI layer.</span></span>

### <a name="ui-layer-types"></a><span data-ttu-id="ef8cf-265">Tipi del livello UI</span><span class="sxs-lookup"><span data-stu-id="ef8cf-265">UI layer types</span></span>

- <span data-ttu-id="ef8cf-266">Controller</span><span class="sxs-lookup"><span data-stu-id="ef8cf-266">Controllers</span></span>
- <span data-ttu-id="ef8cf-267">Filtri</span><span class="sxs-lookup"><span data-stu-id="ef8cf-267">Filters</span></span>
- <span data-ttu-id="ef8cf-268">Viste</span><span class="sxs-lookup"><span data-stu-id="ef8cf-268">Views</span></span>
- <span data-ttu-id="ef8cf-269">ViewModel</span><span class="sxs-lookup"><span data-stu-id="ef8cf-269">ViewModels</span></span>
- <span data-ttu-id="ef8cf-270">Avvio</span><span class="sxs-lookup"><span data-stu-id="ef8cf-270">Startup</span></span>

<span data-ttu-id="ef8cf-271">La classe di avvio è responsabile della configurazione dell'applicazione e dell'associazione dei tipi di implementazione alle interfacce, consentendo il corretto funzionamento dell'inserimento delle dipendenze durante il runtime.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-271">The Startup class is responsible for configuring the application, and for wiring up implementation types to interfaces, allowing dependency injection to work properly at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="ef8cf-272">Per associare l'inserimento delle dipendenze in ConfigureServices nel file Startup.cs del progetto UI, può essere necessario che il progetto faccia riferimento al progetto dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-272">In order to wire up dependency injection in ConfigureServices in the Startup.cs file of the UI project, the project may need to reference the Infrastructure project.</span></span> <span data-ttu-id="ef8cf-273">Questa dipendenza può essere facilmente eliminata usando un contenitore di inserimento delle dipendenze personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-273">This dependency can be eliminated, most easily by using a custom DI container.</span></span> <span data-ttu-id="ef8cf-274">Ai fini di questo esempio, l'approccio più semplice consiste nel consentire al progetto UI di fare riferimento al progetto dell'infrastruttura.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-274">For the purposes of this sample, the simplest approach is to allow the UI project to reference the Infrastructure project.</span></span>

## <a name="monolithic-applications-and-containers"></a><span data-ttu-id="ef8cf-275">Applicazioni monolitiche e contenitori</span><span class="sxs-lookup"><span data-stu-id="ef8cf-275">Monolithic applications and containers</span></span>

<span data-ttu-id="ef8cf-276">È possibile compilare una singola applicazione o un singolo servizio Web basati sulla distribuzione monolitica e distribuirli come contenitore.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-276">You can build a single and monolithic-deployment based Web Application or Service and deploy it as a container.</span></span> <span data-ttu-id="ef8cf-277">All'interno dell'applicazione, il contenitore può non essere monolitico ma organizzato in più librerie, componenti o livelli.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-277">Within the application, it might not be monolithic but organized into several libraries, components, or layers.</span></span> <span data-ttu-id="ef8cf-278">Esternamente è un singolo contenitore, come un singolo processo, una singola applicazione Web o un singolo servizio.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-278">Externally, it's a single container like a single process, single web application, or single service.</span></span>

<span data-ttu-id="ef8cf-279">Per gestire questo modello, distribuire un singolo contenitore per rappresentare l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-279">To manage this model, you deploy a single container to represent the application.</span></span> <span data-ttu-id="ef8cf-280">Per la scalabilità, è sufficiente aggiungere altre copie con un servizio di bilanciamento del carico.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-280">To scale, just add additional copies with a load balancer in front.</span></span> <span data-ttu-id="ef8cf-281">La semplicità deriva dalla gestione di un'unica distribuzione in un singolo contenitore o una singola macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-281">The simplicity comes from managing a single deployment in a single container or VM.</span></span>

![Figura 5-13](./media/image5-13.png)

<span data-ttu-id="ef8cf-283">È possibile includere più componenti/librerie o livelli interni in ogni contenitore, come illustrato nella figura 5-13.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-283">You can include multiple components/libraries or internal layers within each container, as illustrated in Figure 5-13.</span></span> <span data-ttu-id="ef8cf-284">In base al principio secondo il quale _"un contenitore esegue un'operazione e lo fa in un unico processo_", tuttavia, lo schema monolitico potrebbe generare conflitti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-284">But, following the container principle of _"a container does one thing, and does it in one process_", the monolithic pattern might be a conflict.</span></span>

<span data-ttu-id="ef8cf-285">Lo svantaggio di questo approccio diventa evidente con l'eventuale crescita dell'applicazione, che ne richiede il ridimensionamento.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-285">The downside of this approach comes if/when the application grows, requiring it to scale.</span></span> <span data-ttu-id="ef8cf-286">Se l'intera applicazione viene ridimensionata, non ci sono problemi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-286">If the entire application scales, it's not really a problem.</span></span> <span data-ttu-id="ef8cf-287">Tuttavia, nella maggior parte dei casi, alcune parti dell'applicazione rappresentano colli di bottiglia che richiedono il ridimensionamento, mentre altri componenti vengono usati di meno.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-287">However, in most cases, a few parts of the application are the choke points requiring scaling, while other components are used less.</span></span>

<span data-ttu-id="ef8cf-288">Usando il tipico esempio di e-commerce, la parte che probabilmente sarà necessario ridimensionare è il componente relativo alle informazioni sui prodotti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-288">Using the typical eCommerce example, what you likely need to scale is the product information component.</span></span> <span data-ttu-id="ef8cf-289">Il numero di clienti che visualizzano i prodotti è molto superiore al numero di quelli che li acquistano.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-289">Many more customers browse products than purchase them.</span></span> <span data-ttu-id="ef8cf-290">Molti più clienti usano il carrello per poi usare la pipeline di pagamento,</span><span class="sxs-lookup"><span data-stu-id="ef8cf-290">More customers use their basket than use the payment pipeline.</span></span> <span data-ttu-id="ef8cf-291">meno clienti aggiungono commenti o visualizzano la cronologia degli acquisti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-291">Fewer customers add comments or view their purchase history.</span></span> <span data-ttu-id="ef8cf-292">E probabilmente solo pochi dipendenti, in una singola area, avranno bisogno di gestire i contenuti e le campagne di marketing.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-292">And you likely only have a handful of employees, in a single region, that need to manage the content and marketing campaigns.</span></span> <span data-ttu-id="ef8cf-293">Con il ridimensionamento della progettazione monolitica, tutto il codice viene distribuito più volte.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-293">By scaling the monolithic design, all the code is deployed multiple times.</span></span>

<span data-ttu-id="ef8cf-294">Oltre al problema del ridimensionamento di tutti i componenti, le modifiche apportate a un singolo componente richiedono la completa riesecuzione dei test sull'intera applicazione e una ridistribuzione completa di tutte le istanze.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-294">In addition to the "scale everything" problem, changes to a single component require complete retesting of the entire application, and a complete redeployment of all the instances.</span></span>

<span data-ttu-id="ef8cf-295">L'approccio monolitico è comune e molte organizzazioni usano questo approccio architetturale nelle loro attività di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-295">The monolithic approach is common, and many organizations are developing with this architectural approach.</span></span> <span data-ttu-id="ef8cf-296">Molte stanno ottenendo buoni risultati, mentre altre stanno raggiungendo i limiti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-296">Many are having good enough results, while others are hitting limits.</span></span> <span data-ttu-id="ef8cf-297">Molte organizzazioni hanno progettato le proprie applicazioni usando questo modello perché gli strumenti e l'infrastruttura a loro disposizione erano troppo complesse per creare architetture orientate ai servizi e perché non ne hanno intravisto la necessità fino a quando le dimensioni dell'app non sono aumentate.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-297">Many designed their applications in this model, because the tools and infrastructure were too difficult to build service-oriented architectures (SOA), and they didn't see the need until the app grew.</span></span> <span data-ttu-id="ef8cf-298">Nel caso in cui i limiti dell'approccio monolitico stiano per essere raggiunti, la suddivisione dell'app per ottenere un uso migliore di contenitori e microservizi può costituire il passaggio logico successivo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-298">If you find you're hitting the limits of the monolithic approach, breaking up the app to enable it to better leverage containers and microservices may be the next logical step.</span></span>

![Figura 5-14](./media/image5-14.png)

<span data-ttu-id="ef8cf-300">La distribuzione delle applicazioni monolitiche in Microsoft Azure può essere realizzata usando macchine virtuali dedicate per ogni istanza.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-300">Deploying monolithic applications in Microsoft Azure can be achieved using dedicated VMs for each instance.</span></span> <span data-ttu-id="ef8cf-301">Con i [set di scalabilità di macchine virtuali di Microsoft Azure](https://docs.microsoft.com/azure/virtual-machine-scale-sets/) è possibile ridimensionare facilmente le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-301">Using [Azure Virtual Machine Scale Sets](https://docs.microsoft.com/azure/virtual-machine-scale-sets/), you can easily scale the VMs.</span></span> <span data-ttu-id="ef8cf-302">I [Servizi app di Azure](https://azure.microsoft.com/services/app-service/) sono in grado di eseguire le applicazioni monolitiche e di ridimensionare facilmente le istanze senza la necessità di gestire le macchine virtuali.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-302">[Azure App Services](https://azure.microsoft.com/services/app-service/) can run monolithic applications and easily scale instances without having to manage the VMs.</span></span> <span data-ttu-id="ef8cf-303">I Servizi app di Azure possono eseguire anche singole istanze di contenitori Docker, semplificando la distribuzione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-303">Azure App Services can run single instances of Docker containers as well, simplifying the deployment.</span></span> <span data-ttu-id="ef8cf-304">Usando Docker, è possibile distribuire una singola macchina virtuale come host Docker ed eseguire più istanze.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-304">Using Docker, you can deploy a single VM as a Docker host, and run multiple instances.</span></span> <span data-ttu-id="ef8cf-305">Usando il bilanciamento del carico di Azure, come illustrato nella figura 5-14, è possibile gestire il ridimensionamento.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-305">Using the Azure balancer, as shown in the Figure 5-14, you can manage scaling.</span></span>

<span data-ttu-id="ef8cf-306">La distribuzione ai vari host può essere gestita con le tecniche di distribuzione tradizionali.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-306">The deployment to the various hosts can be managed with traditional deployment techniques.</span></span> <span data-ttu-id="ef8cf-307">Gli host Docker possono essere gestiti con comandi come **docker run** eseguiti manualmente o tramite automazione, ad esempio le pipeline di recapito continuo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-307">The Docker hosts can be managed with commands like **docker run** performed manually, or through automation such as Continuous Delivery (CD) pipelines.</span></span>

### <a name="monolithic-application-deployed-as-a-container"></a><span data-ttu-id="ef8cf-308">Applicazione monolitica distribuita come contenitore</span><span class="sxs-lookup"><span data-stu-id="ef8cf-308">Monolithic application deployed as a container</span></span>

<span data-ttu-id="ef8cf-309">L'uso dei contenitori per gestire le distribuzioni di applicazioni monolitiche offre alcuni vantaggi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-309">There are benefits of using containers to manage monolithic application deployments.</span></span> <span data-ttu-id="ef8cf-310">Il ridimensionamento di istanze di contenitori è molto più veloce e semplice rispetto alla distribuzione di macchine virtuali aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-310">Scaling the instances of containers is far faster and easier than deploying additional VMs.</span></span> <span data-ttu-id="ef8cf-311">Anche quando si usano i set di scalabilità di macchine virtuali per ridimensionare le VM, la creazione delle istanze richiede tempo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-311">Even when using virtual machine scale sets to scale VMs, they take time to instance.</span></span> <span data-ttu-id="ef8cf-312">Quando viene distribuita come istanza dell'app, la configurazione dell'app viene gestita nell'ambito della macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-312">When deployed as app instances, the configuration of the app is managed as part of the VM.</span></span>

<span data-ttu-id="ef8cf-313">La distribuzione degli aggiornamenti come immagini Docker è molto più veloce ed efficiente per la rete.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-313">Deploying updates as Docker images is far faster and network efficient.</span></span> <span data-ttu-id="ef8cf-314">L'avvio delle immagini Docker richiede in genere pochi secondi, consentendo implementazioni più veloci.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-314">Docker Images typically start in seconds, speeding rollouts.</span></span> <span data-ttu-id="ef8cf-315">Per chiudere un'istanza di Docker, è sufficiente eseguire un comando `docker stop` che viene normalmente completato in meno di un secondo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-315">Tearing down a Docker instance is as easy as issuing a `docker stop` command, typically completing in less than a second.</span></span>

<span data-ttu-id="ef8cf-316">Poiché i contenitori sono implicitamente non modificabili per impostazione predefinita, le macchine virtuali danneggiate non costituiscono un problema, mentre gli script di aggiornamento potrebbero tralasciare alcune configurazioni o file specifici rimasti su disco.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-316">As containers are inherently immutable by design, you never need to worry about corrupted VMs, whereas update scripts might forget to account for some specific configuration or file left on disk.</span></span>

<span data-ttu-id="ef8cf-317">È possibile usare i contenitori Docker per la distribuzione monolitica di applicazioni Web più semplici.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-317">You can use Docker containers for monolithic deployment of simpler web applications.</span></span> <span data-ttu-id="ef8cf-318">Ciò migliora le pipeline di integrazione continua e distribuzione continua e consente di ottenere risultati ottimali dalla distribuzione alla produzione,</span><span class="sxs-lookup"><span data-stu-id="ef8cf-318">This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success.</span></span> <span data-ttu-id="ef8cf-319">Non più "Funziona sulla mia macchina, perché non funziona in produzione?"</span><span class="sxs-lookup"><span data-stu-id="ef8cf-319">No more “It works on my machine, why does it not work in production?”</span></span>

<span data-ttu-id="ef8cf-320">Un'architettura basata su microservizi offre numerosi vantaggi, ma al costo di una maggiore complessità.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-320">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="ef8cf-321">In alcuni casi i costi superano i vantaggi. Un'applicazione con distribuzione monolitica in esecuzione in un unico contenitore o in pochi contenitori è pertanto un'opzione migliore.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-321">In some cases, the costs outweigh the benefits, so a monolithic deployment application running in a single container or in just a few containers is a better option.</span></span>

<span data-ttu-id="ef8cf-322">Un'applicazione monolitica potrebbe non essere facilmente scomponibile in microservizi ben distinti.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-322">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="ef8cf-323">I microservizi dovrebbero funzionare indipendentemente uno dall'altro per garantire un'applicazione più resiliente.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-323">Microservices should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="ef8cf-324">Se non è possibile creare sezioni di funzionalità indipendenti dell'applicazione, una separazione aggiunge solo complessità.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-324">If you can't deliver independent feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="ef8cf-325">Per un'applicazione potrebbe non essere necessaria la scalabilità delle funzionalità in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-325">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="ef8cf-326">Molte applicazioni, quando è necessario ridimensionare più di una singola istanza, possono farlo tramite il processo relativamente semplice di clonazione dell'intera istanza.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-326">Many applications, when they need to scale beyond a single instance, can do so through the relatively simple process of cloning that entire instance.</span></span> <span data-ttu-id="ef8cf-327">Il lavoro aggiuntivo per separare l'applicazione in servizi distinti offre vantaggi minimi quando il ridimensionamento delle istanze complete dell'applicazione è semplice ed economicamente conveniente.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-327">The additional work to separate the application into discrete services provides minimal benefit when scaling full instances of the application is simple and cost-effective.</span></span>

<span data-ttu-id="ef8cf-328">Nelle prime fasi di sviluppo di un'applicazione, i limiti funzionali naturali potrebbero inoltre non essere ancora chiari.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-328">Early in the development of an application, you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="ef8cf-329">Durante lo sviluppo di un prodotto valido minimo, la separazione naturale potrebbe non essere ancora emersa.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-329">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span> <span data-ttu-id="ef8cf-330">Alcune di queste condizioni potrebbero essere temporanee.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-330">Some of these conditions might be temporary.</span></span> <span data-ttu-id="ef8cf-331">Si potrebbe iniziare creando un'applicazione monolitica e successivamente separare alcune funzionalità da sviluppare e distribuire come microservizi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-331">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="ef8cf-332">Altre condizioni potrebbero essere essenziali per lo spazio dei problemi dell'applicazione, il che significa che l'applicazione potrebbe non essere mai suddivisa in più microservizi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-332">Other conditions might be essential to the application's problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="ef8cf-333">La separazione di un'applicazione in più processi distinti presenta anche il problema del sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-333">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="ef8cf-334">La separazione delle funzionalità in processi diversi aumenta la complessità.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-334">There's more complexity in separating features into different processes.</span></span> <span data-ttu-id="ef8cf-335">I protocolli di comunicazione diventano più complessi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-335">The communication protocols become more complex.</span></span> <span data-ttu-id="ef8cf-336">Invece delle chiamate ai metodi, è necessario usare comunicazioni asincrone tra i servizi.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-336">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="ef8cf-337">Quando si passa a un'architettura di microservizi, è necessario aggiungere molti dei blocchi predefiniti implementati nella versione dei microservizi dell'applicazione eShopOnContainers: gestione del bus di eventi, resilienza dei messaggi e nuovi tentativi, coerenza futura e altro ancora.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-337">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the eShopOnContainers application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="ef8cf-338">L'[applicazione di riferimento eShopOnWeb](https://github.com/dotnet-architecture/eShopOnWeb), molto più semplice, supporta l'utilizzo del contenitore monolitico a contenitore singolo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-338">The much simpler [eShopOnWeb reference application](https://github.com/dotnet-architecture/eShopOnWeb) supports single-container monolithic container usage.</span></span> <span data-ttu-id="ef8cf-339">L'applicazione include un'applicazione Web con visualizzazioni MVC tradizionali, API Web e Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-339">The application includes one web application that includes traditional MVC views, web APIs, and Razor Pages.</span></span> <span data-ttu-id="ef8cf-340">L'applicazione può essere avviata dalla radice della soluzione usando i comandi `docker-compose build` e `docker-compose up`.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-340">This application can be launched from the solution root using the `docker-compose build` and `docker-compose up` commands.</span></span> <span data-ttu-id="ef8cf-341">Questo comando configura un contenitore per l'istanza Web usando l'oggetto `Dockerfile` all'interno della radice del progetto Web ed esegue il contenitore in una porta specifica.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-341">This command configures a container for the web instance, using the `Dockerfile` found in the web project's root, and runs the container on a specified port.</span></span> <span data-ttu-id="ef8cf-342">È possibile scaricare l'origine per questa applicazione da GitHub ed eseguirla in locale.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-342">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="ef8cf-343">Anche questa applicazione monolitica trae vantaggio dalla distribuzione in un ambiente basato su contenitori.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-343">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="ef8cf-344">Da una parte, la distribuzione in contenitori significa che ogni istanza dell'applicazione è eseguita nello stesso ambiente.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-344">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="ef8cf-345">Ciò include l'ambiente di sviluppo in cui hanno luogo le fasi di test preliminare e di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-345">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="ef8cf-346">Il team di sviluppo può eseguire l'applicazione in un ambiente basato su contenitori corrispondente all'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-346">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="ef8cf-347">Inoltre, la scalabilità orizzontale delle applicazioni incluse in contenitori è garantita a costi inferiori.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-347">In addition, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="ef8cf-348">L'uso di un ambiente basato su contenitori consente una maggiore condivisione di risorse rispetto agli ambienti di macchine virtuali tradizionali.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-348">Using a container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="ef8cf-349">Infine, l'inserimento dell'applicazione in contenitori impone una separazione tra la logica di business e il server di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-349">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="ef8cf-350">Di pari passo con la scalabilità orizzontale dell'applicazione, i diversi contenitori si baseranno tutti su un singolo supporto di archiviazione fisica,</span><span class="sxs-lookup"><span data-stu-id="ef8cf-350">As the application scales out, the multiple containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="ef8cf-351">che sarà in genere un server a disponibilità elevata che esegue un database SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-351">This storage medium would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="docker-support"></a><span data-ttu-id="ef8cf-352">Supporto Docker</span><span class="sxs-lookup"><span data-stu-id="ef8cf-352">Docker support</span></span>

<span data-ttu-id="ef8cf-353">Il progetto `eShopOnWeb` viene eseguito in .NET Core.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-353">The `eShopOnWeb` project runs on .NET Core.</span></span> <span data-ttu-id="ef8cf-354">Pertanto, può essere eseguito sia in contenitori basati su Linux che in contenitori basati su Windows.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-354">Therefore, it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="ef8cf-355">Si noti che per la distribuzione di Docker viene usato lo stesso tipo di host per SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-355">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="ef8cf-356">I contenitori basati su Linux consentono un footprint minore e sono preferibili.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-356">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="ef8cf-357">È possibile usare Visual Studio 2017 o versione successiva per aggiungere il supporto per Docker a un'applicazione esistente facendo clic con il pulsante destro del mouse su un progetto in **Esplora soluzioni** e scegliendo **Aggiungi** > **Supporto Docker**.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-357">You can use Visual Studio 2017 or later to add Docker support to an existing application by right-clicking on a project in **Solution Explorer** and choosing **Add** > **Docker Support**.</span></span> <span data-ttu-id="ef8cf-358">Questa operazione aggiunge i file necessari e modifica il progetto per il loro uso.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-358">This adds the files required and modifies the project to use them.</span></span> <span data-ttu-id="ef8cf-359">L'esempio `eShopOnWeb` corrente include già i file.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-359">The current `eShopOnWeb` sample already has these files in place.</span></span>

<span data-ttu-id="ef8cf-360">Il file `docker-compose.yml` a livello di soluzione contiene informazioni sulle immagini da compilare e i contenitori da avviare.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-360">The solution-level `docker-compose.yml` file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="ef8cf-361">Il file consente di usare il comando `docker-compose` per avviare più applicazioni contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-361">The file allows you to use the `docker-compose` command to launch multiple applications at the same time.</span></span> <span data-ttu-id="ef8cf-362">In questo caso avvia solo il progetto Web.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-362">In this case, it is only launching the Web project.</span></span> <span data-ttu-id="ef8cf-363">È anche possibile usarlo per configurare le dipendenze, ad esempio un contenitore di database separato.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-363">You can also use it to configure dependencies, such as a separate database container.</span></span>

```yml
version: '3'

services:
  eshopwebmvc:
    image: eshopwebmvc
    build:
      context: .
      dockerfile: src/Web/Dockerfile
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    ports:
      - "5106:5106"

networks:
  default:
    external:
      name: nat
```

<span data-ttu-id="ef8cf-364">Il file `docker-compose.yml` fa riferimento a `Dockerfile` nel progetto `Web`.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-364">The `docker-compose.yml` file references the `Dockerfile` in the `Web` project.</span></span> <span data-ttu-id="ef8cf-365">L'oggetto `Dockerfile` viene usato per specificare quale contenitore di base sarà usato e in che modo verrà configurata di conseguenza l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-365">The `Dockerfile` is used to specify which base container will be used and how the application will be configured on it.</span></span> <span data-ttu-id="ef8cf-366">In `Dockerfile` di `Web`:</span><span class="sxs-lookup"><span data-stu-id="ef8cf-366">The `Web`' `Dockerfile`:</span></span>

```Dockerfile
FROM mcr.microsoft.com/dotnet/core/sdk:3.1 AS build
WORKDIR /app

COPY *.sln .
COPY . .
WORKDIR /app/src/Web
RUN dotnet restore

RUN dotnet publish -c Release -o out

FROM mcr.microsoft.com/dotnet/core/aspnet:3.1 AS runtime
WORKDIR /app
COPY --from=build /app/src/Web/out ./

ENTRYPOINT ["dotnet", "Web.dll"]
```

### <a name="troubleshooting-docker-problems"></a><span data-ttu-id="ef8cf-367">Risoluzione dei problemi relativi a Docker</span><span class="sxs-lookup"><span data-stu-id="ef8cf-367">Troubleshooting Docker problems</span></span>

<span data-ttu-id="ef8cf-368">Dopo avere avviato l'applicazione in contenitori, questa rimane in esecuzione fino a quando non viene arrestata.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-368">Once you run the containerized application, it continues to run until you stop it.</span></span> <span data-ttu-id="ef8cf-369">È possibile visualizzare quali contenitori sono in esecuzione usando il comando `docker ps`.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-369">You can view which containers are running with the `docker ps` command.</span></span> <span data-ttu-id="ef8cf-370">È possibile arrestare un contenitore in esecuzione usando il comando `docker stop` e specificando l'ID del contenitore.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-370">You can stop a running container by using the `docker stop` command and specifying the container ID.</span></span>

<span data-ttu-id="ef8cf-371">I contenitori Docker in esecuzione potrebbero essere associati a porte che potrebbero altrimenti essere usate nell'ambiente di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-371">Note that running Docker containers may be bound to ports you might otherwise try to use in your development environment.</span></span> <span data-ttu-id="ef8cf-372">Se si tenta di eseguire un'applicazione o il debug dell'applicazione usando la stessa porta di un contenitore Docker in esecuzione, viene visualizzato un errore indicante l'impossibilità da parte del server di collegarsi a tale porta.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-372">If you try to run or debug an application using the same port as a running Docker container, you'll get an error stating that the server can't bind to that port.</span></span> <span data-ttu-id="ef8cf-373">L'arresto del contenitore dovrebbe anche in questo caso risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-373">Once again, stopping the container should resolve the issue.</span></span>

<span data-ttu-id="ef8cf-374">Se si vuole aggiungere il supporto per Docker all'applicazione tramite Visual Studio, assicurarsi che Docker Desktop sia in esecuzione quando si esegue questa operazione.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-374">If you want to add Docker support to your application using Visual Studio, make sure Docker Desktop is running when you do so.</span></span> <span data-ttu-id="ef8cf-375">La procedura guidata non verrà eseguita correttamente se Docker Desktop non è in esecuzione quando la procedura viene avviata.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-375">The wizard won't run correctly if Docker Desktop isn't running when you start the wizard.</span></span> <span data-ttu-id="ef8cf-376">Inoltre, la procedura guidata esamina la scelta del contenitore corrente per aggiungere il supporto per Docker corretto.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-376">In addition, the wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="ef8cf-377">Se si vuole aggiungere il supporto per i contenitori Windows, è necessario eseguire la procedura guidata mentre Docker Desktop è in esecuzione con i contenitori Windows configurati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-377">If you want to add support for Windows Containers, you need to run the wizard while you have Docker Desktop running with Windows Containers configured.</span></span> <span data-ttu-id="ef8cf-378">Se si vuole aggiungere il supporto per i contenitori Linux, eseguire la procedura guidata mentre Docker è in esecuzione con i contenitori Linux configurati.</span><span class="sxs-lookup"><span data-stu-id="ef8cf-378">If you want to add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

### <a name="references--common-web-architectures"></a><span data-ttu-id="ef8cf-379">Riferimenti - Architetture Web comuni</span><span class="sxs-lookup"><span data-stu-id="ef8cf-379">References – Common web architectures</span></span>

- <span data-ttu-id="ef8cf-380">**Architettura pulita**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-380">**The Clean Architecture**</span></span>  
  <https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html>
- <span data-ttu-id="ef8cf-381">**Architettura ad anelli**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-381">**The Onion Architecture**</span></span>  
  <https://jeffreypalermo.com/blog/the-onion-architecture-part-1/>
- <span data-ttu-id="ef8cf-382">**Il modello del repositoryThe Repository Pattern**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-382">**The Repository Pattern**</span></span>  
  <https://deviq.com/repository-pattern/>
- <span data-ttu-id="ef8cf-383">**Modello di soluzione Architettura pulita**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-383">**Clean Architecture Solution Template**</span></span>  
  <https://github.com/ardalis/cleanarchitecture>
- <span data-ttu-id="ef8cf-384">**Progettazione di un e-book di microservizi**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-384">**Architecting Microservices e-book**</span></span>  
  <https://aka.ms/MicroservicesEbook>
- <span data-ttu-id="ef8cf-385">**Progettazione basata su domini (DDD)**</span><span class="sxs-lookup"><span data-stu-id="ef8cf-385">**DDD (Domain-Driven Design)**</span></span>  
  <https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/>

>[!div class="step-by-step"]
><span data-ttu-id="ef8cf-386">[Successivo](architectural-principles.md)
>[precedente](common-client-side-web-technologies.md)</span><span class="sxs-lookup"><span data-stu-id="ef8cf-386">[Previous](architectural-principles.md)
[Next](common-client-side-web-technologies.md)</span></span>
