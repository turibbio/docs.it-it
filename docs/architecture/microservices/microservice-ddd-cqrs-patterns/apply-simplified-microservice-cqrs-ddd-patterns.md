---
title: Applicazione di schemi CQRS e DDD semplificati in un microservizio
description: Architettura dei microservizi .NET per le applicazioni .NET in contenitori | Riconoscere la relazione globale tra criteri CQRS e DDD.
ms.date: 10/08/2018
ms.openlocfilehash: e4e36bafff39f5f30d6371ed7c113322a85c3362
ms.sourcegitcommit: f87ad41b8e62622da126aa928f7640108c4eff98
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/07/2020
ms.locfileid: "80805584"
---
# <a name="apply-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="c757c-103">Applicare modelli CQRS e DDD semplificati in un microservizio</span><span class="sxs-lookup"><span data-stu-id="c757c-103">Apply simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="c757c-104">CQRS è uno schema architetturale che separa i modelli per la lettura e la scrittura dei dati.</span><span class="sxs-lookup"><span data-stu-id="c757c-104">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="c757c-105">Il termine correlato [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) è stato originariamente definito da Bertrand Meyer nel suo libro *Object Oriented Software Construction*.</span><span class="sxs-lookup"><span data-stu-id="c757c-105">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="c757c-106">L'idea di base è che è possibile dividere le operazioni di un sistema in due categorie nettamente separate:</span><span class="sxs-lookup"><span data-stu-id="c757c-106">The basic idea is that you can divide a system's operations into two sharply separated categories:</span></span>

- <span data-ttu-id="c757c-107">Query.</span><span class="sxs-lookup"><span data-stu-id="c757c-107">Queries.</span></span> <span data-ttu-id="c757c-108">Restituiscono un risultato, non modificano lo stato del sistema e sono prive di effetti collaterali.</span><span class="sxs-lookup"><span data-stu-id="c757c-108">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

- <span data-ttu-id="c757c-109">Comandi.</span><span class="sxs-lookup"><span data-stu-id="c757c-109">Commands.</span></span> <span data-ttu-id="c757c-110">Modificano lo stato di un sistema.</span><span class="sxs-lookup"><span data-stu-id="c757c-110">These change the state of a system.</span></span>

<span data-ttu-id="c757c-111">CQS è un concetto semplice: si tratta di metodi all'interno dello stesso oggetto essendo query o comandi.</span><span class="sxs-lookup"><span data-stu-id="c757c-111">CQS is a simple concept: it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="c757c-112">Ogni metodo restituisce lo stato oppure modifica lo stato, ma non esegue entrambe le operazioni.</span><span class="sxs-lookup"><span data-stu-id="c757c-112">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="c757c-113">Anche un singolo oggetto di schema di repository può essere conforme a CQS.</span><span class="sxs-lookup"><span data-stu-id="c757c-113">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="c757c-114">CQS può essere considerato un principio fondamentale per CQRS.</span><span class="sxs-lookup"><span data-stu-id="c757c-114">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="c757c-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) è stato introdotto da Greg Young e fortemente promosso da Udi Dahan e altri esperti.</span><span class="sxs-lookup"><span data-stu-id="c757c-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="c757c-116">È basato sul principio CQS, sebbene sia più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="c757c-116">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="c757c-117">Può essere considerato uno schema basato sui comandi e sugli eventi, oltre che facoltativamente sui messaggi asincroni.</span><span class="sxs-lookup"><span data-stu-id="c757c-117">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="c757c-118">In molti casi, CQRS è correlato a scenari più avanzati, come l'uso di un database per le operazioni di lettura (query) diverso da quello per le operazioni di scrittura (aggiornamenti).</span><span class="sxs-lookup"><span data-stu-id="c757c-118">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="c757c-119">Inoltre, un sistema CQRS più evoluto potrebbe implementare la [determinazione dell'origine degli eventi](https://martinfowler.com/eaaDev/EventSourcing.html) per il database degli aggiornamenti, consentendo di archiviare solo gli eventi nel modello di dominio, anziché archiviare i dati sullo stato corrente.</span><span class="sxs-lookup"><span data-stu-id="c757c-119">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="c757c-120">Tuttavia, questo approccio non viene utilizzato in questa guida.</span><span class="sxs-lookup"><span data-stu-id="c757c-120">However, this approach is not used in this guide.</span></span> <span data-ttu-id="c757c-121">Questa guida utilizza l'approccio CQRS più semplice, che consiste nel separare le query dai comandi.</span><span class="sxs-lookup"><span data-stu-id="c757c-121">This guide uses the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="c757c-122">L'aspetto di separazione di CQRS viene ottenuto mediante il raggruppamento delle operazioni di query in un livello e dei comandi in un altro livello.</span><span class="sxs-lookup"><span data-stu-id="c757c-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="c757c-123">Ogni livello dispone di un proprio modello di dati (si noti che parliamo di modello, non necessariamente di un database diverso) e viene creato tramite una specifica combinazione di schemi e tecnologie.</span><span class="sxs-lookup"><span data-stu-id="c757c-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="c757c-124">Cosa ancora più importante, i due livelli possono essere contenuti nello stesso livello o microservizio, come illustrato nell'esempio (microservizio per gli ordini) usato per questa guida.</span><span class="sxs-lookup"><span data-stu-id="c757c-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="c757c-125">In alternativa, possono essere implementati in diversi microservizi o processi, in modo da poter essere ottimizzati e scalati in orizzontale separatamente senza influire l'uno sull'altro.</span><span class="sxs-lookup"><span data-stu-id="c757c-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="c757c-126">CQRS significa creare due oggetti per un'operazione di lettura/scrittura, dove in altri contesti ne è presente uno.</span><span class="sxs-lookup"><span data-stu-id="c757c-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="c757c-127">Esistono diversi motivi per cui è consigliabile disporre di un database denormalizzato per le letture (informazioni in proposito sono disponibili nella documentazione più avanzata su CQRS).</span><span class="sxs-lookup"><span data-stu-id="c757c-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="c757c-128">In questo caso, non useremo tale approccio, perché il nostro obiettivo è avere maggiore flessibilità nelle query invece di limitare le query con vincoli dagli schemi DDD come gli aggregati.</span><span class="sxs-lookup"><span data-stu-id="c757c-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="c757c-129">Un esempio di questo tipo di servizio è il microservizio per gli ordini dell'applicazione di riferimento eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="c757c-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="c757c-130">Questo servizio implementa un microservizio basato su un approccio CQRS semplificato.</span><span class="sxs-lookup"><span data-stu-id="c757c-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="c757c-131">Usa una singola origine dati o un singolo database, ma due modelli logici, più schemi DDD per il dominio transazionale, come illustrato nella figura 7-2.</span><span class="sxs-lookup"><span data-stu-id="c757c-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 7-2.</span></span>

![Diagramma che mostra un microservizio CQRS e DDD semplificato di alto livello.](./media/apply-simplified-microservice-cqrs-ddd-patterns/simplified-cqrs-ddd-microservice.png)

<span data-ttu-id="c757c-133">**Figura 7-2**.</span><span class="sxs-lookup"><span data-stu-id="c757c-133">**Figure 7-2**.</span></span> <span data-ttu-id="c757c-134">Microservizio semplificato basato su CQRS e DDD</span><span class="sxs-lookup"><span data-stu-id="c757c-134">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="c757c-135">Il Microservizio logico "Ordinante" include il database di ordinazione, che può essere, ma non deve essere lo stesso host Docker.</span><span class="sxs-lookup"><span data-stu-id="c757c-135">The Logical "Ordering" Microservice includes its Ordering database, which can be, but doesn't have to be, the same Docker host.</span></span> <span data-ttu-id="c757c-136">Il fatto che il database sia incluso nello stesso host Docker è ottimale per lo sviluppo, ma non per la produzione.</span><span class="sxs-lookup"><span data-stu-id="c757c-136">Having the database in the same Docker host is good for development, but not for production.</span></span>

<span data-ttu-id="c757c-137">Il livello dell'applicazione può essere la stessa API Web.</span><span class="sxs-lookup"><span data-stu-id="c757c-137">The application layer can be the Web API itself.</span></span> <span data-ttu-id="c757c-138">L'aspetto di progettazione importante a questo proposito è che il microservizio ha suddiviso le query e i ViewModel (modelli di dati creati appositamente per le applicazioni client) dai comandi, dal modello di dominio e dalle transazioni seguendo lo schema CQRS.</span><span class="sxs-lookup"><span data-stu-id="c757c-138">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="c757c-139">Questo approccio mantiene le query indipendenti da restrizioni e vincoli provenienti da schemi DDD che sono applicabili esclusivamente per le transazioni e gli aggiornamenti, come descritto nelle sezioni successive.</span><span class="sxs-lookup"><span data-stu-id="c757c-139">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="c757c-140">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="c757c-140">Additional resources</span></span>

- <span data-ttu-id="c757c-141">**Greg Young. Controllo delle versioni in un sistema** di origine di eventi (gratuito per la lettura online e-book)</span><span class="sxs-lookup"><span data-stu-id="c757c-141">**Greg Young. Versioning in an Event Sourced System** (Free to read online e-book) \</span></span>
   <https://leanpub.com/esversioning/read>

>[!div class="step-by-step"]
><span data-ttu-id="c757c-142">[Successivo](index.md)
>[precedente](eshoponcontainers-cqrs-ddd-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="c757c-142">[Previous](index.md)
[Next](eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
