---
title: Dati distribuiti
description: Confronto tra l'archiviazione dei dati in applicazioni monolitiche e native del cloud.
author: robvet
ms.date: 05/13/2020
ms.openlocfilehash: 28513f8691c06cf58ed14d57bf7830bb35d94852
ms.sourcegitcommit: ee5b798427f81237a3c23d1fd81fff7fdc21e8d3
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/28/2020
ms.locfileid: "84144396"
---
# <a name="distributed-data"></a><span data-ttu-id="aae9d-103">Dati distribuiti</span><span class="sxs-lookup"><span data-stu-id="aae9d-103">Distributed data</span></span>

<span data-ttu-id="aae9d-104">Come è stato illustrato in questo libro, un approccio nativo del cloud cambia la modalità di progettazione, distribuzione e gestione delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="aae9d-104">As we've seen throughout this book, a cloud-native approach changes the way you design, deploy, and manage applications.</span></span> <span data-ttu-id="aae9d-105">Cambia anche la modalità di gestione e archiviazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-105">It also changes the way you manage and store data.</span></span>

<span data-ttu-id="aae9d-106">La figura 5-1 contrasta le differenze.</span><span class="sxs-lookup"><span data-stu-id="aae9d-106">Figure 5-1 contrasts the differences.</span></span>

![Archiviazione dei dati in applicazioni native del cloud](./media/distributed-data.png)

<span data-ttu-id="aae9d-108">**Figura 5-1**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-108">**Figure 5-1**.</span></span> <span data-ttu-id="aae9d-109">Gestione dei dati in applicazioni native del cloud</span><span class="sxs-lookup"><span data-stu-id="aae9d-109">Data management in cloud-native applications</span></span>

<span data-ttu-id="aae9d-110">Gli sviluppatori esperti riconoscono facilmente l'architettura sul lato sinistro della figura 5-1.</span><span class="sxs-lookup"><span data-stu-id="aae9d-110">Experienced developers will easily recognize the architecture on the left-side of figure 5-1.</span></span> <span data-ttu-id="aae9d-111">In questa *applicazione monolitica*, i componenti del servizio business si collocano insieme in un livello di servizi condivisi, condividendo i dati da un singolo database relazionale.</span><span class="sxs-lookup"><span data-stu-id="aae9d-111">In this *monolithic application*, business service components collocate together in a shared services tier, sharing data from a single relational database.</span></span>

<span data-ttu-id="aae9d-112">In molti casi, un database singolo mantiene la gestione dei dati semplice.</span><span class="sxs-lookup"><span data-stu-id="aae9d-112">In many ways, a single database keeps data management simple.</span></span> <span data-ttu-id="aae9d-113">L'esecuzione di query sui dati in più tabelle è semplice.</span><span class="sxs-lookup"><span data-stu-id="aae9d-113">Querying data across multiple tables is straightforward.</span></span> <span data-ttu-id="aae9d-114">Modifiche apportate all'aggiornamento dei dati o a tutti i rollback.</span><span class="sxs-lookup"><span data-stu-id="aae9d-114">Changes to data update together or they all rollback.</span></span> <span data-ttu-id="aae9d-115">[Le transazioni ACID](https://docs.microsoft.com/windows/desktop/cossdk/acid-properties) garantiscono coerenza assoluta e immediata.</span><span class="sxs-lookup"><span data-stu-id="aae9d-115">[ACID transactions](https://docs.microsoft.com/windows/desktop/cossdk/acid-properties) guarantee strong and immediate consistency.</span></span>

<span data-ttu-id="aae9d-116">Progettazione per il cloud nativo, viene adottato un approccio diverso.</span><span class="sxs-lookup"><span data-stu-id="aae9d-116">Designing for cloud-native, we take a different approach.</span></span> <span data-ttu-id="aae9d-117">Sul lato destro della figura 5-1, si noti il modo in cui la funzionalità di business si separa in microservizi piccoli e indipendenti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-117">On the right-side of Figure 5-1, note how business functionality segregates into small, independent microservices.</span></span> <span data-ttu-id="aae9d-118">Ogni microservizio incapsula una funzionalità aziendale specifica e i relativi dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-118">Each microservice encapsulates a specific business capability and its own data.</span></span> <span data-ttu-id="aae9d-119">Il database monolitico viene decomposto in un modello di dati distribuito con molti database più piccoli, ognuno dei quali è allineato a un microservizio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-119">The monolithic database decomposes into a distributed data model with many smaller databases, each aligning with a microservice.</span></span> <span data-ttu-id="aae9d-120">Quando il fumo si cancella, emergiamo con una progettazione che espone un *database per ogni microservizio*.</span><span class="sxs-lookup"><span data-stu-id="aae9d-120">When the smoke clears, we emerge with a design that exposes a *database per microservice*.</span></span>

## <a name="database-per-microservice-why"></a><span data-ttu-id="aae9d-121">Database per microservizi, perché?</span><span class="sxs-lookup"><span data-stu-id="aae9d-121">Database-per-microservice, why?</span></span>

<span data-ttu-id="aae9d-122">Questo database per microservizio offre numerosi vantaggi, specialmente per i sistemi che devono evolversi rapidamente e supportano una scalabilità massiccia.</span><span class="sxs-lookup"><span data-stu-id="aae9d-122">This database per microservice provides many benefits, especially for systems that must evolve rapidly and support massive scale.</span></span> <span data-ttu-id="aae9d-123">Con questo modello...</span><span class="sxs-lookup"><span data-stu-id="aae9d-123">With this model...</span></span>

- <span data-ttu-id="aae9d-124">I dati del dominio vengono incapsulati all'interno del servizio</span><span class="sxs-lookup"><span data-stu-id="aae9d-124">Domain data is encapsulated within the service</span></span>
- <span data-ttu-id="aae9d-125">Lo schema dati può evolvere senza influito direttamente sugli altri servizi</span><span class="sxs-lookup"><span data-stu-id="aae9d-125">Data schema can evolve without directly impacting other services</span></span>
- <span data-ttu-id="aae9d-126">Ogni archivio dati può essere ridimensionato in modo indipendente</span><span class="sxs-lookup"><span data-stu-id="aae9d-126">Each data store can independently scale</span></span>
- <span data-ttu-id="aae9d-127">Un errore dell'archivio dati in un servizio non influirà direttamente sugli altri servizi</span><span class="sxs-lookup"><span data-stu-id="aae9d-127">A data store failure in one service won't directly impact other services</span></span>

<span data-ttu-id="aae9d-128">La separazione dei dati consente anche a ogni microservizio di implementare il tipo di archivio dati ottimizzato in modo ottimale per il carico di lavoro, le esigenze di archiviazione e i modelli di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-128">Segregating data also enables each microservice to implement the data store type that is best optimized for its workload, storage needs, and read/write patterns.</span></span> <span data-ttu-id="aae9d-129">Le scelte includono archivi dati relazionali, documenti, chiave-valore e anche basati su Graph.</span><span class="sxs-lookup"><span data-stu-id="aae9d-129">Choices include relational, document, key-value, and even graph-based data stores.</span></span>

<span data-ttu-id="aae9d-130">La figura 5-2 presenta il principio della persistenza poliglotta in un sistema nativo del cloud.</span><span class="sxs-lookup"><span data-stu-id="aae9d-130">Figure 5-2 presents the principle of polyglot persistence in a cloud-native system.</span></span>

![Persistenza dei dati poliglotta](./media/polyglot-data-persistence.png)

<span data-ttu-id="aae9d-132">**Figura 5-2**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-132">**Figure 5-2**.</span></span> <span data-ttu-id="aae9d-133">Persistenza dei dati poliglotta</span><span class="sxs-lookup"><span data-stu-id="aae9d-133">Polyglot data persistence</span></span>

<span data-ttu-id="aae9d-134">Si noti che nella figura precedente il modo in cui ogni microservizio supporta un tipo diverso di archivio dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-134">Note in the previous figure how each microservice supports a different type of data store.</span></span>

- <span data-ttu-id="aae9d-135">Il microservizio Catalogo prodotti usa un database relazionale per gestire la struttura relazionale avanzata dei dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-135">The product catalog microservice consumes a relational database to accommodate the rich relational structure of its underlying data.</span></span>
- <span data-ttu-id="aae9d-136">Il microservizio carrello acquisti utilizza una cache distribuita che supporta il proprio archivio dati semplice e chiave-valore.</span><span class="sxs-lookup"><span data-stu-id="aae9d-136">The shopping cart microservice consumes a distributed cache that supports its simple, key-value data store.</span></span>
- <span data-ttu-id="aae9d-137">Il microservizio degli ordini usa un database di documenti NoSql per le operazioni di scrittura insieme a un archivio chiave/valore altamente denormalizzato per gestire volumi elevati di operazioni di lettura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-137">The ordering microservice consumes both a NoSql document database for write operations along with a highly denormalized key/value store to accommodate high-volumes of read operations.</span></span>
  
<span data-ttu-id="aae9d-138">Sebbene i database relazionali rimangano rilevanti per i microservizi con dati complessi, i database NoSQL hanno acquisito una notevole popolarità.</span><span class="sxs-lookup"><span data-stu-id="aae9d-138">While relational databases remain relevant for microservices with complex data, NoSQL databases have gained considerable popularity.</span></span> <span data-ttu-id="aae9d-139">Forniscono scalabilità e disponibilità elevate.</span><span class="sxs-lookup"><span data-stu-id="aae9d-139">They provide massive scale and high availability.</span></span> <span data-ttu-id="aae9d-140">La loro natura senza schema consente agli sviluppatori di uscire da un'architettura di classi di dati tipizzate e ORM che rendono la modifica costosa e dispendiosa in termini di tempo.</span><span class="sxs-lookup"><span data-stu-id="aae9d-140">Their schemaless nature allows developers to move away from an architecture of typed data classes and ORMs that make change expensive and time-consuming.</span></span> <span data-ttu-id="aae9d-141">I database NoSQL vengono coperti più avanti in questo capitolo.</span><span class="sxs-lookup"><span data-stu-id="aae9d-141">We cover NoSQL databases later in this chapter.</span></span>

 <span data-ttu-id="aae9d-142">Sebbene l'incapsulamento dei dati in microservizi distinti possa aumentare l'agilità, le prestazioni e la scalabilità, presenta anche molti problemi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-142">While encapsulating  data into separate microservices can increase agility, performance, and scalability, it also presents many challenges.</span></span> <span data-ttu-id="aae9d-143">Nella sezione successiva si esamineranno tali problemi insieme ai modelli e alle procedure per risolverli.</span><span class="sxs-lookup"><span data-stu-id="aae9d-143">In the next section, we discuss these challenges along with patterns and practices to help overcome them.</span></span>  

## <a name="cross-service-queries"></a><span data-ttu-id="aae9d-144">Query tra servizi</span><span class="sxs-lookup"><span data-stu-id="aae9d-144">Cross-service queries</span></span>

<span data-ttu-id="aae9d-145">Anche se i microservizi sono indipendenti e si concentrano su funzionalità funzionali specifiche, ad esempio inventario, spedizione o ordinamento, spesso richiedono l'integrazione con altri microservizi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-145">While microservices are independent and focus on specific functional capabilities, like inventory, shipping, or ordering, they frequently require integration with other microservices.</span></span> <span data-ttu-id="aae9d-146">Spesso l'integrazione prevede un microservizio che *esegue query* su un altro per i dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-146">Often the integration involves one microservice *querying* another for data.</span></span> <span data-ttu-id="aae9d-147">La figura 5-3 illustra lo scenario.</span><span class="sxs-lookup"><span data-stu-id="aae9d-147">Figure 5-3 shows the scenario.</span></span>

![Esecuzione di query tra microservizi](./media/cross-service-query.png)

<span data-ttu-id="aae9d-149">**Figura 5-3**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-149">**Figure 5-3**.</span></span> <span data-ttu-id="aae9d-150">Esecuzione di query tra microservizi</span><span class="sxs-lookup"><span data-stu-id="aae9d-150">Querying across microservices</span></span>

<span data-ttu-id="aae9d-151">Nella figura precedente viene visualizzato un microservizio carrello acquisti che aggiunge un elemento al carrello acquisti di un utente.</span><span class="sxs-lookup"><span data-stu-id="aae9d-151">In the preceding figure, we see a shopping basket microservice that adds an item to a user's shopping basket.</span></span> <span data-ttu-id="aae9d-152">Mentre l'archivio dati per questo microservizio contiene i dati relativi a basket e voce, non mantiene i dati relativi ai prodotti o ai prezzi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-152">While the data store for this microservice contains basket and line item data, it doesn't maintain product or pricing data.</span></span> <span data-ttu-id="aae9d-153">Gli elementi di dati sono invece di proprietà dei microservizi Catalog e pricing.</span><span class="sxs-lookup"><span data-stu-id="aae9d-153">Instead, those data items are owned by the catalog and pricing microservices.</span></span> <span data-ttu-id="aae9d-154">Questa operazione presenta un problema.</span><span class="sxs-lookup"><span data-stu-id="aae9d-154">This presents a problem.</span></span> <span data-ttu-id="aae9d-155">In che modo il microservizio carrello acquisti aggiunge un prodotto al carrello acquisti dell'utente quando non contiene prodotti o dati sui prezzi nel database?</span><span class="sxs-lookup"><span data-stu-id="aae9d-155">How can the shopping basket microservice add a product to the user's shopping basket when it doesn't have product nor pricing data in its database?</span></span>

<span data-ttu-id="aae9d-156">Una delle opzioni descritte nel capitolo 4 è una [chiamata http diretta](service-to-service-communication.md#queries) dal carrello acquisti ai microservizi del catalogo e dei prezzi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-156">One option discussed in Chapter 4 is a [direct HTTP call](service-to-service-communication.md#queries) from the shopping basket to the catalog and pricing microservices.</span></span> <span data-ttu-id="aae9d-157">Tuttavia, nel capitolo 4, abbiamo detto che l'HTTP sincrono chiama *due* microservizi insieme, riducendo la loro autonomia e diminuendo i vantaggi architettonici.</span><span class="sxs-lookup"><span data-stu-id="aae9d-157">However, in chapter 4, we said synchronous HTTP calls *couple* microservices together, reducing their autonomy and diminishing their architectural benefits.</span></span>

<span data-ttu-id="aae9d-158">È anche possibile implementare un modello Request/Reply con code separate in ingresso e in uscita per ogni servizio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-158">We could also implement a request-reply pattern with separate inbound and outbound queues for each service.</span></span> <span data-ttu-id="aae9d-159">Tuttavia, questo modello è complesso e richiede un plumbing per correlare i messaggi di richiesta e risposta.</span><span class="sxs-lookup"><span data-stu-id="aae9d-159">However, this pattern is complicated and requires plumbing to correlate request and response messages.</span></span>
<span data-ttu-id="aae9d-160">Mentre separa le chiamate del microservizio back-end, il servizio chiamante deve comunque attendere in modo sincrono il completamento della chiamata.</span><span class="sxs-lookup"><span data-stu-id="aae9d-160">While it does decouple the backend microservice calls, the calling service must still synchronously wait for the call to complete.</span></span> <span data-ttu-id="aae9d-161">Congestione della rete, errori temporanei o un microservizio di overload e possono comportare operazioni a esecuzione prolungata e anche non riuscite.</span><span class="sxs-lookup"><span data-stu-id="aae9d-161">Network congestion, transient faults, or an overloaded microservice and can result in long-running and even failed operations.</span></span>

<span data-ttu-id="aae9d-162">Al contrario, un modello ampiamente accettato per la rimozione delle dipendenze tra i servizi è il [modello di vista materializzata](https://docs.microsoft.com/azure/architecture/patterns/materialized-view), illustrato nella figura 5-4.</span><span class="sxs-lookup"><span data-stu-id="aae9d-162">Instead, a widely accepted pattern for removing cross-service dependencies is the [Materialized View Pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view), shown in Figure 5-4.</span></span>

![Modello di vista materializzata](./media/materialized-view-pattern.png)

<span data-ttu-id="aae9d-164">**Figura 5-4**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-164">**Figure 5-4**.</span></span> <span data-ttu-id="aae9d-165">Modello di vista materializzata</span><span class="sxs-lookup"><span data-stu-id="aae9d-165">Materialized View Pattern</span></span>

<span data-ttu-id="aae9d-166">Con questo modello, si inserisce una tabella di dati locale (nota come *modello di lettura*) nel servizio carrello acquisti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-166">With this pattern, you place a local data table (known as a *read model*) in the shopping basket service.</span></span> <span data-ttu-id="aae9d-167">Questa tabella contiene una copia denormalizzata dei dati necessari per i microservizi Product e pricing.</span><span class="sxs-lookup"><span data-stu-id="aae9d-167">This table contains a denormalized copy of the data needed from the product and pricing microservices.</span></span> <span data-ttu-id="aae9d-168">La copia dei dati direttamente nel microservizio carrello acquisti Elimina la necessità di costosi chiamate tra servizi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-168">Copying the data directly into the shopping basket microservice eliminates the need for expensive cross-service calls.</span></span> <span data-ttu-id="aae9d-169">Con i dati locali per il servizio, è possibile migliorare il tempo di risposta e l'affidabilità del servizio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-169">With the data local to the service, you improve the service's response time and reliability.</span></span> <span data-ttu-id="aae9d-170">Inoltre, la presenza di una propria copia dei dati rende più resiliente il servizio carrello acquisti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-170">Additionally, having its own copy of the data makes the shopping basket service more resilient.</span></span> <span data-ttu-id="aae9d-171">Se il servizio catalogo non è più disponibile, non avrà alcun effetto direttamente sul servizio carrello acquisti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-171">If the catalog service should become unavailable, it wouldn't directly impact the shopping basket service.</span></span> <span data-ttu-id="aae9d-172">Il carrello acquisti può continuare a funzionare con i dati provenienti dal proprio negozio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-172">The shopping basket can continue operating with the data from its own store.</span></span>

<span data-ttu-id="aae9d-173">Il problema con questo approccio è che ora si hanno dati duplicati nel sistema.</span><span class="sxs-lookup"><span data-stu-id="aae9d-173">The catch with this approach is that you now have duplicate data in your system.</span></span> <span data-ttu-id="aae9d-174">Tuttavia, la duplicazione *strategica* dei dati nei sistemi nativi del cloud è una prassi stabilita e non è considerata un anti-modello o una procedura non valida.</span><span class="sxs-lookup"><span data-stu-id="aae9d-174">However, *strategically* duplicating data in cloud-native systems is an established practice and not considered an anti-pattern, or bad practice.</span></span> <span data-ttu-id="aae9d-175">Tenere presente che un *solo servizio* può essere proprietario di un set di dati e avere un'autorità.</span><span class="sxs-lookup"><span data-stu-id="aae9d-175">Keep in mind that *one and only one service* can own a data set and have authority over it.</span></span> <span data-ttu-id="aae9d-176">È necessario sincronizzare i modelli di lettura quando il sistema di registrazione viene aggiornato.</span><span class="sxs-lookup"><span data-stu-id="aae9d-176">You'll need to synchronize the read models when the system of record is updated.</span></span> <span data-ttu-id="aae9d-177">La sincronizzazione viene in genere implementata tramite messaggistica asincrona con un [modello di pubblicazione/sottoscrizione](service-to-service-communication.md#events), come illustrato nella figura 5,4.</span><span class="sxs-lookup"><span data-stu-id="aae9d-177">Synchronization is typically implemented via asynchronous messaging with a [publish/subscribe pattern](service-to-service-communication.md#events), as shown in Figure 5.4.</span></span>

## <a name="distributed-transactions"></a><span data-ttu-id="aae9d-178">Transazioni distribuite</span><span class="sxs-lookup"><span data-stu-id="aae9d-178">Distributed transactions</span></span>

<span data-ttu-id="aae9d-179">Quando si eseguono query sui dati tra microservizi è difficile, l'implementazione di una transazione tra più microservizi è ancora più complessa.</span><span class="sxs-lookup"><span data-stu-id="aae9d-179">While querying data across microservices is difficult, implementing a transaction across several microservices is even more complex.</span></span> <span data-ttu-id="aae9d-180">La sfida inerente alla gestione della coerenza dei dati tra origini dati indipendenti in microservizi diversi non può essere sottostata.</span><span class="sxs-lookup"><span data-stu-id="aae9d-180">The inherent challenge of maintaining data consistency across independent data sources in different microservices can't be understated.</span></span> <span data-ttu-id="aae9d-181">La mancanza di transazioni distribuite nelle applicazioni native del cloud significa che è necessario gestire le transazioni distribuite a livello di programmazione.</span><span class="sxs-lookup"><span data-stu-id="aae9d-181">The lack of distributed transactions in cloud-native applications means that you must manage distributed transactions programmatically.</span></span> <span data-ttu-id="aae9d-182">Si passa da un mondo di *coerenza immediata* a quello di *coerenza finale*.</span><span class="sxs-lookup"><span data-stu-id="aae9d-182">You move from a world of *immediate consistency* to that of *eventual consistency*.</span></span>

<span data-ttu-id="aae9d-183">La figura 5-5 illustra il problema.</span><span class="sxs-lookup"><span data-stu-id="aae9d-183">Figure 5-5 shows the problem.</span></span>

![Transazione nel modello saga](./media/saga-transaction-operation.png)

<span data-ttu-id="aae9d-185">**Figura 5-5**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-185">**Figure 5-5**.</span></span> <span data-ttu-id="aae9d-186">Implementazione di una transazione tra microservizi</span><span class="sxs-lookup"><span data-stu-id="aae9d-186">Implementing a transaction across microservices</span></span>

<span data-ttu-id="aae9d-187">Nella figura precedente cinque microservizi indipendenti partecipano a una transazione distribuita che crea un ordine.</span><span class="sxs-lookup"><span data-stu-id="aae9d-187">In the preceding figure, five independent microservices participate in a distributed transaction that creates an order.</span></span> <span data-ttu-id="aae9d-188">Ogni microservizio mantiene il proprio archivio dati e implementa una transazione locale per il relativo archivio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-188">Each microservice maintains its own data store and implements a local transaction for its store.</span></span> <span data-ttu-id="aae9d-189">Per creare l'ordine, la transazione locale per *ogni* singolo microservizio deve avere esito *positivo oppure è* necessario interrompere ed eseguire il rollback dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="aae9d-189">To create the order, the local transaction for *each* individual microservice must succeed, or *all* must abort and roll back the operation.</span></span> <span data-ttu-id="aae9d-190">Sebbene il supporto transazionale predefinito sia disponibile all'interno di ogni microservizio, non esiste alcun supporto per una transazione distribuita che si estenderebbe su tutti i cinque servizi per mantenere coerenti i dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-190">While built-in transactional support is available inside each of the microservices, there's no support for a distributed transaction that would span across all five services to keep data consistent.</span></span>

<span data-ttu-id="aae9d-191">È invece necessario costruire questa transazione distribuita *a livello di codice*.</span><span class="sxs-lookup"><span data-stu-id="aae9d-191">Instead, you must construct this distributed transaction *programmatically*.</span></span>

<span data-ttu-id="aae9d-192">Uno dei modelli più diffusi per l'aggiunta del supporto transazionale distribuito è il modello saga.</span><span class="sxs-lookup"><span data-stu-id="aae9d-192">A popular pattern for adding distributed transactional support is the Saga pattern.</span></span> <span data-ttu-id="aae9d-193">Viene implementata raggruppando le transazioni locali a livello di codice e richiamando in modo sequenziale ciascuna di esse.</span><span class="sxs-lookup"><span data-stu-id="aae9d-193">It's implemented by grouping local transactions together programmatically and sequentially invoking each one.</span></span> <span data-ttu-id="aae9d-194">Se alcune transazioni locali hanno esito negativo, la saga interrompe l'operazione e richiama un set di [transazioni di compensazione](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction).</span><span class="sxs-lookup"><span data-stu-id="aae9d-194">If any of the local transactions fail, the Saga aborts the operation and invokes a set of [compensating transactions](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction).</span></span> <span data-ttu-id="aae9d-195">Le transazioni di compensazione annullano le modifiche apportate dalle transazioni locali precedenti e ripristinano la coerenza dei dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-195">The compensating transactions undo the changes made by the preceding local transactions and restore data consistency.</span></span> <span data-ttu-id="aae9d-196">La figura 5-6 Mostra una transazione non riuscita con il modello saga.</span><span class="sxs-lookup"><span data-stu-id="aae9d-196">Figure 5-6 shows a failed transaction with the Saga pattern.</span></span>

![Eseguire il rollback nel modello saga](./media/saga-rollback-operation.png)

<span data-ttu-id="aae9d-198">**Figura 5-6**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-198">**Figure 5-6**.</span></span> <span data-ttu-id="aae9d-199">Rollback di una transazione</span><span class="sxs-lookup"><span data-stu-id="aae9d-199">Rolling back a transaction</span></span>

<span data-ttu-id="aae9d-200">Nella figura precedente, l'operazione di *aggiornamento dell'inventario* non è riuscita nel microservizio di inventario.</span><span class="sxs-lookup"><span data-stu-id="aae9d-200">In the previous figure, the *Update Inventory* operation has failed in the Inventory microservice.</span></span> <span data-ttu-id="aae9d-201">La saga richiama un set di transazioni di compensazione (in rosso) per modificare i conteggi dell'inventario, annullare il pagamento e l'ordine e restituire i dati per ogni microservizio a uno stato coerente.</span><span class="sxs-lookup"><span data-stu-id="aae9d-201">The Saga invokes a set of compensating transactions (in red) to adjust the inventory counts, cancel the payment and the order, and return the data for each microservice back to a consistent state.</span></span>

<span data-ttu-id="aae9d-202">I modelli di Saga vengono in genere sottoposti a coreografia come una serie di eventi correlati o orchestrati come un set di comandi correlati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-202">Saga patterns are typically choreographed as a series of related events, or orchestrated as a set of related commands.</span></span> <span data-ttu-id="aae9d-203">Nel capitolo 4 è stato illustrato il modello Service aggregator che costituisce la base per un'implementazione di Saga orchestrata.</span><span class="sxs-lookup"><span data-stu-id="aae9d-203">In Chapter 4, we discussed the service aggregator pattern that would be the foundation for an orchestrated saga implementation.</span></span> <span data-ttu-id="aae9d-204">Sono stati anche discussi gli eventi con il bus di servizio di Azure e gli argomenti di griglia di eventi di Azure che sarebbero una base per un'implementazione della saga con coreografia.</span><span class="sxs-lookup"><span data-stu-id="aae9d-204">We also discussed eventing along with Azure Service Bus and Azure Event Grid topics that would be a foundation for a choreographed saga implementation.</span></span>

## <a name="high-volume-data"></a><span data-ttu-id="aae9d-205">Dati con volumi elevati</span><span class="sxs-lookup"><span data-stu-id="aae9d-205">High volume data</span></span>

<span data-ttu-id="aae9d-206">Le grandi applicazioni native del cloud supportano spesso requisiti di volumi elevati di dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-206">Large cloud-native applications often support high-volume data requirements.</span></span> <span data-ttu-id="aae9d-207">In questi scenari, le tecniche tradizionali di archiviazione dei dati possono causare colli di bottiglia.</span><span class="sxs-lookup"><span data-stu-id="aae9d-207">In these scenarios, traditional data storage techniques can cause bottlenecks.</span></span> <span data-ttu-id="aae9d-208">Per i sistemi complessi distribuiti su larga scala, sia separazione di responsabilità per query e comandi (CQRS) che l'origine eventi possono migliorare le prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="aae9d-208">For complex systems that deploy on a large scale, both Command and Query Responsibility Segregation (CQRS) and Event Sourcing may improve application performance.</span></span>  

### <a name="cqrs"></a><span data-ttu-id="aae9d-209">CQRS</span><span class="sxs-lookup"><span data-stu-id="aae9d-209">CQRS</span></span>

<span data-ttu-id="aae9d-210">[CQRS](https://docs.microsoft.com/azure/architecture/patterns/cqrs)è uno schema architettonico che consente di ottimizzare le prestazioni, la scalabilità e la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="aae9d-210">[CQRS](https://docs.microsoft.com/azure/architecture/patterns/cqrs), is an architectural pattern that can help maximize performance, scalability, and security.</span></span> <span data-ttu-id="aae9d-211">Il criterio separa le operazioni di lettura dei dati dalle operazioni che scrivono i dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-211">The pattern separates operations that read data from those operations that write data.</span></span>

<span data-ttu-id="aae9d-212">Per gli scenari normali, lo stesso modello di entità e l'oggetto archivio dati vengono utilizzati per le operazioni *di lettura e* scrittura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-212">For normal scenarios, the same entity model and data repository object are used for *both* read and write operations.</span></span>

<span data-ttu-id="aae9d-213">Uno scenario di dati con volumi elevati può tuttavia trarre vantaggio da modelli e tabelle di dati separati per operazioni di lettura e scrittura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-213">However, a high volume data scenario can benefit from separate models and data tables for reads and writes.</span></span> <span data-ttu-id="aae9d-214">Per migliorare le prestazioni, l'operazione di lettura può eseguire una query su una rappresentazione altamente denormalizzata dei dati per evitare costosi join di tabella ripetitivi e blocchi di tabella.</span><span class="sxs-lookup"><span data-stu-id="aae9d-214">To improve performance, the read operation could query against a highly denormalized representation of the data to avoid expensive repetitive table joins and table locks.</span></span> <span data-ttu-id="aae9d-215">L'operazione di *scrittura* , nota come *comando*, verrebbe aggiornata rispetto a una rappresentazione completamente normalizzata dei dati che garantirebbe la coerenza.</span><span class="sxs-lookup"><span data-stu-id="aae9d-215">The *write* operation, known as a *command*, would update against a fully normalized representation of the data that would guarantee consistency.</span></span> <span data-ttu-id="aae9d-216">È quindi necessario implementare un meccanismo per mantenendo sincronizzate entrambe le rappresentazioni. In genere, ogni volta che la tabella di scrittura viene modificata, pubblica un evento che replica la modifica nella tabella Read.</span><span class="sxs-lookup"><span data-stu-id="aae9d-216">You then need to implement a mechanism to keep both representations in sync. Typically, whenever the write table is modified, it publishes an event that replicates the modification to the read table.</span></span>

<span data-ttu-id="aae9d-217">La figura 5-7 illustra un'implementazione del modello CQRS.</span><span class="sxs-lookup"><span data-stu-id="aae9d-217">Figure 5-7 shows an implementation of the CQRS pattern.</span></span>

![separazione di responsabilità per query e comandi](./media/cqrs-implementation.png)

<span data-ttu-id="aae9d-219">**Figura 5-7**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-219">**Figure 5-7**.</span></span> <span data-ttu-id="aae9d-220">Implementazione di CQRS</span><span class="sxs-lookup"><span data-stu-id="aae9d-220">CQRS implementation</span></span>

<span data-ttu-id="aae9d-221">Nella figura precedente sono implementati i modelli di query e di comando separati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-221">In the previous figure, separate command and query models are implemented.</span></span> <span data-ttu-id="aae9d-222">Ogni operazione di scrittura dei dati viene salvata nell'archivio di scrittura e quindi propagata nell'archivio di lettura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-222">Each data write operation is saved to the write store and then propagated to the read store.</span></span> <span data-ttu-id="aae9d-223">Prestare particolare attenzione al modo in cui il processo di propagazione dei dati opera sul principio della [coerenza finale](https://www.cloudcomputingpatterns.org/eventual_consistency/).</span><span class="sxs-lookup"><span data-stu-id="aae9d-223">Pay close attention to how the data propagation process operates on the principle of [eventual consistency](https://www.cloudcomputingpatterns.org/eventual_consistency/).</span></span> <span data-ttu-id="aae9d-224">Il modello di lettura viene sincronizzato con il modello di scrittura, ma è possibile che si verifichi un ritardo nel processo.</span><span class="sxs-lookup"><span data-stu-id="aae9d-224">The read model eventually synchronizes with the write model, but there may be some lag in the process.</span></span> <span data-ttu-id="aae9d-225">Nella sezione successiva verrà illustrata la coerenza finale.</span><span class="sxs-lookup"><span data-stu-id="aae9d-225">We discuss eventual consistency in the next section.</span></span>

<span data-ttu-id="aae9d-226">Questa separazione consente la scalabilità delle letture e scritture in modo indipendente.</span><span class="sxs-lookup"><span data-stu-id="aae9d-226">This separation enables reads and writes to scale independently.</span></span> <span data-ttu-id="aae9d-227">Le operazioni di lettura utilizzano uno schema ottimizzato per le query, mentre le Scritture utilizzano uno schema ottimizzato per gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-227">Read operations use a schema optimized for queries, while the writes use a schema optimized for updates.</span></span> <span data-ttu-id="aae9d-228">Le query di lettura vengono eseguite su dati denormalizzati, mentre la logica di business complessa può essere applicata al modello di scrittura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-228">Read queries go against denormalized data, while complex business logic can be applied to the write model.</span></span> <span data-ttu-id="aae9d-229">È anche possibile imporre una sicurezza più stretta sulle operazioni di scrittura rispetto a quelle che espongono le letture.</span><span class="sxs-lookup"><span data-stu-id="aae9d-229">As well, you might impose tighter security on write operations than those exposing reads.</span></span>

<span data-ttu-id="aae9d-230">L'implementazione di CQRS può migliorare le prestazioni dell'applicazione per i servizi nativi del cloud.</span><span class="sxs-lookup"><span data-stu-id="aae9d-230">Implementing CQRS can improve application performance for cloud-native services.</span></span> <span data-ttu-id="aae9d-231">Tuttavia, si ottiene un progetto più complesso.</span><span class="sxs-lookup"><span data-stu-id="aae9d-231">However, it does result in a more complex design.</span></span> <span data-ttu-id="aae9d-232">Applicare questo principio in modo accurato e strategico a tali sezioni dell'applicazione nativa del cloud che ne trarranno vantaggio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-232">Apply this principle carefully and strategically to those sections of your cloud-native application that will benefit from it.</span></span> <span data-ttu-id="aae9d-233">Per altre informazioni su CQRS, vedere la documentazione Microsoft relativa ai [microservizi .NET: architettura per le applicazioni .NET in contenitori](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/apply-simplified-microservice-cqrs-ddd-patterns).</span><span class="sxs-lookup"><span data-stu-id="aae9d-233">For more on CQRS, see the Microsoft book [.NET Microservices: Architecture for Containerized .NET Applications](https://docs.microsoft.com/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/apply-simplified-microservice-cqrs-ddd-patterns).</span></span>

### <a name="event-sourcing"></a><span data-ttu-id="aae9d-234">Origine eventi</span><span class="sxs-lookup"><span data-stu-id="aae9d-234">Event sourcing</span></span>

<span data-ttu-id="aae9d-235">Un altro approccio per l'ottimizzazione degli scenari con volumi elevati di dati riguarda l'origine di [eventi](https://docs.microsoft.com/azure/architecture/patterns/event-sourcing).</span><span class="sxs-lookup"><span data-stu-id="aae9d-235">Another approach to optimizing high volume data scenarios involves [Event Sourcing](https://docs.microsoft.com/azure/architecture/patterns/event-sourcing).</span></span>

<span data-ttu-id="aae9d-236">In genere, un sistema archivia lo stato corrente di un'entità di dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-236">A system typically stores the current state of a data entity.</span></span> <span data-ttu-id="aae9d-237">Se un utente modifica il numero di telefono, ad esempio, il record del cliente viene aggiornato con il nuovo numero.</span><span class="sxs-lookup"><span data-stu-id="aae9d-237">If a user changes their phone number, for example, the customer record is updated with the new number.</span></span> <span data-ttu-id="aae9d-238">Si conosce sempre lo stato corrente di un'entità di dati, ma ogni aggiornamento sovrascrive lo stato precedente.</span><span class="sxs-lookup"><span data-stu-id="aae9d-238">We always know the current state of a data entity, but each update overwrites the previous state.</span></span>

<span data-ttu-id="aae9d-239">Nella maggior parte dei casi, questo modello funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="aae9d-239">In most cases, this model works fine.</span></span> <span data-ttu-id="aae9d-240">Nei sistemi con volumi elevati, tuttavia, l'overhead del blocco transazionale e delle frequenti operazioni di aggiornamento può influisca sulle prestazioni del database, sulla velocità di risposta e sul limite di scalabilità.</span><span class="sxs-lookup"><span data-stu-id="aae9d-240">In high volume systems, however, overhead from transactional locking and frequent update operations can impact database performance, responsiveness, and limit scalability.</span></span>

<span data-ttu-id="aae9d-241">L'origine eventi adotta un approccio diverso per l'acquisizione dei dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-241">Event Sourcing takes a different approach to capturing data.</span></span> <span data-ttu-id="aae9d-242">Ogni operazione che influiscono sui dati viene salvata in modo permanente in un archivio eventi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-242">Each operation that affects data is persisted to an event store.</span></span> <span data-ttu-id="aae9d-243">Anziché aggiornare lo stato di un record di dati, ogni modifica viene accodata a un elenco sequenziale di eventi passati, simile al Ledger di un revisore.</span><span class="sxs-lookup"><span data-stu-id="aae9d-243">Instead of updating the state of a data record, we append each change to a sequential list of past events - similar to an accountant's ledger.</span></span> <span data-ttu-id="aae9d-244">L'archivio eventi diventa il sistema di registrazione per i dati.</span><span class="sxs-lookup"><span data-stu-id="aae9d-244">The Event Store becomes the system of record for the data.</span></span> <span data-ttu-id="aae9d-245">Viene usato per propagare varie viste materializzate all'interno del contesto delimitato di un microservizio.</span><span class="sxs-lookup"><span data-stu-id="aae9d-245">It's used to propagate various materialized views within the bounded context of a microservice.</span></span> <span data-ttu-id="aae9d-246">Nella figura 5,8 è illustrato il modello.</span><span class="sxs-lookup"><span data-stu-id="aae9d-246">Figure 5.8 shows the pattern.</span></span>

![Origine eventi](./media/event-sourcing.png)

<span data-ttu-id="aae9d-248">**Figura 5-8**.</span><span class="sxs-lookup"><span data-stu-id="aae9d-248">**Figure 5-8**.</span></span> <span data-ttu-id="aae9d-249">Origine eventi</span><span class="sxs-lookup"><span data-stu-id="aae9d-249">Event Sourcing</span></span>

<span data-ttu-id="aae9d-250">Nella figura precedente si noti come ogni voce (in blu) per il carrello acquisti di un utente viene aggiunta a un archivio eventi sottostante.</span><span class="sxs-lookup"><span data-stu-id="aae9d-250">In the previous figure, note how each entry (in blue) for a user's shopping cart is appended to an underlying event store.</span></span> <span data-ttu-id="aae9d-251">Nella vista materializzata adiacente, il sistema proietta lo stato corrente riproducendo tutti gli eventi associati a ogni carrello acquisti.</span><span class="sxs-lookup"><span data-stu-id="aae9d-251">In the adjoining materialized view, the system projects the current state by replaying all the events associated with each shopping cart.</span></span> <span data-ttu-id="aae9d-252">Questa vista, o lettura modello, viene quindi esposta all'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="aae9d-252">This view, or read model, is then exposed back to the UI.</span></span> <span data-ttu-id="aae9d-253">Gli eventi possono inoltre essere integrati con applicazioni e sistemi esterni o sottoposti a query per determinare lo stato corrente di un'entità.</span><span class="sxs-lookup"><span data-stu-id="aae9d-253">Events can also be integrated with external systems and applications or queried to determine the current state of an entity.</span></span> <span data-ttu-id="aae9d-254">Con questo approccio si mantiene la cronologia.</span><span class="sxs-lookup"><span data-stu-id="aae9d-254">With this approach, you maintain history.</span></span> <span data-ttu-id="aae9d-255">Non solo si conosce lo stato corrente di un'entità, ma anche il modo in cui è stato raggiunto questo stato.</span><span class="sxs-lookup"><span data-stu-id="aae9d-255">You know not only the current state of an entity, but also how you reached this state.</span></span>

<span data-ttu-id="aae9d-256">In termini meccanici, l'origine eventi semplifica il modello di scrittura.</span><span class="sxs-lookup"><span data-stu-id="aae9d-256">Mechanically speaking, event sourcing simplifies the write model.</span></span> <span data-ttu-id="aae9d-257">Non sono presenti aggiornamenti o eliminazioni.</span><span class="sxs-lookup"><span data-stu-id="aae9d-257">There are no updates or deletes.</span></span> <span data-ttu-id="aae9d-258">L'aggiunta di ogni voce di dati come evento non modificabile riduce al minimo i conflitti di contesa, di blocco e di concorrenza associati a database relazionali.</span><span class="sxs-lookup"><span data-stu-id="aae9d-258">Appending each data entry as an immutable event minimizes contention, locking, and concurrency conflicts associated with relational databases.</span></span> <span data-ttu-id="aae9d-259">La compilazione di modelli di lettura con il modello di vista materializzata consente di separare la visualizzazione dal modello di scrittura e scegliere l'archivio dati migliore per ottimizzare le esigenze dell'interfaccia utente dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="aae9d-259">Building read models with the materialized view pattern enables you to decouple the view from the write model and choose the best data store to optimize the needs of your application UI.</span></span>

<span data-ttu-id="aae9d-260">Per questo modello, si consideri un archivio dati che supporta direttamente il sourcing degli eventi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-260">For this pattern, consider a data store that directly supports event sourcing.</span></span> <span data-ttu-id="aae9d-261">Azure Cosmos DB, MongoDB, Cassandra, CouchDB e RavenDB sono candidati validi.</span><span class="sxs-lookup"><span data-stu-id="aae9d-261">Azure Cosmos DB, MongoDB, Cassandra, CouchDB, and RavenDB are good candidates.</span></span>

<span data-ttu-id="aae9d-262">Come per tutti i modelli e le tecnologie, implementare in modo strategico e quando necessario.</span><span class="sxs-lookup"><span data-stu-id="aae9d-262">As with all patterns and technologies, implement strategically and when needed.</span></span> <span data-ttu-id="aae9d-263">Sebbene l'origine di eventi possa fornire prestazioni e scalabilità migliorate, si tratta di una riduzione della complessità e di una curva di apprendimento.</span><span class="sxs-lookup"><span data-stu-id="aae9d-263">While event sourcing can provide increased performance and scalability, it comes at the expense of complexity and a learning curve.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="aae9d-264">[Precedente](service-mesh-communication-infrastructure.md) 
> [Avanti](relational-vs-nosql-data.md)</span><span class="sxs-lookup"><span data-stu-id="aae9d-264">[Previous](service-mesh-communication-infrastructure.md)
[Next](relational-vs-nosql-data.md)</span></span>
