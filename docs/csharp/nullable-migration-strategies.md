---
title: Aggiornare la codebase per usare i tipi di riferimento Nullable
description: Scegliere la strategia migliore per aggiornare la codebase per usare i tipi di riferimento Nullable.
ms.technology: csharp-null-safety
ms.date: 07/31/2019
ms.openlocfilehash: 5909eb9ffe1f5398fc2eb74848b82f8fe9516548
ms.sourcegitcommit: fff146ba3fd1762c8c432d95c8b877825ae536fc
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/08/2020
ms.locfileid: "82975333"
---
# <a name="update-libraries-to-use-nullable-reference-types-and-communicate-nullable-rules-to-callers"></a><span data-ttu-id="13bb4-103">Aggiornare le librerie per usare i tipi di riferimento nullable e comunicare le regole Nullable ai chiamanti</span><span class="sxs-lookup"><span data-stu-id="13bb4-103">Update libraries to use nullable reference types and communicate nullable rules to callers</span></span>

<span data-ttu-id="13bb4-104">L'aggiunta di [tipi di riferimento Nullable](nullable-references.md) significa che è possibile dichiarare se è `null` consentito o meno un valore per ogni variabile.</span><span class="sxs-lookup"><span data-stu-id="13bb4-104">The addition of [nullable reference types](nullable-references.md) means you can declare whether or not a `null` value is allowed or expected for every variable.</span></span> <span data-ttu-id="13bb4-105">Inoltre, è possibile applicare `AllowNull`diversi attributi:, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen`e `NotNullIfNotNull` per descrivere completamente gli Stati null di argomenti e valori restituiti.</span><span class="sxs-lookup"><span data-stu-id="13bb4-105">In addition, you can apply a number of attributes: `AllowNull`, `DisallowNull`, `MaybeNull`, `NotNull`, `NotNullWhen`, `MaybeNullWhen`, and `NotNullIfNotNull` to completely describe the null states of argument and return values.</span></span> <span data-ttu-id="13bb4-106">Che offre un'esperienza ottimale durante la scrittura del codice.</span><span class="sxs-lookup"><span data-stu-id="13bb4-106">That provides a great experience as you write code.</span></span> <span data-ttu-id="13bb4-107">Si ottengono avvisi se una variabile che non ammette i valori null può `null`essere impostata su.</span><span class="sxs-lookup"><span data-stu-id="13bb4-107">You get warnings if a non-nullable variable might be set to `null`.</span></span> <span data-ttu-id="13bb4-108">Si ottengono avvisi se una variabile nullable non è controllata da null prima di dereferenziarla.</span><span class="sxs-lookup"><span data-stu-id="13bb4-108">You get warnings if a nullable variable isn't null-checked before you dereference it.</span></span> <span data-ttu-id="13bb4-109">L'aggiornamento delle librerie può richiedere tempo, ma i profitti valgono.</span><span class="sxs-lookup"><span data-stu-id="13bb4-109">Updating your libraries can take time, but the payoffs are worth it.</span></span> <span data-ttu-id="13bb4-110">Maggiori sono le informazioni fornite al compilatore *quando* un `null` valore è consentito o proibito, gli avvisi migliori che gli utenti dell'API otterranno.</span><span class="sxs-lookup"><span data-stu-id="13bb4-110">The more information you provide to the compiler about *when* a `null` value is allowed or prohibited, the better warnings users of your API will get.</span></span> <span data-ttu-id="13bb4-111">Iniziamo con un esempio familiare.</span><span class="sxs-lookup"><span data-stu-id="13bb4-111">Let's start with a familiar example.</span></span> <span data-ttu-id="13bb4-112">Si supponga che la libreria disponga dell'API seguente per recuperare una stringa di risorsa:</span><span class="sxs-lookup"><span data-stu-id="13bb4-112">Imagine your library has the following API to retrieve a resource string:</span></span>

```csharp
bool TryGetMessage(string key, out string message)
```

<span data-ttu-id="13bb4-113">L'esempio precedente segue il modello `Try*` familiare in .NET.</span><span class="sxs-lookup"><span data-stu-id="13bb4-113">The preceding example follows the familiar `Try*` pattern in .NET.</span></span> <span data-ttu-id="13bb4-114">Per questa API sono disponibili due argomenti di riferimento: `key` e `message` .</span><span class="sxs-lookup"><span data-stu-id="13bb4-114">There are two reference arguments for this API: the `key` and the `message` parameter.</span></span> <span data-ttu-id="13bb4-115">Questa API presenta le regole seguenti relative al valore null di questi argomenti:</span><span class="sxs-lookup"><span data-stu-id="13bb4-115">This API has the following rules relating to the nullness of these arguments:</span></span>

- <span data-ttu-id="13bb4-116">I chiamanti non `null` devono passare come argomento `key`per.</span><span class="sxs-lookup"><span data-stu-id="13bb4-116">Callers shouldn't pass `null` as the argument for `key`.</span></span>
- <span data-ttu-id="13bb4-117">I chiamanti possono passare una variabile il cui `null` valore è come argomento `message`per.</span><span class="sxs-lookup"><span data-stu-id="13bb4-117">Callers can pass a variable whose value is `null` as the argument for `message`.</span></span>
- <span data-ttu-id="13bb4-118">Se il `TryGetMessage` metodo restituisce `true`, il valore di `message` non è null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-118">If the `TryGetMessage` method returns `true`, the value of `message` isn't null.</span></span> <span data-ttu-id="13bb4-119">Se il valore restituito è `false,` il valore di `message` (e il relativo stato null) è null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-119">If the return value is `false,` the value of `message` (and its null state) is null.</span></span>

<span data-ttu-id="13bb4-120">La regola per `key` può essere interamente espressa dal tipo di variabile: `key` deve essere un tipo di riferimento non nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-120">The rule for `key` can be completely expressed by the variable type: `key` should be a non-nullable reference type.</span></span> <span data-ttu-id="13bb4-121">Il `message` parametro è più complesso.</span><span class="sxs-lookup"><span data-stu-id="13bb4-121">The `message` parameter is more complex.</span></span> <span data-ttu-id="13bb4-122">Consente `null` come argomento, ma garantisce che, in seguito all'esito positivo `out` , l'argomento non sia null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-122">It allows `null` as the argument, but guarantees that, on success, that `out` argument isn't null.</span></span> <span data-ttu-id="13bb4-123">Per questi scenari, è necessario un vocabolario più completo per descrivere le aspettative.</span><span class="sxs-lookup"><span data-stu-id="13bb4-123">For these scenarios, you need a richer vocabulary to describe the expectations.</span></span>

<span data-ttu-id="13bb4-124">Per l'aggiornamento della libreria per i riferimenti Nullable è necessario `?` più di un'irrigazione su alcune variabili e nomi di tipo.</span><span class="sxs-lookup"><span data-stu-id="13bb4-124">Updating your library for nullable references requires more than sprinkling `?` on some of the variables and type names.</span></span> <span data-ttu-id="13bb4-125">L'esempio precedente mostra che è necessario esaminare le API e prendere in considerazione le aspettative per ogni argomento di input.</span><span class="sxs-lookup"><span data-stu-id="13bb4-125">The preceding example shows that you need to examine your APIs and consider your expectations for each input argument.</span></span> <span data-ttu-id="13bb4-126">Prendere in considerazione le garanzie per il valore restituito e `out` gli `ref` eventuali argomenti o sul valore restituito dal metodo.</span><span class="sxs-lookup"><span data-stu-id="13bb4-126">Consider the guarantees for the return value, and any `out` or `ref` arguments upon the method's return.</span></span> <span data-ttu-id="13bb4-127">Comunicare quindi tali regole al compilatore e il compilatore fornirà avvisi quando i chiamanti non rispettano tali regole.</span><span class="sxs-lookup"><span data-stu-id="13bb4-127">Then communicate those rules to the compiler, and the compiler will provide warnings when callers don't abide by those rules.</span></span>

<span data-ttu-id="13bb4-128">Questo lavoro richiede tempo.</span><span class="sxs-lookup"><span data-stu-id="13bb4-128">This work takes time.</span></span> <span data-ttu-id="13bb4-129">Iniziamo con le strategie per rendere la libreria o l'applicazione compatibile con i valori null, con il bilanciamento di altri requisiti e risultati finali.</span><span class="sxs-lookup"><span data-stu-id="13bb4-129">Let's start with strategies to make your library or application nullable-aware, while balancing other requirements and deliverables.</span></span> <span data-ttu-id="13bb4-130">Si vedrà come bilanciare lo sviluppo in corso abilitando i tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-130">You'll see how to balance ongoing development enabling nullable reference types.</span></span> <span data-ttu-id="13bb4-131">Verranno illustrate le esigenze per le definizioni di tipo generico.</span><span class="sxs-lookup"><span data-stu-id="13bb4-131">You'll learn challenges for generic type definitions.</span></span> <span data-ttu-id="13bb4-132">Si apprenderà come applicare gli attributi per descrivere le condizioni preliminari e successive sulle singole API.</span><span class="sxs-lookup"><span data-stu-id="13bb4-132">You'll learn to apply attributes to describe pre- and post-conditions on individual APIs.</span></span>

## <a name="choose-a-strategy-for-nullable-reference-types"></a><span data-ttu-id="13bb4-133">Scegliere una strategia per i tipi di riferimento Nullable</span><span class="sxs-lookup"><span data-stu-id="13bb4-133">Choose a strategy for nullable reference types</span></span>

<span data-ttu-id="13bb4-134">La prima scelta è se i tipi di riferimento nullable devono essere attivati o disattivati per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="13bb4-134">The first choice is whether nullable reference types should be on or off by default.</span></span> <span data-ttu-id="13bb4-135">Sono disponibili due strategie:</span><span class="sxs-lookup"><span data-stu-id="13bb4-135">You have two strategies:</span></span>

- <span data-ttu-id="13bb4-136">Abilitare i tipi di riferimento Nullable per l'intero progetto e disabilitarlo nel codice non pronto.</span><span class="sxs-lookup"><span data-stu-id="13bb4-136">Enable nullable reference types for the entire project, and disable it in code that's not ready.</span></span>
- <span data-ttu-id="13bb4-137">Abilitare solo i tipi di riferimento Nullable per il codice che è stato annotato per i tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-137">Only enable nullable reference types for code that's been annotated for nullable reference types.</span></span>

<span data-ttu-id="13bb4-138">La prima strategia funziona meglio quando si aggiungono altre funzionalità alla libreria durante l'aggiornamento per i tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-138">The first strategy works best when you're adding other features to the library as you update it for nullable reference types.</span></span> <span data-ttu-id="13bb4-139">Tutti i nuovi sviluppi supportano i valori null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-139">All new development is nullable aware.</span></span> <span data-ttu-id="13bb4-140">Quando si aggiorna il codice esistente, si abilitano i tipi di riferimento nullable in tali classi.</span><span class="sxs-lookup"><span data-stu-id="13bb4-140">As you update existing code, you enable nullable reference types in those classes.</span></span>

<span data-ttu-id="13bb4-141">Seguendo questa prima strategia, si eseguono le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="13bb4-141">Following this first strategy, you do the following:</span></span>

1. <span data-ttu-id="13bb4-142">Abilitare i tipi di riferimento Nullable per l'intero progetto aggiungendo `<Nullable>enable</Nullable>` l'elemento ai file *csproj* .</span><span class="sxs-lookup"><span data-stu-id="13bb4-142">Enable nullable reference types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="13bb4-143">Aggiungere il `#nullable disable` pragma a ogni file di origine nel progetto.</span><span class="sxs-lookup"><span data-stu-id="13bb4-143">Add the `#nullable disable` pragma to every source file in your project.</span></span>
1. <span data-ttu-id="13bb4-144">Quando si lavora su ogni file, rimuovere il pragma e risolvere eventuali avvisi.</span><span class="sxs-lookup"><span data-stu-id="13bb4-144">As you work on each file, remove the pragma and address any warnings.</span></span>

<span data-ttu-id="13bb4-145">Questa prima strategia ha più lavoro iniziale per aggiungere il pragma a ogni file.</span><span class="sxs-lookup"><span data-stu-id="13bb4-145">This first strategy has more up-front work to add the pragma to every file.</span></span> <span data-ttu-id="13bb4-146">Il vantaggio è che ogni nuovo file di codice aggiunto al progetto sarà abilitato per i valori null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-146">The advantage is that every new code file added to the project will be nullable enabled.</span></span> <span data-ttu-id="13bb4-147">Eventuali nuovi lavori saranno in grado di riconoscere i valori null. è necessario aggiornare solo il codice esistente.</span><span class="sxs-lookup"><span data-stu-id="13bb4-147">Any new work will be nullable aware; only existing code must be updated.</span></span>

<span data-ttu-id="13bb4-148">La seconda strategia funziona meglio se la libreria è in genere stabile e l'obiettivo principale dello sviluppo è l'adozione di tipi di riferimento Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-148">The second strategy works better if the library is generally stable, and the main focus of the development is to adopt nullable reference types.</span></span> <span data-ttu-id="13bb4-149">Si attivano i tipi di riferimento Nullable durante l'annotazione delle API.</span><span class="sxs-lookup"><span data-stu-id="13bb4-149">You turn on nullable reference types as you annotate APIs.</span></span> <span data-ttu-id="13bb4-150">Al termine, si abilitano i tipi di riferimento Nullable per l'intero progetto.</span><span class="sxs-lookup"><span data-stu-id="13bb4-150">When you've finished, you enable nullable reference types for the entire project.</span></span>

<span data-ttu-id="13bb4-151">Seguendo questa seconda strategia si eseguono le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="13bb4-151">Following this second strategy you do the following:</span></span>

1. <span data-ttu-id="13bb4-152">Aggiungere il `#nullable enable` pragma al file che si desidera rendere compatibile con Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-152">Add the `#nullable enable` pragma to the file you want to make nullable aware.</span></span>
1. <span data-ttu-id="13bb4-153">Risolvere tutti gli avvisi.</span><span class="sxs-lookup"><span data-stu-id="13bb4-153">Address any warnings.</span></span>
1. <span data-ttu-id="13bb4-154">Continuare questi primi due passaggi fino a quando non è stata resa disponibile l'intera libreria Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-154">Continue these first two steps until you've made the entire library nullable aware.</span></span>
1. <span data-ttu-id="13bb4-155">Abilitare i tipi Nullable per l'intero progetto aggiungendo l' `<Nullable>enable</Nullable>` elemento ai file *csproj* .</span><span class="sxs-lookup"><span data-stu-id="13bb4-155">Enable nullable types for the entire project by adding the `<Nullable>enable</Nullable>` element to your *csproj* files.</span></span>
1. <span data-ttu-id="13bb4-156">Rimuovere i `#nullable enable` pragma, perché non sono più necessari.</span><span class="sxs-lookup"><span data-stu-id="13bb4-156">Remove the `#nullable enable` pragmas, as they're no longer needed.</span></span>

<span data-ttu-id="13bb4-157">Questa seconda strategia ha meno lavoro in primo piano.</span><span class="sxs-lookup"><span data-stu-id="13bb4-157">This second strategy has less work up-front.</span></span> <span data-ttu-id="13bb4-158">Il compromesso consiste nel fatto che la prima attività quando si crea un nuovo file consiste nell'aggiungere il pragma e renderlo compatibile con i valori null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-158">The tradeoff is that the first task when you create a new file is to add the pragma and make it nullable aware.</span></span> <span data-ttu-id="13bb4-159">Se gli sviluppatori del team dimenticano, il nuovo codice si trova ora nel backlog di lavoro per rendere il codice Nullable compatibile.</span><span class="sxs-lookup"><span data-stu-id="13bb4-159">If any developers on your team forget, that new code is now in the backlog of work to make all code nullable aware.</span></span>

<span data-ttu-id="13bb4-160">La scelta di queste strategie dipende dalla quantità di attività di sviluppo attive nel progetto.</span><span class="sxs-lookup"><span data-stu-id="13bb4-160">Which of these strategies you pick depends on how much active development is taking place in your project.</span></span> <span data-ttu-id="13bb4-161">Il progetto è più maturo e stabile, migliore sarà la seconda strategia.</span><span class="sxs-lookup"><span data-stu-id="13bb4-161">The more mature and stable your project, the better the second strategy.</span></span> <span data-ttu-id="13bb4-162">Maggiore è la maggior parte delle funzionalità sviluppate, migliore sarà la prima strategia.</span><span class="sxs-lookup"><span data-stu-id="13bb4-162">The more features being developed, the better the first strategy.</span></span>

## <a name="should-nullable-warnings-introduce-breaking-changes"></a><span data-ttu-id="13bb4-163">Gli avvisi Nullable introducono modifiche di rilievo?</span><span class="sxs-lookup"><span data-stu-id="13bb4-163">Should nullable warnings introduce breaking changes?</span></span>

<span data-ttu-id="13bb4-164">Prima di abilitare i tipi di riferimento Nullable, le variabili sono considerate *Nullable ignare*.</span><span class="sxs-lookup"><span data-stu-id="13bb4-164">Before you enable nullable reference types, variables are considered *nullable oblivious*.</span></span> <span data-ttu-id="13bb4-165">Quando si abilitano i tipi di riferimento Nullable, tutte queste variabili *non ammettono valori null*.</span><span class="sxs-lookup"><span data-stu-id="13bb4-165">Once you enable nullable reference types, all those variables are *non-nullable*.</span></span> <span data-ttu-id="13bb4-166">Il compilatore emetterà avvisi se tali variabili non vengono inizializzate su valori non null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-166">The compiler will issue warnings if those variables aren't initialized to non-null values.</span></span>

<span data-ttu-id="13bb4-167">Un'altra fonte di avvisi probabile è la restituzione di valori quando il valore non è stato inizializzato.</span><span class="sxs-lookup"><span data-stu-id="13bb4-167">Another likely source of warnings is return values when the value hasn't been initialized.</span></span>

<span data-ttu-id="13bb4-168">Il primo passaggio per indirizzare gli avvisi del compilatore consiste `?` nell'usare le annotazioni sui tipi Parameter e Return per indicare quando gli argomenti o i valori restituiti possono essere null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-168">The first step in addressing the compiler warnings is to use `?` annotations on parameter and return types to indicate when arguments or return values may be null.</span></span> <span data-ttu-id="13bb4-169">Quando le variabili di riferimento non devono essere null, la dichiarazione originale è corretta.</span><span class="sxs-lookup"><span data-stu-id="13bb4-169">When reference variables must not be null, the original declaration is correct.</span></span> <span data-ttu-id="13bb4-170">Quando si esegue questa operazione, l'obiettivo non è solo correggere gli avvisi.</span><span class="sxs-lookup"><span data-stu-id="13bb4-170">As you do this, your goal isn't just to fix warnings.</span></span> <span data-ttu-id="13bb4-171">L'obiettivo più importante è fare in modo che il compilatore conosca le finalità dei potenziali valori null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-171">The more important goal is to make the compiler understand your intent for potential null values.</span></span> <span data-ttu-id="13bb4-172">Quando si esaminano gli avvisi, si raggiunge la decisione principale successiva per la raccolta.</span><span class="sxs-lookup"><span data-stu-id="13bb4-172">As you examine the warnings, you reach your next major decision for your library.</span></span> <span data-ttu-id="13bb4-173">Si desidera modificare le firme dell'API per comunicare in modo più chiaro lo scopo della progettazione?</span><span class="sxs-lookup"><span data-stu-id="13bb4-173">Do you want to consider modifying API signatures to more clearly communicate your design intent?</span></span> <span data-ttu-id="13bb4-174">Una firma API migliore per il `TryGetMessage` metodo esaminato in precedenza potrebbe essere:</span><span class="sxs-lookup"><span data-stu-id="13bb4-174">A better API signature for the `TryGetMessage` method examined earlier could be:</span></span>

```csharp
string? TryGetMessage(string key);
```

<span data-ttu-id="13bb4-175">Il valore restituito indica l'esito positivo o negativo e contiene il valore se il valore è stato trovato.</span><span class="sxs-lookup"><span data-stu-id="13bb4-175">The return value indicates success or failure, and carries the value if the value was found.</span></span> <span data-ttu-id="13bb4-176">In molti casi, la modifica delle firme API può migliorare il modo in cui comunicano i valori null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-176">In many cases, changing API signatures can improve how they communicate null values.</span></span>

<span data-ttu-id="13bb4-177">Tuttavia, per le librerie pubbliche o le librerie con basi utente di grandi dimensioni, è preferibile non introdurre modifiche alla firma dell'API.</span><span class="sxs-lookup"><span data-stu-id="13bb4-177">However, for public libraries, or libraries with large user bases, you may prefer not introducing any API signature changes.</span></span> <span data-ttu-id="13bb4-178">Per questi casi e altri modelli comuni, è possibile applicare gli attributi per definire in modo più chiaro quando un argomento o un valore `null`restituito può essere.</span><span class="sxs-lookup"><span data-stu-id="13bb4-178">For those cases, and other common patterns, you can apply attributes to more clearly define when an argument or return value may be `null`.</span></span> <span data-ttu-id="13bb4-179">Indipendentemente dalla possibilità di modificare la superficie dell'API, probabilmente si noterà che le annotazioni di tipo non sono sufficienti per descrivere `null` i valori per gli argomenti o i valori restituiti.</span><span class="sxs-lookup"><span data-stu-id="13bb4-179">Whether or not you consider changing the surface of your API, you'll likely find that type annotations alone aren't sufficient for describing `null` values for arguments or return values.</span></span> <span data-ttu-id="13bb4-180">In questi casi, è possibile applicare gli attributi per descrivere più chiaramente un'API.</span><span class="sxs-lookup"><span data-stu-id="13bb4-180">In those instances, you can apply attributes to more clearly describe an API.</span></span>

## <a name="attributes-extend-type-annotations"></a><span data-ttu-id="13bb4-181">Attributi estensione delle annotazioni di tipo</span><span class="sxs-lookup"><span data-stu-id="13bb4-181">Attributes extend type annotations</span></span>

<span data-ttu-id="13bb4-182">Sono stati aggiunti diversi attributi per esprimere informazioni aggiuntive sullo stato null delle variabili.</span><span class="sxs-lookup"><span data-stu-id="13bb4-182">Several attributes have been added to express additional information about the null state of variables.</span></span> <span data-ttu-id="13bb4-183">Tutto il codice scritto prima di C# 8 ha introdotto tipi di riferimento Nullable è un *valore null ignaro*.</span><span class="sxs-lookup"><span data-stu-id="13bb4-183">All code you wrote before C# 8 introduced nullable reference types was *null oblivious*.</span></span> <span data-ttu-id="13bb4-184">Ciò significa che qualsiasi variabile di tipo riferimento può essere null, ma non sono necessari controlli null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-184">That means any reference type variable may be null, but null checks aren't required.</span></span> <span data-ttu-id="13bb4-185">Quando il codice *ammette i valori null*, tali regole cambiano.</span><span class="sxs-lookup"><span data-stu-id="13bb4-185">Once your code is *nullable aware*, those rules change.</span></span> <span data-ttu-id="13bb4-186">I tipi di riferimento non devono `null` mai essere il valore e i tipi di riferimento Nullable `null` devono essere controllati prima di essere dereferenziati.</span><span class="sxs-lookup"><span data-stu-id="13bb4-186">Reference types should never be the `null` value, and nullable reference types must be checked against `null` before being dereferenced.</span></span>

<span data-ttu-id="13bb4-187">Le regole per le API sono probabilmente più complesse, come si è visto con `TryGetValue` lo scenario API.</span><span class="sxs-lookup"><span data-stu-id="13bb4-187">The rules for your APIs are likely more complicated, as you saw with the `TryGetValue` API scenario.</span></span> <span data-ttu-id="13bb4-188">Molte API hanno regole più complesse quando le variabili possono o non possono essere `null`.</span><span class="sxs-lookup"><span data-stu-id="13bb4-188">Many of your APIs have more complex rules for when variables can or can't be `null`.</span></span> <span data-ttu-id="13bb4-189">In questi casi, si useranno gli attributi per esprimere tali regole.</span><span class="sxs-lookup"><span data-stu-id="13bb4-189">In these cases, you'll use attributes to express those rules.</span></span> <span data-ttu-id="13bb4-190">Gli attributi che descrivono la semantica dell'API sono disponibili nell'articolo sugli [attributi che influiscano sull'analisi dei valori null](./language-reference/attributes/nullable-analysis.md).</span><span class="sxs-lookup"><span data-stu-id="13bb4-190">The attributes that describe the semantics of your API are found in the article on [Attributes that impact nullable analysis](./language-reference/attributes/nullable-analysis.md).</span></span>

## <a name="generic-definitions-and-nullability"></a><span data-ttu-id="13bb4-191">Definizioni generiche e supporto dei valori null</span><span class="sxs-lookup"><span data-stu-id="13bb4-191">Generic definitions and nullability</span></span>

<span data-ttu-id="13bb4-192">La comunicazione corretta dello stato null dei tipi generici e dei metodi generici richiede particolare attenzione.</span><span class="sxs-lookup"><span data-stu-id="13bb4-192">Correctly communicating the null state of generic types and generic methods requires special care.</span></span> <span data-ttu-id="13bb4-193">Questo deriva dal fatto che un tipo di valore nullable e un tipo di riferimento nullable sono fondamentalmente diversi.</span><span class="sxs-lookup"><span data-stu-id="13bb4-193">This stems from the fact that a nullable value type and a nullable reference type are fundamentally different.</span></span> <span data-ttu-id="13bb4-194">Un `int?` oggetto è un sinonimo `Nullable<int>`di `string?` , `string` mentre è con un attributo aggiunto dal compilatore.</span><span class="sxs-lookup"><span data-stu-id="13bb4-194">An `int?` is a synonym for `Nullable<int>`, whereas `string?` is `string` with an attribute added by the compiler.</span></span> <span data-ttu-id="13bb4-195">Il risultato è che il compilatore non può generare codice corretto `T?` per senza sapere `T` se è `class` o `struct`.</span><span class="sxs-lookup"><span data-stu-id="13bb4-195">The result is that the compiler can't generate correct code for `T?` without knowing if `T` is a `class` or a `struct`.</span></span>

<span data-ttu-id="13bb4-196">Ciò non significa che non è possibile usare un tipo Nullable (tipo di valore o tipo di riferimento) come argomento di tipo per un tipo generico chiuso.</span><span class="sxs-lookup"><span data-stu-id="13bb4-196">This doesn't mean you can't use a nullable type (either value type or reference type) as the type argument for a closed generic type.</span></span> <span data-ttu-id="13bb4-197">`List<string?>` E `List<int?>` sono istanze valide di `List<T>`.</span><span class="sxs-lookup"><span data-stu-id="13bb4-197">Both `List<string?>` and `List<int?>` are valid instantiations of `List<T>`.</span></span>

<span data-ttu-id="13bb4-198">Cosa significa che non è possibile usare `T?` in una dichiarazione di classe o metodo generica senza vincoli.</span><span class="sxs-lookup"><span data-stu-id="13bb4-198">What it does mean is that you can't use `T?` in a generic class or method declaration without constraints.</span></span> <span data-ttu-id="13bb4-199">Ad esempio, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> non verrà modificato in return `T?`.</span><span class="sxs-lookup"><span data-stu-id="13bb4-199">For example, <xref:System.Linq.Enumerable.FirstOrDefault%60%601(System.Collections.Generic.IEnumerable%7B%60%600%7D)?displayProperty=nameWithType> won't be changed to return `T?`.</span></span> <span data-ttu-id="13bb4-200">Per ovviare a questa limitazione, è possibile `struct` aggiungere `class` il vincolo o.</span><span class="sxs-lookup"><span data-stu-id="13bb4-200">You can overcome this limitation by adding either the `struct` or `class` constraint.</span></span> <span data-ttu-id="13bb4-201">Con uno di questi vincoli, il compilatore sa come generare codice sia `T` per che `T?`per.</span><span class="sxs-lookup"><span data-stu-id="13bb4-201">With either of those constraints, the compiler knows how to generate code for both `T` and `T?`.</span></span>

<span data-ttu-id="13bb4-202">Potrebbe essere necessario limitare i tipi utilizzati per un argomento di tipo generico in modo che siano tipi non nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-202">You may want to restrict the types used for a generic type argument to be non-nullable types.</span></span> <span data-ttu-id="13bb4-203">A tale scopo, è possibile aggiungere `notnull` il vincolo su tale argomento di tipo.</span><span class="sxs-lookup"><span data-stu-id="13bb4-203">You can do that by adding the `notnull` constraint on that type argument.</span></span> <span data-ttu-id="13bb4-204">Quando viene applicato il vincolo, l'argomento di tipo non deve essere un tipo Nullable.</span><span class="sxs-lookup"><span data-stu-id="13bb4-204">When that constraint is applied, the type argument must not be a nullable type.</span></span>

## <a name="late-initialized-properties-data-transfer-objects-and-nullability"></a><span data-ttu-id="13bb4-205">Proprietà con inizializzazione tardiva, oggetti Trasferimento dati e supporto di valori null</span><span class="sxs-lookup"><span data-stu-id="13bb4-205">Late-initialized properties, Data Transfer Objects and nullability</span></span>

<span data-ttu-id="13bb4-206">L'indicazione del supporto di valori Null delle proprietà che sono inizializzate in ritardo, ovvero impostate dopo la costruzione, potrebbe richiedere particolare attenzione per garantire che la classe continui a esprimere correttamente l'intento di progettazione originale.</span><span class="sxs-lookup"><span data-stu-id="13bb4-206">Indicating the nullability of properties that are late-initialized, meaning set after construction, may require special consideration to ensure that your class continues to correctly express the original design intent.</span></span>

<span data-ttu-id="13bb4-207">I tipi che contengono proprietà inizializzate in ritardo, ad esempio oggetti Trasferimento dati (dto), vengono spesso creati da una libreria esterna, ad esempio un database ORM (Object Relational Mapper), un deserializzatore o un altro componente che popola automaticamente le proprietà da un'altra origine.</span><span class="sxs-lookup"><span data-stu-id="13bb4-207">Types that contain late-initialized properties, such as Data Transfer Objects (DTOs), are often instantiated by an external library, like a database ORM (Object Relational Mapper), a deserializer, or some other component that automatically populates properties from another source.</span></span>

<span data-ttu-id="13bb4-208">Si consideri la seguente classe DTO, prima di abilitare i tipi di riferimento Nullable, che rappresenta uno studente:</span><span class="sxs-lookup"><span data-stu-id="13bb4-208">Consider the following DTO class, prior to enabling nullable reference types, that represents a student:</span></span>

```csharp
class Student
{
    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string VehicleRegistration { get; set; }
}
```

<span data-ttu-id="13bb4-209">Lo scopo della progettazione, indicato in questo caso dall' `Required` attributo, suggerisce che in questo sistema le `FirstName` proprietà e `LastName` sono **obbligatorie**e pertanto non null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-209">The design intent (indicated in this case by the `Required` attribute) suggests that in this system, the `FirstName` and `LastName` properties are **mandatory**, and therefore not null.</span></span>

<span data-ttu-id="13bb4-210">La `VehicleRegistration` proprietà **non è obbligatoria**, pertanto può essere null.</span><span class="sxs-lookup"><span data-stu-id="13bb4-210">The `VehicleRegistration` property is **not mandatory**, so may be null.</span></span>

<span data-ttu-id="13bb4-211">Quando si abilitano i tipi di riferimento Nullable, si vuole indicare nel DTO quale delle proprietà può essere nullable, coerente con l'intento originale:</span><span class="sxs-lookup"><span data-stu-id="13bb4-211">When you enable nullable reference types, you want to indicate on our DTO which of the properties may be nullable, consistent with your original intent:</span></span>

```csharp
class Student
{
    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string? VehicleRegistration { get; set; }
}
```

<span data-ttu-id="13bb4-212">Per questo DTO, l'unica proprietà che può essere null è ``VehicleRegistration``.</span><span class="sxs-lookup"><span data-stu-id="13bb4-212">For this DTO, the only property that may be null is ``VehicleRegistration``.</span></span>

<span data-ttu-id="13bb4-213">Tuttavia, il compilatore genera `CS8618` avvisi sia `FirstName` per che `LastName`per, per indicare che le proprietà che non ammettono i valori null non sono inizializzate.</span><span class="sxs-lookup"><span data-stu-id="13bb4-213">However, the compiler raises `CS8618` warnings for both `FirstName` and `LastName`, indicating the non-nullable properties are uninitialized.</span></span>

<span data-ttu-id="13bb4-214">Sono disponibili tre opzioni che consentono di risolvere gli avvisi del compilatore in modo da mantenere la finalità originale.</span><span class="sxs-lookup"><span data-stu-id="13bb4-214">There are three options available to you that resolve the compiler warnings in a way that maintains the original intent.</span></span> <span data-ttu-id="13bb4-215">Una di queste opzioni è valida; è consigliabile scegliere quella più adatta alle proprie esigenze di progettazione e stile di codifica.</span><span class="sxs-lookup"><span data-stu-id="13bb4-215">Any of these options are valid; you should choose the one that best suits your coding style and design requirements.</span></span>

### <a name="initialize-in-the-constructor"></a><span data-ttu-id="13bb4-216">Inizializzazione nel costruttore</span><span class="sxs-lookup"><span data-stu-id="13bb4-216">Initialize in the constructor</span></span>

<span data-ttu-id="13bb4-217">Il modo ideale per risolvere gli avvisi non inizializzati consiste nell'inizializzare le proprietà nel costruttore:</span><span class="sxs-lookup"><span data-stu-id="13bb4-217">The ideal way to resolve the uninitialized warnings is to initialize the properties in the constructor:</span></span>

```csharp
class Student
{
    public Student(string firstName, string lastName)
    {
        FirstName = firstName;
        LastName = lastName;
    }

    [Required]
    public string FirstName { get; set; }

    [Required]
    public string LastName { get; set; }

    public string? VehicleRegistration { get; set; }
}
```

<span data-ttu-id="13bb4-218">Questo approccio funziona solo se la libreria utilizzata per creare un'istanza della classe supporta il passaggio di parametri nel costruttore.</span><span class="sxs-lookup"><span data-stu-id="13bb4-218">This approach only works if the library that you use to instantiate the class supports passing parameters in the constructor.</span></span>

<span data-ttu-id="13bb4-219">Inoltre, una libreria può supportare il passaggio di *alcune* proprietà nel costruttore, ma non tutte.</span><span class="sxs-lookup"><span data-stu-id="13bb4-219">In addition, a library may support passing *some* properties in the constructor, but not all.</span></span>
<span data-ttu-id="13bb4-220">Ad esempio, EF Core supporta il [binding del costruttore](/ef/core/modeling/constructors) per le proprietà di colonna normali, ma non le proprietà di navigazione.</span><span class="sxs-lookup"><span data-stu-id="13bb4-220">For example, EF Core supports [constructor binding](/ef/core/modeling/constructors) for normal column properties, but not navigation properties.</span></span>

<span data-ttu-id="13bb4-221">Controllare la documentazione sulla libreria che crea un'istanza della classe, per comprendere in che misura è supportata l'associazione del costruttore.</span><span class="sxs-lookup"><span data-stu-id="13bb4-221">Check the documentation on the library that instantiates your class, to understand the extent to which it supports constructor binding.</span></span>

### <a name="property-with-nullable-backing-field"></a><span data-ttu-id="13bb4-222">Proprietà con campo di supporto Nullable</span><span class="sxs-lookup"><span data-stu-id="13bb4-222">Property with nullable backing field</span></span>

<span data-ttu-id="13bb4-223">Se l'associazione del costruttore non funziona per l'utente, un modo per risolvere questo problema consiste nel disporre di una proprietà che non ammette i valori null con un campo sottostante Nullable:</span><span class="sxs-lookup"><span data-stu-id="13bb4-223">If constructor binding won't work for you, one way to deal with this problem is to have a non-nullable property with a nullable backing field:</span></span>

```csharp
private string? _firstName;

[Required]
public string FirstName
{
    set => _firstName = value;
    get => _firstName
           ?? throw new InvalidOperationException("Uninitialized " + nameof(FirstName))
}
```

<span data-ttu-id="13bb4-224">In questo scenario, se si `FirstName` accede alla proprietà prima che sia stata inizializzata, il codice genera un' `InvalidOperationException`eccezione, perché il contratto API è stato usato in modo errato.</span><span class="sxs-lookup"><span data-stu-id="13bb4-224">In this scenario, if the `FirstName` property is accessed before it has been initialized, then the code throws an `InvalidOperationException`, because the API contract has been used incorrectly.</span></span>

<span data-ttu-id="13bb4-225">È necessario considerare che alcune librerie possono avere considerazioni speciali quando si usano i campi di backup.</span><span class="sxs-lookup"><span data-stu-id="13bb4-225">You should consider that some libraries may have special considerations when using backing fields.</span></span> <span data-ttu-id="13bb4-226">Ad esempio, potrebbe essere necessario configurare EF Core per l'uso corretto dei [campi di backup](/ef/core/modeling/backing-field) .</span><span class="sxs-lookup"><span data-stu-id="13bb4-226">For example, EF Core may need to be configured to use [backing fields](/ef/core/modeling/backing-field) correctly.</span></span>

### <a name="initialize-the-property-to-null"></a><span data-ttu-id="13bb4-227">Inizializza la proprietà su null</span><span class="sxs-lookup"><span data-stu-id="13bb4-227">Initialize the property to null</span></span>

<span data-ttu-id="13bb4-228">Come alternativa Terser all'uso di un campo di supporto nullable o se la libreria che crea un'istanza della classe non è compatibile con questo approccio, è possibile semplicemente inizializzare la proprietà `null` direttamente su, con l'ausilio dell'operatore che perdona i`!`valori null ():</span><span class="sxs-lookup"><span data-stu-id="13bb4-228">As a terser alternative to using a nullable backing field, or if the library that instantiates your class is not compatible with that approach, you can simply initialize the property to `null` directly, with the help of the null-forgiving operator (`!`):</span></span>

```csharp
[Required]
public string FirstName { get; set; } = null!;

[Required]
public string LastName { get; set; } = null!;

public string? VehicleRegistration { get; set; }
```

<span data-ttu-id="13bb4-229">Non si osserverà mai un valore null effettivo in fase di esecuzione, ad eccezione di un bug di programmazione, accedendo alla proprietà prima che sia stata inizializzata correttamente.</span><span class="sxs-lookup"><span data-stu-id="13bb4-229">You will never observe an actual null value at runtime except as a result of a programming bug, by accessing the property before it has been properly initialized.</span></span>

## <a name="see-also"></a><span data-ttu-id="13bb4-230">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="13bb4-230">See also</span></span>

- [<span data-ttu-id="13bb4-231">Eseguire la migrazione di una base di codice esistente a riferimenti nullable</span><span class="sxs-lookup"><span data-stu-id="13bb4-231">Migrate an existing codebase to nullable references</span></span>](tutorials/upgrade-to-nullable-references.md)
- [<span data-ttu-id="13bb4-232">Utilizzo dei tipi di riferimento nullable in EF Core</span><span class="sxs-lookup"><span data-stu-id="13bb4-232">Working with Nullable Reference Types in EF Core</span></span>](/ef/core/miscellaneous/nullable-reference-types)
