---
title: SpinWait
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- synchronization primitives, SpinWait
ms.assetid: 36012f42-34e5-4f86-adf4-973f433ed6c6
ms.openlocfilehash: 8b98e7d8b8ea4578fb446a0587f9a46ba4271348
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/02/2020
ms.locfileid: "84291110"
---
# <a name="spinwait"></a><span data-ttu-id="4c58b-102">SpinWait</span><span class="sxs-lookup"><span data-stu-id="4c58b-102">SpinWait</span></span>
<span data-ttu-id="4c58b-103"><xref:System.Threading.SpinWait?displayProperty=nameWithType> è un tipo di sincronizzazione leggera che è possibile usare in scenari di basso livello per evitare i cambi di contesto dispendiosi e le transizioni del kernel necessarie per gli eventi del kernel.</span><span class="sxs-lookup"><span data-stu-id="4c58b-103"><xref:System.Threading.SpinWait?displayProperty=nameWithType> is a lightweight synchronization type that you can use in low-level scenarios to avoid the expensive context switches and kernel transitions that are required for kernel events.</span></span> <span data-ttu-id="4c58b-104">Nei computer multicore, quando non si prevede che una risorsa venga bloccata per lunghi periodi di tempo, per un thread in attesa potrebbe essere più efficiente ruotare in modalità utente per alcune decine o centinaia di cicli e quindi ritentare di acquisire la risorsa.</span><span class="sxs-lookup"><span data-stu-id="4c58b-104">On multicore computers, when a resource is not expected to be held for long periods of time, it can be more efficient for a waiting thread to spin in user mode for a few dozen or a few hundred cycles, and then retry to acquire the resource.</span></span> <span data-ttu-id="4c58b-105">Se la risorsa è disponibile dopo la rotazione, vengono risparmiate diverse migliaia di cicli.</span><span class="sxs-lookup"><span data-stu-id="4c58b-105">If the resource is available after spinning, then you have saved several thousand cycles.</span></span> <span data-ttu-id="4c58b-106">Se la risorsa continua a non essere disponibile, sono stati usati solo alcuni cicli ed è possibile attivare un'attesa basata sul kernel.</span><span class="sxs-lookup"><span data-stu-id="4c58b-106">If the resource is still not available, then you have spent only a few cycles and can still enter a kernel-based wait.</span></span> <span data-ttu-id="4c58b-107">Questa combinazione di rotazione-attesa è talvolta detta un *operazione di attesa a due fasi*.</span><span class="sxs-lookup"><span data-stu-id="4c58b-107">This spinning-then-waiting combination is sometimes referred to as a *two-phase wait operation*.</span></span>  
  
 <span data-ttu-id="4c58b-108"><xref:System.Threading.SpinWait> è progettato per essere usato in combinazione con i tipi di .NET Framework che eseguono il wrapping di eventi del kernel, ad esempio <xref:System.Threading.ManualResetEvent>.</span><span class="sxs-lookup"><span data-stu-id="4c58b-108"><xref:System.Threading.SpinWait> is designed to be used in conjunction with the .NET Framework types that wrap kernel events such as <xref:System.Threading.ManualResetEvent>.</span></span> <span data-ttu-id="4c58b-109"><xref:System.Threading.SpinWait> può essere usato anche da solo per la funzionalità di rotazione di base in un unico programma.</span><span class="sxs-lookup"><span data-stu-id="4c58b-109"><xref:System.Threading.SpinWait> can also be used by itself for basic spinning functionality in just one program.</span></span>  
  
 <span data-ttu-id="4c58b-110"><xref:System.Threading.SpinWait> è molto più di un ciclo vuoto.</span><span class="sxs-lookup"><span data-stu-id="4c58b-110"><xref:System.Threading.SpinWait> is more than just an empty loop.</span></span> <span data-ttu-id="4c58b-111">Viene implementato con particolare attenzione per offrire un comportamento di rotazione corretto per usi generali; avvia cambi di contesto in caso di rotazione per una durata sufficiente (approssimativamente l'intervallo di tempo necessario per una transizione del kernel).</span><span class="sxs-lookup"><span data-stu-id="4c58b-111">It is carefully implemented to provide correct spinning behavior for the general case, and will itself initiate context switches if it spins long enough (roughly the length of time required for a kernel transition).</span></span> <span data-ttu-id="4c58b-112">Ad esempio, nei computer a core singolo, <xref:System.Threading.SpinWait> restituisce subito l'intervallo di tempo del thread perché la rotazione impedisce l'avanzamento per tutti i thread.</span><span class="sxs-lookup"><span data-stu-id="4c58b-112">For example, on single-core computers, <xref:System.Threading.SpinWait> yields the time slice of the thread immediately because spinning blocks forward progress on all threads.</span></span> <span data-ttu-id="4c58b-113"><xref:System.Threading.SpinWait> restituisce il controllo anche in computer multicore per impedire al thread in attesa di bloccare i thread con priorità superiore o la funzionalità Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="4c58b-113"><xref:System.Threading.SpinWait> also yields even on multi-core machines to prevent the waiting thread from blocking higher-priority threads or the garbage collector.</span></span> <span data-ttu-id="4c58b-114">Pertanto, se si usa <xref:System.Threading.SpinWait> in un'operazione di attesa a due fasi, è consigliabile richiamare l'attesa del kernel prima che <xref:System.Threading.SpinWait> avvii un cambio di contesto.</span><span class="sxs-lookup"><span data-stu-id="4c58b-114">Therefore, if you are using a <xref:System.Threading.SpinWait> in a two-phase wait operation, we recommend that you invoke the kernel wait before the <xref:System.Threading.SpinWait> itself initiates a context switch.</span></span> <span data-ttu-id="4c58b-115"><xref:System.Threading.SpinWait> fornisce la proprietà <xref:System.Threading.SpinWait.NextSpinWillYield%2A>, che è possibile controllare prima di ogni chiamata a <xref:System.Threading.SpinWait.SpinOnce%2A>.</span><span class="sxs-lookup"><span data-stu-id="4c58b-115"><xref:System.Threading.SpinWait> provides the <xref:System.Threading.SpinWait.NextSpinWillYield%2A> property, which you can check before every call to <xref:System.Threading.SpinWait.SpinOnce%2A>.</span></span> <span data-ttu-id="4c58b-116">Quando la proprietà restituisce `true`, avviare l'operazione di attesa.</span><span class="sxs-lookup"><span data-stu-id="4c58b-116">When the property returns `true`, initiate your own Wait operation.</span></span> <span data-ttu-id="4c58b-117">Per un esempio, vedere [Procedura: Usare SpinWait per implementare un'operazione di attesa a due fasi](how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md).</span><span class="sxs-lookup"><span data-stu-id="4c58b-117">For an example, see [How to: Use SpinWait to Implement a Two-Phase Wait Operation](how-to-use-spinwait-to-implement-a-two-phase-wait-operation.md).</span></span>  
  
 <span data-ttu-id="4c58b-118">Se non si esegue un'operazione di attesa a due fasi, ma la rotazione continua finché una condizione è vera, è possibile abilitare <xref:System.Threading.SpinWait> per eseguire i relativi cambi di contesto in modo che sia un elemento positivo nell'ambiente del sistema operativo Windows.</span><span class="sxs-lookup"><span data-stu-id="4c58b-118">If you are not performing a two-phase wait operation but are just spinning until some condition is true, you can enable <xref:System.Threading.SpinWait> to perform its context switches so that it is a good citizen in the Windows operating system environment.</span></span> <span data-ttu-id="4c58b-119">L'esempio di base seguente illustra un <xref:System.Threading.SpinWait> in uno stack senza blocco.</span><span class="sxs-lookup"><span data-stu-id="4c58b-119">The following basic example shows a <xref:System.Threading.SpinWait> in a lock-free stack.</span></span> <span data-ttu-id="4c58b-120">Se è necessario uno stack thread-safe e ad alte prestazioni, è consigliabile usare <xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="4c58b-120">If you require a high-performance, thread-safe stack, consider using <xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=nameWithType>.</span></span>  
  
 [!code-csharp[CDS_SpinWait#05](../../../samples/snippets/csharp/VS_Snippets_Misc/cds_spinwait/cs/spinwait.cs#05)]
 [!code-vb[CDS_SpinWait#05](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_spinwait/vb/cds_spinwait1.vb#05)]  
  
## <a name="see-also"></a><span data-ttu-id="4c58b-121">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="4c58b-121">See also</span></span>

- <xref:System.Threading.Thread.SpinWait%2A>
- [<span data-ttu-id="4c58b-122">Oggetti e funzionalità di threading</span><span class="sxs-lookup"><span data-stu-id="4c58b-122">Threading Objects and Features</span></span>](threading-objects-and-features.md)
