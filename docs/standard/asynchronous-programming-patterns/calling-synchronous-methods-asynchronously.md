---
title: Chiamata asincrona dei metodi sincroni
description: Informazioni su come chiamare metodi sincroni in modo asincrono in .NET, usando i metodi BeginInvoke ed EndInvoke.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- asynchronous programming, delegates
- asynchronous delegates
- AsyncWaitHandle property
- callback methods
- calling synchronous methods in asynchronous manner
- WaitHandle class, code examples
- asynchronous programming, status polling
- polling asynchronous operation status
- delegates [.NET Framework], asynchronous
- synchronous calling in asynchronous manner
- waiting for asynchronous calls
- status information [.NET Framework], asynchronous operations
ms.assetid: 41972034-92ed-450a-9664-ab93fcc6f1fb
ms.openlocfilehash: ff2d30c00e7b6becb0c3ff910d825c2e9d6f78e3
ms.sourcegitcommit: 7137e12f54c4e83a94ae43ec320f8cf59c1772ea
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/10/2020
ms.locfileid: "84662641"
---
# <a name="calling-synchronous-methods-asynchronously"></a><span data-ttu-id="6e3e3-103">Chiamata asincrona dei metodi sincroni</span><span class="sxs-lookup"><span data-stu-id="6e3e3-103">Calling Synchronous Methods Asynchronously</span></span>

<span data-ttu-id="6e3e3-104">.NET Framework consente di chiamare qualsiasi metodo in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-104">The .NET Framework enables you to call any method asynchronously.</span></span> <span data-ttu-id="6e3e3-105">A questo scopo occorre definire un delegato con la stessa firma del metodo che si vuole chiamare. Common Language Runtime definisce automaticamente i metodi `BeginInvoke` e `EndInvoke` per il delegato, con le firme appropriate.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-105">To do this you define a delegate with the same signature as the method you want to call; the common language runtime automatically defines `BeginInvoke` and `EndInvoke` methods for this delegate, with the appropriate signatures.</span></span>

> [!NOTE]
> <span data-ttu-id="6e3e3-106">Le chiamate asincrone dei delegati, con particolare riferimento ai metodi `BeginInvoke` e `EndInvoke` , non sono supportate in .NET Compact Framework.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-106">Asynchronous delegate calls, specifically the `BeginInvoke` and `EndInvoke` methods, are not supported in the .NET Compact Framework.</span></span>

<span data-ttu-id="6e3e3-107">Il `BeginInvoke` metodo avvia la chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-107">The `BeginInvoke` method initiates the asynchronous call.</span></span> <span data-ttu-id="6e3e3-108">Presenta gli stessi parametri del metodo da eseguire in modo asincrono, con due parametri aggiuntivi facoltativi.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-108">It has the same parameters as the method that you want to execute asynchronously, plus two additional optional parameters.</span></span> <span data-ttu-id="6e3e3-109">Il primo parametro è un delegato <xref:System.AsyncCallback> che fa riferimento a un metodo da chiamare al completamento della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-109">The first parameter is an <xref:System.AsyncCallback> delegate that references a method to be called when the asynchronous call completes.</span></span> <span data-ttu-id="6e3e3-110">Il secondo parametro è un oggetto definito dall'utente che passa informazioni al metodo di callback.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-110">The second parameter is a user-defined object that passes information into the callback method.</span></span> <span data-ttu-id="6e3e3-111">`BeginInvoke` restituisce immediatamente un valore e non attende il completamento della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-111">`BeginInvoke` returns immediately and does not wait for the asynchronous call to complete.</span></span> <span data-ttu-id="6e3e3-112">`BeginInvoke` restituisce un oggetto <xref:System.IAsyncResult>che può essere usato per monitorare lo stato di avanzamento della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-112">`BeginInvoke` returns an <xref:System.IAsyncResult>, which can be used to monitor the progress of the asynchronous call.</span></span>

<span data-ttu-id="6e3e3-113">Il metodo `EndInvoke` recupera i risultati della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-113">The `EndInvoke` method retrieves the results of the asynchronous call.</span></span> <span data-ttu-id="6e3e3-114">Può essere chiamato in qualsiasi momento dopo `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-114">It can be called any time after `BeginInvoke`.</span></span> <span data-ttu-id="6e3e3-115">Se la chiamata asincrona non è stata completata, `EndInvoke` blocca il thread chiamante fino al suo completamento.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-115">If the asynchronous call has not completed, `EndInvoke` blocks the calling thread until it completes.</span></span> <span data-ttu-id="6e3e3-116">I parametri di `EndInvoke` includono i `out` `ref` parametri e ( `<Out>` `ByRef` e `ByRef` in Visual Basic) del metodo che si desidera eseguire in modo asincrono, oltre all'oggetto <xref:System.IAsyncResult> restituito da `BeginInvoke` .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-116">The parameters of `EndInvoke` include the `out` and `ref` parameters (`<Out>` `ByRef` and `ByRef` in Visual Basic) of the method that you want to execute asynchronously, plus the <xref:System.IAsyncResult> returned by `BeginInvoke`.</span></span>

> [!NOTE]
> <span data-ttu-id="6e3e3-117">La funzionalità IntelliSense in Visual Studio visualizza i parametri di `BeginInvoke` e `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-117">The IntelliSense feature in Visual Studio displays the parameters of `BeginInvoke` and `EndInvoke`.</span></span> <span data-ttu-id="6e3e3-118">Se non si usa Visual Studio o uno strumento analogo o se si usa C# con Visual Studio, vedere [Modello di programmazione asincrona (APM)](asynchronous-programming-model-apm.md) per una descrizione dei parametri definiti per tali metodi.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-118">If you're not using Visual Studio or a similar tool, or if you're using C# with Visual Studio, see [Asynchronous Programming Model (APM)](asynchronous-programming-model-apm.md) for a description of the parameters defined for these methods.</span></span>

<span data-ttu-id="6e3e3-119">Gli esempi di codice in questo argomento presentano quattro modi comuni per usare `BeginInvoke` e `EndInvoke` per effettuare chiamate asincrone.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-119">The code examples in this topic demonstrate four common ways to use `BeginInvoke` and `EndInvoke` to make asynchronous calls.</span></span> <span data-ttu-id="6e3e3-120">Dopo avere chiamato `BeginInvoke` è possibile procedere nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="6e3e3-120">After calling `BeginInvoke` you can do the following:</span></span>

- <span data-ttu-id="6e3e3-121">Eseguire alcune operazioni, quindi chiamare `EndInvoke` per bloccare l'esecuzione fino al completamento della chiamata.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-121">Do some work and then call `EndInvoke` to block until the call completes.</span></span>

- <span data-ttu-id="6e3e3-122">Ottenere un oggetto <xref:System.Threading.WaitHandle> mediante la proprietà <xref:System.IAsyncResult.AsyncWaitHandle%2A?displayProperty=nameWithType> , usare il relativo metodo <xref:System.Threading.WaitHandle.WaitOne%2A> per bloccare l'esecuzione fino a quando non viene segnalato <xref:System.Threading.WaitHandle> , quindi chiamare `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-122">Obtain a <xref:System.Threading.WaitHandle> using the <xref:System.IAsyncResult.AsyncWaitHandle%2A?displayProperty=nameWithType> property, use its <xref:System.Threading.WaitHandle.WaitOne%2A> method to block execution until the <xref:System.Threading.WaitHandle> is signaled, and then call `EndInvoke`.</span></span>

- <span data-ttu-id="6e3e3-123">Eseguire il polling dell'oggetto <xref:System.IAsyncResult> restituito da `BeginInvoke` per stabilire quando viene completata la chiamata, quindi chiamare `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-123">Poll the <xref:System.IAsyncResult> returned by `BeginInvoke` to determine when the asynchronous call has completed, and then call `EndInvoke`.</span></span>

- <span data-ttu-id="6e3e3-124">Passare un delegato per un metodo di callback a `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-124">Pass a delegate for a callback method to `BeginInvoke`.</span></span> <span data-ttu-id="6e3e3-125">Il metodo viene eseguito su un thread <xref:System.Threading.ThreadPool> al completamento della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-125">The method is executed on a <xref:System.Threading.ThreadPool> thread when the asynchronous call completes.</span></span> <span data-ttu-id="6e3e3-126">Il metodo di callback chiama `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-126">The callback method calls `EndInvoke`.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6e3e3-127">Indipendentemente dalla tecnica usata, chiamare sempre `EndInvoke` per completare la chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-127">No matter which technique you use, always call `EndInvoke` to complete your asynchronous call.</span></span>

## <a name="defining-the-test-method-and-asynchronous-delegate"></a><span data-ttu-id="6e3e3-128">Definizione del metodo di test e del delegato asincrono</span><span class="sxs-lookup"><span data-stu-id="6e3e3-128">Defining the Test Method and Asynchronous Delegate</span></span>
 <span data-ttu-id="6e3e3-129">Gli esempi di codice seguenti illustrano diversi modi per chiamare lo stesso metodo di lunga durata, `TestMethod`, in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-129">The code examples that follow demonstrate various ways of calling the same long-running method, `TestMethod`, asynchronously.</span></span> <span data-ttu-id="6e3e3-130">Il metodo `TestMethod` visualizza un messaggio di console per indicare che ha iniziato l'elaborazione, si disattiva per alcuni secondi e quindi termina.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-130">The `TestMethod` method displays a console message to show that it has begun processing, sleeps for a few seconds, and then ends.</span></span> <span data-ttu-id="6e3e3-131">`TestMethod` include un parametro `out` per dimostrare in che modo tali parametri vengono aggiunti alle firme di `BeginInvoke` e `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-131">`TestMethod` has an `out` parameter to demonstrate the way such parameters are added to the signatures of `BeginInvoke` and `EndInvoke`.</span></span> <span data-ttu-id="6e3e3-132">I parametri `ref` possono essere gestiti in modo analogo.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-132">You can handle `ref` parameters similarly.</span></span>

 <span data-ttu-id="6e3e3-133">L'esempio di codice seguente illustra la definizione di `TestMethod` e il delegato denominato `AsyncMethodCaller` che può essere usato per chiamare `TestMethod` in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-133">The following code example shows the definition of `TestMethod` and the delegate named `AsyncMethodCaller` that can be used to call `TestMethod` asynchronously.</span></span> <span data-ttu-id="6e3e3-134">Per compilare gli esempi di codice, è necessario includere le definizioni per `TestMethod` e il delegato `AsyncMethodCaller`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-134">To compile the code examples, you must include the definitions for `TestMethod` and the `AsyncMethodCaller` delegate.</span></span>

 [!code-cpp[AsyncDelegateExamples#1](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/TestMethod.cpp#1)]
 [!code-csharp[AsyncDelegateExamples#1](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/TestMethod.cs#1)]
 [!code-vb[AsyncDelegateExamples#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/TestMethod.vb#1)]

## <a name="waiting-for-an-asynchronous-call-with-endinvoke"></a><span data-ttu-id="6e3e3-135">Attesa di una chiamata asincrona con EndInvoke</span><span class="sxs-lookup"><span data-stu-id="6e3e3-135">Waiting for an Asynchronous Call with EndInvoke</span></span>
 <span data-ttu-id="6e3e3-136">Il modo più semplice per eseguire un metodo in modo asincrono consiste nell'avviare l'esecuzione del metodo chiamando il metodo `BeginInvoke` del delegato, eseguire alcune operazioni sul thread principale e quindi chiamare il metodo `EndInvoke` del delegato.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-136">The simplest way to execute a method asynchronously is to start executing the method by calling the delegate's `BeginInvoke` method, do some work on the main thread, and then call the delegate's `EndInvoke` method.</span></span> <span data-ttu-id="6e3e3-137">`EndInvoke` potrebbe bloccare il thread chiamante perché non restituisce un valore fino al completamento della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-137">`EndInvoke` might block the calling thread because it does not return until the asynchronous call completes.</span></span> <span data-ttu-id="6e3e3-138">Si tratta di una tecnica valida per le operazioni su file o rete.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-138">This is a good technique to use with file or network operations.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6e3e3-139">Poiché `EndInvoke` potrebbe bloccarsi, non deve mai essere chiamato dai thread che servono l'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-139">Because `EndInvoke` might block, you should never call it from threads that service the user interface.</span></span>

 [!code-cpp[AsyncDelegateExamples#2](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/EndInvoke.cpp#2)]
 [!code-csharp[AsyncDelegateExamples#2](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/EndInvoke.cs#2)]
 [!code-vb[AsyncDelegateExamples#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/EndInvoke.vb#2)]

## <a name="waiting-for-an-asynchronous-call-with-waithandle"></a><span data-ttu-id="6e3e3-140">Attesa di una chiamata asincrona con WaitHandle</span><span class="sxs-lookup"><span data-stu-id="6e3e3-140">Waiting for an Asynchronous Call with WaitHandle</span></span>
 <span data-ttu-id="6e3e3-141">È possibile ottenere un oggetto <xref:System.Threading.WaitHandle> usando la proprietà <xref:System.IAsyncResult.AsyncWaitHandle%2A> dell'oggetto <xref:System.IAsyncResult> restituito da `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-141">You can obtain a <xref:System.Threading.WaitHandle> by using the <xref:System.IAsyncResult.AsyncWaitHandle%2A> property of the <xref:System.IAsyncResult> returned by `BeginInvoke`.</span></span> <span data-ttu-id="6e3e3-142">L'oggetto <xref:System.Threading.WaitHandle> viene segnalato al completamento della chiamata asincrona ed è possibile attenderlo chiamando il metodo <xref:System.Threading.WaitHandle.WaitOne%2A> .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-142">The <xref:System.Threading.WaitHandle> is signaled when the asynchronous call completes, and you can wait for it by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method.</span></span>

 <span data-ttu-id="6e3e3-143">Se si usa un <xref:System.Threading.WaitHandle>, è possibile eseguire altre operazioni prima o dopo il completamento della chiamata asincrona, ma prima di chiamare `EndInvoke` per recuperare i risultati.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-143">If you use a <xref:System.Threading.WaitHandle>, you can perform additional processing before or after the asynchronous call completes, but before calling `EndInvoke` to retrieve the results.</span></span>

> [!NOTE]
> <span data-ttu-id="6e3e3-144">L'handle di attesa non viene chiuso automaticamente quando si chiama `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-144">The wait handle is not closed automatically when you call `EndInvoke`.</span></span> <span data-ttu-id="6e3e3-145">Se si rilasciano tutti i riferimenti all'handle di attesa, le risorse di sistema vengono liberate quando Garbage Collection recupera l'handle di attesa.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-145">If you release all references to the wait handle, system resources are freed when garbage collection reclaims the wait handle.</span></span> <span data-ttu-id="6e3e3-146">Per liberare le risorse di sistema non appena si ha finito di usare l'handle di attesa, eliminarlo chiamando il metodo <xref:System.Threading.WaitHandle.Close%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-146">To free the system resources as soon as you are finished using the wait handle, dispose of it by calling the <xref:System.Threading.WaitHandle.Close%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="6e3e3-147">Garbage Collection opera in modo più efficiente quando gli oggetti eliminabili vengono eliminati in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-147">Garbage collection works more efficiently when disposable objects are explicitly disposed.</span></span>

 [!code-cpp[AsyncDelegateExamples#3](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/waithandle.cpp#3)]
 [!code-csharp[AsyncDelegateExamples#3](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/waithandle.cs#3)]
 [!code-vb[AsyncDelegateExamples#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/WaitHandle.vb#3)]

## <a name="polling-for-asynchronous-call-completion"></a><span data-ttu-id="6e3e3-148">Polling del completamento della chiamata asincrona</span><span class="sxs-lookup"><span data-stu-id="6e3e3-148">Polling for Asynchronous Call Completion</span></span>
 <span data-ttu-id="6e3e3-149">È possibile usare la proprietà <xref:System.IAsyncResult.IsCompleted%2A> dell'oggetto <xref:System.IAsyncResult> restituito da `BeginInvoke` per rilevare il completamento della chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-149">You can use the <xref:System.IAsyncResult.IsCompleted%2A> property of the <xref:System.IAsyncResult> returned by `BeginInvoke` to discover when the asynchronous call completes.</span></span> <span data-ttu-id="6e3e3-150">Questa operazione può essere eseguita quando si effettua la chiamata asincrona da un thread che serve l'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-150">You might do this when making the asynchronous call from a thread that services the user interface.</span></span> <span data-ttu-id="6e3e3-151">Il polling del completamento consente al thread chiamante di continuare l'esecuzione mentre viene eseguita la chiamata asincrona su un thread <xref:System.Threading.ThreadPool> .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-151">Polling for completion allows the calling thread to continue executing while the asynchronous call executes on a <xref:System.Threading.ThreadPool> thread.</span></span>

 [!code-cpp[AsyncDelegateExamples#4](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/polling.cpp#4)]
 [!code-csharp[AsyncDelegateExamples#4](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/polling.cs#4)]
 [!code-vb[AsyncDelegateExamples#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/polling.vb#4)]

## <a name="executing-a-callback-method-when-an-asynchronous-call-completes"></a><span data-ttu-id="6e3e3-152">Esecuzione di un metodo di callback al completamento di una chiamata asincrona</span><span class="sxs-lookup"><span data-stu-id="6e3e3-152">Executing a Callback Method When an Asynchronous Call Completes</span></span>
 <span data-ttu-id="6e3e3-153">Se il thread che avvia la chiamata asincrona non deve necessariamente essere il thread che elabora i risultati, è possibile eseguire un metodo di callback al completamento della chiamata.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-153">If the thread that initiates the asynchronous call does not need to be the thread that processes the results, you can execute a callback method when the call completes.</span></span> <span data-ttu-id="6e3e3-154">Il metodo di callback viene eseguito su un thread <xref:System.Threading.ThreadPool> .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-154">The callback method is executed on a <xref:System.Threading.ThreadPool> thread.</span></span>

 <span data-ttu-id="6e3e3-155">Per usare un metodo di callback, è necessario passare a `BeginInvoke` un delegato <xref:System.AsyncCallback> che rappresenta il metodo di callback.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-155">To use a callback method, you must pass `BeginInvoke` an <xref:System.AsyncCallback> delegate that represents the callback method.</span></span> <span data-ttu-id="6e3e3-156">È possibile passare anche un oggetto contenente informazioni che devono essere usate dal metodo di callback.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-156">You can also pass an object that contains information to be used by the callback method.</span></span> <span data-ttu-id="6e3e3-157">Nel metodo di callback è possibile eseguire il cast di <xref:System.IAsyncResult>, che è l'unico parametro del metodo di callback, a un oggetto <xref:System.Runtime.Remoting.Messaging.AsyncResult> .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-157">In the callback method, you can cast the <xref:System.IAsyncResult>, which is the only parameter of the callback method, to an <xref:System.Runtime.Remoting.Messaging.AsyncResult> object.</span></span> <span data-ttu-id="6e3e3-158">È quindi possibile usare la proprietà <xref:System.Runtime.Remoting.Messaging.AsyncResult.AsyncDelegate%2A?displayProperty=nameWithType> per ottenere il delegato usato per avviare la chiamata in modo che sia possibile chiamare `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-158">You can then use the <xref:System.Runtime.Remoting.Messaging.AsyncResult.AsyncDelegate%2A?displayProperty=nameWithType> property to get the delegate that was used to initiate the call so that you can call `EndInvoke`.</span></span>

 <span data-ttu-id="6e3e3-159">Note sull'esempio:</span><span class="sxs-lookup"><span data-stu-id="6e3e3-159">Notes on the example:</span></span>

- <span data-ttu-id="6e3e3-160">Il `threadId` parametro di `TestMethod` è un `out` parametro ([ `<Out>` `ByRef` in Visual Basic), pertanto il valore di input non viene mai usato da `TestMethod` .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-160">The `threadId` parameter of `TestMethod` is an `out` parameter ([`<Out>` `ByRef` in Visual Basic), so its input value is never used by `TestMethod`.</span></span> <span data-ttu-id="6e3e3-161">Viene passata una variabile fittizia alla chiamata `BeginInvoke` .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-161">A dummy variable is passed to the `BeginInvoke` call.</span></span> <span data-ttu-id="6e3e3-162">Se il parametro `threadId` fosse un parametro `ref` (`ByRef` in Visual Basic), la variabile dovrebbe essere un campo a livello di classe perché possa essere passata sia a `BeginInvoke` che a `EndInvoke`.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-162">If the `threadId` parameter were a `ref` parameter (`ByRef` in Visual Basic), the variable would have to be a class-level field so that it could be passed to both `BeginInvoke` and `EndInvoke`.</span></span>

- <span data-ttu-id="6e3e3-163">Le informazioni sullo stato che vengono passate a `BeginInvoke` sono costituite da una stringa di formato, che viene usata dal metodo di callback per formattare un messaggio di output.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-163">The state information that is passed to `BeginInvoke` is a format string, which the callback method uses to format an output message.</span></span> <span data-ttu-id="6e3e3-164">Dato che le informazioni sullo stato vengono passate come tipo <xref:System.Object>, è necessario eseguirne il cast al tipo appropriato prima di poterle usare.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-164">Because it is passed as type <xref:System.Object>, the state information must be cast to its proper type before it can be used.</span></span>

- <span data-ttu-id="6e3e3-165">Il callback viene eseguito su un thread <xref:System.Threading.ThreadPool> .</span><span class="sxs-lookup"><span data-stu-id="6e3e3-165">The callback is made on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="6e3e3-166">I thread<xref:System.Threading.ThreadPool> sono thread in background, che non mantengono l'applicazione in esecuzione se il thread principale termina, quindi il thread principale dell'esempio deve rimanere sospeso per un tempo sufficiente al completamento del callback.</span><span class="sxs-lookup"><span data-stu-id="6e3e3-166"><xref:System.Threading.ThreadPool> threads are background threads, which do not keep the application running if the main thread ends, so the main thread of the example has to sleep long enough for the callback to finish.</span></span>

 [!code-cpp[AsyncDelegateExamples#5](../../../samples/snippets/cpp/VS_Snippets_CLR/AsyncDelegateExamples/cpp/callback.cpp#5)]
 [!code-csharp[AsyncDelegateExamples#5](../../../samples/snippets/csharp/VS_Snippets_CLR/AsyncDelegateExamples/CS/callback.cs#5)]
 [!code-vb[AsyncDelegateExamples#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/AsyncDelegateExamples/VB/callback.vb#5)]

## <a name="see-also"></a><span data-ttu-id="6e3e3-167">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="6e3e3-167">See also</span></span>

- <xref:System.Delegate>
- <span data-ttu-id="6e3e3-168">[Event-based Asynchronous Pattern (EAP)](event-based-asynchronous-pattern-eap.md) (Modello asincrono basato su eventi, EAP)</span><span class="sxs-lookup"><span data-stu-id="6e3e3-168">[Event-based Asynchronous Pattern (EAP)](event-based-asynchronous-pattern-eap.md)</span></span>
