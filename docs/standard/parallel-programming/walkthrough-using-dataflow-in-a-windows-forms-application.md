---
title: "Procedura dettagliata: Uso del flusso di dati in un'applicazione Windows Forms"
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
ms.openlocfilehash: 7cd82ffde5fccf938027a6ab6ea15fef226fef6f
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/02/2020
ms.locfileid: "84288433"
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="41a27-102">Procedura dettagliata: Uso del flusso di dati in un'applicazione Windows Forms</span><span class="sxs-lookup"><span data-stu-id="41a27-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>
<span data-ttu-id="41a27-103">Questo documento illustra come creare una rete di blocchi di flussi di dati tramite cui viene eseguita l'elaborazione di immagini in una Windows Forms Application.</span><span class="sxs-lookup"><span data-stu-id="41a27-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="41a27-104">Questo esempio carica i file di immagine dalla cartella specificata, crea un'immagine composita e visualizza il risultato.</span><span class="sxs-lookup"><span data-stu-id="41a27-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="41a27-105">L'esempio utilizza il modello di flusso di dati per instradare le immagini tramite la rete.</span><span class="sxs-lookup"><span data-stu-id="41a27-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="41a27-106">Nel modello del flusso di dati, i componenti indipendenti di un programma di comunicano tra loro mediante l'invio di messaggi.</span><span class="sxs-lookup"><span data-stu-id="41a27-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="41a27-107">Quando un componente riceve un messaggio, esegue una determinata azione e quindi passa il risultato a un altro componente.</span><span class="sxs-lookup"><span data-stu-id="41a27-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="41a27-108">Confrontare questo modello con il modello di flusso di controllo, in cui un'applicazione utilizza le strutture di controllo, ad esempio le istruzioni condizionali, i cicli e così via, per controllare l'ordine delle operazioni in un programma.</span><span class="sxs-lookup"><span data-stu-id="41a27-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="41a27-109">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="41a27-109">Prerequisites</span></span>  
 <span data-ttu-id="41a27-110">Prima di iniziare questa procedura dettagliata, leggere [Flusso di dati](dataflow-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="41a27-110">Read [Dataflow](dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="sections"></a><span data-ttu-id="41a27-111">Sezioni</span><span class="sxs-lookup"><span data-stu-id="41a27-111">Sections</span></span>  
 <span data-ttu-id="41a27-112">Questa procedura dettagliata contiene le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="41a27-112">This walkthrough contains the following sections:</span></span>  
  
- [<span data-ttu-id="41a27-113">Creazione di Windows Forms Application</span><span class="sxs-lookup"><span data-stu-id="41a27-113">Creating the Windows Forms Application</span></span>](#winforms)  
  
- [<span data-ttu-id="41a27-114">Creazione della rete del flusso di dati</span><span class="sxs-lookup"><span data-stu-id="41a27-114">Creating the Dataflow Network</span></span>](#network)  
  
- [<span data-ttu-id="41a27-115">Connessione della rete del flusso dati all'interfaccia utente</span><span class="sxs-lookup"><span data-stu-id="41a27-115">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
- [<span data-ttu-id="41a27-116">Esempio completo</span><span class="sxs-lookup"><span data-stu-id="41a27-116">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>
## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="41a27-117">Creazione di Windows Forms Application</span><span class="sxs-lookup"><span data-stu-id="41a27-117">Creating the Windows Forms Application</span></span>  
 <span data-ttu-id="41a27-118">In questa sezione viene descritto come creare la Windows Forms Application di base e aggiungere i controlli al modulo principale.</span><span class="sxs-lookup"><span data-stu-id="41a27-118">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="41a27-119">Per creare l'applicazione Windows Forms</span><span class="sxs-lookup"><span data-stu-id="41a27-119">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="41a27-120">In Visual Studio creare un progetto **Applicazione Windows Form** di Visual C# o Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="41a27-120">In Visual Studio, create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="41a27-121">In questo documento, il progetto viene denominato `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="41a27-121">In this document, the project is named `CompositeImages`.</span></span>  
  
2. <span data-ttu-id="41a27-122">Nella finestra di progettazione del form per il form principale, Form1.cs (Form1.vb per Visual Basic), aggiungere un controllo <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="41a27-122">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3. <span data-ttu-id="41a27-123">Aggiungere un controllo <xref:System.Windows.Forms.ToolStripButton> al controllo <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="41a27-123">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="41a27-124">Impostare la proprietà <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> su <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> e la proprietà <xref:System.Windows.Forms.ToolStripItem.Text%2A> su **Scegli cartella**.</span><span class="sxs-lookup"><span data-stu-id="41a27-124">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4. <span data-ttu-id="41a27-125">Aggiungere un secondo controllo <xref:System.Windows.Forms.ToolStripButton> al controllo <xref:System.Windows.Forms.ToolStrip>.</span><span class="sxs-lookup"><span data-stu-id="41a27-125">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="41a27-126">Impostare la proprietà <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> su <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, la proprietà <xref:System.Windows.Forms.ToolStripItem.Text%2A> su **Annulla** e la proprietà <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> su `False`.</span><span class="sxs-lookup"><span data-stu-id="41a27-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5. <span data-ttu-id="41a27-127">Aggiungere un oggetto <xref:System.Windows.Forms.PictureBox> al form principale.</span><span class="sxs-lookup"><span data-stu-id="41a27-127">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="41a27-128">Impostare la proprietà <xref:System.Windows.Forms.Control.Dock%2A> su <xref:System.Windows.Forms.DockStyle.Fill>.</span><span class="sxs-lookup"><span data-stu-id="41a27-128">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>
## <a name="creating-the-dataflow-network"></a><span data-ttu-id="41a27-129">Creazione della rete del flusso di dati</span><span class="sxs-lookup"><span data-stu-id="41a27-129">Creating the Dataflow Network</span></span>  
 <span data-ttu-id="41a27-130">In questa sezione viene descritto come creare la rete del flusso di dati che esegue l'elaborazione delle immagini.</span><span class="sxs-lookup"><span data-stu-id="41a27-130">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="41a27-131">Per creare la rete del flusso di dati</span><span class="sxs-lookup"><span data-stu-id="41a27-131">To Create the Dataflow Network</span></span>  
  
1. <span data-ttu-id="41a27-132">Nel progetto aggiungere un riferimento a System.Threading.Tasks.Dataflow.dll.</span><span class="sxs-lookup"><span data-stu-id="41a27-132">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2. <span data-ttu-id="41a27-133">Assicurarsi che in Form1.cs (Form1.vb per Visual Basic) siano contenute le seguenti istruzioni `using` (`Using` in Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="41a27-133">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` (`Using` in Visual Basic) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3. <span data-ttu-id="41a27-134">Aggiungere i membri dei dati seguenti alla classe `Form1`:</span><span class="sxs-lookup"><span data-stu-id="41a27-134">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4. <span data-ttu-id="41a27-135">Aggiungere il metodo `CreateImageProcessingNetwork` seguente alla classe `Form1`.</span><span class="sxs-lookup"><span data-stu-id="41a27-135">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="41a27-136">Questo metodo crea una rete di elaborazione delle immagini.</span><span class="sxs-lookup"><span data-stu-id="41a27-136">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5. <span data-ttu-id="41a27-137">Implementare il metodo `LoadBitmaps`.</span><span class="sxs-lookup"><span data-stu-id="41a27-137">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6. <span data-ttu-id="41a27-138">Implementare il metodo `CreateCompositeBitmap`.</span><span class="sxs-lookup"><span data-stu-id="41a27-138">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    > <span data-ttu-id="41a27-139">La versione C# del metodo `CreateCompositeBitmap` usa puntatori per abilitare l'elaborazione efficiente degli oggetti <xref:System.Drawing.Bitmap?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="41a27-139">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="41a27-140">Pertanto, è necessario abilitare l'opzione **Consenti codice di tipo unsafe** nel progetto per utilizzare la parola chiave [unsafe](../../csharp/language-reference/keywords/unsafe.md).</span><span class="sxs-lookup"><span data-stu-id="41a27-140">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](../../csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="41a27-141">Per altre informazioni su come abilitare il codice unsafe in un progetto Visual C#, vedere [Pagina Compilazione, Creazione progetti (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span><span class="sxs-lookup"><span data-stu-id="41a27-141">For more information about how to enable unsafe code in a Visual C# project, see [Build Page, Project Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span></span>  
  
 <span data-ttu-id="41a27-142">Nella tabella seguente vengono descritti i membri della rete.</span><span class="sxs-lookup"><span data-stu-id="41a27-142">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="41a27-143">Membro</span><span class="sxs-lookup"><span data-stu-id="41a27-143">Member</span></span>|<span data-ttu-id="41a27-144">Type</span><span class="sxs-lookup"><span data-stu-id="41a27-144">Type</span></span>|<span data-ttu-id="41a27-145">Descrizione</span><span class="sxs-lookup"><span data-stu-id="41a27-145">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="41a27-146">Accetta il percorso di una cartella come input e genera una raccolta di oggetti <xref:System.Drawing.Bitmap> come output.</span><span class="sxs-lookup"><span data-stu-id="41a27-146">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="41a27-147">Accetta una raccolta di oggetti <xref:System.Drawing.Bitmap> come input e genera una bitmap composita come output.</span><span class="sxs-lookup"><span data-stu-id="41a27-147">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="41a27-148">Visualizza il bitmap composito nel modulo.</span><span class="sxs-lookup"><span data-stu-id="41a27-148">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="41a27-149">Visualizza un'immagine per indicare che l'operazione è annullata e consente all'utente di selezionare un'altra cartella.</span><span class="sxs-lookup"><span data-stu-id="41a27-149">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="41a27-150">Per connettere i blocchi di flussi di dati per formare una rete, questo esempio usa il metodo <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A>.</span><span class="sxs-lookup"><span data-stu-id="41a27-150">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="41a27-151">Il metodo <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> contiene una versione di overload che accetta un oggetto <xref:System.Predicate%601> che determina se il blocco di destinazione accetta o rifiuta un messaggio.</span><span class="sxs-lookup"><span data-stu-id="41a27-151">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="41a27-152">Questo processo di filtraggio consente ai blocchi di messaggi di ricevere solo certi valori.</span><span class="sxs-lookup"><span data-stu-id="41a27-152">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="41a27-153">In questo esempio, la rete può creare un ramo in due modi.</span><span class="sxs-lookup"><span data-stu-id="41a27-153">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="41a27-154">Il ramo principale carica le immagini dal disco, crea un'immagine composita e visualizza tale immagine nel modulo.</span><span class="sxs-lookup"><span data-stu-id="41a27-154">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="41a27-155">Il ramo alternativo annulla l'operazione in corso.</span><span class="sxs-lookup"><span data-stu-id="41a27-155">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="41a27-156">Gli oggetti <xref:System.Predicate%601> consentono ai blocchi di flussi di dati lungo il ramo principale di passare al ramo alternativo rifiutando determinati messaggi.</span><span class="sxs-lookup"><span data-stu-id="41a27-156">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="41a27-157">Ad esempio, se l'utente annulla l'operazione, il blocco del flusso di dati `createCompositeBitmap` genera `null` (`Nothing` in Visual Basic) come output.</span><span class="sxs-lookup"><span data-stu-id="41a27-157">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in Visual Basic) as its output.</span></span> <span data-ttu-id="41a27-158">Il blocco del flusso di dati `displayCompositeBitmap` rifiuta i valori di input `null` e pertanto, il messaggio viene offerto a `operationCancelled`.</span><span class="sxs-lookup"><span data-stu-id="41a27-158">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="41a27-159">Il blocco del flusso di dati `operationCancelled` accetta tutti i messaggi e visualizza quindi un'immagine per indicare che l'operazione viene annullata.</span><span class="sxs-lookup"><span data-stu-id="41a27-159">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="41a27-160">Nella figura seguente viene illustrata la rete di elaborazione delle immagini:</span><span class="sxs-lookup"><span data-stu-id="41a27-160">The following illustration shows the image processing network:</span></span>  
  
 ![Figura che illustra la rete di elaborazione delle immagini.](./media/walkthrough-using-dataflow-in-a-windows-forms-application/dataflow-winforms-image-processing.png)  
  
 <span data-ttu-id="41a27-162">Poiché i blocchi di flussi di dati `displayCompositeBitmap` e `operationCancelled` vengono usati nell'interfaccia utente, è importante che queste azioni si verifichino nel thread di interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="41a27-162">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="41a27-163">A questo scopo, durante la costruzione ognuno di questi oggetti fornisce un oggetto <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> la cui proprietà <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> è impostata su <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="41a27-163">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="41a27-164">Tramite il metodo <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> viene creato un oggetto <xref:System.Threading.Tasks.TaskScheduler> mediante il quale viene eseguito il lavoro nel contesto di sincronizzazione corrente.</span><span class="sxs-lookup"><span data-stu-id="41a27-164">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="41a27-165">Poiché il metodo `CreateImageProcessingNetwork` viene chiamato dal gestore del pulsante **Scegli cartella**, che viene eseguito nel thread di interfaccia utente, anche le azioni per i blocchi di flussi di dati `displayCompositeBitmap` e `operationCancelled` vengono eseguite nel thread di interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="41a27-165">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="41a27-166">Questo esempio usa un token di annullamento condiviso anziché impostare la proprietà <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A>, perché la proprietà <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> annulla in modo permanente l'esecuzione dei blocchi di flussi di dati.</span><span class="sxs-lookup"><span data-stu-id="41a27-166">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="41a27-167">Un token di annullamento consente in questo esempio di riutilizzare la stessa rete del flusso di dati più volte, anche quando l'utente annulla una o più operazioni.</span><span class="sxs-lookup"><span data-stu-id="41a27-167">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="41a27-168">Per un esempio che usa <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> per annullare in modo permanente l'esecuzione di un blocco di flussi di dati, vedere [Procedura: Annullare un blocco di flussi di dati](how-to-cancel-a-dataflow-block.md).</span><span class="sxs-lookup"><span data-stu-id="41a27-168">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>
## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="41a27-169">Connessione della rete del flusso dati all'interfaccia utente</span><span class="sxs-lookup"><span data-stu-id="41a27-169">Connecting the Dataflow Network to the User Interface</span></span>  
 <span data-ttu-id="41a27-170">In questa sezione viene descritto come connettere la rete del flusso di dati all'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="41a27-170">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="41a27-171">La creazione dell'immagine composita e l'annullamento dell'operazione vengono avviate dai pulsanti **Scegli cartella** e **Annulla**.</span><span class="sxs-lookup"><span data-stu-id="41a27-171">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="41a27-172">Quando l'utente sceglie uno di questi pulsanti, l'azione appropriata viene avviata in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="41a27-172">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="41a27-173">Per connettere la rete del flusso dati all'interfaccia utente</span><span class="sxs-lookup"><span data-stu-id="41a27-173">To Connect the Dataflow Network to the User Interface</span></span>  
  
1. <span data-ttu-id="41a27-174">Nella finestra di progettazione del form principale creare un gestore per l'evento <xref:System.Windows.Forms.ToolStripItem.Click> per il pulsante **Scegli cartella**.</span><span class="sxs-lookup"><span data-stu-id="41a27-174">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2. <span data-ttu-id="41a27-175">Implementare l'evento <xref:System.Windows.Forms.ToolStripItem.Click> per il pulsante **Scegli cartella**.</span><span class="sxs-lookup"><span data-stu-id="41a27-175">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3. <span data-ttu-id="41a27-176">Nella finestra di progettazione del form principale creare un gestore per l'evento <xref:System.Windows.Forms.ToolStripItem.Click> per il pulsante **Annulla**.</span><span class="sxs-lookup"><span data-stu-id="41a27-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4. <span data-ttu-id="41a27-177">Implementare l'evento <xref:System.Windows.Forms.ToolStripItem.Click> per il pulsante **Annulla**.</span><span class="sxs-lookup"><span data-stu-id="41a27-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>
## <a name="the-complete-example"></a><span data-ttu-id="41a27-178">Esempio completo</span><span class="sxs-lookup"><span data-stu-id="41a27-178">The Complete Example</span></span>  
 <span data-ttu-id="41a27-179">Nell'esempio riportato di seguito viene illustrato il codice completo per questa procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="41a27-179">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="41a27-180">La figura seguente mostra un output tipico per la cartella common\Sample Pictures\.</span><span class="sxs-lookup"><span data-stu-id="41a27-180">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="41a27-181">![Applicazione Windows Form](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="41a27-181">![The Windows Forms Application](media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  

## <a name="see-also"></a><span data-ttu-id="41a27-182">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="41a27-182">See also</span></span>

- [<span data-ttu-id="41a27-183">Flusso di dati</span><span class="sxs-lookup"><span data-stu-id="41a27-183">Dataflow</span></span>](dataflow-task-parallel-library.md)
