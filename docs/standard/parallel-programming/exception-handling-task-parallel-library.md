---
title: Gestione delle eccezioni (Task Parallel Library)
ms.date: 04/20/2020
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, exceptions
ms.assetid: beb51e50-9061-4d3d-908c-56a4f7c2e8c1
ms.openlocfilehash: aa6d4b706eb11921ffd419402bcf4cf059a29b11
ms.sourcegitcommit: 348bb052d5cef109a61a3d5253faa5d7167d55ac
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/22/2020
ms.locfileid: "82021507"
---
# <a name="exception-handling-task-parallel-library"></a><span data-ttu-id="a5d50-102">Gestione delle eccezioni (Task Parallel Library)</span><span class="sxs-lookup"><span data-stu-id="a5d50-102">Exception handling (Task Parallel Library)</span></span>

<span data-ttu-id="a5d50-103">Salvo in determinati scenari descritti più avanti in questo argomento, le eccezioni non gestite generate da codice utente in esecuzione in un'attività vengono propagate nel thread di unione.</span><span class="sxs-lookup"><span data-stu-id="a5d50-103">Unhandled exceptions that are thrown by user code that is running inside a task are propagated back to the calling thread, except in certain scenarios that are described later in this topic.</span></span> <span data-ttu-id="a5d50-104">Le eccezioni vengono propagate quando si usa uno dei metodi <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> di istanza e li si gestisce includendo la chiamata in un'istruzione `try`/`catch`.</span><span class="sxs-lookup"><span data-stu-id="a5d50-104">Exceptions are propagated when you use one of the static or instance <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> methods, and you handle them by enclosing the call in a `try`/`catch` statement.</span></span> <span data-ttu-id="a5d50-105">Se un'attività è il padre di attività figlio connesse o se si è in attesa di più attività, potrebbero essere generate più eccezioni.</span><span class="sxs-lookup"><span data-stu-id="a5d50-105">If a task is the parent of attached child tasks, or if you are waiting on multiple tasks, multiple exceptions could be thrown.</span></span>

<span data-ttu-id="a5d50-106">Per propagare tutte le eccezioni nel thread chiamante, l'infrastruttura di Task ne esegue il wrapping in un'istanza di <xref:System.AggregateException> .</span><span class="sxs-lookup"><span data-stu-id="a5d50-106">To propagate all the exceptions back to the calling thread, the Task infrastructure wraps them in an <xref:System.AggregateException> instance.</span></span> <span data-ttu-id="a5d50-107">L'eccezione <xref:System.AggregateException> ha una proprietà <xref:System.AggregateException.InnerExceptions%2A> che può essere enumerata per esaminare tutte le eccezioni originali generate e per gestire (o non gestire) individualmente ognuna di esse.</span><span class="sxs-lookup"><span data-stu-id="a5d50-107">The <xref:System.AggregateException> exception has an <xref:System.AggregateException.InnerExceptions%2A> property that can be enumerated to examine all the original exceptions that were thrown, and handle (or not handle) each one individually.</span></span> <span data-ttu-id="a5d50-108">È anche possibile gestire le eccezioni originali usando il metodo <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a5d50-108">You can also handle the original exceptions by using the <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="a5d50-109">Anche se viene generata un'unica eccezione, il sistema ne esegue comunque il wrapping in un oggetto <xref:System.AggregateException> , come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="a5d50-109">Even if only one exception is thrown, it is still wrapped in an <xref:System.AggregateException> exception, as the following example shows.</span></span>

[!code-csharp[TPL_Exceptions#21](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/handling21.cs#21)]
[!code-vb[TPL_Exceptions#21](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/handling21.vb#21)]

<span data-ttu-id="a5d50-110">È possibile evitare un'eccezione non gestita rilevando solo l'oggetto <xref:System.AggregateException> senza osservare alcuna eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="a5d50-110">You could avoid an unhandled exception by just catching the <xref:System.AggregateException> and not observing any of the inner exceptions.</span></span> <span data-ttu-id="a5d50-111">Tuttavia, è consigliabile evitare questo approccio perché è analogo al rilevamento del tipo <xref:System.Exception> di base negli scenari senza parallelismo.</span><span class="sxs-lookup"><span data-stu-id="a5d50-111">However, we recommend that you do not do this because it is analogous to catching the base <xref:System.Exception> type in non-parallel scenarios.</span></span> <span data-ttu-id="a5d50-112">Rilevare un'eccezione senza intraprendere azioni specifiche per gestirla può lasciare il programma in uno stato indeterminato.</span><span class="sxs-lookup"><span data-stu-id="a5d50-112">To catch an exception without taking specific actions to recover from it can leave your program in an indeterminate state.</span></span>

<span data-ttu-id="a5d50-113">Se non si vuole chiamare il metodo <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> per attendere il completamento dell'attività, è anche possibile recuperare l'eccezione <xref:System.AggregateException> dalla proprietà <xref:System.Threading.Tasks.Task.Exception%2A> dell'attività, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="a5d50-113">If you do not want to call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to wait for a task's completion, you can also retrieve the <xref:System.AggregateException> exception from the task's <xref:System.Threading.Tasks.Task.Exception%2A> property, as the following example shows.</span></span> <span data-ttu-id="a5d50-114">Per altre informazioni, vedere la sezione [Osservazione delle eccezioni tramite la sezione della proprietà Task.Exception](#observing-exceptions-by-using-the-taskexception-property) in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="a5d50-114">For more information, see the [Observing exceptions by using the Task.Exception property](#observing-exceptions-by-using-the-taskexception-property) section in this topic.</span></span>

[!code-csharp[TPL_Exceptions#29](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/handling22.cs#29)]
[!code-vb[TPL_Exceptions#29](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/handling22.vb#29)]

<span data-ttu-id="a5d50-115">Se non si resta in attesa di un'attività che propaga un'eccezione o se si accede alla relativa proprietà <xref:System.Threading.Tasks.Task.Exception%2A> , il sistema esegue l'escalation dell'eccezione in base ai criteri delle eccezioni di .NET quando l'attività viene raccolta nel Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="a5d50-115">If you do not wait on a task that propagates an exception, or access its <xref:System.Threading.Tasks.Task.Exception%2A> property, the exception is escalated according to the .NET exception policy when the task is garbage-collected.</span></span>

<span data-ttu-id="a5d50-116">Quando alle eccezioni è consentita la propagazione fino al thread di unione, un'attività potrebbe continuare a elaborare alcuni elementi dopo la generazione dell'eccezione.</span><span class="sxs-lookup"><span data-stu-id="a5d50-116">When exceptions are allowed to bubble up back to the joining thread, it is possible that a task may continue to process some items after the exception is raised.</span></span>

> [!NOTE]
> <span data-ttu-id="a5d50-117">Quando "Just My Code" è abilitato, Visual Studio in alcuni casi si interromperà in corrispondenza della riga che genera l'eccezione e visualizzerà un messaggio di errore simile a "Eccezione non gestita dal codice utente".</span><span class="sxs-lookup"><span data-stu-id="a5d50-117">When "Just My Code" is enabled, Visual Studio in some cases will break on the line that throws the exception and display an error message that says "exception not handled by user code."</span></span> <span data-ttu-id="a5d50-118">Questo errore non è grave.</span><span class="sxs-lookup"><span data-stu-id="a5d50-118">This error is benign.</span></span> <span data-ttu-id="a5d50-119">È possibile premere F5 per continuare e osservare il comportamento di gestione delle eccezioni illustrato in questi esempi.</span><span class="sxs-lookup"><span data-stu-id="a5d50-119">You can press F5 to continue and see the exception-handling behavior that is demonstrated in these examples.</span></span> <span data-ttu-id="a5d50-120">Per impedire l'interruzione di Visual Studio al primo errore, deselezionare semplicemente la casella di controllo **Abilita Just My Code** in **Strumenti, Opzioni, Debug, Generale**.</span><span class="sxs-lookup"><span data-stu-id="a5d50-120">To prevent Visual Studio from breaking on the first error, just uncheck the **Enable Just My Code** checkbox under **Tools, Options, Debugging, General**.</span></span>

## <a name="attached-child-tasks-and-nested-aggregateexceptions"></a><span data-ttu-id="a5d50-121">Attività figlio connesse e oggetti AggregateException annidati</span><span class="sxs-lookup"><span data-stu-id="a5d50-121">Attached child tasks and nested AggregateExceptions</span></span>

<span data-ttu-id="a5d50-122">Se un'attività presenta un'attività figlio connessa che genera un'eccezione, il sistema ne eseguirà il wrapping in un oggetto <xref:System.AggregateException> prima che venga propagata nell'attività padre che a sua volta ne eseguirà il wrapping nel proprio oggetto <xref:System.AggregateException> prima che venga ripropagata al thread chiamante.</span><span class="sxs-lookup"><span data-stu-id="a5d50-122">If a task has an attached child task that throws an exception, that exception is wrapped in an <xref:System.AggregateException> before it is propagated to the parent task, which wraps that exception in its own <xref:System.AggregateException> before it propagates it back to the calling thread.</span></span> <span data-ttu-id="a5d50-123">In casi di questo tipo, nella proprietà <xref:System.AggregateException.InnerExceptions%2A> dell'eccezione <xref:System.AggregateException> rilevata nel metodo <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> o <xref:System.Threading.Tasks.Task.WaitAny%2A> o <xref:System.Threading.Tasks.Task.WaitAll%2A> sono contenute una o più istanze di <xref:System.AggregateException>, non le eccezioni originali che hanno provocato l'errore.</span><span class="sxs-lookup"><span data-stu-id="a5d50-123">In such cases, the <xref:System.AggregateException.InnerExceptions%2A> property of the <xref:System.AggregateException> exception that is caught at the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task.WaitAny%2A>, or <xref:System.Threading.Tasks.Task.WaitAll%2A> method contains one or more <xref:System.AggregateException> instances, not the original exceptions that caused the fault.</span></span> <span data-ttu-id="a5d50-124">Per evitare di dover eseguire l'iterazione di oggetti <xref:System.AggregateException> annidati, è possibile usare il metodo <xref:System.AggregateException.Flatten%2A> per rimuovere tutti gli oggetti <xref:System.AggregateException> annidati, in modo che nella proprietà <xref:System.AggregateException.InnerExceptions%2A?displayProperty=nameWithType> siano contenute le eccezioni originali.</span><span class="sxs-lookup"><span data-stu-id="a5d50-124">To avoid having to iterate over nested <xref:System.AggregateException> exceptions, you can use the <xref:System.AggregateException.Flatten%2A> method to remove all the nested <xref:System.AggregateException> exceptions, so that the <xref:System.AggregateException.InnerExceptions%2A?displayProperty=nameWithType> property contains the original exceptions.</span></span> <span data-ttu-id="a5d50-125">L'esempio seguente applica automaticamente il metodo Flatten alle istanze di <xref:System.AggregateException> annidate e le gestisce in un solo ciclo.</span><span class="sxs-lookup"><span data-stu-id="a5d50-125">In the following example, nested <xref:System.AggregateException> instances are flattened and handled in just one loop.</span></span>

[!code-csharp[TPL_Exceptions#22](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/flatten2.cs#22)]
[!code-vb[TPL_Exceptions#22](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/flatten2.vb#22)]

<span data-ttu-id="a5d50-126">È anche possibile usare il metodo <xref:System.AggregateException.Flatten%2A?displayProperty=nameWithType> per generare nuovamente le eccezioni interne da più istanze di <xref:System.AggregateException> generate da più attività in una singola istanza di <xref:System.AggregateException>, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="a5d50-126">You can also use the <xref:System.AggregateException.Flatten%2A?displayProperty=nameWithType> method to rethrow the inner exceptions from multiple <xref:System.AggregateException> instances thrown by multiple tasks in a single <xref:System.AggregateException> instance, as the following example shows.</span></span>

[!code-csharp[TPL_Exceptions#13](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/taskexceptions2.cs#13)]
[!code-vb[TPL_Exceptions#13](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/taskexceptions2.vb#13)]

## <a name="exceptions-from-detached-child-tasks"></a><span data-ttu-id="a5d50-127">Eccezioni provenienti da attività figlio disconnesse</span><span class="sxs-lookup"><span data-stu-id="a5d50-127">Exceptions from detached child tasks</span></span>

<span data-ttu-id="a5d50-128">Per impostazione predefinita, le attività figlio vengono create come disconnesse.</span><span class="sxs-lookup"><span data-stu-id="a5d50-128">By default, child tasks are created as detached.</span></span> <span data-ttu-id="a5d50-129">Le eccezioni generate dalle attività disconnesse devono essere gestite o generate nuovamente nell'attività padre immediata. A differenza di quanto accade per le attività figlio connesse, tali eccezioni non vengono propagate nel thread chiamante.</span><span class="sxs-lookup"><span data-stu-id="a5d50-129">Exceptions thrown from detached tasks must be handled or rethrown in the immediate parent task; they are not propagated back to the calling thread in the same way as attached child tasks propagated back.</span></span> <span data-ttu-id="a5d50-130">Il padre di primo livello può rigenerare manualmente un'eccezione proveniente da un figlio disconnesso per fare in modo che ne venga eseguito il wrapping in un oggetto <xref:System.AggregateException> e venga propagata nel thread di unione.</span><span class="sxs-lookup"><span data-stu-id="a5d50-130">The topmost parent can manually rethrow an exception from a detached child to cause it to be wrapped in an <xref:System.AggregateException> and propagated back to the calling thread.</span></span>

[!code-csharp[TPL_Exceptions#23](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/detached21.cs#23)]
[!code-vb[TPL_Exceptions#23](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/detached21.vb#23)]

<span data-ttu-id="a5d50-131">Anche se si usa una continuazione per osservare un'eccezione in un'attività figlio, l'eccezione deve comunque essere osservata dall'attività padre.</span><span class="sxs-lookup"><span data-stu-id="a5d50-131">Even if you use a continuation to observe an exception in a child task, the exception still must be observed by the parent task.</span></span>

## <a name="exceptions-that-indicate-cooperative-cancellation"></a><span data-ttu-id="a5d50-132">Eccezioni che indicano un annullamento cooperativo</span><span class="sxs-lookup"><span data-stu-id="a5d50-132">Exceptions that indicate cooperative cancellation</span></span>

<span data-ttu-id="a5d50-133">Quando il codice utente in un'attività risponde a una richiesta di annullamento, la procedura corretta è generare un oggetto <xref:System.OperationCanceledException> che passa il token di annullamento usato per comunicare la richiesta.</span><span class="sxs-lookup"><span data-stu-id="a5d50-133">When user code in a task responds to a cancellation request, the correct procedure is to throw an <xref:System.OperationCanceledException> passing in the cancellation token on which the request was communicated.</span></span> <span data-ttu-id="a5d50-134">Prima di provare a propagare l'eccezione, l'istanza dell'attività confronta il token nell'eccezione con quello che le è stato passato quando è stata creata.</span><span class="sxs-lookup"><span data-stu-id="a5d50-134">Before it attempts to propagate the exception, the task instance compares the token in the exception to the one that was passed to it when it was created.</span></span> <span data-ttu-id="a5d50-135">Se sono uguali, l'attività propaga un oggetto <xref:System.Threading.Tasks.TaskCanceledException> con wrapping nell'oggetto <xref:System.AggregateException>e che può essere visto quando vengono esaminate le eccezioni interne.</span><span class="sxs-lookup"><span data-stu-id="a5d50-135">If they are the same, the task propagates a <xref:System.Threading.Tasks.TaskCanceledException> wrapped in the <xref:System.AggregateException>, and it can be seen when the inner exceptions are examined.</span></span> <span data-ttu-id="a5d50-136">Tuttavia, se il thread di unione non è in attesa dell'attività, questa eccezione specifica non verrà propagata.</span><span class="sxs-lookup"><span data-stu-id="a5d50-136">However, if the calling thread is not waiting on the task, this specific exception will not be propagated.</span></span> <span data-ttu-id="a5d50-137">Per altre informazioni, vedere [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md).</span><span class="sxs-lookup"><span data-stu-id="a5d50-137">For more information, see [Task Cancellation](../../../docs/standard/parallel-programming/task-cancellation.md).</span></span>

[!code-csharp[TPL_Exceptions#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/exceptions.cs#4)]
[!code-vb[TPL_Exceptions#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/tpl_exceptions.vb#4)]

## <a name="using-the-handle-method-to-filter-inner-exceptions"></a><span data-ttu-id="a5d50-138">Uso del metodo Handle per filtrare le eccezioni interne</span><span class="sxs-lookup"><span data-stu-id="a5d50-138">Using the handle method to filter inner exceptions</span></span>

<span data-ttu-id="a5d50-139">È possibile usare il metodo <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> per escludere le eccezioni che è possibile trattare come "gestite" senza dover usare altre risorse di logica.</span><span class="sxs-lookup"><span data-stu-id="a5d50-139">You can use the <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> method to filter out exceptions that you can treat as "handled" without using any further logic.</span></span> <span data-ttu-id="a5d50-140">Nel delegato dell'utente fornito al metodo <xref:System.AggregateException.Handle%28System.Func%7BSystem.Exception%2CSystem.Boolean%7D%29?displayProperty=nameWithType> è possibile esaminare il tipo di eccezione o la relativa proprietà <xref:System.Exception.Message%2A> o qualsiasi altra informazione relativa a essa che consentirà di determinare se è non dannosa.</span><span class="sxs-lookup"><span data-stu-id="a5d50-140">In the user delegate that is supplied to the <xref:System.AggregateException.Handle%28System.Func%7BSystem.Exception%2CSystem.Boolean%7D%29?displayProperty=nameWithType> method, you can examine the exception type, its <xref:System.Exception.Message%2A> property, or any other information about it that will let you determine whether it is benign.</span></span> <span data-ttu-id="a5d50-141">Qualsiasi eccezione per cui viene restituito `false` dal delegato viene generata nuovamente in una nuova istanza di <xref:System.AggregateException> subito dopo la restituzione di un valore da parte del metodo <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a5d50-141">Any exceptions for which the delegate returns `false` are rethrown in a new <xref:System.AggregateException> instance immediately after the <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> method returns.</span></span>

<span data-ttu-id="a5d50-142">L'esempio seguente è funzionalmente equivalente al primo esempio in questo argomento, che esamina ogni eccezione nella raccolta <xref:System.AggregateException.InnerExceptions%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a5d50-142">The following example is functionally equivalent to the first example in this topic, which examines each exception in the <xref:System.AggregateException.InnerExceptions%2A?displayProperty=nameWithType> collection.</span></span>  <span data-ttu-id="a5d50-143">Al contrario, questo gestore di eccezioni chiama l'oggetto del metodo <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> per ogni eccezione e rigenera solo le eccezioni che non sono istanze di `CustomException`.</span><span class="sxs-lookup"><span data-stu-id="a5d50-143">Instead, this exception handler calls the <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> method object for each exception, and only rethrows exceptions that are not `CustomException` instances.</span></span>

[!code-csharp[TPL_Exceptions#26](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/handlemethod21.cs#26)]
[!code-vb[TPL_Exceptions#26](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/handlemethod21.vb#26)]

<span data-ttu-id="a5d50-144">Di seguito è riportato un esempio più completo che usa il metodo <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> per fornire una gestione speciale di un'eccezione <xref:System.UnauthorizedAccessException> durante l'enumerazione dei file.</span><span class="sxs-lookup"><span data-stu-id="a5d50-144">The following is a more complete example that uses the <xref:System.AggregateException.Handle%2A?displayProperty=nameWithType> method to provide special handling for an <xref:System.UnauthorizedAccessException> exception when enumerating files.</span></span>

[!code-csharp[TPL_Exceptions#12](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/taskexceptions.cs#12)]
[!code-vb[TPL_Exceptions#12](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/taskexceptions.vb#12)]

## <a name="observing-exceptions-by-using-the-taskexception-property"></a><span data-ttu-id="a5d50-145">Osservazione delle eccezioni con la proprietà Task.Exception</span><span class="sxs-lookup"><span data-stu-id="a5d50-145">Observing exceptions by using the Task.Exception property</span></span>

<span data-ttu-id="a5d50-146">Se un'attività viene completata con lo stato <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType>, è possibile esaminarne la proprietà <xref:System.Threading.Tasks.Task.Exception%2A> per trovare l'eccezione specifica che ha provocato l'errore.</span><span class="sxs-lookup"><span data-stu-id="a5d50-146">If a task completes in the <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> state, its <xref:System.Threading.Tasks.Task.Exception%2A> property can be examined to discover which specific exception caused the fault.</span></span> <span data-ttu-id="a5d50-147">Un modo efficiente per osservare la proprietà <xref:System.Threading.Tasks.Task.Exception%2A> consiste nell'usare una continuazione che viene eseguita solo se nell'attività precedente si verifica un errore, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="a5d50-147">A good way to observe the <xref:System.Threading.Tasks.Task.Exception%2A> property is to use a continuation that runs only if the antecedent task faults, as shown in the following example.</span></span>

[!code-csharp[TPL_Exceptions#27](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_exceptions/cs/exceptionprop21.cs#27)]
[!code-vb[TPL_Exceptions#27](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_exceptions/vb/exceptionprop21.vb#27)]

<span data-ttu-id="a5d50-148">In un'applicazione significativa, il delegato di continuazione potrebbe registrare informazioni dettagliate sull'eccezione ed eventualmente generare nuove attività per il ripristino dall'eccezione.</span><span class="sxs-lookup"><span data-stu-id="a5d50-148">In a meaningful application, the continuation delegate could log detailed information about the exception and possibly spawn new tasks to recover from the exception.</span></span> <span data-ttu-id="a5d50-149">Se un'attività si verifica un errore, le espressioni seguenti generano l'eccezione:If a task faults, the following expressions throw the exception:</span><span class="sxs-lookup"><span data-stu-id="a5d50-149">If a task faults, the following expressions throw the exception:</span></span>

- `await task`
- `task.Wait()`
- `task.Result`
- `task.GetAwaiter().GetResult()`

<span data-ttu-id="a5d50-150">Utilizzare [`try-catch`](../../csharp/language-reference/keywords/try-catch.md) un'istruzione per gestire e osservare le eccezioni generate.</span><span class="sxs-lookup"><span data-stu-id="a5d50-150">Use a [`try-catch`](../../csharp/language-reference/keywords/try-catch.md) statement to handle and observe thrown exceptions.</span></span> <span data-ttu-id="a5d50-151">In alternativa, osservare l'eccezione accedendo alla <xref:System.Threading.Tasks.Task.Exception%2A?displayProperty=nameWithType> proprietà.</span><span class="sxs-lookup"><span data-stu-id="a5d50-151">Alternatively, observe the exception by accessing the <xref:System.Threading.Tasks.Task.Exception%2A?displayProperty=nameWithType> property.</span></span>

## <a name="unobservedtaskexception-event"></a><span data-ttu-id="a5d50-152">Evento UnobservedTaskException</span><span class="sxs-lookup"><span data-stu-id="a5d50-152">UnobservedTaskException event</span></span>

<span data-ttu-id="a5d50-153">In alcuni scenari, ad esempio durante l'hosting di plug-in non attendibili, le eccezioni benigne potrebbero essere comuni e potrebbe risultare troppo difficile osservarle tutte manualmente.</span><span class="sxs-lookup"><span data-stu-id="a5d50-153">In some scenarios, such as when hosting untrusted plug-ins, benign exceptions might be common, and it might be too difficult to manually observe them all.</span></span> <span data-ttu-id="a5d50-154">In questi casi è possibile gestire l'evento <xref:System.Threading.Tasks.TaskScheduler.UnobservedTaskException?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a5d50-154">In these cases, you can handle the <xref:System.Threading.Tasks.TaskScheduler.UnobservedTaskException?displayProperty=nameWithType> event.</span></span> <span data-ttu-id="a5d50-155">L'istanza di <xref:System.Threading.Tasks.UnobservedTaskExceptionEventArgs?displayProperty=nameWithType> passata al gestore può essere usata per evitare la propagazione dell'eccezione non osservata al thread di unione.</span><span class="sxs-lookup"><span data-stu-id="a5d50-155">The <xref:System.Threading.Tasks.UnobservedTaskExceptionEventArgs?displayProperty=nameWithType> instance that is passed to your handler can be used to prevent the unobserved exception from being propagated back to the joining thread.</span></span>

## <a name="see-also"></a><span data-ttu-id="a5d50-156">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a5d50-156">See also</span></span>

- [<span data-ttu-id="a5d50-157">Task Parallel Library (TPL)</span><span class="sxs-lookup"><span data-stu-id="a5d50-157">Task Parallel Library (TPL)</span></span>](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)
