---
title: Task Parallel Library e programmazione asincrona .NET Framework tradizionale
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, with other asynchronous models
ms.assetid: e7b31170-a156-433f-9f26-b1fc7cd1776f
ms.openlocfilehash: 7db031c655980dd800de77cbbd6a07a0ba94b33b
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/02/2020
ms.locfileid: "84284884"
---
# <a name="tpl-and-traditional-net-framework-asynchronous-programming"></a><span data-ttu-id="0c0e3-102">Task Parallel Library e programmazione asincrona .NET Framework tradizionale</span><span class="sxs-lookup"><span data-stu-id="0c0e3-102">TPL and Traditional .NET Framework Asynchronous Programming</span></span>
<span data-ttu-id="0c0e3-103">.NET Framework offre i due modelli standard seguenti per eseguire operazioni asincrone di solo I/O e di solo calcolo:</span><span class="sxs-lookup"><span data-stu-id="0c0e3-103">The .NET Framework provides the following two standard patterns for performing I/O-bound and compute-bound asynchronous operations:</span></span>  
  
- <span data-ttu-id="0c0e3-104">Modello di programmazione asincrono (APM, Asynchronous Programming Model), in cui le operazioni asincrone sono rappresentate da una coppia di metodi Begin/End come <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType> e <xref:System.IO.Stream.EndRead%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-104">Asynchronous Programming Model (APM), in which asynchronous operations are represented by a pair of Begin/End methods such as <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType> and <xref:System.IO.Stream.EndRead%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="0c0e3-105">Modello asincrono basato su eventi (EAP, Event-based Asynchronous Pattern), in cui le operazioni asincrone sono rappresentate da una coppia metodo/evento denominati *OperationName*Async e *OperationName*Completed, ad esempio, <xref:System.Net.WebClient.DownloadStringAsync%2A?displayProperty=nameWithType> e <xref:System.Net.WebClient.DownloadStringCompleted?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-105">Event-based asynchronous pattern (EAP), in which asynchronous operations are represented by a method/event pair that are named *OperationName*Async and *OperationName*Completed, for example, <xref:System.Net.WebClient.DownloadStringAsync%2A?displayProperty=nameWithType> and <xref:System.Net.WebClient.DownloadStringCompleted?displayProperty=nameWithType>.</span></span> <span data-ttu-id="0c0e3-106">Il modello EAP è stato introdotto in .NET Framework versione 2.0.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-106">(EAP was introduced in the .NET Framework version 2.0.)</span></span>  
  
 <span data-ttu-id="0c0e3-107">È possibile usare Task Parallel Library (TPL) in diversi modi insieme a uno dei due modelli asincroni.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-107">The Task Parallel Library (TPL) can be used in various ways in conjunction with either of the asynchronous patterns.</span></span> <span data-ttu-id="0c0e3-108">È possibile esporre operazioni APM ed EAP come attività nei consumer della libreria oppure esporre i modelli APM ma usare oggetti Task per implementarli internamente.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-108">You can expose both APM and EAP operations as Tasks to library consumers, or you can expose the APM patterns but use Task objects to implement them internally.</span></span> <span data-ttu-id="0c0e3-109">In entrambi gli scenari, usando oggetti Task è possibile semplificare il codice e trarre vantaggio dalle utili funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="0c0e3-109">In both scenarios, by using Task objects, you can simplify the code and take advantage of the following useful functionality:</span></span>  
  
- <span data-ttu-id="0c0e3-110">Registrare callback, sotto forma di continuazioni di attività, in qualsiasi momento dopo l'avvio dell'attività.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-110">Register callbacks, in the form of task continuations, at any time after the task has started.</span></span>  
  
- <span data-ttu-id="0c0e3-111">Coordinare più operazioni eseguite in risposta a un metodo `Begin_`, usando i metodi <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> e <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> il metodo <xref:System.Threading.Tasks.Task.WaitAll%2A> oppure il metodo <xref:System.Threading.Tasks.Task.WaitAny%2A>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-111">Coordinate multiple operations that execute in response to a `Begin_` method, by using the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> and <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> methods, or the <xref:System.Threading.Tasks.Task.WaitAll%2A> method or the <xref:System.Threading.Tasks.Task.WaitAny%2A> method.</span></span>  
  
- <span data-ttu-id="0c0e3-112">Incapsulare operazioni asincrone di solo I/O e di solo calcolo nello stesso oggetto Task.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-112">Encapsulate asynchronous I/O-bound and compute-bound operations in the same Task object.</span></span>  
  
- <span data-ttu-id="0c0e3-113">Monitorare lo stato dell'oggetto Task.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-113">Monitor the status of the Task object.</span></span>  
  
- <span data-ttu-id="0c0e3-114">Eseguire il marshalling dello stato di un'operazione a un oggetto Task usando <xref:System.Threading.Tasks.TaskCompletionSource%601>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-114">Marshal the status of an operation to a Task object by using <xref:System.Threading.Tasks.TaskCompletionSource%601>.</span></span>  
  
## <a name="wrapping-apm-operations-in-a-task"></a><span data-ttu-id="0c0e3-115">Wrapping di operazioni APM in un'attività</span><span class="sxs-lookup"><span data-stu-id="0c0e3-115">Wrapping APM Operations in a Task</span></span>  
 <span data-ttu-id="0c0e3-116">Le classi <xref:System.Threading.Tasks.TaskFactory?displayProperty=nameWithType> e <xref:System.Threading.Tasks.TaskFactory%601?displayProperty=nameWithType> forniscono entrambe diversi overload dei metodi <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A?displayProperty=nameWithType> e <xref:System.Threading.Tasks.TaskFactory%601.FromAsync%2A?displayProperty=nameWithType>, che permettono di incapsulare una coppia di metodi Begin/End APM in un'unica istanza di <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-116">Both the <xref:System.Threading.Tasks.TaskFactory?displayProperty=nameWithType> and <xref:System.Threading.Tasks.TaskFactory%601?displayProperty=nameWithType> classes provide several overloads of the <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.TaskFactory%601.FromAsync%2A?displayProperty=nameWithType> methods that let you encapsulate an APM Begin/End method pair in one <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> instance.</span></span> <span data-ttu-id="0c0e3-117">I diversi overload si adattano a qualsiasi coppia di metodi Begin/End che include da zero a tre parametri di input.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-117">The various overloads accommodate any Begin/End method pair that have from zero to three input parameters.</span></span>  
  
 <span data-ttu-id="0c0e3-118">Per le coppie con metodi `End` che restituiscono un valore (`Function` in Visual Basic), usare i metodi in <xref:System.Threading.Tasks.TaskFactory%601>, che creano un oggetto <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-118">For pairs that have `End` methods that return a value (`Function` in Visual Basic), use the methods in <xref:System.Threading.Tasks.TaskFactory%601> that create a <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="0c0e3-119">Per i metodi `End` che restituiscono void (`Sub` in Visual Basic), usare i metodi in <xref:System.Threading.Tasks.TaskFactory>, che creano un oggetto <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-119">For `End` methods that return void (`Sub` in Visual Basic), use the methods in <xref:System.Threading.Tasks.TaskFactory> that create a <xref:System.Threading.Tasks.Task>.</span></span>  
  
 <span data-ttu-id="0c0e3-120">Per i pochi casi in cui il metodo `Begin` include più di tre parametri o contiene parametri `ref` o `out`, sono disponibili overload `FromAsync` aggiuntivi che incapsulano solo il metodo `End`.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-120">For those few cases in which the `Begin` method has more than three parameters or contains `ref` or `out` parameters, additional `FromAsync` overloads that encapsulate only the `End` method are provided.</span></span>  
  
 <span data-ttu-id="0c0e3-121">L'esempio seguente mostra la firma per l'overload `FromAsync` che corrisponde ai metodi <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType> e <xref:System.IO.FileStream.EndRead%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-121">The following example shows the signature for the `FromAsync` overload that matches the <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType> and <xref:System.IO.FileStream.EndRead%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="0c0e3-122">Questo overload accetta i tre parametri di input seguenti.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-122">This overload takes three input parameters, as follows.</span></span>  
  
 [!code-csharp[FromAsync#01](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#01)]
 [!code-vb[FromAsync#01](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#01)]  
  
 <span data-ttu-id="0c0e3-123">Il primo parametro è un delegato <xref:System.Func%606> che corrisponde alla firma del metodo <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-123">The first parameter is a <xref:System.Func%606> delegate that matches the signature of the <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="0c0e3-124">Il secondo parametro è un delegato <xref:System.Func%602> che accetta un oggetto <xref:System.IAsyncResult> e restituisce un valore `TResult`.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-124">The second parameter is a <xref:System.Func%602> delegate that takes an <xref:System.IAsyncResult> and returns a `TResult`.</span></span> <span data-ttu-id="0c0e3-125">Poiché <xref:System.IO.FileStream.EndRead%2A> restituisce un numero intero, il compilatore deduce il tipo di `TResult` come <xref:System.Int32> e il tipo dell'attività come <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-125">Because <xref:System.IO.FileStream.EndRead%2A> returns an integer, the compiler infers the type of `TResult` as <xref:System.Int32> and the type of the task as <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="0c0e3-126">Gli ultimi quattro parametri sono identici a quelli nel metodo <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType>:</span><span class="sxs-lookup"><span data-stu-id="0c0e3-126">The last four parameters are identical to those in the <xref:System.IO.FileStream.BeginRead%2A?displayProperty=nameWithType> method:</span></span>  
  
- <span data-ttu-id="0c0e3-127">Buffer in cui archiviare i dati del file.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-127">The buffer in which to store the file data.</span></span>  
  
- <span data-ttu-id="0c0e3-128">Offset nel buffer in corrispondenza del quale iniziare a scrivere dati.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-128">The offset in the buffer at which to begin writing data.</span></span>  
  
- <span data-ttu-id="0c0e3-129">Quantità massima di dati da leggere dal file.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-129">The maximum amount of data to read from the file.</span></span>  
  
- <span data-ttu-id="0c0e3-130">Oggetto facoltativo che archivia dati di stato definiti dall'utente da passare al callback.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-130">An optional object that stores user-defined state data to pass to the callback.</span></span>  
  
### <a name="using-continuewith-for-the-callback-functionality"></a><span data-ttu-id="0c0e3-131">Uso di ContinueWith per la funzionalità di callback</span><span class="sxs-lookup"><span data-stu-id="0c0e3-131">Using ContinueWith for the Callback Functionality</span></span>  
 <span data-ttu-id="0c0e3-132">Se è necessario accedere ai dati nel file e non soltanto al numero di byte, il metodo <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A> non è sufficiente.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-132">If you require access to the data in the file, as opposed to just the number of bytes, the <xref:System.Threading.Tasks.TaskFactory.FromAsync%2A> method is not sufficient.</span></span> <span data-ttu-id="0c0e3-133">Usare invece <xref:System.Threading.Tasks.Task>, la cui proprietà `Result` contiene i dati del file.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-133">Instead, use <xref:System.Threading.Tasks.Task>, whose `Result` property contains the file data.</span></span> <span data-ttu-id="0c0e3-134">A questo scopo, è possibile aggiungere una continuazione all'attività originale.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-134">You can do this by adding a continuation to the original task.</span></span> <span data-ttu-id="0c0e3-135">La continuazione esegue le operazioni svolte in genere dal delegato <xref:System.AsyncCallback>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-135">The continuation performs the work that would typically be performed by the <xref:System.AsyncCallback> delegate.</span></span> <span data-ttu-id="0c0e3-136">La continuazione viene richiamata al termine dell'attività precedente e dopo che il buffer di dati è stato completato.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-136">It is invoked when the antecedent completes, and the data buffer has been filled.</span></span> <span data-ttu-id="0c0e3-137">L'oggetto <xref:System.IO.FileStream> deve essere chiuso prima della restituzione.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-137">(The <xref:System.IO.FileStream> object should be closed before returning.)</span></span>  
  
 <span data-ttu-id="0c0e3-138">L'esempio seguente mostra come restituire un oggetto <xref:System.Threading.Tasks.Task> che incapsula la coppia BeginRead/EndRead della classe <xref:System.IO.FileStream>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-138">The following example shows how to return a <xref:System.Threading.Tasks.Task> that encapsulates the BeginRead/EndRead pair of the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[FromAsync#03](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#03)]
 [!code-vb[FromAsync#03](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#03)]  
  
 <span data-ttu-id="0c0e3-139">Il metodo può quindi essere chiamato nel modo seguente.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-139">The method can then be called, as follows.</span></span>  
  
 [!code-csharp[FromAsync#04](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#04)]
 [!code-vb[FromAsync#04](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#04)]  
  
### <a name="providing-custom-state-data"></a><span data-ttu-id="0c0e3-140">Fornire dati di stato personalizzati</span><span class="sxs-lookup"><span data-stu-id="0c0e3-140">Providing Custom State Data</span></span>  
 <span data-ttu-id="0c0e3-141">Nelle tipiche operazioni <xref:System.IAsyncResult> se il delegato <xref:System.AsyncCallback> richiede dati di stato, è necessario passarli attraverso l'ultimo parametro nel metodo `Begin`, in modo che sia possibile creare un pacchetto dei dati nell'oggetto <xref:System.IAsyncResult>, che viene infine passato al metodo di callback.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-141">In typical <xref:System.IAsyncResult> operations, if your <xref:System.AsyncCallback> delegate requires some custom state data, you have to pass it in through the last parameter in the `Begin` method, so that the data can be packaged into the <xref:System.IAsyncResult> object that is eventually passed to the callback method.</span></span> <span data-ttu-id="0c0e3-142">Questo approccio non è in genere necessario quando si usano i metodi `FromAsync`.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-142">This is typically not required when the `FromAsync` methods are used.</span></span> <span data-ttu-id="0c0e3-143">Se i dati personalizzati sono noti alla continuazione, possono essere acquisiti direttamente nel delegato della continuazione.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-143">If the custom data is known to the continuation, then it can be captured directly in the continuation delegate.</span></span> <span data-ttu-id="0c0e3-144">L'esempio seguente assomiglia a quello precedente, ma invece di esaminare la proprietà `Result` dell'attività precedente, la continuazione esamina i dati di stato personalizzati, cui il delegato dell'utente della continuazione può accedere direttamente.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-144">The following example resembles the previous example, but instead of examining the `Result` property of the antecedent, the continuation examines the custom state data that is directly accessible to the user delegate of the continuation.</span></span>  
  
 [!code-csharp[FromAsync#05](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#05)]
 [!code-vb[FromAsync#05](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#05)]  
  
### <a name="synchronizing-multiple-fromasync-tasks"></a><span data-ttu-id="0c0e3-145">Sincronizzazione di più attività FromAsync</span><span class="sxs-lookup"><span data-stu-id="0c0e3-145">Synchronizing Multiple FromAsync Tasks</span></span>  
 <span data-ttu-id="0c0e3-146">I metodi statici <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> e <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> offrono flessibilità aggiunta se vengono usati insieme ai metodi `FromAsync`.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-146">The static <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A> and <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A> methods provide added flexibility when used in conjunction with the `FromAsync` methods.</span></span> <span data-ttu-id="0c0e3-147">L'esempio seguente mostra come avviare più operazioni di I/O asincrone e quindi attenderne il completamento prima di eseguire la continuazione.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-147">The following example shows how to initiate multiple asynchronous I/O operations, and then wait for all of them to complete before you execute the continuation.</span></span>  
  
 [!code-csharp[FromAsync#06](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#06)]
 [!code-vb[FromAsync#06](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#06)]  
  
### <a name="fromasync-tasks-for-only-the-end-method"></a><span data-ttu-id="0c0e3-148">Attività FromAsync solo per il metodo End</span><span class="sxs-lookup"><span data-stu-id="0c0e3-148">FromAsync Tasks For Only the End Method</span></span>  
 <span data-ttu-id="0c0e3-149">Per i pochi casi in cui il metodo `Begin` richiede più di tre parametri di input o include parametri `ref` o `out`, è possibile usare gli overload `FromAsync`, ad esempio <xref:System.Threading.Tasks.TaskFactory%601.FromAsync%28System.IAsyncResult%2CSystem.Func%7BSystem.IAsyncResult%2C%600%7D%29?displayProperty=nameWithType>, che rappresentano solo il metodo `End`.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-149">For those few cases in which the `Begin` method requires more than three input parameters, or has `ref` or `out` parameters, you can use the `FromAsync` overloads, for example, <xref:System.Threading.Tasks.TaskFactory%601.FromAsync%28System.IAsyncResult%2CSystem.Func%7BSystem.IAsyncResult%2C%600%7D%29?displayProperty=nameWithType>, that represent only the `End` method.</span></span> <span data-ttu-id="0c0e3-150">Questi metodi possono essere usati anche in qualsiasi scenario in cui viene passato un oggetto <xref:System.IAsyncResult> e si vuole incapsularlo in un'attività.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-150">These methods can also be used in any scenario in which you are passed an <xref:System.IAsyncResult> and want to encapsulate it in a Task.</span></span>  
  
 [!code-csharp[FromAsync#07](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#07)]
 [!code-vb[FromAsync#07](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#07)]  
  
### <a name="starting-and-canceling-fromasync-tasks"></a><span data-ttu-id="0c0e3-151">Avvio e annullamento di attività FromAsync</span><span class="sxs-lookup"><span data-stu-id="0c0e3-151">Starting and Canceling FromAsync Tasks</span></span>  
 <span data-ttu-id="0c0e3-152">L'attività restituita da un metodo `FromAsync` ha lo stato WaitingForActivation e verrà avviata dal sistema in un determinato momento al termine della sua creazione.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-152">The task returned by a `FromAsync` method has a status of WaitingForActivation and will be started by the system at some point after the task is created.</span></span> <span data-ttu-id="0c0e3-153">Se si tenta di chiamare Start su questa attività, viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-153">If you attempt to call Start on such a task, an exception will be raised.</span></span>  
  
 <span data-ttu-id="0c0e3-154">Non è possibile annullare un'attività `FromAsync`, perché le API di .NET Framework sottostanti non supportano l'annullamento in corso di operazioni di I/O su file o di rete.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-154">You cannot cancel a `FromAsync` task, because the underlying .NET Framework APIs currently do not support in-progress cancellation of file or network I/O.</span></span> <span data-ttu-id="0c0e3-155">È possibile aggiungere la funzionalità di annullamento a un metodo che incapsula una chiamata di `FromAsync`, ma è possibile rispondere all'annullamento prima che `FromAsync` venga chiamato o dopo il suo completamento, ad esempio in un'attività di continuazione.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-155">You can add cancellation functionality to a method that encapsulates a `FromAsync` call, but you can only respond to the cancellation before `FromAsync` is called or after it completed (for example, in a continuation task).</span></span>  
  
 <span data-ttu-id="0c0e3-156">Alcune classi che supportano il modello EAP, ad esempio <xref:System.Net.WebClient>, supportano l'annullamento ed è possibile integrare questa funzionalità di annullamento nativa usando token di annullamento.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-156">Some classes that support EAP, for example, <xref:System.Net.WebClient>, do support cancellation, and you can integrate that native cancellation functionality by using cancellation tokens.</span></span>  
  
## <a name="exposing-complex-eap-operations-as-tasks"></a><span data-ttu-id="0c0e3-157">Esposizione di operazioni EAP complesse come attività</span><span class="sxs-lookup"><span data-stu-id="0c0e3-157">Exposing Complex EAP Operations As Tasks</span></span>  
 <span data-ttu-id="0c0e3-158">TPL non fornisce alcun metodo progettato in modo specifico per incapsulare un'operazione asincrona basata su eventi allo stesso modo in cui la famiglia di metodi `FromAsync` esegue il wrapping del modello <xref:System.IAsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-158">The TPL does not provide any methods that are specifically designed to encapsulate an event-based asynchronous operation in the same way that the `FromAsync` family of methods wrap the <xref:System.IAsyncResult> pattern.</span></span> <span data-ttu-id="0c0e3-159">Tuttavia, TPL fornisce la classe <xref:System.Threading.Tasks.TaskCompletionSource%601?displayProperty=nameWithType>, che può essere usata per rappresentare qualsiasi set arbitrario di operazioni come <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-159">However, the TPL does provide the <xref:System.Threading.Tasks.TaskCompletionSource%601?displayProperty=nameWithType> class, which can be used to represent any arbitrary set of operations as a <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="0c0e3-160">Le operazioni possono essere sincrone o asincrone di solo I/O o di solo calcolo, o di entrambi i tipi.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-160">The operations may be synchronous or asynchronous, and may be I/O bound or compute-bound, or both.</span></span>  
  
 <span data-ttu-id="0c0e3-161">L'esempio seguente mostra come usare un oggetto <xref:System.Threading.Tasks.TaskCompletionSource%601> per esporre un set di operazioni <xref:System.Net.WebClient> asincrone al codice client come <xref:System.Threading.Tasks.Task%601> di base.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-161">The following example shows how to use a <xref:System.Threading.Tasks.TaskCompletionSource%601> to expose a set of asynchronous <xref:System.Net.WebClient> operations to client code as a basic <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="0c0e3-162">Il metodo permette di immettere una matrice di URL Web e un termine o un nome da cercare e quindi restituisce il numero di volte in cui il termine di ricerca è presente in ogni sito.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-162">The method lets you enter an array of Web URLs, and a term or name to search for, and then returns the number of times the search term occurs on each site.</span></span>  
  
 [!code-csharp[FromAsync#10](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/snippet10.cs#10)]
 [!code-vb[FromAsync#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/snippet10.vb#10)]  
  
 <span data-ttu-id="0c0e3-163">Per un esempio più completo, che include gestione aggiuntiva delle eccezioni e mostra come chiamare il metodo dal codice client, vedere [Procedura: Eseguire il wrapping di modelli EAP in un'attività](how-to-wrap-eap-patterns-in-a-task.md).</span><span class="sxs-lookup"><span data-stu-id="0c0e3-163">For a more complete example, which includes additional exception handling and shows how to call the method from client code, see [How to: Wrap EAP Patterns in a Task](how-to-wrap-eap-patterns-in-a-task.md).</span></span>  
  
 <span data-ttu-id="0c0e3-164">Tenere presente che qualsiasi attività creata da <xref:System.Threading.Tasks.TaskCompletionSource%601> verrà avviata da TaskCompletionSource e, di conseguenza, il codice utente non deve chiamare il metodo Start sull'attività.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-164">Remember that any task that is created by a <xref:System.Threading.Tasks.TaskCompletionSource%601> will be started by that TaskCompletionSource and, therefore, user code should not call the Start method on that task.</span></span>  
  
## <a name="implementing-the-apm-pattern-by-using-tasks"></a><span data-ttu-id="0c0e3-165">Implementazione del modello APM usando attività</span><span class="sxs-lookup"><span data-stu-id="0c0e3-165">Implementing the APM Pattern By Using Tasks</span></span>  
 <span data-ttu-id="0c0e3-166">In alcuni scenari può essere opportuno esporre direttamente il modello <xref:System.IAsyncResult> usando coppie di metodi Begin/End in un'API.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-166">In some scenarios, it may be desirable to directly expose the <xref:System.IAsyncResult> pattern by using Begin/End method pairs in an API.</span></span> <span data-ttu-id="0c0e3-167">Ad esempio, si potrebbe voler mantenere la coerenza con le API esistenti o disporre di strumenti automatici che richiedono questo modello.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-167">For example, you may want to maintain consistency with existing APIs, or you may have automated tools that require this pattern.</span></span> <span data-ttu-id="0c0e3-168">In questi casi, è possibile usare attività per semplificare l'implementazione interna del modello APM.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-168">In such cases, you can use Tasks to simplify how the APM pattern is implemented internally.</span></span>  
  
 <span data-ttu-id="0c0e3-169">L'esempio seguente mostra come usare attività per implementare una coppia di metodi Begin/End APM per un metodo di solo calcolo a esecuzione prolungata.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-169">The following example shows how to use tasks to implement an APM Begin/End method pair for a long-running compute-bound method.</span></span>  
  
 [!code-csharp[FromAsync#09](../../../samples/snippets/csharp/VS_Snippets_Misc/fromasync/cs/fromasync.cs#09)]
 [!code-vb[FromAsync#09](../../../samples/snippets/visualbasic/VS_Snippets_Misc/fromasync/vb/module1.vb#09)]  
  
## <a name="using-the-streamextensions-sample-code"></a><span data-ttu-id="0c0e3-170">Uso del codice di esempio StreamExtensions</span><span class="sxs-lookup"><span data-stu-id="0c0e3-170">Using the StreamExtensions Sample Code</span></span>  
 <span data-ttu-id="0c0e3-171">Il file *Streamextensions.cs* , nel repository [.NET standard Parallel Extensions Extras](/samples/dotnet/samples/parallel-programming-extensions-extras-cs/) , contiene diverse implementazioni di riferimento che usano `Task` oggetti per l'I/O di file e di rete asincroni.</span><span class="sxs-lookup"><span data-stu-id="0c0e3-171">The *StreamExtensions.cs* file, in the [.NET Standard parallel extensions extras](/samples/dotnet/samples/parallel-programming-extensions-extras-cs/) repository, contains several reference implementations that use `Task` objects for asynchronous file and network I/O.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="0c0e3-172">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="0c0e3-172">See also</span></span>

- [<span data-ttu-id="0c0e3-173">Task Parallel Library (TPL)</span><span class="sxs-lookup"><span data-stu-id="0c0e3-173">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)
