---
title: Panoramica di BlockingCollection
description: Vedere la pagina relativa a BlockingCollection <T> , una classe di raccolte thread-safe in .NET. Questa classe offre funzionalità quali l'aggiunta simultanea & l'acquisizione di elementi da molti thread.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
ms.openlocfilehash: fc11f6c28a551e56d3bac4c5be9c08a396c0c6b1
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/09/2020
ms.locfileid: "84600802"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="d2f71-104">Panoramica di BlockingCollection</span><span class="sxs-lookup"><span data-stu-id="d2f71-104">BlockingCollection Overview</span></span>
<span data-ttu-id="d2f71-105"><xref:System.Collections.Concurrent.BlockingCollection%601> è una classe di raccolta thread-safe che offre le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="d2f71-105"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
- <span data-ttu-id="d2f71-106">Implementazione del modello Producer-Consumer.</span><span class="sxs-lookup"><span data-stu-id="d2f71-106">An implementation of the Producer-Consumer pattern.</span></span>  
  
- <span data-ttu-id="d2f71-107">Aggiunta e rimozione simultanea di elementi da più thread.</span><span class="sxs-lookup"><span data-stu-id="d2f71-107">Concurrent adding and taking of items from multiple threads.</span></span>  
  
- <span data-ttu-id="d2f71-108">Capacità massima facoltativa.</span><span class="sxs-lookup"><span data-stu-id="d2f71-108">Optional maximum capacity.</span></span>  
  
- <span data-ttu-id="d2f71-109">Operazioni di inserimento e rimozione che si bloccano quando la raccolta è vuota o piena.</span><span class="sxs-lookup"><span data-stu-id="d2f71-109">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
- <span data-ttu-id="d2f71-110">Operazioni "prova" di inserimento e rimozione che non si bloccano o che si bloccano per un periodo di tempo specificato.</span><span class="sxs-lookup"><span data-stu-id="d2f71-110">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
- <span data-ttu-id="d2f71-111">Incapsulamento di qualsiasi tipo di raccolta che implementi <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span><span class="sxs-lookup"><span data-stu-id="d2f71-111">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
- <span data-ttu-id="d2f71-112">Annullamento con token di annullamento.</span><span class="sxs-lookup"><span data-stu-id="d2f71-112">Cancellation with cancellation tokens.</span></span>  
  
- <span data-ttu-id="d2f71-113">Due tipi di enumerazione con `foreach` (`For Each` in Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="d2f71-113">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1. <span data-ttu-id="d2f71-114">Enumerazione di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="d2f71-114">Read-only enumeration.</span></span>  
  
    2. <span data-ttu-id="d2f71-115">Enumerazione che rimuove gli elementi quando vengono enumerati.</span><span class="sxs-lookup"><span data-stu-id="d2f71-115">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="d2f71-116">Supporto di delimitazione e blocco</span><span class="sxs-lookup"><span data-stu-id="d2f71-116">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="d2f71-117"><xref:System.Collections.Concurrent.BlockingCollection%601> supporta delimitazione e blocco.</span><span class="sxs-lookup"><span data-stu-id="d2f71-117"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="d2f71-118">La delimitazione consente di impostare la capacità massima della raccolta.</span><span class="sxs-lookup"><span data-stu-id="d2f71-118">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="d2f71-119">La delimitazione è importante in determinati scenari poiché consente di controllare la dimensione massima della raccolta in memoria, impedendo ai thread Producer di spostarsi troppo oltre i thread Consumer.</span><span class="sxs-lookup"><span data-stu-id="d2f71-119">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="d2f71-120">Più thread o attività possono aggiungere contemporaneamente elementi alla raccolta, e se la raccolta raggiunge la capacità massima specificata, i thread Producer si bloccano fino a quando non viene rimosso un elemento.</span><span class="sxs-lookup"><span data-stu-id="d2f71-120">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="d2f71-121">Più Consumer possono rimuovere contemporaneamente elementi e quando la raccolta diventa vuota, i thread Consumer si bloccano fino a quando un Producer aggiunge un elemento.</span><span class="sxs-lookup"><span data-stu-id="d2f71-121">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="d2f71-122">Un thread Producer può chiamare <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> per indicare che non verranno aggiunti altri elementi.</span><span class="sxs-lookup"><span data-stu-id="d2f71-122">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="d2f71-123">I Consumer monitorano la proprietà <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> per sapere quando la raccolta è vuota e non verranno aggiunti altri elementi.</span><span class="sxs-lookup"><span data-stu-id="d2f71-123">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="d2f71-124">Nell'esempio seguente viene illustrato un semplice BlockingCollection con una capacità delimitata di 100.</span><span class="sxs-lookup"><span data-stu-id="d2f71-124">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="d2f71-125">Un'attività Producer aggiunge elementi alla raccolta, purché una condizione esterna sia true e quindi chiama <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span><span class="sxs-lookup"><span data-stu-id="d2f71-125">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="d2f71-126">L'attività di tipo Consumer accetta elementi finché la proprietà <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> è true.</span><span class="sxs-lookup"><span data-stu-id="d2f71-126">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="d2f71-127">Per un esempio completo, vedere [Procedura: Aggiungere e rimuovere singoli elementi di un oggetto BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="d2f71-127">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="d2f71-128">Operazioni di blocco temporizzate</span><span class="sxs-lookup"><span data-stu-id="d2f71-128">Timed Blocking Operations</span></span>  
 <span data-ttu-id="d2f71-129">Nelle operazioni di blocco temporizzate <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> e <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> sulle raccolte delimitate il metodo tenta di aggiungere o rimuovere un elemento.</span><span class="sxs-lookup"><span data-stu-id="d2f71-129">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="d2f71-130">Se è disponibile un elemento, questo viene posizionato nella variabile che è stata passata per riferimento e il metodo restituisce true.</span><span class="sxs-lookup"><span data-stu-id="d2f71-130">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="d2f71-131">Se dopo un periodo di timeout specificato non viene recuperato alcun elemento, il metodo restituisce false.</span><span class="sxs-lookup"><span data-stu-id="d2f71-131">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="d2f71-132">Il thread è quindi libero di eseguire altre operazioni utili prima di tentare nuovamente di accedere alla raccolta.</span><span class="sxs-lookup"><span data-stu-id="d2f71-132">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="d2f71-133">Per un esempio di accesso con blocco temporizzato, vedere il secondo esempio in [Procedura: Aggiungere e rimuovere singoli elementi di un oggetto BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="d2f71-133">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="d2f71-134">Annullamento di operazioni di aggiunta e rimozione</span><span class="sxs-lookup"><span data-stu-id="d2f71-134">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="d2f71-135">Le operazioni di aggiunta e rimozione solitamente vengono eseguite in un ciclo.</span><span class="sxs-lookup"><span data-stu-id="d2f71-135">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="d2f71-136">È possibile annullare un ciclo passando un <xref:System.Threading.CancellationToken> al metodo <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> o <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> e quindi controllando il valore della proprietà <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> del token in ogni iterazione.</span><span class="sxs-lookup"><span data-stu-id="d2f71-136">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="d2f71-137">Se il valore è true, l'utente deve decidere se rispondere alla richiesta di annullamento cancellando tutte le risorse e uscendo dal ciclo.</span><span class="sxs-lookup"><span data-stu-id="d2f71-137">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="d2f71-138">Nell'esempio seguente viene illustrato un overload di <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> che accetta un token di annullamento e il codice che viene usato:</span><span class="sxs-lookup"><span data-stu-id="d2f71-138">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="d2f71-139">Per un esempio di aggiunta del supporto per l'annullamento, vedere il secondo esempio in [Procedura: Aggiungere e rimuovere singoli elementi di un oggetto BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="d2f71-139">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="d2f71-140">Specifica del tipo di raccolta</span><span class="sxs-lookup"><span data-stu-id="d2f71-140">Specifying the Collection Type</span></span>  
 <span data-ttu-id="d2f71-141">Quando si crea un oggetto <xref:System.Collections.Concurrent.BlockingCollection%601>, è possibile specificare non solo la capacità delimitata ma anche il tipo di raccolta da usare.</span><span class="sxs-lookup"><span data-stu-id="d2f71-141">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="d2f71-142">Ad esempio, è possibile specificare <xref:System.Collections.Concurrent.ConcurrentQueue%601> per il comportamento FIFO (First In, First Out) o <xref:System.Collections.Concurrent.ConcurrentStack%601> per il comportamento LIFO (Last In, First Out).</span><span class="sxs-lookup"><span data-stu-id="d2f71-142">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="d2f71-143">È possibile usare qualsiasi classe di raccolta che implementa l'interfaccia <xref:System.Collections.Concurrent.IProducerConsumerCollection%601>.</span><span class="sxs-lookup"><span data-stu-id="d2f71-143">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="d2f71-144">Il tipo di raccolta predefinito per <xref:System.Collections.Concurrent.BlockingCollection%601> è <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span><span class="sxs-lookup"><span data-stu-id="d2f71-144">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="d2f71-145">L'esempio di codice seguente illustra come creare un oggetto <xref:System.Collections.Concurrent.BlockingCollection%601> di stringhe con capacità 1000, che usa un oggetto <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span><span class="sxs-lookup"><span data-stu-id="d2f71-145">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="d2f71-146">Per altre informazioni, vedere [Procedura: Aggiungere funzionalità di delimitazione e blocco a una raccolta](how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="d2f71-146">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="d2f71-147">Supporto di IEnumerable</span><span class="sxs-lookup"><span data-stu-id="d2f71-147">IEnumerable Support</span></span>  
 <span data-ttu-id="d2f71-148"><xref:System.Collections.Concurrent.BlockingCollection%601> offre un metodo <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> che consente agli utenti di usare `foreach` (`For Each` in Visual Basic) per rimuovere gli elementi fino a quando non viene completata la raccolta, ovvero finché non è vuota e non vengono aggiunti altri elementi.</span><span class="sxs-lookup"><span data-stu-id="d2f71-148"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="d2f71-149">Per altre informazioni, vedere [Procedura: usare ForEach per rimuovere elementi in un oggetto BlockingCollection](how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="d2f71-149">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="d2f71-150">Uso di più oggetti BlockingCollections come uno solo</span><span class="sxs-lookup"><span data-stu-id="d2f71-150">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="d2f71-151">Per gli scenari in cui un Consumer deve rimuovere elementi da più raccolte contemporaneamente, è possibile creare matrici di <xref:System.Collections.Concurrent.BlockingCollection%601> e usare i metodi statici, ad esempio <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> e <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> che eseguiranno operazioni di aggiunta o rimozione in qualsiasi raccolta nella matrice.</span><span class="sxs-lookup"><span data-stu-id="d2f71-151">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="d2f71-152">Se una raccolta è bloccata, il metodo ne cerca immediatamente un'altra finché non ne trova una che può eseguire l'operazione.</span><span class="sxs-lookup"><span data-stu-id="d2f71-152">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="d2f71-153">Per altre informazioni, vedere [Procedura: usare matrici di BlockingCollection in una pipeline](how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="d2f71-153">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d2f71-154">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d2f71-154">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>
- [<span data-ttu-id="d2f71-155">Raccolte e strutture di dati</span><span class="sxs-lookup"><span data-stu-id="d2f71-155">Collections and Data Structures</span></span>](../index.md)
- [<span data-ttu-id="d2f71-156">Raccolte thread-safe</span><span class="sxs-lookup"><span data-stu-id="d2f71-156">Thread-Safe Collections</span></span>](index.md)
